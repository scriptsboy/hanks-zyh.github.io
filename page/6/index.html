<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hanks&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="android,web,node,python">
<meta property="og:type" content="website">
<meta property="og:title" content="Hanks' Blog">
<meta property="og:url" content="http://hanks-zyh.github.io/page/6/index.html">
<meta property="og:site_name" content="Hanks' Blog">
<meta property="og:description" content="android,web,node,python">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hanks' Blog">
<meta name="twitter:description" content="android,web,node,python">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <!-- <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <!-- <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'> -->
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo"></a>
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      
        <a class="main-nav-link" href="/archives">归档</a>
      
        <a class="main-nav-link" href="/daily">日报</a>
      
        <a class="main-nav-link" href="/eye-video">开眼</a>
      
        <a class="main-nav-link" href="/joke">joke</a>
      
        <a class="main-nav-link" href="/picture-fight">斗图</a>
      
        <a class="main-nav-link" href="/atom.xml">RSS</a>
      
    </nav>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/daily" class="mobile-nav-link">日报</a>
  
    <a href="/eye-video" class="mobile-nav-link">开眼</a>
  
    <a href="/joke" class="mobile-nav-link">joke</a>
  
    <a href="/picture-fight" class="mobile-nav-link">斗图</a>
  
    <a href="/atom.xml" class="mobile-nav-link">RSS</a>
  
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap mdl-shadow--2dp">
    <div class="info">
     <div class="content">
       <div>
         <a href="https://github.com/hanks-zyh"><img class="avatar" src="https://avatars2.githubusercontent.com/u/6268322?v=3&s=460" alt="" /></a>
       </div>
       <div class="name">
         <h2 >Hanks</h2>
       </div>
       <p>90后，奋青，Android ……</p>
       <div class="account">
         <div class="account-item">
           <a href="http://weibo.com/u/2359002991"><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f3ik9y4q7hj205k05kdfx.jpg" style="width:40px;height:40px;border-radius: 50%;"></a>
         </div>
         <div class="account-item">
              <a href="http://www.zhihu.com/people/yuhan-zhang-36"><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f3ik7sv63wj205k05k3yg.jpg" style="width:40px;height:40px;border-radius: 50%;"></a>
         </div>
         <div class="account-item">
           <a href="http://hanks.xyz/atom.xml"> <img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f3ik9kk2ctj205k05kt8n.jpg" style="width:40px;height:40px;border-radius: 50%;"></a>
         </div>
       </div>
     </div>
    </div>
  </div>


  
    
  <div class="widget-wrap mdl-shadow--2dp">
    <h3 class="widget-title">最新发布</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/26/node-image-recognition/">Node 识别图片中的文字</a>
          </li>
        
          <li>
            <a href="/2017/03/22/proxy-test/">请求代理</a>
          </li>
        
          <li>
            <a href="/2017/02/16/android-customview-inputmethod/">Android 自定义 view 连接输入法</a>
          </li>
        
          <li>
            <a href="/2017/01/10/android-lua/">Android 与 Lua</a>
          </li>
        
          <li>
            <a href="/2017/01/10/android-markdown-render/">Android 下 Markdown 渲染</a>
          </li>
        
          <li>
            <a href="/2017/01/09/android-webview-font/">Android 中 webview 自定义字体</a>
          </li>
        
          <li>
            <a href="/2016/09/25/slack-bot/">slack bot</a>
          </li>
        
          <li>
            <a href="/2016/09/19/webapp/">让网页更适配移动设备</a>
          </li>
        
          <li>
            <a href="/2016/09/05/weex-2333/">体验 weex —— 写一个表情包应用</a>
          </li>
        
          <li>
            <a href="/2016/08/31/nestedscrollchild/">WebView 实现 NestedScrollingChild</a>
          </li>
        
          <li>
            <a href="/2016/08/29/nestedchildparent/">NestedScrollingParent 实现复杂交互效果</a>
          </li>
        
          <li>
            <a href="/2016/08/04/telegram-bot/">写一个福利 Telegram 机器人</a>
          </li>
        
          <li>
            <a href="/2016/07/31/write-butterkinfe/">写一个 ButterKnife</a>
          </li>
        
          <li>
            <a href="/2016/07/24/edittext-cursor/">多行 EditText 的光标高度问题</a>
          </li>
        
          <li>
            <a href="/2016/07/22/textview-lineheight/">TextView 设置行高并垂直居中</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap mdl-shadow--2dp">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Atom/" style="font-size: 10px;">Atom</a> <a href="/tags/Dagger2/" style="font-size: 10px;">Dagger2</a> <a href="/tags/EditText/" style="font-size: 10px;">EditText</a> <a href="/tags/Express/" style="font-size: 11.67px;">Express</a> <a href="/tags/Fragment/" style="font-size: 10px;">Fragment</a> <a href="/tags/Framework/" style="font-size: 11.67px;">Framework</a> <a href="/tags/HTML-CSS/" style="font-size: 10px;">HTML/CSS</a> <a href="/tags/Jade/" style="font-size: 10px;">Jade</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/tags/LAMP/" style="font-size: 10px;">LAMP</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Lua/" style="font-size: 10px;">Lua</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/NestedScrolling/" style="font-size: 13.33px;">NestedScrolling</a> <a href="/tags/Node-js/" style="font-size: 13.33px;">Node.js</a> <a href="/tags/OS-X/" style="font-size: 10px;">OS X</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/Python/" style="font-size: 11.67px;">Python</a> <a href="/tags/React-Native/" style="font-size: 18.33px;">React-Native</a> <a href="/tags/Refactoring/" style="font-size: 10px;">Refactoring</a> <a href="/tags/Rx/" style="font-size: 10px;">Rx</a> <a href="/tags/RxJava/" style="font-size: 13.33px;">RxJava</a> <a href="/tags/Rxandroid/" style="font-size: 10px;">Rxandroid</a> <a href="/tags/Rxjava/" style="font-size: 11.67px;">Rxjava</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/Scrapy/" style="font-size: 11.67px;">Scrapy</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/SwipeRefreshLayout/" style="font-size: 10px;">SwipeRefreshLayout</a> <a href="/tags/Telegram/" style="font-size: 10px;">Telegram</a> <a href="/tags/TextView/" style="font-size: 10px;">TextView</a> <a href="/tags/Ubuntu/" style="font-size: 16.67px;">Ubuntu</a> <a href="/tags/VPS/" style="font-size: 10px;">VPS</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/Vue-js/" style="font-size: 10px;">Vue.js</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/WebView/" style="font-size: 11.67px;">WebView</a> <a href="/tags/bot/" style="font-size: 10px;">bot</a> <a href="/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/interpolator/" style="font-size: 10px;">interpolator</a> <a href="/tags/leancloud/" style="font-size: 10px;">leancloud</a> <a href="/tags/mac-os/" style="font-size: 10px;">mac os</a> <a href="/tags/slack/" style="font-size: 10px;">slack</a> <a href="/tags/virtualBox/" style="font-size: 10px;">virtualBox</a> <a href="/tags/weex/" style="font-size: 10px;">weex</a> <a href="/tags/代理/" style="font-size: 10px;">代理</a> <a href="/tags/依赖注入/" style="font-size: 10px;">依赖注入</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/学习/" style="font-size: 10px;">学习</a> <a href="/tags/必备知识/" style="font-size: 10px;">必备知识</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/热修复/" style="font-size: 11.67px;">热修复</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/自动化/" style="font-size: 10px;">自动化</a> <a href="/tags/设计/" style="font-size: 10px;">设计</a>
    </div>
  </div>


  
    
  <div class="widget-wrap mdl-shadow--2dp">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://github.com/hanks-zyh">hanks-zyh</a>
          </li>
        
          <li>
            <a href="http://kiya.space">Kiya‘s space</a>
          </li>
        
          <li>
            <a href="http://rocko.xyz/">Rocko&#39;s blog</a>
          </li>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap mdl-shadow--2dp">
    <div class="wx">
      <h3 class="widget-title">微信公众号</h3>
      <img src='http://ww1.sinaimg.cn/large/8c9b876fly1fe0nnlvokpj20by0bywfi.jpg' height="100%" width="100%" >
      <p>搜索公众号: CodeProvider</p>
    </div>
  </div>


  
</aside>
        
        <section id="main" class="mdl-shadow--2dp">
  
    <article id="post-前方高能--Retrofit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/27/前方高能--Retrofit/">前方高能--Retrofit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#Retrofit</p>
<blockquote>
<p>A type-safe REST client for Android and Java</p>
</blockquote>
<hr>
<p>Android中非常有名的网络框架<br><a href="http://square.github.io/retrofit/" target="_blank" rel="external"><strong>官网</strong> ：http://square.github.io/retrofit/</a><br><a href="http://square.github.io/okhttp/" target="_blank" rel="external"><strong>参考项目</strong>： http://square.github.io/okhttp/</a><br><a href="https://github.com/goodev/RetrofitDemo" target="_blank" rel="external"><strong>Android 示例项目</strong>：  https://github.com/goodev/RetrofitDemo</a></p>
<hr>
<p><strong><a href="#">Retrofit</a></strong> vs <strong><a href="#">Volley</a></strong><br><a href="http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/" target="_blank" rel="external">http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/</a><br>提取一张图片<br><img src="http://i.imgur.com/tIdZkl3.png" alt="这里写图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//API</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</div><div class="line">    <span class="meta">@GET</span>(<span class="string">"/jobs"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getJobs</span><span class="params">(Callback&lt;Data&gt; callback)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//RestClient</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestClient</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final <span class="keyword">String</span> BASE_URL = <span class="string">"https://yourapi.host.com"</span>;</div><div class="line">    <span class="keyword">private</span> ApiService apiService;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> RestClient() &#123;</div><div class="line">        Gson gson = <span class="keyword">new</span> <span class="type">GsonBuilder</span>()</div><div class="line">                .registerTypeAdapterFactory(<span class="keyword">new</span> <span class="type">ItemTypeAdapterFactory</span>())</div><div class="line">                .setDateFormat(<span class="string">"yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'SSS'Z'"</span>)</div><div class="line">                .create();</div><div class="line"></div><div class="line">        RestAdapter restAdapter = <span class="keyword">new</span> <span class="type">RestAdapter</span>.Builder()</div><div class="line">                .setLogLevel(RestAdapter.LogLevel.FULL)</div><div class="line">                .setEndpoint(BASE_URL)</div><div class="line">                .setConverter(<span class="keyword">new</span> <span class="type">GsonConverter</span>(gson))</div><div class="line">                .setRequestInterceptor(<span class="keyword">new</span> <span class="type">SessionRequestInterceptor</span>())</div><div class="line">                .setClient(<span class="keyword">new</span> <span class="type">OkClient</span>(MySSLTrust.getUnsafeOkHttpClient()))</div><div class="line">                .build();</div><div class="line"></div><div class="line">        apiService = restAdapter.create(ApiService.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> ApiService getApiService() &#123;</div><div class="line">        <span class="keyword">return</span> apiService;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MySSLTrust 的SSL信任</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySSLTrust</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OkHttpClient <span class="title">getUnsafeOkHttpClient</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// Create a trust manager that does not validate certificate chains</span></div><div class="line">            <span class="keyword">final</span> TrustManager[] trustAllCerts = <span class="keyword">new</span> TrustManager[] &#123;</div><div class="line">                    <span class="keyword">new</span> X509TrustManager() &#123;</div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(java.security.cert.X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(java.security.cert.X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="keyword">public</span> java.security.cert.X509Certificate[] getAcceptedIssuers() &#123;</div><div class="line">                            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">            <span class="comment">// Install the all-trusting trust manager</span></div><div class="line">            <span class="keyword">final</span> SSLContext sslContext = SSLContext.getInstance(<span class="string">"SSL"</span>);</div><div class="line">            sslContext.init(<span class="keyword">null</span>, trustAllCerts, <span class="keyword">new</span> java.security.SecureRandom());</div><div class="line">            <span class="comment">// Create an ssl socket factory with our all-trusting manager</span></div><div class="line">            <span class="keyword">final</span> SSLSocketFactory sslSocketFactory = sslContext.getSocketFactory();</div><div class="line"></div><div class="line">            OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</div><div class="line">            okHttpClient.setSslSocketFactory(sslSocketFactory);</div><div class="line">            okHttpClient.setHostnameVerifier(<span class="keyword">new</span> HostnameVerifier() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String hostname, SSLSession session)</span> </span>&#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> okHttpClient;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * add Headers fro every request</div><div class="line"> * Created by Hanks on 2015/5/18.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionRequestInterceptor</span> <span class="keyword">implements</span> <span class="title">RequestInterceptor</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">intercept</span><span class="params">(RequestFacade request)</span> </span>&#123;</div><div class="line">        <span class="comment">/*request.addHeader("Accept", "application/json;versions=1");</span></div><div class="line">        if(isUserLoggedIn())&#123;</div><div class="line">            request.addHeader("Authorization",getToken());</div><div class="line">        &#125;*/</div><div class="line">            request.addHeader(<span class="string">"Authorization"</span>,<span class="string">"huhu="</span>)；</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>官网的几个例子：<br>API Declaration</p>
<p>Annotations on the interface methods and its parameters indicate how a request will be handled.</p>
<p>REQUEST METHOD</p>
<p>Every method must have an HTTP annotation that provides the request method and relative URL. There are five built-in annotations: GET, POST, PUT, DELETE, and HEAD. The relative URL of the resource is specified in the annotation.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>")</div></pre></td></tr></table></figure></p>
<p>You can also specify query parameters in the URL.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>?<span class="keyword">sort</span>=<span class="keyword">desc</span>")</div></pre></td></tr></table></figure>
<p>URL MANIPULATION</p>
<p>A request URL can be updated dynamically using replacement blocks and parameters on the method. A replacement block is an alphanumeric string surrounded by { and }. A corresponding parameter must be annotated with @Path using the same string.</p>
<p>@GET(“/group/{id}/users”)<br>List<user> groupList(@Path(“id”) int groupId);<br>Query parameters can also be added.<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@GET</span>(<span class="string">"/group/&#123;id&#125;/users"</span>)</div><div class="line">List&lt;User&gt; groupList(<span class="variable">@Path</span>(<span class="string">"id"</span>) int groupId, <span class="variable">@Query</span>(<span class="string">"sort"</span>) String sort);</div></pre></td></tr></table></figure></user></p>
<p>For complex query parameter combinations a Map can be used.<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET(<span class="meta-string">"/group/&#123;id&#125;/users"</span>)</span></div></pre></td></tr></table></figure></p>
<p>List<user> groupList(@Path(“id”) int groupId, @QueryMap Map<string, string=""> options);<br>REQUEST BODY</string,></user></p>
<p>An object can be specified for use as an HTTP request body with the @Body annotation.</p>
<p>@POST(“/users/new”)<br>void createUser(@Body User user, Callback<user> cb);<br>The object will also be converted using the RestAdapter’s converter.</user></p>
<p>FORM ENCODED AND MULTIPART</p>
<p>Methods can also be declared to send form-encoded and multipart data.</p>
<p>Form-encoded data is sent when @FormUrlEncoded is present on the method. Each key-value pair is annotated with @Field containing the name and the object providing the value.</p>
<p>@FormUrlEncoded<br>@POST(“/user/edit”)<br>User updateUser(@Field(“first_name”) String first, @Field(“last_name”) String last);<br>Multipart requests are used when @Multipart is present on the method. Parts are declared using the @Part annotation.</p>
<p>@Multipart<br>@PUT(“/user/photo”)<br>User updateUser(@Part(“photo”) TypedFile photo, @Part(“description”) TypedString description);<br>Multipart parts use the RestAdapter’s converter or they can implement TypedOutput to handle their own serialization.</p>
<p>HEADER MANIPULATION</p>
<p>You can set static headers for a method using the @Headers annotation.<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@Headers</span>(<span class="string">"Cache-Control: max-age=640000"</span>)</div><div class="line"><span class="variable">@GET</span>(<span class="string">"/widget/list"</span>)</div><div class="line">List&lt;Widget&gt; widgetList();</div><div class="line"><span class="variable">@Headers</span>(&#123;</div><div class="line">    <span class="string">"Accept: application/vnd.github.v3.full+json"</span>,</div><div class="line">    <span class="string">"User-Agent: Retrofit-Sample-App"</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/&#123;<span class="selector-tag">username</span>&#125;")</div></pre></td></tr></table></figure>
<p>User getUser(@Path(“username”) String username);<br>Note that headers do not overwrite each other. All headers with the same name will be included in the request.</p>
<p>A request Header can be updated dynamically using the @Header annotation. A corresponding parameter must be provided to the @Header. If the value is null, the header will be omitted. Otherwise, toString will be called on the value, and the result used.<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@GET</span>(<span class="string">"/user"</span>)</div><div class="line">void getUser(<span class="variable">@Header</span>(<span class="string">"Authorization"</span>) String authorization, Callback&lt;User&gt; callback)</div></pre></td></tr></table></figure></p>
<p>Headers that need to be added to every request can be specified using a RequestInterceptor. The following code creates a RequestInterceptor that will add a User-Agent header to every request.<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">RequestInterceptor requestInterceptor = <span class="keyword">new</span> RequestInterceptor() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">intercept</span><span class="params">(RequestFacade request)</span> </span>&#123;</div><div class="line">    request.addHeader(<span class="string">"User-Agent"</span>, <span class="string">"Retrofit-Sample-App"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">RestAdapter restAdapter = <span class="keyword">new</span> RestAdapter.Builder()</div><div class="line">  .setEndpoint(<span class="string">"https://api.github.com"</span>)</div><div class="line">  .setRequestInterceptor(requestInterceptor)</div><div class="line">  .build();</div></pre></td></tr></table></figure></p>
<p>SYNCHRONOUS VS. ASYNCHRONOUS VS. OBSERVABLE</p>
<p>Methods can be declared for either synchronous or asynchronous execution.</p>
<p>A method with a return type will be executed synchronously.<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET(<span class="meta-string">"/user/&#123;id&#125;/photo"</span>)</span></div></pre></td></tr></table></figure></p>
<p>Photo getUserPhoto(@Path(“id”) int id);<br>Asynchronous execution requires the last parameter of the method be a Callback.<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET(<span class="meta-string">"/user/&#123;id&#125;/photo"</span>)</span></div></pre></td></tr></table></figure></p>
<p>void getUserPhoto(@Path(“id”) int id, Callback<photo> cb);<br>On Android, callbacks will be executed on the main thread. For desktop applications callbacks will happen on the same thread that executed the HTTP request.</photo></p>
<p>Retrofit also integrates RxJava to support methods with a return type of rx.Observable<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET(<span class="meta-string">"/user/&#123;id&#125;/photo"</span>)</span></div></pre></td></tr></table></figure></p>
<p>Observable<photo> getUserPhoto(@Path(“id”) int id);<br>Observable requests are subscribed asynchronously and observed on the same thread that executed the HTTP request. To observe on a different thread (e.g. Android’s main thread) call observeOn(Scheduler) on the returned Observable.</photo></p>
<p><strong>RESPONSE OBJECT TYPE</strong></p>
<p>HTTP responses are automatically converted to a specified type using the RestAdapter’s converter which defaults to JSON. The desired type is declared as the method return type or using the Callback or Observable.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>")</div><div class="line">List&lt;User&gt; userList();</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"/users/list"</span>)</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">userList</span><span class="params">(Callback&lt;List&lt;User&gt;&gt; cb)</span></span>;</div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>")</div><div class="line">Observable&lt;List&lt;User&gt;&gt; userList();</div></pre></td></tr></table></figure>
<p>For access to the raw HTTP response use the Response type.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>")</div><div class="line">Response userList();</div></pre></td></tr></table></figure></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"/users/list"</span>)</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">userList</span><span class="params">(Callback&lt;Response&gt; cb)</span></span>;</div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">GET</span>("/<span class="keyword">users</span>/<span class="keyword">list</span>")</div><div class="line">Observable&lt;Response&gt; userList();</div></pre></td></tr></table></figure>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-android-AdvancedRecyclerview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/24/android-AdvancedRecyclerview/">android-AdvancedRecyclerview</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>演示地址(需梯子):<br><a href="https://www.youtube.com/watch?feature=player_embedded&amp;v=S7cSwMArjUQ" target="_blank" rel="external">https://www.youtube.com/watch?feature=player_embedded&amp;v=S7cSwMArjUQ</a></p>
<hr>
<p>今天主要使用这个库来实现<strong><a href="#"><code>RecyclerView</code></a></strong> 的<strong>[<code>左右滑动item</code></strong>](#)  和 <strong><a href="#"><code>拖拽排序</code></a></strong></p>
<p><img src="http://img.blog.csdn.net/20150524223918616" alt="效果图"><br>Gradle配置<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'com.android.support:recyclerview-v7:22.1.1'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.h6ah4i.android.widget.advrecyclerview:advrecyclerview:0.7.1'</span></div></pre></td></tr></table></figure></p>
<p>接下来我们就可以使用了</p>
<p>####1. 在布局中添加<strong><a href="#"><code>RecyclerView</code></a></strong>控件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- activity_main.xml --&gt;</span></div><div class="line"></div><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recycler_view"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>####2. 初始化<strong><a href="#"><code>RecyclerView</code></a></strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MainActivity</span></div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerView</span>                        mRecyclerView;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerView</span>.<span class="type">LayoutManager</span>          mLayoutManager;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerView</span>.<span class="type">Adapter</span>                mAdapter;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerView</span>.<span class="type">Adapter</span>                mWrappedAdapter;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerViewSwipeManager</span>            mRecyclerViewSwipeManager;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerViewTouchActionGuardManager</span> mRecyclerViewTouchActionGuardManager;</div><div class="line">    <span class="keyword">private</span> <span class="type">RecyclerViewDragDropManager</span>         mRecyclerViewDragDropManager;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="type">List</span>&lt;<span class="type">MyItem</span>&gt; dataList = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;&gt;();</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="comment">//获取RecycleView,创建LayoutManager</span></div><div class="line">        mRecyclerView = (<span class="type">RecyclerView</span>) findViewById(<span class="type">R</span>.id.recycler_view);</div><div class="line">        mLayoutManager = <span class="keyword">new</span> <span class="type">LinearLayoutManager</span>(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        <span class="comment">// touch guard manager 阻止当左右滑动(swipe)item时列表滚动</span></div><div class="line">        mRecyclerViewTouchActionGuardManager = <span class="keyword">new</span> <span class="type">RecyclerViewTouchActionGuardManager</span>();</div><div class="line">        mRecyclerViewTouchActionGuardManager.setInterceptVerticalScrollingWhileAnimationRunning(<span class="literal">true</span>);</div><div class="line">        mRecyclerViewTouchActionGuardManager.setEnabled(<span class="literal">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// drag &amp; drop manager 拖拽排序的manager</span></div><div class="line">        mRecyclerViewDragDropManager = <span class="keyword">new</span> <span class="type">RecyclerViewDragDropManager</span>();</div><div class="line">        mRecyclerViewDragDropManager.setDraggingItemShadowDrawable(</div><div class="line">                (<span class="type">NinePatchDrawable</span>) getResources().getDrawable(<span class="type">R</span>.drawable.material_shadow_z3_xxhdpi));</div><div class="line"></div><div class="line">        <span class="comment">// swipe manager 滑动item的manager</span></div><div class="line">        mRecyclerViewSwipeManager = <span class="keyword">new</span> <span class="type">RecyclerViewSwipeManager</span>();</div><div class="line"></div><div class="line">        <span class="comment">//adapter,这里是模拟数据</span></div><div class="line">        <span class="keyword">for</span>(int i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</div><div class="line">            dataList.add(<span class="keyword">new</span> <span class="type">MyItem</span>(i,<span class="string">"测试数据"</span>+i));</div><div class="line">        &#125;</div><div class="line">        mAdapter  = <span class="keyword">new</span> <span class="type">MyAdapter</span>(dataList);</div><div class="line"></div><div class="line">		<span class="comment">//封装一下adapter</span></div><div class="line">        mWrappedAdapter = mRecyclerViewDragDropManager.createWrappedAdapter(mAdapter);   <span class="comment">//处理一下mAdapter可以拖拽</span></div><div class="line">        mWrappedAdapter = mRecyclerViewSwipeManager.createWrappedAdapter(mWrappedAdapter);      <span class="comment">//处理一下mAdapter可以滑动删除,注意这里的 -变量</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="type">GeneralItemAnimator</span> animator = <span class="keyword">new</span> <span class="type">SwipeDismissItemAnimator</span>();</div><div class="line"></div><div class="line">        <span class="comment">// Change animations are enabled by default since support-v7-recyclerview v22.</span></div><div class="line">        <span class="comment">// Disable the change animation in order to make turning back animation of swiped item works properly.</span></div><div class="line">        animator.setSupportsChangeAnimations(<span class="literal">false</span>);</div><div class="line"></div><div class="line">        mRecyclerView.setLayoutManager(mLayoutManager);</div><div class="line">        mRecyclerView.setAdapter(mWrappedAdapter);  <span class="comment">// 注意设置的是mWrappedAdapter</span></div><div class="line">        mRecyclerView.setItemAnimator(animator);</div><div class="line"></div><div class="line">        <span class="comment">//additional decorations</span></div><div class="line">        <span class="comment">//noinspection StatementWithEmptyBody</span></div><div class="line">        <span class="keyword">if</span> (supportsViewElevation()) &#123;</div><div class="line">            <span class="comment">// Lollipop or later has native drop shadow feature. ItemShadowDecorator is not required.</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mRecyclerView.addItemDecoration(<span class="keyword">new</span> <span class="type">ItemShadowDecorator</span>((<span class="type">NinePatchDrawable</span>) getResources().getDrawable(<span class="type">R</span>.drawable.material_shadow_z3_xxhdpi)));</div><div class="line">        &#125;</div><div class="line">        mRecyclerView.addItemDecoration(<span class="keyword">new</span> <span class="type">SimpleListDividerDecorator</span>(getResources().getDrawable(<span class="type">R</span>.drawable.list_divider), <span class="literal">true</span>));</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span></span></div><div class="line">        <span class="comment">// 初始化的顺序十分重要,这决定了处理Touch事件的优先级</span></div><div class="line">        <span class="comment">// 优先级: TouchActionGuard &gt; Swipe &gt; DragAndDrop</span></div><div class="line">        mRecyclerViewTouchActionGuardManager.attachRecyclerView(mRecyclerView);</div><div class="line">        mRecyclerViewSwipeManager.attachRecyclerView(mRecyclerView);</div><div class="line">        mRecyclerViewDragDropManager.attachRecyclerView(mRecyclerView);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">//判断版本号</span></div><div class="line">    <span class="keyword">private</span> boolean supportsViewElevation() &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="type">Build</span>.<span class="type">VERSION</span>.<span class="type">SDK_INT</span> &gt;= <span class="type">Build</span>.<span class="type">VERSION_CODES</span>.<span class="type">LOLLIPOP</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要注意的问题</p>
<ol>
<li><strong>adapter</strong>的处理</li>
<li>需要将需要用到的<strong>manager</strong> 绑定到<strong>recylerView</strong>上</li>
</ol>
</blockquote>
<h4 id="3-最主要的还是Adapter"><a href="#3-最主要的还是Adapter" class="headerlink" title="3. 最主要的还是Adapter"></a>3. 最主要的还是Adapter</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MyAdapter</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Created by Hanks</div><div class="line"> * Copyright (c) 2015 Nashangban. All rights reserved</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">package</span> app.hanks.com.testadvancerecyclerview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.draggable.DraggableItemAdapter;</div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.draggable.ItemDraggableRange;</div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.draggable.RecyclerViewDragDropManager;</div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.swipeable.RecyclerViewSwipeManager;</div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.swipeable.SwipeableItemAdapter;</div><div class="line"><span class="keyword">import</span> com.h6ah4i.android.widget.advrecyclerview.utils.AbstractDraggableSwipeableItemViewHolder;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Hanks on 2015/5/24.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span></span></div><div class="line">        <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MyAdapter</span>.<span class="title">MyViewHolder</span>&gt;</div><div class="line">        <span class="keyword">implements</span> <span class="title">DraggableItemAdapter</span>&lt;<span class="title">MyAdapter</span>.<span class="title">MyViewHolder</span>&gt;,</div><div class="line">        <span class="title">SwipeableItemAdapter</span>&lt;<span class="title">MyAdapter</span>.<span class="title">MyViewHolder</span>&gt; &#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;MyItem&gt;         dataList;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAdapter</span><span class="params">( List&lt;MyItem&gt; dataList)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dataList = dataList;</div><div class="line">		<span class="comment">//需要设置id</span></div><div class="line">        setHasStableIds(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">//需要设置Id</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> dataList.get(position).getId();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> dataList.get(position).getViewType();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function">MyViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> LayoutInflater inflater = LayoutInflater.from(parent.getContext());</div><div class="line">        View v = inflater.inflate(R.layout.item_list_swipe, parent, <span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(v);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">        MyItem item = dataList.get(position);</div><div class="line">        holder.textView.setText(item.getContent());</div><div class="line"></div><div class="line">        <span class="comment">// set background resource (target view ID: container)</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> dragState = holder.getDragStateFlags();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> swipeState = holder.getSwipeStateFlags();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (((dragState &amp; RecyclerViewDragDropManager.STATE_FLAG_IS_UPDATED) != <span class="number">0</span>) ||</div><div class="line">                ((swipeState &amp; RecyclerViewSwipeManager.STATE_FLAG_IS_UPDATED) != <span class="number">0</span>)) &#123;</div><div class="line">            <span class="keyword">int</span> bgResId;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> ((dragState &amp; RecyclerViewDragDropManager.STATE_FLAG_IS_ACTIVE) != <span class="number">0</span>) &#123;</div><div class="line">                bgResId = R.drawable.bg_item_dragging_active_state;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((dragState &amp; RecyclerViewDragDropManager.STATE_FLAG_DRAGGING) != <span class="number">0</span>) &#123;</div><div class="line">                bgResId = R.drawable.bg_item_dragging_state;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((swipeState &amp; RecyclerViewSwipeManager.STATE_FLAG_IS_ACTIVE) != <span class="number">0</span>) &#123;</div><div class="line">                bgResId = R.drawable.bg_item_swiping_active_state;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((swipeState &amp; RecyclerViewSwipeManager.STATE_FLAG_SWIPING) != <span class="number">0</span>) &#123;</div><div class="line">                bgResId = R.drawable.bg_item_swiping_state;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                bgResId = R.drawable.bg_item_normal_state;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            holder.container.setBackgroundResource(bgResId);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// set swiping properties</span></div><div class="line">        holder.setSwipeItemSlideAmount(</div><div class="line">                item.isPinedToSwipeLeft() ? RecyclerViewSwipeManager.OUTSIDE_OF_THE_WINDOW_LEFT : 0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> dataList.<span class="title">size</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">//交换位置</span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onMoveItem</span><span class="params">(<span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</div><div class="line">        Log.d(<span class="string">"zyh"</span>, <span class="string">"onMoveItem(fromPosition = "</span> + fromPosition + <span class="string">", toPosition = "</span> + toPosition + <span class="string">")"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (fromPosition == toPosition) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        moveItem(fromPosition, toPosition);</div><div class="line">        notifyItemMoved(fromPosition, toPosition);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">moveItem</span><span class="params">(<span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (fromPosition == toPosition) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">final</span> MyItem item = dataList.remove(fromPosition);</div><div class="line">        dataList.add(toPosition, item);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onGetSwipeReactionType</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (onCheckCanStartDrag(holder, position, x, y)) &#123;</div><div class="line">            <span class="keyword">return</span> RecyclerViewSwipeManager.REACTION_CAN_NOT_SWIPE_BOTH;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> RecyclerViewSwipeManager.REACTION_CAN_SWIPE_BOTH;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onSetSwipeBackground</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position, <span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> bgRes = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (type) &#123;</div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.DRAWABLE_SWIPE_NEUTRAL_BACKGROUND:</div><div class="line">                bgRes = R.drawable.bg_swipe_item_neutral;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.DRAWABLE_SWIPE_LEFT_BACKGROUND:</div><div class="line">                bgRes = R.drawable.bg_swipe_item_left;  <span class="comment">//左边滑动出现的布局,应该算是一个drawable</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.DRAWABLE_SWIPE_RIGHT_BACKGROUND:</div><div class="line">                bgRes = R.drawable.bg_swipe_item_right; <span class="comment">//右边滑动出现的布局</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        holder.itemView.setBackgroundResource(bgRes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onSwipeItem</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position, <span class="keyword">int</span> result)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (result) &#123;</div><div class="line">            <span class="comment">// swipe right</span></div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.RESULT_SWIPED_RIGHT:</div><div class="line">                <span class="keyword">if</span> (dataList.<span class="keyword">get</span>(position).isPinedToSwipeLeft()) &#123;</div><div class="line">                    <span class="comment">// pinned --- back to default position</span></div><div class="line">                    <span class="keyword">return</span> RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_DEFAULT;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// not pinned --- remove</span></div><div class="line">                    <span class="keyword">return</span> RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_REMOVE_ITEM;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// swipe left -- pin</span></div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.RESULT_SWIPED_LEFT:</div><div class="line">                <span class="keyword">return</span> RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_MOVE_TO_SWIPED_DIRECTION;</div><div class="line">            <span class="comment">// other --- do nothing</span></div><div class="line">            <span class="keyword">case</span> RecyclerViewSwipeManager.RESULT_CANCELED:</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">return</span> RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_DEFAULT;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onPerformAfterSwipeReaction</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position, <span class="keyword">int</span> result, <span class="keyword">int</span> reaction)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> MyItem item = dataList.get(position);</div><div class="line">        <span class="keyword">if</span> (reaction == RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_REMOVE_ITEM) &#123;</div><div class="line">            dataList.remove(position);</div><div class="line">            notifyItemRemoved(position);</div><div class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(reaction == RecyclerViewSwipeManager.AFTER_SWIPE_REACTION_MOVE_TO_SWIPED_DIRECTION)</span> </span>&#123;</div><div class="line">            item.setPinedToSwipeLeft(<span class="keyword">true</span>);</div><div class="line">            notifyItemChanged(position);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            item.setPinedToSwipeLeft(<span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCheckCanStartDrag</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="comment">// x, y --- relative from the itemView's top-left</span></div><div class="line">        <span class="keyword">final</span> View containerView = holder.container;</div><div class="line">        <span class="keyword">final</span> View dragHandleView = holder.dragHandle;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offsetX = containerView.getLeft() + (<span class="keyword">int</span>) (ViewCompat.getTranslationX(containerView) + <span class="number">0.5</span>f);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offsetY = containerView.getTop() + (<span class="keyword">int</span>) (ViewCompat.getTranslationY(containerView) + <span class="number">0.5</span>f);</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">return</span> <span class="title">hitTest</span><span class="params">(dragHandleView, x - offsetX, y - offsetY)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function">ItemDraggableRange <span class="title">onGetItemDraggableRange</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="comment">// no drag-sortable range specified</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">AbstractDraggableSwipeableItemViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ViewGroup container;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> TextView  textView;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> View      dragHandle;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">            container = (ViewGroup) itemView.findViewById(R.id.container);</div><div class="line">            dragHandle = itemView.findViewById(R.id.drag_handle);</div><div class="line">            textView = (TextView) itemView.findViewById(R.id.text);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="function">View <span class="title">getSwipeableContainerView</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> container;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">boolean</span> <span class="title">hitTest</span><span class="params">(View v, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> tx = (<span class="keyword">int</span>) (ViewCompat.getTranslationX(v) + <span class="number">0.5</span>f);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> ty = (<span class="keyword">int</span>) (ViewCompat.getTranslationY(v) + <span class="number">0.5</span>f);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> left = v.getLeft() + tx;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> right = v.getRight() + tx;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> top = v.getTop() + ty;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> bottom = v.getBottom() + ty;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> (x &gt;= left) &amp;&amp; (x &lt;= right) &amp;&amp; (y &gt;= top) &amp;&amp; (y &lt;= bottom);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####4. 还没完, item的布局<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- item_list_swipe --&gt;</span></div><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- <span class="doctag">NOTE:</span> should use FrameLayout or RelativeLayout for parent of the "@id/container" view (for Android 2.3 compatibility) --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"64dp"</span></div><div class="line">    <span class="attr">android:minHeight</span>=<span class="string">"64dp"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/bg_swipe_item_neutral"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/container"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:clickable</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">tools:ignore</span>=<span class="string">"UselessParent"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">View</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/drag_handle"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"32dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_alignParentLeft</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:layout_alignParentTop</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:background</span>=<span class="string">"#20000000"</span>/&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/text"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"sdsad"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/drag_handle"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">            <span class="attr">tools:ignore</span>=<span class="string">"RtlHardcoded"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>注意上面的布局</strong></p>
<p>Demo: <a href="https://github.com/hanks-zyh/RecylerView" target="_blank" rel="external">https://github.com/hanks-zyh/RecylerView</a></p>
<p>library: <a href="https://github.com/h6ah4i/android-advancedrecyclerview" target="_blank" rel="external">https://github.com/h6ah4i/android-advancedrecyclerview</a></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-大杀器-RoboBinding" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/20/大杀器-RoboBinding/">大杀器-RoboBinding</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###介绍</p>
<blockquote>
<p>一个实现了<strong><code>数据绑定</code></strong> <strong><code>Presentation Model(MVVM)</code></strong> 模式的Android开源框架。 在没有性能损失的前提下(使用<strong>源代码生成来替代Java反射</strong>)，<a href="#">RoboBinding</a> 帮助你编写更可读，易于测试与维护的UI代码。</p>
</blockquote>
<ul>
<li>通过绑定<a href="#">移除大量不必要的代码</a>(如addXXListener()，findViewById()等) 。</li>
<li>将难于测试的Android代码以及运行过久且不切实际的Android单元测试 变为 pojo PresentationModels 及其普通的JUnit单元测试。</li>
<li>提供对象类型Cursor来替换 - 关系类型Cursor，因为我们已经习惯于操作对象 。</li>
<li>可以很容易的为任何自定义组件，第三方组件或Android widget编写属性绑定实现，简化代码，使项目易于维护。</li>
</ul>
<hr>
<h3 id="官网-http-robobinding-org"><a href="#官网-http-robobinding-org" class="headerlink" title="官网:  http://robobinding.org"></a>官网: <a href="http://robobinding.org/" target="_blank" rel="external"> http://robobinding.org</a></h3><p>有中文翻译版本,关于详细介绍,移步官网,下面主要填一下使用<a href="#"><strong>Android Studio</strong></a>配置时的一些坑.</p>
<p>根据官方介绍,我使用了<strong><code>AspectJ</code></strong>(AS上不好配置),也可以不用<br>1.配置 <strong><code>app/build.gradle</code></strong><br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">buildscript</span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">repositories</span>&#123;</div><div class="line">        mavenCentral()</div><div class="line">        maven()&#123;</div><div class="line">            name <span class="string">'RoboBinding AspectJPlugin Maven Repository'</span></div><div class="line">            url <span class="string">"https://github.com/RoboBinding/RoboBinding-aspectj-plugin/raw/master/mavenRepo"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.+'</span></div><div class="line">        <span class="keyword">classpath</span> <span class="string">'org.robobinding:aspectj-plugin:0.8.4'</span></div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.+'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意需要引用v4,我是在libs添加的jar包<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.neenbedankt.android-apt'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'org.robobinding.android-aspectj'</span></div></pre></td></tr></table></figure></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">compile</span> (<span class="string">"org.robobinding:robobinding:0.8.9:with-aop-and-dependencies"</span>) &#123;</div><div class="line">    <span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'com.google.guava'</span>, module: <span class="string">'guava'</span></div><div class="line">&#125;</div><div class="line">aspectPath (<span class="string">"org.robobinding:robobinding:0.8.9:with-aop-and-dependencies"</span>) &#123;</div><div class="line">    <span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'com.google.guava'</span>, module: <span class="string">'guava'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apt <span class="string">"org.robobinding:codegen:0.8.9"</span></div><div class="line"></div><div class="line">androidTestCompile <span class="string">'com.jayway.android.robotium:robotium-solo:5.2.1'</span></div></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">repositories &#123;</div><div class="line">    jcenter()</div><div class="line">    mavenCentral()</div><div class="line">    maven() &#123;</div><div class="line">        name <span class="string">'SonaType snapshot repository'</span></div><div class="line">        url <span class="string">'https://oss.sonatype.org/content/repositories/snapshots'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">android &#123;</div><div class="line">    ....</div><div class="line">    <span class="comment">//这里是禁止xml中使用bind命名空间时报错的</span></div><div class="line">    lintOptions &#123;</div><div class="line">        disable <span class="string">'UnusedAttribute'</span>, <span class="string">'ValidFragment'</span>, <span class="string">'GradleDependency'</span>, <span class="string">'OnClick'</span>, <span class="string">'MissingPrefix'</span>, <span class="string">'MenuTitle'</span></div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上片段是需要注意的</p>
<p>还有就是网络问题,在公司的网络Gradle死活都编译不通,回到家立马就好了<br>接下来就是使用了</p>
<hr>
<p>以在Fragment中使用为例(官方的例子用法很全了)</p>
<ol>
<li>fragment_demo.xml  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout</div><div class="line">	<span class="comment">//加上命名空间</span></div><div class="line">	xmlns:<span class="keyword">bind</span>=<span class="string">"http://robobinding.org/android"</span></div><div class="line"></div><div class="line">&lt;TextView</div><div class="line">	<span class="keyword">bind</span>:text=<span class="string">"&#123;content&#125;"</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>点击事件 <strong>bind:onClick=”methodName”</strong><br>还支持其他更多属性的绑定</p>
<ol>
<li><p>DemoPresentationModel.java</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//加上注解</span></div><div class="line">@PresentationModel</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPresentationModel</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> content; <span class="comment">//对应xml中bind:text="&#123;content&#125;"</span></div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">String</span> getContent()&#123;</div><div class="line">		<span class="keyword">return</span> content;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">String</span> setContent(Content content)&#123;</div><div class="line">		<span class="built_in">this</span>.content = content;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>DemoFragment.java</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="aspectj">   <span class="meta">@Override</span></span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">       presentationModel = <span class="keyword">new</span> DemoPresentationModel();</div><div class="line">       presentationModel.setContent(<span class="string">"内容"</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="keyword">public</span> <span class="function">View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       ViewBinder viewBinder = <span class="keyword">new</span> BinderFactoryBuilder().build().createViewBinder(getActivity());</div><div class="line">       View rootView = viewBinder.inflateAndBind(R.layout.fragment_demo, presentationModel);   <span class="comment">//xml里面按照上面的要求,不能写错</span></div><div class="line">       <span class="keyword">return</span> rootView;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>需要更新属性的,让POJO类实现<strong><code>HasPresentationModelChangeSupport</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//加上注解</span></div><div class="line"><span class="meta">@PresentationModel</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPresentationModel</span> <span class="keyword">implements</span> <span class="title">HasPresentationModelChangeSupport</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String content; <span class="comment">//对应xml中bind:text="&#123;content&#125;"</span></div><div class="line"></div><div class="line">	<span class="keyword">private</span> PresentationModelChangeSupport changeSupport;</div><div class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">DemoPresentationModel</span><span class="params">()</span></span>&#123;</div><div class="line">		 changeSupport = <span class="keyword">new</span> PresentationModelChangeSupport(<span class="keyword">this</span>);</div><div class="line">	 &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> content;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setContent</span><span class="params">(Content content)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.content = content;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updataContent</span><span class="params">(String newContent)</span></span>&#123;</div><div class="line">		changeSupport.firePropertyChange(<span class="string">"content"</span>);<span class="comment">//更新content属性</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们调用 <strong><code>updataContent</code></strong>来更新视图</p>
<hr>
<p>一下子简化好多代码和逻辑,还有其他更强大的功能,<a href="http://robobinding.org" target="_blank" rel="external">官网</a>观看,还有中文的视频</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-自定义控件--带动画的CheckBox" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/15/自定义控件--带动画的CheckBox/">自定义控件--带动画的CheckBox</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<p><strong><span style="font-family:Comic Sans MS; font-size:18px; color:#ff0000">效果图</span></strong></p>
<p><strong><span style="font-family:Comic Sans MS; font-size:18px; color:#ff0000"><img src="http://img.blog.csdn.net/20150516001002925" alt=""><br>
</span></strong></p>
<p><span style="font-family:Comic Sans MS; font-size:18px">CheckBox状态： <span style="color:#ff0000">
Checked</span>&nbsp;,&nbsp;<span style="color:#999999">UnChecked</span></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>动画分析：</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>1.UnChecked --&gt; Checked ， 圆由小变大（简单易实现），然后是对号的动画（后面分析怎么画对号）</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>2.Checked --&gt; UnChecked ， 显示对号消失动画，然后圆由大变小（简单易实现）</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>---------------------------------------------------------------------------------------------------------</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>画的对号的位置分析</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong><img src="http://img.blog.csdn.net/20150516001447859?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>
</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong><br>
</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>然后是画对号的动画分析</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong><img src="http://img.blog.csdn.net/20150516001503257?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>
</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong>关键分析在图里，上代码</strong></span></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong></strong></span></p>
<pre name="code" class="java">/*
 * Created by Hanks
 * Copyright (c) 2015 . All rights reserved
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package rxandroid.zyh.com.rxandroid.custom;

import android.animation.ValueAnimator;
import android.annotation.TargetApi;
import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.os.Build;
import android.util.AttributeSet;
import android.view.View;
import android.view.animation.LinearInterpolator;

/**
 * Created by Administrator on 2015/5/14.
 */
public class TouchCheckBox extends View {

    private Paint mCirclePaint;
    private Paint mCorrectPaint;
    private int radius;                    //圆的半径
    private int width, height;             //控件宽高
    private int cx, cy;                    //圆心xy坐标
    private float[] points = new float[6]; //对号的3个点的坐标
    private float correctProgress;
    private float downY;
    private boolean isChecked;
    private boolean toggle;
    private boolean isAnim;
    private int animDurtion = 150;

    private OnCheckedChangeListener listener;
    private int unCheckColor = Color.GRAY;
    private int circleColor = Color.RED;

    public TouchCheckBox(Context context) {
        this(context, null);
    }

    public TouchCheckBox(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public TouchCheckBox(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        init(context);

    }

    @TargetApi(Build.VERSION_CODES.LOLLIPOP)
    public TouchCheckBox(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
    }


    /**
     * 初始化
     * @param context
     */
    private void init(Context context) {

        mCirclePaint = new Paint(Paint.ANTI_ALIAS_FLAG);
        mCirclePaint.setColor(Color.RED);
        mCirclePaint.setStyle(Paint.Style.FILL);

        mCorrectPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
        mCorrectPaint.setColor(Color.WHITE);
        mCorrectPaint.setStyle(Paint.Style.FILL);
        mCorrectPaint.setStrokeWidth(dip2px(context, 2));
        setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View v) {
                if (isChecked) {
                    hideCorrect();
                } else {
                    showCheck();
                }
            }
        });
    }

    /**
     * 设置当前选中状态
     * @param checked
     */
    public void setChecked(boolean checked){
        if (isChecked &amp;&amp; !checked) {
            hideCorrect();
        } else if(!isChecked &amp;&amp; checked) {
            showCheck();
        }
    }

    /**
     * 返回当前选中状态
     * @return
     */
    public boolean isChecked(){
        return isChecked;
    }

    /**
     * 确定尺寸坐标
     * @param w
     * @param h
     * @param oldw
     * @param oldh
     */
    @Override
    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
        super.onSizeChanged(w, h, oldw, oldh);
        height = width = Math.min(w - getPaddingLeft() - getPaddingRight(),h - getPaddingBottom() - getPaddingTop());
        cx = w / 2;
        cy = h / 2;

        float r = height / 2f;
        points[0] = r / 2f + getPaddingLeft();
        points[1] = r + getPaddingTop();

        points[2] = r * 5f / 6f + getPaddingLeft();
        points[3] = r + r / 3f + getPaddingTop();

        points[4] = r * 1.5f +getPaddingLeft();
        points[5] = r - r / 3f + getPaddingTop();
        radius = (int) (height * 0.125f);
    }

    @Override
    protected void onDraw(Canvas canvas) {

        float f = (radius -height * 0.125f) / (height * 0.5f); //当前进度
        mCirclePaint.setColor(evaluate(f,unCheckColor,circleColor));
        canvas.drawCircle(cx, cy, radius, mCirclePaint); //画圆

        //画对号
        if(correctProgress&gt;0) {
            if(correctProgress&lt;1/3f) {
                float x = points[0] + (points[2] - points[0]) * correctProgress;
                float y = points[1] + (points[3] - points[1]) * correctProgress;
                canvas.drawLine(points[0], points[1], x, y, mCorrectPaint);
            }else {
                float x = points[2] + (points[4] - points[2]) * correctProgress;
                float y = points[3] + (points[5] - points[3]) * correctProgress;
                canvas.drawLine(points[0], points[1], points[2], points[3], mCorrectPaint);
                canvas.drawLine(points[2], points[3], x,y, mCorrectPaint);
            }
        }
    }


    /**
     * 设置圆的颜色
     * @param color
     */
    public void setCircleColor(int color){
        circleColor = color;
    }

    /**
     * 设置对号的颜色
     * @param color
     */
    public void setCorrectColor(int color){
        mCorrectPaint.setColor(color);
    }

    /**
     * 设置未选中时的颜色
     * @param color
     */
    public void setUnCheckColor(int color){
        unCheckColor = color;
    }

    private int evaluate(float fraction, int startValue, int endValue) {
        int startInt = startValue;
        int startA = (startInt &gt;&gt; 24) &amp; 0xff;
        int startR = (startInt &gt;&gt; 16) &amp; 0xff;
        int startG = (startInt &gt;&gt; 8) &amp; 0xff;
        int startB = startInt &amp; 0xff;

        int endInt = endValue;
        int endA = (endInt &gt;&gt; 24) &amp; 0xff;
        int endR = (endInt &gt;&gt; 16) &amp; 0xff;
        int endG = (endInt &gt;&gt; 8) &amp; 0xff;
        int endB = endInt &amp; 0xff;

        return ((startA + (int) (fraction * (endA - startA))) &lt;&lt; 24)
                | ((startR + (int) (fraction * (endR - startR))) &lt;&lt; 16)
                | ((startG + (int) (fraction * (endG - startG))) &lt;&lt; 8)
                | ((startB + (int) (fraction * (endB - startB))));
    }

    /**
     * 处理触摸事件触发动画
     */
    /*private class OnChangeStatusListener implements OnTouchListener {
        @Override
        public boolean onTouch(View v, MotionEvent event) {
            Log.i(&quot;Touch&quot;,&quot;Touch&quot;);
            switch (event.getAction()) {
                case MotionEvent.ACTION_DOWN:
                    downY = event.getRawY();
                    break;
                case MotionEvent.ACTION_MOVE:
                    float dy = event.getRawY() - downY;
                    if (Math.abs(dy) &gt;= 0) { //滑过一半触发
                        toggle = true;
                    } else {
                        toggle = false;
                    }
                    break;
                case MotionEvent.ACTION_CANCEL:
                case MotionEvent.ACTION_UP:
                    if (toggle) {
                        if (isChecked) {
                            hideCorrect();
                        } else {
                            showCheck();
                        }
                    }
                    break;
            }
            return true;
        }
    }*/

    private void showUnChecked() {
        if (isAnim) {
            return;
        }

        isAnim = true;
        ValueAnimator va = ValueAnimator.ofFloat(0, 1).setDuration(animDurtion);
        va.setInterpolator(new LinearInterpolator());
        va.start();
        va.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                float value = (float) animation.getAnimatedValue(); // 0f ~ 1f
                radius = (int) ((1 - value) * height * 0.375f + height * 0.125f);
                if (value &gt;= 1) {
                    isChecked = false;
                    isAnim = false;
                    if(listener!=null){
                        listener.onCheckedChanged(TouchCheckBox.this,false);
                    }
                }
                invalidate();
            }
        });
    }

    private void showCheck() {
        if (isAnim) {
            return;
        }
        isAnim = true;
        ValueAnimator va = ValueAnimator.ofFloat(0, 1).setDuration(animDurtion);
        va.setInterpolator(new LinearInterpolator());
        va.start();
        va.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                float value = (float) animation.getAnimatedValue(); // 0f ~ 1f
                radius = (int) (value * height * 0.37f + height * 0.125f);
                if (value &gt;= 1) {
                    isChecked = true;
                    isAnim = false;
                    if(listener!=null){
                        listener.onCheckedChanged(TouchCheckBox.this,true);
                    }
                    showCorrect();
                }
                invalidate();
            }
        });
    }

    private void showCorrect() {
        if (isAnim) {
            return;
        }
        isAnim = true;
        ValueAnimator va = ValueAnimator.ofFloat(0, 1).setDuration(animDurtion);
        va.setInterpolator(new LinearInterpolator());
        va.start();
        va.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                float value = (float) animation.getAnimatedValue(); // 0f ~ 1f
                correctProgress = value;
                invalidate();
                if(value&gt;=1){
                    isAnim = false;
                }
            }
        });
    }
    private void hideCorrect() {
        if (isAnim) {
            return;
        }
        isAnim = true;
        ValueAnimator va = ValueAnimator.ofFloat(0, 1).setDuration(animDurtion);
        va.setInterpolator(new LinearInterpolator());
        va.start();
        va.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                float value = (float) animation.getAnimatedValue(); // 0f ~ 1f
                correctProgress = 1-value;
                invalidate();
                if(value&gt;=1){
                    isAnim = false;
                    showUnChecked();
                }
            }
        });
    }
    public void setOnCheckedChangeListener(OnCheckedChangeListener listener){
        this.listener = listener;
    }
    public interface OnCheckedChangeListener{
        void onCheckedChanged(View buttonView, boolean isChecked);
    }

    /**
     * 根据手机的分辨率从 dp 的单位 转成为 px(像素)
     */
    public static int dip2px(Context context, float dpValue) {
        final float scale = context.getResources().getDisplayMetrics().density;
        return (int) (dpValue * scale + 0.5f);
    }

    /**
     * 根据手机的分辨率从 px(像素) 的单位 转成为 dp
     */
    public static int px2dip(Context context, float pxValue) {
        final float scale = context.getResources().getDisplayMetrics().density;
        return (int) (pxValue / scale + 0.5f);
    }
}
</pre><br>
源码：<a target="_blank" href="https://github.com/hanks-zyh/AnimateCheckBox">https://github.com/hanks-zyh/AnimateCheckBox</a><br>
<p></p>
<p><span style="font-family:Comic Sans MS; font-size:18px; color:#333333"><strong><br>
</strong></span></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Android中ProgressBar样式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/26/Android中ProgressBar样式/">Android中ProgressBar样式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://img.blog.csdn.net/20150426140252132" alt="这里写图片描述"><br>Android系统已经被各大厂商改的面目全非，各种系统组件在不同手机上显示的效果完全不同，现在要想在开发中想要保持统一的界面风格，必须全部修改系统组件的样式，现在我们需要修改系统默认的<strong><code>ProgressBar</code></strong>,就Android系统本身来说，不同的版本组件的样式也不同。</p>
<p>##系统中ProgressBar样式<br><img src="http://img.blog.csdn.net/20150426141921299" alt="系统样式"><br>找到<code>android-sdk</code>目录下的<code>platforms\android-15\data\res\values</code>中的<code>styles.xml</code>,然后查找ProgressBar，可以发现<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;style <span class="built_in">name</span>=<span class="string">"Widget.ProgressBar"</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:indeterminateOnly"</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:indeterminateDrawable"</span>&gt;@android:drawable/progress_medium_white&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:indeterminateBehavior"</span>&gt;<span class="keyword">repeat</span>&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:indeterminateDuration"</span>&gt;<span class="number">3500</span>&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:minWidth"</span>&gt;<span class="number">48</span>dip&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:maxWidth"</span>&gt;<span class="number">48</span>dip&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:minHeight"</span>&gt;<span class="number">48</span>dip&lt;/<span class="built_in">item</span>&gt;</div><div class="line">        &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:maxHeight"</span>&gt;<span class="number">48</span>dip&lt;/<span class="built_in">item</span>&gt;</div><div class="line">    &lt;/style&gt;</div></pre></td></tr></table></figure></p>
<p><code>android:indeterminateDrawable</code>的值为<strong><code>@android:drawable/progress_medium_white</code></strong>,找到drawable目录下的progress_medium_white.xml,打开<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">animated-rotate</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/spinner_white_48"</span></div><div class="line">    <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></div><div class="line">    <span class="attr">android:pivotY</span>=<span class="string">"50%"</span></div><div class="line">    <span class="attr">android:framesCount</span>=<span class="string">"12"</span></div><div class="line">    <span class="attr">android:frameDuration</span>=<span class="string">"100"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>就是一个简单的spinner_white_48.png的<strong><code>旋转动画</code></strong></p>
<p>##自定义<code>android:indeterminateDrawable</code>的值</p>
<p>###旋转动画<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">rotate</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></div><div class="line">    <span class="attr">android:pivotY</span>=<span class="string">"50%"</span></div><div class="line">    <span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></div><div class="line">    <span class="attr">android:toDegrees</span>=<span class="string">"360"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">bitmap</span></span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@mipmap/icon_timeline_stop_blue"</span></div><div class="line">        <span class="attr">android:antialias</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:filter</span>=<span class="string">"true"</span>&gt;<span class="tag">&lt;/<span class="name">bitmap</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">rotate</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ProgressBar</div><div class="line">    android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">    android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">    android:indeterminateDrawable=<span class="string">"@drawable/loading_anim"</span></div><div class="line">    android:<span class="built_in">id</span>=<span class="string">"@+id/progressBar"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>即可制作简单的旋转样式的的ProgressBar</p>
<hr>
<p>###帧动画<br>还有一种样式的为<strong><code>帧动画</code></strong>，这里有一点需要注意的<br><img src="http://img.blog.csdn.net/20150426142305106" alt="这里写图片描述">       <img src="http://img.blog.csdn.net/20150426142433923" alt="这里写图片描述"><br>两个图片,制作帧动画<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:oneshot</span>=<span class="string">"false"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:duration</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">clip</span></span></div><div class="line">            <span class="attr">android:clipOrientation</span>=<span class="string">"horizontal"</span></div><div class="line">            <span class="attr">android:drawable</span>=<span class="string">"@mipmap/kaoyan_tip_f1"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"left"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:duration</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">clip</span></span></div><div class="line">        <span class="attr">android:clipOrientation</span>=<span class="string">"horizontal"</span></div><div class="line">        <span class="attr">android:drawable</span>=<span class="string">"@mipmap/kaoyan_tip_f2"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"left"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要注意的是，需要使用<strong><code>clip</code></strong>节点来指定<strong><code>android:clipOrientation</code></strong>和<strong><code>android:gravity=&quot;left&quot;</code></strong>，否则可能出现不同屏幕显示不完整的情况</p>
</blockquote>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-xmlns_tools" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/25/xmlns_tools/">Android中的xmlns:tools</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<p><span style="font-family:Comic Sans MS"><span style="font-family:freight-text-pro,Georgia,Cambria,'Times New Roman',Times,serif; font-size:32px; letter-spacing:0.159999996423721px; line-height:44.7999992370606px; text-align:center"><em>Don’t be a tool, use
 the tools.</em></span><br>
</span></p>
<p><span style="font-family:Comic Sans MS"><br>
</span></p>
<p><span style="font-family:Comic Sans MS">创建XML文件，IDE自动添加了 tools命名空间</span></p>
<p></p>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#bababa">xmlns:tools=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;</span></pre>
<p></p>
<p><span style="font-family:Comic Sans MS">tools可以告诉IDE，哪些属性在运行的时候是被忽略的，只在设计布局的时候有效。<br>
tools可以覆盖android的所有标准属性，将android:换成tools:即可，同时在运行的时候就连tools:本身都是被忽略的（不会编译到apk）。</span></p>
<p><span style="font-family:Comic Sans MS">栗子：</span></p>
<p></p>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;TextView
</span><span style="color:#e8bf6a">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:id=</span><span style="color:#a5c261">&quot;@&#43;id/text_main&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_width=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_height=</span><span style="color:#a5c261">&quot;wrap_content&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:textAppearance=</span><span style="color:#a5c261">&quot;@style/TextAppearance.Title&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_margin=</span><span style="color:#a5c261">&quot;@dimen/main_margin&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:text=</span><span style="color:#a5c261">&quot;I am a title&quot; </span><span style="color:#e8bf6a">/&gt;</span></pre>
<p></p>
<p><span style="font-family:Comic Sans MS">不用再去使用<span style="background-color:rgb(204,204,204)"><span style="color:#cc0000">android:text=“”</span></span> 实时布局效果查看了，也不用再查看过效果后去删除了，使用<span style="background-color:rgb(204,204,204)"><span style="color:#cc0000">tools:text</span></span></span>预览效果，运行时不进入打包的apk</p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<p></p>
<h2>tools属性的种类</h2>
tools属性可以分为两种：一种是影响Lint提示的，一种是关于xml布局设计的。
<p></p>
<p>以上介绍的是tools的最基本用法：在UI设计的时候覆盖标准的android属性，属于第二种。</p>
<p>下面介绍Lint相关的属性。</p>
<p></p>
<h2>Lint相关的属性</h2>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt">tools:ignore
tools:targetApi
tools:locale
tools:ignore</pre>
<h3><span style="font-family:Comic Sans MS"><span style="color:#990000; background-color:rgb(204,204,204)"><span style="color:rgb(204,0,0); font-family:'Comic Sans MS'; background-color:rgb(204,204,204)">tools:ignore</span></span></span></h3>
<p></p>
<p><span style="font-family:Comic Sans MS"><span style="color:#990000; background-color:rgb(204,204,204)"></span>告诉Lint忽略xml中的某些警告。<br>
<br>
假设我们有这样的一个ImageView</span></p>
<p><span style="font-family:Comic Sans MS"></span></p>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;ImageView
</span><span style="color:#e8bf6a">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_width=</span><span style="color:#a5c261">&quot;wrap_content&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_height=</span><span style="color:#a5c261">&quot;wrap_content&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:scaleType=</span><span style="color:#a5c261">&quot;center&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:src=</span><span style="color:#a5c261">&quot;@android:drawable/ic_delete&quot; </span><span style="color:#e8bf6a">/</span></pre>
Lint会提示该ImageView缺少<span style="color:#cc0000; background-color:rgb(204,204,204)">android:contentDescription</span>属性。我们可以使用<span style="color:#cc0000; background-color:rgb(204,204,204)">tools:ignore</span>来忽略这个警告：<br>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;ImageView
</span><span style="color:#e8bf6a">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_width=</span><span style="color:#a5c261">&quot;wrap_content&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_height=</span><span style="color:#a5c261">&quot;wrap_content&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:scaleType=</span><span style="color:#a5c261">&quot;center&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:src=</span><span style="color:#a5c261">&quot;</span><span style="color:#a5c261; background-color:#344134">@android:drawable/ic_delete</span><span style="color:#a5c261">&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:ignore=</span><span style="color:#a5c261">&quot;contentDescription&quot; </span><span style="color:#e8bf6a">/&gt;</span></pre>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:targetApi</span></span></h3>
<span style="font-family:Comic Sans MS">假设minSdkLevel 15，而你使用了api21中的控件比如RippleDrawable<br>
&lt;ripple xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android:color=&quot;@color/accent_color&quot; /&gt;<br>
则Lint会提示警告。<br>
为了不显示这个警告，可以：<br>
</span>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;ripple </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">android</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/apk/res/android&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">tools</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:color=</span><span style="color:#a5c261">&quot;@color/accent_color&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:targetApi=</span><span style="color:#a5c261">&quot;LOLLIPOP&quot; </span><span style="color:#e8bf6a">/&gt;</span></pre>
<span style="color:#cc0000; background-color:rgb(204,204,204)"><br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:locale</span>（本地语言）</span></h3>
<span style="font-family:Comic Sans MS"><br>
默认情况下<span style="color:#cc0000; background-color:rgb(204,204,204)">res/values/strings.xml</span>中的字符串会执行拼写检查，如果不是英语，会提示拼写错误，通过以下代码来告诉studio本地语言不是英语，就不会有提示了。<br>
</span>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;resources
</span><span style="color:#e8bf6a">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">android</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/apk/res/android&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">tools</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:locale=</span><span style="color:#a5c261">&quot;it&quot;</span><span style="color:#e8bf6a">&gt;
</span><span style="color:#e8bf6a">
</span><span style="color:#e8bf6a">    </span><span style="color:#808080"><em>&lt;!-- Your strings go here --&gt;
</em></span><span style="color:#808080"><em>
</em></span><span style="color:#e8bf6a">&lt;/resources&gt;</span></pre>
ps：关于忽略Lint的属性，如果不想了解的话也没关系，因为并不影响编译，一般我都不会管这些警告。<br>
<br>
<p></p>
<h2><span style="font-family:Comic Sans MS">UI相关属性</span></h2>
<p></p>
<pre style="color:rgb(169,183,198); font-size:12pt; font-family:Consolas; background-color:rgb(43,43,43)">tools:context
tools:menu
tools:actionBarNavMode
tools:listitem/listheader/listfooter
tools:showIn
tools:layout</pre>
<span style="font-family:Comic Sans MS"><br>
</span>
<p></p>
<p></p>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:context</span></span></h3>
<span style="font-family:Comic Sans MS"><br>
context属性制定xml布局对应的Activity，IDE就知道在预览布局的时候该采用什么样的主题。</span>
<p></p>
<p><span style="font-family:Comic Sans MS">It can also help the<strong> Go to Related files</strong> intention in Android Studio, even though it has become pretty clever at figuring stuff out by itself.</span></p>
<p><img src="https://d262ilb51hltx0.cloudfront.net/max/600/1*Rp4mBax1Q4pV1PuuZYPRvw.png" alt=""><br>
</p>
<p></p>
<pre style="color:rgb(169,183,198); font-size:12pt; font-family:Consolas; background-color:rgb(43,43,43)"><span style="color:#e8bf6a">&lt;LinearLayout
</span><span style="color:#e8bf6a">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">android</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/apk/res/android&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">tools</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:id=</span><span style="color:#a5c261">&quot;@&#43;id/container&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_width=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_height=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:orientation=</span><span style="color:#a5c261">&quot;vertical&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:context=</span><span style="color:#a5c261">&quot;com.android.example.MainActivity&quot;</span><span style="color:#e8bf6a">&gt;
</span><span style="color:#e8bf6a">    </span><span style="color:#808080"><em>&lt;!-- ... --&gt;
</em></span><span style="color:#e8bf6a">&lt;/LinearLayout&gt;</span></pre>
<p></p>
<p></p>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:menu</span></span></h3>
<span style="font-family:Comic Sans MS">告诉IDE 在预览窗口中使用哪个菜单，这个菜单将显示在layout的根节点上（actionbar的位置）。</span>
<p></p>
<p><img src="http://www.jcodecraeer.com/uploads/20150310/1425918468454802.png" alt=""><br>
<span style="font-family:Comic Sans MS">其实预览窗口非常智能，如果布局和一个activity关联（指上面所讲的用tools:context关联）它将会自动查询相关activity的onCreateOptionsMenu方法中的代码，以显示菜单。而menu属性则可以覆盖这种默认的行为。<br>
<br>
你还可以为menu属性定义多个菜单资源，不同的菜单资源之间用逗号隔开。<span style="color:#cc0000; background-color:rgb(204,204,204)">tools:menu=&quot;menu_main,menu_edit&quot;</span><br>
如果你不希望在预览图中显示菜单则：<span style="color:#cc0000; background-color:rgb(204,204,204)">tools:menu=&quot;&quot;</span><br>
最后需要注意，当主题为Theme.AppCompat时，这个属性不起作用。<br>
<br>
</span></p>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:actionBarNavMode</span></span></h3>
<span style="font-family:Comic Sans MS">这个属性告诉IDE app bar（Material中对actionbar的称呼）的显示模式，其&#20540;可以是standard，tabs，list</span>
<p></p>
<p></p>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;LinearLayout </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">android</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/apk/res/android&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">xmlns:</span><span style="color:#9876aa">tools</span><span style="color:#bababa">=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:orientation=</span><span style="color:#a5c261">&quot;vertical&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_width=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">android</span><span style="color:#bababa">:layout_height=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#9876aa">tools</span><span style="color:#bababa">:actionBarNavMode=</span><span style="color:#a5c261">&quot;tabs&quot; </span><span style="color:#e8bf6a">/&gt;</span></pre>
<span style="font-family:Comic Sans MS"><br>
同样的，当主题是Theme.AppCompat (r21&#43;, at least) 或者Theme.Material,或者使用了布局包含Toolbar的方式。 该属性也不起作用，只有holo主题才有效。<br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:listitem, listheader 和listfooter&nbsp;</span></span></h3>
<span style="font-family:Comic Sans MS">就是在<span style="color:#cc0000; background-color:rgb(204,204,204)">ListView &nbsp;</span>
<span style="color:#cc0000; background-color:rgb(204,204,204)">ExpandableListView</span>等的预览效果中添加头部 尾部 以及子item的预览布局。</span>
<p></p>
<p><span style="font-family:Comic Sans MS">但是注意：<strong>header 和 footer不能设置给<span style="color:#cc0000; background-color:rgb(204,204,204)">GridView</span> ，只有listitem可以被设置</strong></span></p>
<p><br>
<span style="font-family:Comic Sans MS"><img src="http://img.blog.csdn.net/20150425121914629" alt=""></span><br>
<br>
<img src="https://d262ilb51hltx0.cloudfront.net/max/913/1*_3k2qGwN19tZFjUO_pzaSw.jpeg" alt=""><br>
</p>
<h3><span style="font-family:Comic Sans MS; color:#cc0000; background-color:rgb(204,204,204)">tools:layout</span></h3>
<span style="font-family:Comic Sans MS">tools:layout告诉ide，Fragment在程序预览的时候该显示成什么样<br>
&nbsp;<img src="https://d262ilb51hltx0.cloudfront.net/max/1400/1*f5uMzpfa227Fr1RhNcunEw.png" alt=""><br>
<br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="color:#cc0000; background-color:rgb(204,204,204)">tools:showIn</span></span></h3>
<div><span style="font-family:Comic Sans MS"><span style="font-size:12px; color:#333333; background-color:rgb(255,255,255)">But if you go and<strong> edit that included layout</strong>, you won’t have a context for it,
<strong>it’ll just show up as if it were the root layout </strong>of an activity. With the<strong> showIn</strong> attribute<strong> you can tell the preview pane to show you the include into the context
</strong>in which it will then be inflated. This is <strong>especially useful if your included layout has a merge tag</strong> as its root (which is treated as a FrameLayout by the preview pane).</span><br>
</span></div>
<span style="font-family:Comic Sans MS"></span>
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:12.0pt"><span style="color:#e8bf6a">&lt;merge </span><span style="color:#bababa">xmlns:android=</span><span style="color:#a5c261">&quot;http://schemas.android.com/apk/res/android&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">xmlns:tools=</span><span style="color:#a5c261">&quot;http://schemas.android.com/tools&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">android:layout_width=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">android:layout_height=</span><span style="color:#a5c261">&quot;match_parent&quot;
</span><span style="color:#a5c261">    </span><span style="color:#bababa">tools:showIn=</span><span style="color:#a5c261">&quot;@layout/activity_main&quot;</span><span style="color:#e8bf6a">&gt;</span></pre>
<br>
<p></p>
<p><img src="https://d262ilb51hltx0.cloudfront.net/max/757/1*9QdrcTjxpJO15RVmUmL5Iw.png" alt=""><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><span style="font-family:freight-text-pro,Georgia,Cambria,'Times New Roman',Times,serif; font-size:32px; letter-spacing:0.159999996423721px; line-height:44.7999992370606px; text-align:center"><em>Don’t be a tool, use the tools.</em></span><br>
</p>
<p><span style="font-family:freight-text-pro,Georgia,Cambria,'Times New Roman',Times,serif; font-size:32px; letter-spacing:0.159999996423721px; line-height:44.7999992370606px; text-align:center"><em><br>
</em></span></p>
<p><br>
</p>
<p>参考：</p>
<p><a target="_blank" href="https://medium.com/sebs-top-tips/tools-of-the-trade-part-1-f3c1c73de898">https://medium.com/sebs-top-tips/tools-of-the-trade-part-1-f3c1c73de898</a></p>
<p><a target="_blank" href="https://medium.com/sebs-top-tips/tools-of-the-trade-part-2-b91271892d10">https://medium.com/sebs-top-tips/tools-of-the-trade-part-2-b91271892d10</a><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-应用异常崩溃分析工具_--_Crashlytics" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/11/应用异常崩溃分析工具_--_Crashlytics/">应用异常崩溃分析工具 -- Crashlytics</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>作为一个软件开发者，写出来的应用不可能十全十美，谁也不能保证自己的应用永无bug。所以对于应用出现的bug信息的收集与分析是十分重要的。本篇介绍一下国外的一款保存和分析应用崩溃信息的工具 <strong>Crashlytics</strong>.<br><img src="http://img.blog.csdn.net/20150411212604836" alt="介绍"></p>
<hr>
<p>关于Android中<code>自定义crash异常</code>信息，看我<a href="http://blog.csdn.net/hpu_zyh/article/details/41320499" target="_blank" rel="external">这篇博客</a></p>
<hr>
<p>###介绍<br>Crashlytic 成立于2011年，是专门为移动应用开者发提供的保存和分析应用崩溃信息的工具。<br>Crashlytics的使用者包括：支付工具Paypal, 点评应用Yelp, 照片分享应用Path, 团购应用GroupOn等移动应用。<br>2013年1月，Crashlytics被Twitter收购，成为又一个成功的创业产品。被收购之后，由于没有了创业公司的不稳定因素，我们更有理由使用它来分析应用崩溃信息。</p>
<p>###使用</p>
<ol>
<li><p>注册<br>登录<a href="http://try.crashlytics.com/" target="_blank" rel="external">官网</a>进行注册<br><img src="http://img.blog.csdn.net/20150411204833999" alt="官网"><br>之后官方会进行审核，我当时审核的挺快的，大概十几分钟就收到邮件通知可以使用了。</p>
</li>
<li><p>安装开发插件<br><a href="https://fabric.io/downloads" target="_blank" rel="external">下载地址</a><br><img src="http://img.blog.csdn.net/20150411210341078" alt="这里写图片描述"><br>每个插件安装都有具体步骤，我使用的是<code>Eclipse</code><br>安装完成后如下：<br><img src="http://img.blog.csdn.net/20150411210518612" alt="这里写图片描述"></p>
</li>
<li><p>使用<br>点击打开<br><img src="http://img.blog.csdn.net/20150411210643629" alt="这里写图片描述"></p>
</li>
</ol>
<p>自动分析当前打开的项目列表<br><img src="http://img.blog.csdn.net/20150411211324846" alt="这里写图片描述"></p>
<p>选择其中一个，Fabric自动插入代码，<br><img src="http://img.blog.csdn.net/20150411211318750" alt="这里写图片描述"></p>
<p>完成后的项目：<br><img src="http://img.blog.csdn.net/20150411211632986" alt="这里写图片描述"><br>所做的工作<br>在<code>AndroidMafifest.xml</code>自动插入<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;meta-<span class="class"><span class="keyword">data</span></span></div><div class="line">    android:name=<span class="string">"io.fabric.ApiKey"</span></div><div class="line">    android:value=<span class="string">"5b0939ef2dee9a0c7aa6368834655ab4d7e9066e"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>找到用于 launch 的 Activity ，然后在其 onCreate() 方法中调用 Crashlytics.start() 完成初始化。显然这是个单例模式，只需要初始化一次。当然，你在每个 Activity 中都掉用一次也是没有问题的。</p>
<p><code>kits.properties</code>文件<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># <span class="keyword">This</span> <span class="keyword">file</span> describes the kits <span class="keyword">for</span> your <span class="keyword">project</span>.</div><div class="line"># Commit <span class="keyword">this</span> and the kits folder <span class="keyword">into</span> <span class="keyword">source</span> control.</div><div class="line">com.crashlytics.sdk.android:crashlytics:<span class="number">2.2</span>.<span class="number">3</span></div></pre></td></tr></table></figure></p>
<hr>
<p>  crashlytics与<a href="http://blog.csdn.net/hpu_zyh/article/details/41320499" target="_blank" rel="external">自定义的UncaughtExceptionHandler</a> 有冲突，解决方法可选择取消自定义的。看<a href="http://rincliu.com/blog/2013/10/21/crashlytics/" target="_blank" rel="external">这篇博客</a></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Android_MVP_学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/07/Android_MVP_学习/">Android MVP 学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<p>MVP -- Model View Presenter</p>
<p>MartinFowler 的 <a target="_blank" href="http://martinfowler.com/eaaDev/ModelViewPresenter.html">
这篇文章</a>&nbsp;将MVP分为&nbsp;<a target="_blank" href="http://martinfowler.com/eaaDev/SupervisingPresenter.html">SupervisingPresenter</a>&nbsp;和
<a target="_blank" href="http://martinfowler.com/eaaDev/PassiveScreen.html">PassiveView</a><br>
</p>
<p><br>
</p>
<p>Android 中MVP 例子：&nbsp;<a target="_blank" href="https://github.com/antoniolg/androidmvp">https://github.com/antoniolg/androidmvp</a></p>
<p>先看一下项目的结构</p>
<p><img src="http://img.blog.csdn.net/20150406235245964?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="http://img.blog.csdn.net/20150406235215812?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>
</p>
<p><br>
</p>
<p>可以看出每个功能模块包含 XXActivity，XXView （Interface），XXPresenter（interface），XXPresenterImp</p>
<p><br>
</p>
<p>LoginView接口，负责逻辑处理</p>
<p><pre code_snippet_id="637416" snippet_file_name="blog_20150407_1_9255721" name="code" class="java">public interface LoginView {
    public void showProgress();

    public void hideProgress();

    public void setUsernameError();

    public void setPasswordError();

    public void navigateToHome();
}</pre></p>
<p><br>
</p>
<p>LoginPresenter接口</p>
<p><pre code_snippet_id="637416" snippet_file_name="blog_20150407_2_8605182" name="code" class="java">public interface LoginPresenter {
    public void validateCredentials(String username, String password);
}</pre><br>
</p>
LoginActivity，实现了LoginView接口，实现了对应的方法，内部包含一个Presenter作为成员变量，presenterImp调用响应的方法进行UI更新与同步
<p><pre code_snippet_id="637416" snippet_file_name="blog_20150407_3_3951890" name="code" class="java">public class LoginActivity extends Activity implements LoginView, View.OnClickListener {

    private ProgressBar progressBar;
    private EditText username;
    private EditText password;
    private LoginPresenter presenter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);

        progressBar = (ProgressBar) findViewById(R.id.progress);
        username = (EditText) findViewById(R.id.username);
        password = (EditText) findViewById(R.id.password);
        findViewById(R.id.button).setOnClickListener(this);

        presenter = new LoginPresenterImpl(this);
    }

    @Override public void showProgress() {
        progressBar.setVisibility(View.VISIBLE);
    }

    @Override public void hideProgress() {
        progressBar.setVisibility(View.GONE);
    }

    @Override public void setUsernameError() {
        username.setError(getString(R.string.username_error));
    }

    @Override public void setPasswordError() {
        password.setError(getString(R.string.password_error));
    }

    @Override public void navigateToHome() {
        startActivity(new Intent(this, MainActivity.class));
        finish();
    }

    @Override public void onClick(View v) {
        presenter.validateCredentials(username.getText().toString(), password.getText().toString());
    }
}
</pre></p>
<p><br>
</p>
LoginPresenterImp，实现了LoginPresenter<br>
<pre code_snippet_id="637416" snippet_file_name="blog_20150407_4_1872892" name="code" class="java">ublic class LoginPresenterImpl implements LoginPresenter, OnLoginFinishedListener {

    private LoginView loginView;
    private LoginInteractor loginInteractor;

    public LoginPresenterImpl(LoginView loginView) {
        this.loginView = loginView;
        this.loginInteractor = new LoginInteractorImpl();
    }

    @Override public void validateCredentials(String username, String password) {
        loginView.showProgress();
        loginInteractor.login(username, password, this);
    }

    @Override public void onUsernameError() {
        loginView.setUsernameError();
        loginView.hideProgress();
    }

    @Override public void onPasswordError() {
        loginView.setPasswordError();
        loginView.hideProgress();
    }

    @Override public void onSuccess() {
        loginView.navigateToHome();
    }
}
</pre><br>
整个项目架构中，将逻辑处理和UI同步更新从Activity中分离出来，代码更加简洁
<p>对于MVP还不是太理解，还需要再多看例子啊</p>
<p><br>
</p>
<p>关于<a target="_blank" href="https://github.com/wongcain/MVP-Simple-Demo">MVP的改进</a>&nbsp;&nbsp;：<a target="_blank" href="http://blog.cainwong.com/android-mvp-an-alternate-approach/">博客</a></p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-让动画活过来---Robound" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/03/让动画活过来---Robound/">让动画活过来---Robound</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<p>Rebound&nbsp;由Facebook推出</p>
<p>Rebound 可以使你的动画看起来像真实自然，像真实世界物理运动<br>
Rebound 不是一个物理引擎库，但是Rebound可以使用弹簧动力来驱动各种各样的动画<br>
Rebound使用和Origami(IOS的)相同的弹簧系数，方便实用。</p>
<p>上图：</p>
<p><img src="http://img.blog.csdn.net/20150403210540990?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="http://img.blog.csdn.net/20150403211401455?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">&nbsp;
 &nbsp;</p>
<p>&nbsp;<img src="http://img.blog.csdn.net/20150403211819570?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="http://img.blog.csdn.net/20150403211923127?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHB1X3p5aA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>
</p>
<p>使用：</p>
<p>下面为最后一张图片弹性缩放的代码：</p>
<p></p>
<pre code_snippet_id="635667" snippet_file_name="blog_20150403_1_4379386" name="code" class="java">// Create a system to run the physics loop for a set of springs.
SpringSystem springSystem = SpringSystem.create();

// Add a spring to the system.
Spring spring = springSystem.createSpring();

// Add a listener to observe the motion of the spring.
spring.addListener(new SimpleSpringListener() {

  @Override
  public void onSpringUpdate(Spring spring) {
    // You can observe the updates in the spring
    // state by asking its current value in onSpringUpdate.
    float value = (float) spring.getCurrentValue();
    float scale = 1f - (value * 0.5f);
    myView.setScaleX(scale);
    myView.setScaleY(scale);
  }
});

// Set the spring in motion; moving from 0 to 1
spring.setEndValue(1);</pre><br>
<p><br>
</p>
<p>官网：<a target="_blank" href="http://facebook.github.io/rebound/">http://facebook.github.io/rebound/</a></p>
<p></p>
<p>github源码 :&nbsp;<a target="_blank" href="https://github.com/facebook/rebound">https://github.com/facebook/rebound</a></p>
<p><br>
</p>
<p><br>
</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-使用Volley传输网络数据(官网教程)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/26/使用Volley传输网络数据(官网教程)/">使用Volley传输网络数据(官网教程)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<h1><span style="font-family:'Comic Sans MS'">介绍：</span></h1>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley是一个HTTP库,使Android应用程序变得更加容易,最重要的是,网络速度更快。并且是开源的。</span><br>
<br>
<br>
<span style="font-size:18px">Volley有以下特点：</span><br>
<span style="font-size:18px">*自动网络请求调度<br>
*多个并发的网络连接<br>
*透明的磁盘和内存响应缓存与标准HTTP缓存一致性。<br>
*支持请求优先级。<br>
*取消请求API。你可以取消一个请求，或者你可以设定取消请求的块或范围。<br>
*易于定制,例如,重试和补偿。<br>
*订制你异步从网络获取的数据，以便以填充UI<br>
*调试和跟踪工具。</span><br>
<br>
<br>
<br>
</span>
<p><span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley 擅长RPC-type操作,用于填充UI,如抓取页面搜索结果的结构化数据。它轻易与任何协议</span><span style="font-size:18px">集成</span><span style="font-size:18px">,开箱即用,支持原始字符串,图片,和JSON。你需要通过提供内置支持的特性,Volley 让你专注于你应用程序的逻辑。</span></span></p>
<span style="font-family:Comic Sans MS"><span style="font-size:12px">*RPC（Remote Procedure Call Protocol）——远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。</span><br>
<br>
<br>
<span style="font-size:18px">Volley <span style="color:#3333ff"><strong>不适合</strong></span>大型下载或流媒体业务,因为Volley 在内存中保存所有响应。对于大型下载操作,考虑使用另一种像<a target="_blank" href="http://developer.android.com/reference/android/app/DownloadManager.html">DownloadManager</a>。</span><br>
<br>
<br>
</span>
<p><span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley库的核心是在开放AOSP库开发框架， 在Volley 的 “toolbox” 包含请求调度主要管道以及一套普遍适用的实用程序”。</span></span></p>
<p><span style="font-size:12px"><span style="font-family:Comic Sans MS">AOSP:</span><span style="color:rgb(51,51,51); font-family:arial,宋体,sans-serif; line-height:24px; text-indent:2em">&quot;Android Open-Source Project&quot;的缩写</span><span style="text-indent:2em"><span style="font-family:Comic Sans MS">&nbsp;,</span></span><span style="color:rgb(51,51,51); font-family:arial,宋体,sans-serif; line-height:24px; text-indent:2em">中文意为&quot;</span><a target="_blank" href="http://baike.baidu.com/view/1241829.htm" style="font-family:arial,宋体,sans-serif; line-height:24px; text-indent:2em; text-decoration:none; color:rgb(19,110,194)">Android</a><span style="color:rgb(51,51,51); font-family:arial,宋体,sans-serif; line-height:24px; text-indent:2em">&nbsp;开放源代码项目&quot;</span></span></p>
<p><br>
</p>
<h1>下载</h1>
<p><br>
</p>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">添加Volley 到您的项目的最简单方法是克隆Volley 存储库并将它设置为一个library项目:</span><br>
<br>
<br>
</span>
<p><span style="font-family:Comic Sans MS"><span style="font-size:18px">通过git :</span></span></p>
<span style="font-family:Comic Sans MS"><span style="font-size:18px"></span></span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_1_8153672" name="code" class="plain">git clone https://android.googlesource.com/platform/frameworks/volley</pre><br>
<br>
<span style="font-size:18px">下载源代码,导入到你的应用程序项目中作为一个Android library项目(如管理项目从Eclipse ADT所述,如果你使用Eclipse)或使用volley.jar文件。</span><br>
<br>
<br>
<h1>教程</h1>
<h2><span style="font-family:Comic Sans MS"><span style="font-size:18px">1.发送一个简单的请求</span></span></h2>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">学习如何发送一个简单的请求使用Volley 的默认行为,以及如何取消请求。</span><br>
<br>
<span style="font-size:18px">在高版本别上，通过Volley创建一个RequestQueue,并请求对象。RequestQueue管理工作线程上的网络操作,读取或写入缓存,并解析响应。请求做解析原始响应和Volley将解析后的结果返回给主线程</span><br>
<br>
<span style="font-size:18px">这节课描述了如何使用Volley发送一个请求。<span style="color:#ff0000">Volley.newRequestQueue()</span>方法,建立了RequestQueue给你。在下一个课,建立RequestQueue,如何设置RequestQueue。</span><br>
<br>
<span style="font-size:18px">这节课还描述了如何添加一个请求到RequestQueue，和取消一个请求。</span><br>
<br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">1.1 添加网络权限</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">使用Volley,您必须添加<span style="color:#ff0000">&nbsp;android.permission. INTERNET
</span>在 AndroidManifest.xml中。没有这个,你的程序不能连接到网络。</span><br>
<br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">1.2 使用newRequestQueue</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley 提供了一种便利方法。为你设置了一个<span style="color:#ff0000">Volley.newRequestQueue(),</span>使用默认&#20540;,启动队列。例如:</span><br>
<br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_2_9709283" name="code" class="java">final TextView mTextView = (TextView) findViewById(R.id.text);
...

// Instantiate the RequestQueue.
RequestQueue queue = Volley.newRequestQueue(this);
String url =&quot;http://www.google.com&quot;;

// Request a string response from the provided URL.
StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
            new Response.Listener&lt;String&gt;() {
    @Override
    public void onResponse(String response) {
        // Display the first 500 characters of the response string.
        mTextView.setText(&quot;Response is: &quot;+ response.substring(0,500));
    }
}, new Response.ErrorListener() {
    @Override
    public void onErrorResponse(VolleyError error) {
        mTextView.setText(&quot;That didn&#39;t work!&quot;);
    }
});
// Add the request to the RequestQueue.
queue.add(stringRequest);</pre><span style="font-size:18px">Volley 总是在<strong><span style="color:#ff0000">主线程</span></strong>传递结果。运行在主线程与接收的数据方便填充UI控件,您可以自由地修改UI控件直接从您的响应处理程序,但它是尤其重要的许多重要的语义提供的库,尤其是取消请求。</span><br>
<br>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">1.3 发送一个请求</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">发送一个请求,只需建立一个RequestQueue,并使用add()将它添加到RequestQueue,如上所示。一旦你添加请求，它穿过管道维修,有其原始响应解析和交付。</span><br>
<br>
<br>
<span style="font-size:18px">当您调用add(),Volley 运行一个缓存处理线程和一个网络调度线程池。当你添加一个请求队列:如果请求存在缓存中,缓存的响应结果将返回给主线程。如果请求不能从缓存获取,它被放在网络队列。第一个可用的网络线程从队列中获得请求,执行HTTP事务,响应工作线程,将响应写入缓存,解析过的响应交付给主线程。</span><br>
<br>
<br>
<span style="font-size:18px">注意,耗时的操作,比如阻塞I / O和解析/解码工作线程上执行。您可以从任何线程添加一个请求,但反应总是在主线程传递。</span><br>
<br>
<br>
<span style="font-size:18px">下图说明了请求的生命周期:</span><br>
<img src="http://img.blog.csdn.net/20150325234103316" alt=""><br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">1.4 取消请求</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">取消请求,调用<span style="color:#ff0000">request.cancel()</span>。一旦取消,Volley 保证你的响应处理程序永远不会被调用。这意味着你可以取消你所有的挂起(pending)的请求在Activity的onStop()方法,你不必检查getActivity()== null 来回收响应处理程序,是否onSaveInstanceState()已经被调用,或其他defensive
 boilerplate。</span><br>
<span style="font-size:18px">利用这种行为,为了能够取消他们在适当的时候，你通常需要跟踪所有动态请求。有一个简单的办法:你为每个请求设置一个tag。然后,您可以使用这个标记提供取消的请求范围。例如,您可以将你的所有请求标记为他们所在的Activity,并<span style="font-family:'Comic Sans MS'; font-size:18px">在onStop()方法中</span>调用<span style="color:#ff0000">requestQueue.cancelAll(this)</span>。同样,在
 ViewPager Tab 中，你可以标记所有缩略图请求与各自的 Tab : 在 Tab 消失时 cancel()&nbsp;</span><br>
<span style="font-size:18px">&nbsp;</span><br>
<span style="font-size:18px">这里是一个例子,它使用一个字符串&#20540;的tag:</span><br>
</span>
<p><span style="font-family:Comic Sans MS"><span style="font-size:18px">&nbsp;</span></span></p>
<p><span style="font-family:Comic Sans MS"><span style="font-size:18px"></span></span></p>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_3_491901" name="code" class="java">//1.Define your tag and add it to your requests.
public static final String TAG = &quot;MyTag&quot;;
StringRequest stringRequest; // Assume this exists.
RequestQueue mRequestQueue;  // Assume this exists.

// Set the tag on the request.
stringRequest.setTag(TAG);

// Add the request to the RequestQueue.
mRequestQueue.add(stringRequest);
//2. In your activity&#39;s onStop() method, cancel all requests that have this tag.
@Override
protected void onStop () {
    super.onStop();
    if (mRequestQueue != null) {
        mRequestQueue.cancelAll(TAG);
    }
}</pre>
<p></p>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">当取消请求需要小心。如果你根据你的响应处理程序推进状态或启动另一个过程中,你需要考虑这个。再次,响应处理程序将不会被调用。</span><br>
<br>
<br>
</span>
<h2><span style="font-family:Comic Sans MS"><span style="font-size:18px">2.设置一个RequestQueue</span></span></h2>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">了解如何设置RequestQueue,如何实现单例模式创建一个RequestQueue持续你的应用程序的生命周期。</span><br>
<br>
<br>
<span style="font-size:18px">之前的课程 学习了Volley.newRequestQueue 创建RequestQueue。这节课将引导您完成的明确的步骤创建一个RequestQueue,允许您提供自己的自定义行为。</span><br>
<span style="font-size:18px">这节课还描述了建议创建一个 <span style="color:#ff0000">单例模式 </span>
的 RequestQueue,这使得RequestQueue持续在你的应用程序的生命周期。</span><br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">2.1 建立一个网络和缓存</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">RequestQueue需要两件事情来做它的工作:执行请求的传输网络,处理缓存的缓存。Volley的 toolbox中有些可用的 标准实现 : DiskBasedCache 根据一个内存中的索引提供 one-file-per-response缓存,并根据您选择BasicNetwork提供了一个网络传输 Android 的 HttpClient 或 HttpURLConnection。</span><br>
<br>
<br>
<span style="font-size:18px">BasicNetwork 是 Volley 的默认网络的实现。BasicNetwork 必须初始化你应用程序连接网络的HTTP客户机。通常这是 的 HttpClient 或 HttpURLConnection:</span><br>
<br>
<br>
<span style="font-size:18px">针对Android API级别低于9(姜饼)的应用, 使用Android 的 HttpClient 。9(姜饼)之前,HttpURLConnection是不可靠的。更多关于这个话题的讨论中,看Android 的 HTTP Clients&nbsp;</span><br>
<span style="font-size:18px">使用HttpURLConnection应用针对Android API级别9(姜饼)和更高。</span><br>
<br>
<br>
<span style="font-size:18px">创建一个应用程序运行在所有版本的Android系统,您可以检查版本的Android设备,选择适当的HTTP客户端运行,例如:</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_4_7686468" name="code" class="java">HttpStack stack;
...
// If the device is running a version &gt;= Gingerbread...
if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.GINGERBREAD) {
    // ...use HttpURLConnection for stack.
} else {
    // ...use AndroidHttpClient for stack.
}
Network network = new BasicNetwork(stack);</pre><br>
<span style="font-size:18px">设置RequestQueue所涉及的步骤:</span><br>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_5_8228323" name="code" class="java">RequestQueue mRequestQueue;

// Instantiate the cache
Cache cache = new DiskBasedCache(getCacheDir(), 1024 * 1024); // 1MB cap

// Set up the network to use HttpURLConnection as the HTTP client.
Network network = new BasicNetwork(new HurlStack());

// Instantiate the RequestQueue with the cache and network.
mRequestQueue = new RequestQueue(cache, network);

// Start the queue
mRequestQueue.start();

String url =&quot;http://www.myurl.com&quot;;

// Formulate the request and handle the response.
StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
        new Response.Listener&lt;String&gt;() {
    @Override
    public void onResponse(String response) {
        // Do something with the response
    }
},
    new Response.ErrorListener() {
        @Override
        public void onErrorResponse(VolleyError error) {
            // Handle error
    }
});

// Add the request to the RequestQueue.
mRequestQueue.add(stringRequest);
...</pre><span style="font-size:18px">如果你只需要一次性请求并且不想离开线程池,您可以创建RequestQueue只要你需要,调用 stop() &nbsp;一旦你的响应或错误回来,使用Volley.newRequestQueue()方法发送一个简单的请求。但更常见的用例是创建RequestQueue作为一个单例，生命周期保持在运行你的应用程序,在下一节中所述。</span><br>
<br>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">2.2 使用单例模式</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">如果应用程序经常使用的网络,这可能是最有效的建立一个单例的RequestQueue 持续在你的应用程序的生命周期。你可以用不同的方法实现这一目标。推荐的方法是实现一个单例类,封装了RequestQueue和其他Volley 功能。另一种方法是创建Application的子类在onCreate()中设置RequestQueue。但是这种方法是不推荐的; 静态单例可以提供相同的功能更模块化的方式。</span><br>
<span style="font-size:18px">一个关键概念是RequestQueue必须实例化 Application 的 context ,而不是 Activity 的 context 。这将确保RequestQueue将在你的应用程序的生命周期内,而不是每次都在重新创建Activity重新创建(例如,当用户旋转设备)。</span><br>
<br>
<br>
<span style="font-size:18px">这里是单例类的一个例子,它提供了RequestQueue和ImageLoader功能:</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_6_7341718" name="code" class="java">private static MySingleton mInstance;
    private RequestQueue mRequestQueue;
    private ImageLoader mImageLoader;
    private static Context mCtx;

    private MySingleton(Context context) {
        mCtx = context;
        mRequestQueue = getRequestQueue();

        mImageLoader = new ImageLoader(mRequestQueue,
                new ImageLoader.ImageCache() {
            private final LruCache&lt;String, Bitmap&gt;
                    cache = new LruCache&lt;String, Bitmap&gt;(20);

            @Override
            public Bitmap getBitmap(String url) {
                return cache.get(url);
            }

            @Override
            public void putBitmap(String url, Bitmap bitmap) {
                cache.put(url, bitmap);
            }
        });
    }

    public static synchronized MySingleton getInstance(Context context) {
        if (mInstance == null) {
            mInstance = new MySingleton(context);
        }
        return mInstance;
    }

    public RequestQueue getRequestQueue() {
        if (mRequestQueue == null) {
            // getApplicationContext() is key, it keeps you from leaking the
            // Activity or BroadcastReceiver if someone passes one in.
            mRequestQueue = Volley.newRequestQueue(mCtx.getApplicationContext());
        }
        return mRequestQueue;
    }

    public &lt;T&gt; void addToRequestQueue(Request&lt;T&gt; req) {
        getRequestQueue().add(req);
    }

    public ImageLoader getImageLoader() {
        return mImageLoader;
    }
}</pre><br>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_7_3107827" name="code" class="java">// Get a RequestQueue
RequestQueue queue = MySingleton.getInstance(this.getApplicationContext()).
    getRequestQueue();
...

// Add a request (in this example, called stringRequest) to your RequestQueue.
MySingleton.getInstance(this).addToRequestQueue(stringRequest);</pre><br>
<br>
<h2><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.建立一个标准的请求</span></span></h2>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">学习如何发送一个请求使用一个Volley 的开箱即用的请求类型(原始字符串、图像和JSON)。</span><br>
<br>
<span style="font-size:18px">本课程介绍如何使用Volley支持的通用请求类型,:</span><br>
<br>
<br>
<span style="font-size:18px">StringRequest：指定一个URL，接收响应的原始字符串。</span><br>
<span style="font-size:18px">ImageRequest：指定一个URL，接收一个图像作为回应。</span><br>
<span style="font-size:18px">JsonObjectRequest和JsonArrayRequest(JsonRequest 的子类)：指定一个URL，返回JSON对象或数组。</span><br>
<br>
<span style="font-size:18px">如果你的预期响应这些类型之一,你可能不需要实现一个自定义的请求。本课程介绍如何使用这些标准的请求类型。关于如何实现自己的自定义的信息请求,看实现一个自定义的请求。</span><br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.1 请求一个图像</span></span></h3>
<span style="font-family:Comic Sans MS"><br>
<span style="font-size:18px">Volley 提供以下类来请求图像。这些类层之上的相互提供不同层次的处理图片:</span><br>
<br>
<span style="font-size:18px"><strong><span style="color:#ff0000">ImageRequest</span></strong> ：给定的URL并且返回一个bitmap。它还提供了方便的特性,如指定调整大小。它的主要好处是, Volley的线程调度确保处理图片的耗时操作 (解码、调整大小) 自动发生在一个工作线程。</span><br>
<br>
<span style="font-size:18px"><strong><span style="color:#ff0000">ImageLoader</span></strong> ： 一个helper类，处理加载并且缓存图像从远程url。ImageLoader是大量ImageRequests的协调器,例如在ListView显示多个缩略图。ImageLoader 提供了一个内存中的缓存,这一点很重要,以防止闪烁。这使得它可以实现缓存,并且不阻止或推迟主线程, 使用磁盘 I/O 时这是不可能的。ImageLoader
 也 &nbsp;response coalescing, 几乎每一个响应处理程序将一个位图视图和导致布局通过每个图像。合并可以同时实现多个响应,这有助于提高性能。</span><br>
<br>
<span style="font-size:18px"><strong><span style="color:#ff0000">NetworkImageView</span></strong> ：基于 ImageLoader 有效地取代 ImageView 在通过URL获取网络图像的情况下。NetworkImageView 还可以设置在view从hierarchy中detached时取消挂起的请求。</span><br>
<br>
</span>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.1.1 使用ImageRequest</span></span></h4>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">下面是一个使用ImageRequest的示例。它检索指定的图像URL并在应用程序显示。请注意,这段代码与RequestQueue交互通过一个单例类(请参阅设置RequestQueue更多关于该话题的讨论):</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_8_269375" name="code" class="java">ImageView mImageView;
String url = &quot;http://i.imgur.com/7spzG.png&quot;;
mImageView = (ImageView) findViewById(R.id.myImage);
...

// Retrieves an image specified by the URL, displays it in the UI.
ImageRequest request = new ImageRequest(url,
    new Response.Listener&lt;Bitmap&gt;() {
        @Override
        public void onResponse(Bitmap bitmap) {
            mImageView.setImageBitmap(bitmap);
        }
    }, 0, 0, null,
    new Response.ErrorListener() {
        public void onErrorResponse(VolleyError error) {
            mImageView.setImageResource(R.drawable.image_load_error);
        }
    });
// Access the RequestQueue through your singleton class.
MySingleton.getInstance(this).addToRequestQueue(request);</pre><br>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.1.2 使用ImageLoader和NetworkImageView</span></span></h4>
<span style="font-family:Comic Sans MS"><br>
<span style="font-size:18px">您可以使用ImageLoader和NetworkImageView一致有效管理多个图像的显示,如在一个 ListView。在你的XML布局文件,在可以使用 ImageView 的地方，您可以使用NetworkImageView,例如:</span><br>
<br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_9_2447432" name="code" class="html">&lt;com.android.volley.toolbox.NetworkImageView
        android:id=&quot;@+id/networkImageView&quot;
        android:layout_width=&quot;150dp&quot;
        android:layout_height=&quot;170dp&quot;
        android:layout_centerHorizontal=&quot;true&quot; /&gt;</pre>
<p><span style="font-family:Comic Sans MS">使用ImageLoader展示图片</span></p>
<p><span style="font-family:Comic Sans MS"></span></p>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_10_721795" name="code" class="java">ImageLoader mImageLoader;
ImageView mImageView;
// The URL for the image that is being loaded.
private static final String IMAGE_URL =
    &quot;http://developer.android.com/images/training/system-ui.png&quot;;
...
mImageView = (ImageView) findViewById(R.id.regularImageView);

// Get the ImageLoader through your singleton class.
mImageLoader = MySingleton.getInstance(this).getImageLoader();
mImageLoader.get(IMAGE_URL, ImageLoader.getImageListener(mImageView,R.drawable.def_image, R.drawable.err_image));</pre>使用NetworkImageView
<p></p>
<p><span style="font-family:Comic Sans MS"></span></p>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_11_1263650" name="code" class="java">ImageLoader mImageLoader;
NetworkImageView mNetworkImageView;
private static final String IMAGE_URL = &quot;http://developer.android.com/images/training/system-ui.png&quot;;
...

// Get the NetworkImageView that will display the image.
mNetworkImageView = (NetworkImageView) findViewById(R.id.networkImageView);

// Get the ImageLoader through your singleton class.
mImageLoader = MySingleton.getInstance(this).getImageLoader();

// Set the URL of the image that should be loaded into this view, and
// specify the ImageLoader that will be used to make the request.
mNetworkImageView.setImageUrl(IMAGE_URL, mImageLoader);</pre>
<p></p>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">上面的片段通过一个单例类访问RequestQueue和ImageLoader,如建立RequestQueue 。这种方法可以确保在您的应用程序的生命周期中创建这些类的单个实例。这很重要的原因ImageLoader(处理的助手类加载和缓存图像),内存缓存的主要功能是允许flickerless旋转。使用单例模式允许 bitmap 缓存比activity存在时间长。反之,如果你在一个activity
 中创建ImageLoader ImageLoader将重建以及活动每次用户旋转设备。这将引起闪烁。</span><br>
<br>
<br>
</span>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.1.4 LRU缓存例子</span></span></h4>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley toolbox 提供了一个标准缓存通过DiskBasedCache缓存实现类。这类缓存文件直接到硬盘在指定的目录中。但使用ImageLoader,您应该提供一个自定义内存LRU bitmap 缓存实现 ImageLoader 接口。您可能希望设置缓存作为一个单例;讨论这个主题的更多信息,请参见设置RequestQueue。</span><br>
</span>
<p><span style="font-family:Comic Sans MS"></span></p>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_12_5949962" name="code" class="java">import android.graphics.Bitmap;
import android.support.v4.util.LruCache;
import android.util.DisplayMetrics;
import com.android.volley.toolbox.ImageLoader.ImageCache;

public class LruBitmapCache extends LruCache&lt;String, Bitmap&gt;
        implements ImageCache {

    public LruBitmapCache(int maxSize) {
        super(maxSize);
    }

    public LruBitmapCache(Context ctx) {
        this(getCacheSize(ctx));
    }

    @Override
    protected int sizeOf(String key, Bitmap value) {
        return value.getRowBytes() * value.getHeight();
    }

    @Override
    public Bitmap getBitmap(String url) {
        return get(url);
    }

    @Override
    public void putBitmap(String url, Bitmap bitmap) {
        put(url, bitmap);
    }

    // Returns a cache size equal to approximately three screens worth of images.
    public static int getCacheSize(Context ctx) {
        final DisplayMetrics displayMetrics = ctx.getResources().
                getDisplayMetrics();
        final int screenWidth = displayMetrics.widthPixels;
        final int screenHeight = displayMetrics.heightPixels;
        // 4 bytes per pixel
        final int screenBytes = screenWidth * screenHeight * 4;

        return screenBytes * 3;
    }
}</pre>使用：
<p></p>
<p><span style="font-family:Comic Sans MS"></span></p>
<pre code_snippet_id="628064" snippet_file_name="blog_20150326_13_3144530" name="code" class="java">RequestQueue mRequestQueue; // assume this exists.
ImageLoader mImageLoader = new ImageLoader(mRequestQueue, new LruBitmapCache(LruBitmapCache.getCacheSize()));</pre>
<p></p>
<p><br>
</p>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">3.2 JSON请求</span></span></h3>
<span style="font-family:Comic Sans MS"><br>
<span style="font-size:18px">Volley 为JSON请求提供了以下几个类:</span><br>
<br>
<span style="font-size:18px"><strong><span style="color:#ff0000">JsonArrayRequest</span></strong>： 给定URL，返回JSONArray响应主体。</span><br>
<br>
<span style="font-size:18px"><span style="color:#ff0000"><strong>JsonObjectRequest</strong></span> ：给定URL，返回JSONObject响应主体L,比如允许一个可选的JSONObject作为请求的一部分传递的身体。</span><br>
<br>
<span style="font-size:18px">两类基于共同基类 JsonRequest。你使用它们遵循相同的基本模式使用其他类型的请求。例如,这个代码片段获取JSON提要并显示为文本的界面:</span><br>
<br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_14_6402382" name="code" class="java">TextView mTxtDisplay;
ImageView mImageView;
mTxtDisplay = (TextView) findViewById(R.id.txtDisplay);
String url = &quot;http://my-json-feed&quot;;

JsonObjectRequest jsObjRequest = new JsonObjectRequest
        (Request.Method.GET, url, null, new Response.Listener&lt;JSONObject&gt;() {

    @Override
    public void onResponse(JSONObject response) {
        mTxtDisplay.setText(&quot;Response: &quot; + response.toString());
    }
}, new Response.ErrorListener() {

    @Override
    public void onErrorResponse(VolleyError error) {
        // TODO Auto-generated method stub

    }
});

// Access the RequestQueue through your singleton class.
MySingleton.getInstance(this).addToRequestQueue(jsObjRequest);</pre><br>
<h2><span style="font-family:Comic Sans MS"><span style="font-size:18px">4.实现一个自定义的请求</span></span></h2>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">了解如何实现一个自定义的请求。</span><br>
<span style="font-size:18px">这节课描述了如何实现自己的自定义请求类型。</span><br>
<br>
</span>
<h3><span style="font-family:Comic Sans MS"><span style="font-size:18px">4.1 编写一个定制的请求</span></span></h3>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">工具箱中的大多数请求有现成的实现;如果响应是一个字符串,图片,或者JSON,你可能不会需要实现一个自定义的请求。</span><br>
<span style="font-size:18px">以下情况,你需要实现一个自定义的请求,这是所有您需要做的:</span><br>
<br>
<span style="font-size:18px">继承 Request&lt;T&gt; 类, &lt;T&gt; 代表响应的结果类型. </span><span style="font-size:18px">如果你的响应是一个字符串,创建您的自定义请求通过继承 Request&lt;String&gt;。</span><br>
<span style="font-size:18px">实现 抽象方法 parseNetworkResponse() 和 deliverResponse() ,后面将更详细地描述。</span><br>
<br>
<br>
</span>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">4.1.1 parseNetworkResponse</span></span></h4>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">对于一个给定的类型(如字符串、图像或JSON)，响应封装，解析响应交付,。下面是一个示例， 实现parseNetworkResponse():</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_15_9660235" name="code" class="java">@Override
protected Response&lt;T&gt; parseNetworkResponse(
        NetworkResponse response) {
    try {
        String json = new String(response.data,
        HttpHeaderParser.parseCharset(response.headers));
    return Response.success(gson.fromJson(json, clazz),
    HttpHeaderParser.parseCacheHeaders(response));
    }
    // handle errors
...
}</pre><span style="font-size:18px">请注意以下几点:</span><br>
<br>
<span style="font-size:18px">NetworkResponse parseNetworkResponse()作为它的参数,其中包含响应负载作为一个byte[],HTTP状态码和响应头。</span><br>
<p><span style="font-size:18px; font-family:'Comic Sans MS'">您的实现必须返回一个Response&lt;T&gt;,其中包含你的输入响应对象和缓存元数据或错误,比如在解析失败的情况下。</span></p>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">如果你的协议标准语义缓存,您可以构建一个缓存。进入你自己,但大多数请求很好是这样的:</span><br>
<br>
<span style="font-size:18px">return Response.success(myDecodedObject,HttpHeaderParser.parseCacheHeaders(response));</span><br>
<br>
<br>
<span style="font-size:18px">Volley调用parseNetworkResponse()从一个工作线程。这确保了耗时的解析操作,如JPEG解码成位图,不要阻塞UI线程。</span><br>
<br>
<br>
</span>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">4.1.2 deliverResponse</span></span></h4>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">Volley 将parseNetworkResponse()返回的对象回调给主线程。大多数请求调用回调接口,例如:</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_16_8250242" name="code" class="java">protected void deliverResponse(T response) {
        listener.onResponse(response);</pre><br>
<h4><span style="font-family:Comic Sans MS"><span style="font-size:18px">4.1.3 实例: GsonRequest</span></span></h4>
<span style="font-family:Comic Sans MS"><span style="font-size:18px">Gson是一个Library，使用反射将Java对象转换为JSON。您可以定义Java对象,具有相同的名称作为相应的JSON键,通过Gson类对象,Gson将为您填写的字段。下面是一个完整的实施一连串要求使用Gson解析:</span><br>
</span><pre code_snippet_id="628064" snippet_file_name="blog_20150326_17_2380148" name="code" class="java">public class GsonRequest&lt;T&gt; extends Request&lt;T&gt; {
    private final Gson gson = new Gson();
    private final Class&lt;T&gt; clazz;
    private final Map&lt;String, String&gt; headers;
    private final Listener&lt;T&gt; listener;

    /**
     * Make a GET request and return a parsed object from JSON.
     *
     * @param url URL of the request to make
     * @param clazz Relevant class object, for Gson&#39;s reflection
     * @param headers Map of request headers
     */
    public GsonRequest(String url, Class&lt;T&gt; clazz, Map&lt;String, String&gt; headers,
            Listener&lt;T&gt; listener, ErrorListener errorListener) {
        super(Method.GET, url, errorListener);
        this.clazz = clazz;
        this.headers = headers;
        this.listener = listener;
    }

    @Override
    public Map&lt;String, String&gt; getHeaders() throws AuthFailureError {
        return headers != null ? headers : super.getHeaders();
    }

    @Override
    protected void deliverResponse(T response) {
        listener.onResponse(response);
    }

    @Override
    protected Response&lt;T&gt; parseNetworkResponse(NetworkResponse response) {
        try {
            String json = new String(
                    response.data,
                    HttpHeaderParser.parseCharset(response.headers));
            return Response.success(
                    gson.fromJson(json, clazz),
                    HttpHeaderParser.parseCacheHeaders(response));
        } catch (UnsupportedEncodingException e) {
            return Response.error(new ParseError(e));
        } catch (JsonSyntaxException e) {
            return Response.error(new ParseError(e));
        }
    }
}</pre><br>
<span style="font-size:18px">Volley 提供现成的JsonArrayRequest和JsonArrayObject类如果你愿意采取这种方法。有关更多信息,请参见使用标准的请求类型</span><br>
<br>
<br>
<br>
<span style="font-size:18px">原文地址： http://developer.android.com/training/volley/index.html</span>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-HTTP_header_详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/23/HTTP_header_详解/">HTTP header 详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<div id="view-titleh">
<div id="view-title">
<h3 style="text-align:center">HTTP HEADER 详解</h3>
</div>
<div id="view-summary"><br>
</div>
</div>
<div id="readercontainer" style="color:rgb(64,64,64)">
<table cellspacing="1" cellpadding="4">
<tbody>
<tr>
<td>Header</td>
<td>解释</td>
<td>示例</td>
</tr>
<tr>
<td>Accept-Ranges</td>
<td>表明服务器是否支持指定范围请求及哪种类型的分段请求</td>
<td>Accept-Ranges: bytes</td>
</tr>
<tr>
<td>Age</td>
<td>从原始服务器到代理缓存形成的估算时间（以秒计，非负）</td>
<td>Age: 12</td>
</tr>
<tr>
<td>Allow</td>
<td>对某网络资源的有效的请求行为，不允许则返回405</td>
<td>Allow: GET, HEAD</td>
</tr>
<tr>
<td>Cache-Control</td>
<td>告诉所有的缓存机制是否可以缓存及哪种类型</td>
<td>Cache-Control: no-cache</td>
</tr>
<tr>
<td>Content-Encoding</td>
<td>web服务器支持的返回内容压缩编码类型。</td>
<td>Content-Encoding: gzip</td>
</tr>
<tr>
<td>Content-Language</td>
<td>响应体的语言</td>
<td>Content-Language: en,zh</td>
</tr>
<tr>
<td>Content-Length</td>
<td>响应体的长度</td>
<td>Content-Length: 348</td>
</tr>
<tr>
<td>Content-Location</td>
<td>请求资源可替代的备用的另一地址</td>
<td>Content-Location: /index.htm</td>
</tr>
<tr>
<td>Content-MD5</td>
<td>返回资源的MD5校验&#20540;</td>
<td>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td>
</tr>
<tr>
<td>Content-Range</td>
<td>在整个返回体中本部分的字节位置</td>
<td>Content-Range: bytes 21010-47021/47022</td>
</tr>
<tr>
<td>Content-Type</td>
<td>返回内容的MIME类型</td>
<td>Content-Type: text/html; charset=utf-8</td>
</tr>
<tr>
<td>Date</td>
<td>原始服务器消息发出的时间</td>
<td>Date: Tue, 15 Nov 2010 08:12:31 GMT</td>
</tr>
<tr>
<td>ETag</td>
<td>请求变量的实体标签的当前&#20540;</td>
<td>ETag: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>Expires</td>
<td>响应过期的日期和时间</td>
<td>Expires: Thu, 01 Dec 2010 16:00:00 GMT</td>
</tr>
<tr>
<td>Last-Modified</td>
<td>请求资源的最后修改时间</td>
<td>Last-Modified: Tue, 15 Nov 2010 12:45:26 GMT</td>
</tr>
<tr>
<td>Location</td>
<td>用来重定向接收方到非请求URL的位置来完成请求或标识新的资源</td>
<td>Location: http://www.zcmhi.com/archives/94.html</td>
</tr>
<tr>
<td>Pragma</td>
<td>包括实现特定的指令，它可应用到响应链上的任何接收方</td>
<td>Pragma: no-cache</td>
</tr>
<tr>
<td>Proxy-Authenticate</td>
<td>它指出认证方案和可应用到代理的该URL上的参数</td>
<td>Proxy-Authenticate: Basic</td>
</tr>
<tr>
<td>refresh</td>
<td>应用于重定向或一个新的资源被创造，在5秒之后重定向（由网景提出，被大部分浏览器支持）</td>
<td><br>
<br>
<br>
<br>
<span style="color:rgb(64,64,64)">Refresh: 5; url=</span><br>
<span style="color:rgb(64,64,64)">http://www.zcmhi.com/archives/94.html</span></td>
</tr>
<tr>
<td>Retry-After</td>
<td>如果实体暂时不可取，通知客户端在指定时间之后再次尝试</td>
<td>Retry-After: 120</td>
</tr>
<tr>
<td>Server</td>
<td>web服务器<span style="color:rgb(64,64,64)">软件</span>名称</td>
<td>Server: Apache/1.3.27 (Unix) (Red-Hat/Linux)</td>
</tr>
<tr>
<td>Set-Cookie</td>
<td>设置Http Cookie</td>
<td>Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</td>
</tr>
<tr>
<td>Trailer</td>
<td>指出头域在分块传输编码的尾部存在</td>
<td>Trailer: Max-Forwards</td>
</tr>
<tr>
<td>Transfer-Encoding</td>
<td>文件传输编码</td>
<td><span style="color:rgb(64,64,64)">Transfer-Encoding:chunked</span></td>
</tr>
<tr>
<td>Vary</td>
<td>告诉下游代理是使用缓存响应还是从原始服务器请求</td>
<td>Vary: *</td>
</tr>
<tr>
<td>Via</td>
<td>告知代理客户端响应是通过哪里发送的</td>
<td>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</td>
</tr>
<tr>
<td>Warning</td>
<td>警告实体可能存在的问题</td>
<td>Warning: 199 Miscellaneous warning</td>
</tr>
<tr>
<td>WWW-Authenticate</td>
<td>表明客户端请求实体应该使用的授权方案</td>
<td>WWW-Authenticate: Basic</td>
</tr>
</tbody>
</table>
<p><strong>HTTP Request的Header信息</strong></p>
<p><strong>1、HTTP请求方式</strong></p>
<p>如下表：</p>
<div align="center">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<p align="center" style="color:rgb(64,64,64)"><strong>方&nbsp;法</strong></p>
</td>
<td valign="top">
<p align="center" style="color:rgb(64,64,64)"><strong>描&nbsp;述</strong></p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">GET</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">向Web服务器请求一个文件</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">POST</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">向Web服务器发送数据让Web服务器进行处理</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">PUT</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">向Web服务器发送数据并存储在Web服务器内部</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">HEAD</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">检查一个对象是否存在</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">DELETE</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">从Web服务器上删除一个文件</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">CONNECT</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">对通道提供支持</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">TRACE</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">跟踪到服务器的路径</p>
</td>
</tr>
<tr>
<td valign="top">
<p style="color:rgb(64,64,64)">OPTIONS</p>
</td>
<td valign="top">
<p style="color:rgb(64,64,64)">查询Web服务器的性能</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>说明：</p>
<p>主要使用到“GET”和“POST”。</p>
<p>实例：</p>
<p>POST /test/tupian/cm HTTP/1.1</p>
<p>分成三部分：</p>
<p>（1）POST：HTTP请求方式</p>
<p>（2）/test/tupian/cm：请求Web服务器的目录地址（或者指令）</p>
<p>（3）HTTP/1.1: URI（Uniform Resource Identifier，统一资源标识符）及其版本</p>
<p>备注：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在Ajax中，对应method属性设置。</p>
<p><strong>2、Host</strong></p>
<p>说明：</p>
<p>请求的web服务器域名地址</p>
<p>实例：</p>
<p>例如web请求URL：<a target="_blank" name="baidusnap0" style="color:rgb(34,116,155)"></a><a target="_blank" href="http://zjm-forum-test10.zjm.baidu.com:8088/test/tupian/cm" style="color:rgb(0,95,169)"><span style="color:rgb(0,0,255)"><span style="color:rgb(64,64,64)">http://zjm-forum-test10.zjm.baidu.com:8088/test/tupian/cm</span></span></a></p>
<p>Host就为zjm-forum-test10.zjm.baidu.com:8088</p>
<p><strong>3、User-Agent</strong></p>
<p>说明：</p>
<p>HTTP客户端运行的浏览器类型的详细信息。通过该头部信息，web服务器可以判断到当前HTTP请求的客户端浏览器类别。</p>
<p>实例：</p>
<p>&nbsp;&nbsp;&nbsp; User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11</p>
<p><strong>4、Accept</strong></p>
<p>说明：</p>
<p>指定客户端能够接收的内容类型，内容类型中的先后次序表示客户端接收的先后次序。</p>
<p>实例：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如：</p>
<p>Accept:text/xml,application/xml,application/xhtml&#43;xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5</p>
<p>备注：</p>
<p>在Prototyp（1.5）的Ajax代码封装中，将Accept默认设置为“text/javascript, text/html, application/xml, text/xml, */*”。这是因为Ajax默认获取服务器返回的Json数据模式。</p>
<p>在Ajax代码中，可以使用XMLHttpRequest&nbsp;对象中setRequestHeader函数方法来动态设置这些Header信息。</p>
<p><strong>5、Accept-Language</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;指定HTTP客户端浏览器用来展示返回信息所优先选择的语言。</p>
<p>实例：</p>
<p>Accept-Language: zh-cn,zh;q=0.5</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里默认为中文。</p>
<p><strong>6、Accept-Encoding</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定客户端浏览器可以支持的web服务器返回内容压缩编码类型。表示允许服务器在将输出内容发送到客户端以前进行压缩，以节约带宽。而这里设置的就是客户端浏览器所能够支持的返回压缩&#26684;式。</p>
<p>实例：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Accept-Encoding: gzip,deflate</p>
<p>备注：</p>
<p>其实在百度很多产品线中，apache在给客户端返回页面数据之前，将数据以gzip&#26684;式进行压缩。</p>
<p>另外有关deflate压缩介绍：</p>
<p><a target="_blank" href="http://man.chinaunix.net/newsoft/ApacheMenual_CN_2.2new/mod/mod_deflate.html" style="color:rgb(0,95,169)"><span style="color:rgb(64,64,64)"><span style="color:rgb(0,0,255)"><span style="color:rgb(64,64,64)">http://man.chinaunix.net/newsoft/ApacheMenual_CN_2.2new/mod/mod_deflate.html</span></span></span></a></p>
<p><strong>7、Accept-Charset</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;浏览器可以接受的字符编码集。</p>
<p>实例：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Accept-Charset: gb2312,utf-8;q=0.7,*;q=0.7</p>
<p><strong>8、Content-Type</strong></p>
<p>说明：</p>
<p>显示此HTTP请求提交的内容类型。一般只有post提交时才需要设置该属性。</p>
<p>实例：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Content-type: application/x-www-form-urlencoded;charset:UTF-8</p>
<p>有关Content-Type属性&#20540;可以如下两种编码类型：</p>
<p>（1）“application/x-www-form-urlencoded”：&nbsp;表单数据向服务器提交时所采用的编码类型，默认的缺省&#20540;就是“application/x-www-form-urlencoded”。&nbsp;然而，在向服务器发送大量的文本、包含非ASCII字符的文本或二进制数据时这种编码方式效率很低。</p>
<p>（2）“multipart/form-data”：&nbsp;在文件上载时，所使用的编码类型应当是“multipart/form-data”，它既可以发送文本数据，也支持二进制数据上载。</p>
<p>当提交为单单数据时，可以使用“application/x-www-form-urlencoded”；当提交的是文件时，就需要使用“multipart/form-data”编码类型。</p>
<p>在Content-Type属性当中还是指定提交内容的charset字符编码。一般不进行设置，它只是告诉web服务器post提交的数据采用的何种字符编码。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一般在开发过程，是由前端工程与后端UI工程师商量好使用什么字符编码&#26684;式来post提交的，然后后端ui工程师按照固定的字符编码来解析提交的数据。所以这里设置的charset没有多大作用。</p>
<p><strong>9、</strong><a target="_blank" name="baidusnap5" style="color:rgb(34,116,155)"></a><strong>Connection</strong></p>
<p>说明：</p>
<p>表示是否需要持久连接。如果web服务器端看到这里的&#20540;为“<a target="_blank" name="baidusnap2" style="color:rgb(34,116,155)"></a>Keep-Alive”，或者看到请求使用的是HTTP 1.1（HTTP 1.1默认进行持久连接），它就可以利用持久连接的优点，当页面包含多个元素时（例如Applet，图片），显著地减少下载所需要的时间。要实现这一点，&nbsp;web服务器需要在返回给客户端HTTP头信息中发送一个Content-Length（返回信息正文的长度）头，最简单的实现方法是：先把内容写入ByteArrayOutputStream，然&nbsp;后在正式写出内容之前计算它的大小。</p>
<p>实例：</p>
<p><strong>Connection: keep-alive</strong></p>
<p><strong>10、Keep-Alive</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示此HTTP连接的Keep-Alive时间。使客户端到服务器端的连接持续有效，当出现对服务器的后继请求时，Keep-Alive功能避免了建立或者重新建立连接。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以前HTTP请求是一站式连接，从HTTP/1.1协议之后，就有了长连接，即在规定的Keep-Alive时间内，连接是不会断开的。</p>
<p>实例：</p>
<p><strong>Keep-Alive: 300</strong></p>
<p><strong>11、cookie</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HTTP请求发送时，会把保存在该请求域名下的所有cookie&#20540;一起发送给web服务器。</p>
<p><strong>12、Referer</strong></p>
<p>说明：</p>
<p>包含一个URL，用户从该URL代表的页面出发访问当前请求的页面</p>
<p><strong>·服务器端返回HTTP头部信息</strong></p>
<p><strong>1、Content-Length</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表示web服务器返回消息正文的长度</p>
<p><strong>2、Content-Type:</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;返回数据的类型（例如text/html文本类型）和字符编码&#26684;式。</p>
<p>实例：</p>
<p>Content-Type: text/html;charset=utf-8</p>
<p><strong>3、Date</strong></p>
<p>说明：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示当前的时间</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------</p>
<p>网络开发 必须 先熟悉协议&nbsp;<br>
TCP/IP 协议 ----- 大学通信工程专业 必修专业课<br>
<br>
<br>
web开发 必须先 熟悉 http协议&nbsp;<br>
客户端和服务器建立通信连接后，进行数据交互，使用协议进行交流&nbsp;<br>
<br>
<br>
HTTP协议特征<br>
1、基于TCP传输协议&nbsp;<br>
OSI七层网络体系结构 ： 物理层、数据链路层、网络层、传输层、表示层、会话层、应用层&nbsp;<br>
TCP 是 传输层 协议<br>
HTTP 是 应用层协议 基于TCP 协议&nbsp;<br>
<br>
<br>
TCP特征 ： 三层握手&nbsp;<br>
1)、A给B 说话： 能听到我说话吗？<br>
2)、B回应：我能听到，能听到我说话吗？<br>
3)、A回应：我也能听到&nbsp;<br>
确保通信畅通的 ---- 数据传输不允许丢包&nbsp;<br>
A 给 B 发数据，如果B 没有回应，A 选择重新发送 &nbsp;----- 超时&nbsp;<br>
<br>
<br>
2、默认端口80 &nbsp;省略端口 &nbsp;http://www.itcast.cn 省略 :80<br>
<br>
<br>
3、基于请求－响应模式的协议<br>
先请求，再出现响应 &nbsp;---- 请求和响应 一一对应&nbsp;<br>
<br>
<br>
实验一 ： 通过telnet 连接服务器，进行协议操作&nbsp;<br>
XP 自动安装telnet&nbsp;<br>
win7 系统 安装telnet插件&nbsp;<br>
* telnet 采用 传输层连接原理方式 &nbsp;通信内容必须严&#26684;按照应用层协议&nbsp;<br>
语法：telnet ip port&nbsp;<br>
1、 cmd&gt; telnet localhost 80&nbsp;<br>
2、手动输入HTTP协议请求&nbsp;<br>
telnet乱码解决：ctrl&#43;] 回车<br>
3、输入协议内容<br>
GET / HTTP/1.0<br>
HOST: localhost<br>
回车<br>
<br>
<br>
实验二 &nbsp;： 安装Httpwatch<br>
完成访问web页面时 http协议数据包 抓取&nbsp;<br>
<br>
<br>
查看网络连接过程中 http协议内容&nbsp;<br>
<br>
<br>
请求内容<br>
<br>
<br>
GET / HTTP/1.1<br>
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, */*<br>
Accept-Language: zh<br>
Accept-Encoding: gzip, deflate<br>
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727)<br>
Host: localhost<br>
Connection: Keep-Alive<br>
<br>
<br>
响应内容<br>
<br>
<br>
HTTP/1.1 200 OK<br>
Server: Apache-Coyote/1.1<br>
ETag: W/&quot;7347-1184876416000&quot;<br>
Last-Modified: Thu, 19 Jul 2007 20:20:16 GMT<br>
Content-Type: text/html<br>
Content-Length: 7347<br>
Date: Sat, 09 Jun 2012 07:02:35 GMT<br>
<br>
<br>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br>
<br>
<br>
...<br>
<br>
<br>
<br>
<br>
HTTP 和 HTML 关系 ？<br>
HTTP 通信协议 规定数据传输&#26684;式<br>
HTML 网页设计语言，静态网页数据&nbsp;<br>
<br>
<br>
HTTP 传输&#26684;式 、HTML 传输内容&nbsp;<br>
<br>
<br>
HTTP/1.0、HTTP/1.1 区别？<br>
1.0 一次 与服务器连接 只能获得一个资源&nbsp;<br>
1.1 一次与服务器连接 ，连续获得多个资源&nbsp;<br>
<br>
<br>
思考题：<br>
一个web页面中，使用img标签引用了三幅图片，当客户端访问服务器中的这个web页面时，客户端总共会访问几次服务器，即向服务器发送了几次HTTP请求。<br>
* 三幅图片地址是否相同&nbsp;<br>
如果三幅图片地址都不相同 --- 4次请求<br>
<br>
<br>
第一部分 HTTP 请求<br>
请求完整&#26684;式 包括三个部分 ： 请求行、头信息、请求体&nbsp;<br>
<br>
<br>
1、请求行：请求中第一行信息 &nbsp;---- 包括三个部分 请求方式、资源路径、HTTP协议版本<br>
例如： GET / HTTP/1.1&nbsp;<br>
HTTP请求方式有几种 ： POST、GET、HEAD、OPTIONS、DELETE、TRACE、PUT<br>
常用两种： GET 、 POST&nbsp;<br>
<br>
<br>
客户端网页哪些是GET方式请求？ 哪些是 POST 请求<br>
GET方式 ：1、用户直接在浏览器上手动输入url地址 &nbsp;2、&lt;a href=&quot;url&quot;&gt;&lt;/a&gt; &nbsp;3、&lt;form method=&quot;get&quot; &gt; *form表单默认提交方式就是get&nbsp;<br>
POST方式： 1、&lt;form method=&quot;post&quot; &gt;<br>
<br>
<br>
GET提交方式和POST提交方式区别 ？<br>
Get url地址后携带数据有大小限制 1K ,提交数据在url上显示&nbsp;<br>
* http://localhost/day04/url?username=zhangsan &#26684;式 url?name=value&amp;name=value&amp;name=value...&nbsp;<br>
以？分隔url和参数，参数采用键&#20540;对&#26684;式，多个参数使用&amp; 符合分隔<br>
<br>
<br>
POST 数据在请求体中，不在url上显示 ，没有数据大小限制&nbsp;<br>
* username=zhangsan 请求体和头信息直接存在一个空行&nbsp;<br>
<br>
<br>
2、头信息： 很多key -value&nbsp;<br>
Accept: text/html,image/* &nbsp; ----- 客户端可以接收文件类型 text/html HTML文件 image/* 任意&#26684;式图片<br>
Accept-Charset: ISO-8859-1 ----- 客户端可以识别编码字符集 &nbsp;<br>
Accept-Encoding: gzip ----- &nbsp;客户端可以识别压缩数据&#26684;式 gzip是一种压缩&#26684;式&nbsp;<br>
Accept-Language:zh-cn ----- 客户端浏览器语言&nbsp;<br>
Host: www.itcast.com:80 &nbsp;----- 访问服务器地址&nbsp;<br>
If-Modified-Since: Tue, 11 Jul 2000 18:23:51 GMT ----- 该请求的资源在客户端保存最后访问时间 （缓存有关）<br>
Referer: http://www.itcast.com/index.jsp ---- 上一次请求访问页面地址&nbsp;<br>
User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0) ---- 客户端浏览器类型版本&nbsp;<br>
Connection: close/Keep-Alive &nbsp; &nbsp;---- 该次请求连接后，连接是保持还是关闭 1.0 关闭 1.1 保持&nbsp;<br>
Date: Tue, 11 Jul 2000 18:23:51 GMT ---- 请求时间&nbsp;<br>
<br>
<br>
******* Accept-Encoding 、If-Modified-Since 、Referer&nbsp;<br>
<br>
<br>
Referer 防止客户盗链数据 ：通过google搜索页面直接下载 其它网站数据 （盗链）<br>
<br>
<br>
模拟浏览器访问服务器 获得 refererServlet当中信息<br>
1) URL 连接 ---- HTTP协议<br>
2) Socket 连接 ----- TCP协议&nbsp;<br>
<br>
<br>
<br>
<br>
3、请求体： 存放客户端提交post 请求 数据<br>
key=value&amp;key=value&amp;key=value .... &nbsp;&nbsp;<br>
例如 ： username=sss&nbsp;<br>
<br>
<br>
<br>
<br>
第二部分 HTTP响应<br>
响应数据 分为三个部分 ：状态行、头信息、响应体&nbsp;<br>
1、状态行 分为三个部分： HTTP协议版本、状态码、描述信息<br>
例如: HTTP/1.1 200 OK&nbsp;<br>
100～199 Informational &nbsp;请求信息不足 ，还需要其他信息才能处理<br>
200～299 Success &nbsp;请求处理成功<br>
300～399 Redirection 服务器已经处理完毕，客户端还需要进一步动作<br>
400～499 Client Error &nbsp;客户端错误<br>
500～599 Server Error &nbsp;服务器端错误<br>
<br>
<br>
200 请求处理成功 302 客户端进行重定向 304 客户端访问资源没有被修改后，客户端访问本地缓存 404 访问资源不存在 500 服务器内部出错<br>
借钱<br>
200 &nbsp;A 找 B 借钱 B 将钱 借个A&nbsp;<br>
302 &nbsp;A 找 B 借钱 B 通知 A 找C 借钱 --- A 找C 借钱<br>
304 &nbsp;A 找 B 借钱 ， B对A 说 借过了 --- A 使用 之前从B 借的钱<br>
404 &nbsp;没钱<br>
505 &nbsp;B 不存在了&nbsp;<br>
<br>
<br>
2、响应头&nbsp;<br>
Location: http://www.it315.org/index.jsp ---- 重定向地址 结合 302 一起使用&nbsp;<br>
* 重定向 两次请求 两次响应&nbsp;<br>
Server:apache tomcat ----- 服务器类型<br>
Content-Encoding: gzip ---- 设置响应数据压缩&#26684;式 &nbsp; ---- 请求 Accept-Encoding&nbsp;<br>
* 如果响应数据经过压缩 传输体积更小，性能更好&nbsp;<br>
<br>
<br>
没有压缩情况下 &nbsp;13605字节 &nbsp;http://localhost/docs/<br>
如何设置tomcat压缩&nbsp;<br>
* 通过设置 tomcat/conf/server.xml 设置响应数据压缩&nbsp;<br>
&lt;Connector port=&quot;80&quot; protocol=&quot;HTTP/1.1&quot;&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;connectionTimeout=&quot;20000&quot;&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;redirectPort=&quot;8443&quot; compressableMimeType=&quot;text/html,text/xml,text/plain&quot; compression=&quot;on&quot;/&gt;<br>
* 清除浏览器缓存，重启tomcat&nbsp;<br>
4244字节 http://localhost/docs/<br>
<br>
<br>
Content-Length: 80 &nbsp;----- 响应数据长度<br>
Content-Language: zh-cn &nbsp;----- 响应数据语言<br>
Content-Type: text/html; charset=GB2312 &nbsp;----- 响应数据类型&nbsp;<br>
* 数据类型采用Mime协议规定类型 html文件 ---- text/html、 jpg文件---- image/jpeg<br>
* 在 tomcat/conf/web.xml 中查看文件mime类型&nbsp;<br>
<br>
<br>
Last-Modified: Tue, 11 Jul 2000 18:23:51 GMT &nbsp;----- 和请求头信息 If-Modified-Since一起使用，控制服务器缓存<br>
* ETag: W/&quot;13397-1184876416000&quot; tomcat生成Etag 13397文件大小 1184876416000文件最后修改时间（精确毫秒）<br>
* 客户端下次请求时通过If-None-Match 携带刚刚 Etag信息&nbsp;<br>
<br>
<br>
Refresh: 1;url=http://www.it315.org ----- 网页自动跳转&nbsp;<br>
Content-Disposition: attachment; filename=aaa.zip ----- 文件下载时指定文件附件名称<br>
<br>
<br>
控制该程序在客户端不缓存<br>
Expires: -1&nbsp;<br>
Cache-Control: no-cache &nbsp;<br>
Pragma: no-cache &nbsp;&nbsp;<br>
* 对于动态程序，经常修改， 禁止浏览器缓存内容<br>
<br>
<br>
Connection: close/Keep-Alive &nbsp; ---- 响应后连接是否关闭<br>
Date: Tue, 11 Jul 2000 18:23:51 GMT --- 响应时间&nbsp;<br>
<br>
<br>
重点：302结合Location进行重定向 、在tomcat配置gzip压缩 、tomcat缓存策略 、禁止浏览器缓存&nbsp;<br>
<br>
<br>
3、响应体<br>
通常HTML 文件内容 &nbsp;---- 如果设置响应体进行gzip压缩，看到gzip压缩内容<br>
<br>
<br>
-------------------------------------------------------------------------------------------------<br>
通过HTTP协议Range头信息 实现断点下载功能&nbsp;<br>
在连接服务器目标资源进行下载过程中，传递Range头信息， 指定下载目标资源部分内容 ---- 实现断点下载功能&nbsp;<br>
&nbsp;<br>
使用URL类 模拟客户端访问 WebRoot/info.txt 下载文件中内容<br>
</p>
<div><br>
</div>
</div>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-向服务器提交时的3种Content-Type" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/23/向服务器提交时的3种Content-Type/">向服务器提交时的3种Content-Type</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p><strong>application/x-www-form-urlencoded</strong>：窗体数据被编码为key/value的形式。这是标准的编码格式。这是默认的方式。</p>
<blockquote>
<p>当action为<strong>get</strong>时候，浏览器用x-www-form-urlencoded的编码方式把form数据转换成一个字串（name1=value1&amp;name2=value2…），然后把这个字串append到url后面，用 <strong>?</strong> 分割，加载这个新的url。<br>当action为<strong>post</strong>时候，浏览器把form数据封装到http body中，然后发送到server。 如果没有type=file的控件，用默认的application/x-www-form-urlencoded就可以了。</p>
</blockquote>
<p>但是如果有type=file的话，就要用到multipart/form-data了。浏览器会把整个表单以控件为单位分割，并为每个部分加上Content-Disposition(form-data或者file),Content-Type(默认为text/plain),name(控件name)等信息，并加上分割符(boundary)。</p>
</li>
</ul>
<ul>
<li><p><strong>multipart/form-data</strong>：窗体数据被编码为一条消息，页上的每个控件对应消息中的一个部分。二进制数据传输方式，主要用于上传文件</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Content-<span class="keyword">Type</span>: multipart/<span class="keyword">form</span>-<span class="keyword">data</span>; boundary=&lt;Boundary&gt;</div><div class="line">--&lt;Boundary&gt;</div><div class="line"></div><div class="line">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=<span class="string">"key"</span></div><div class="line">&lt;resource_key&gt;</div><div class="line">--&lt;Boundary&gt;</div><div class="line"></div><div class="line">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=<span class="string">"x:&lt;custom_field_name&gt;"</span></div><div class="line">&lt;custom_value&gt;</div><div class="line">--&lt;Boundary&gt;</div><div class="line"></div><div class="line">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=<span class="string">"token"</span></div><div class="line">&lt;upload_token&gt;</div><div class="line">--&lt;Boundary&gt;</div><div class="line"></div><div class="line">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=<span class="string">"file"</span>; filename=<span class="string">"[文件名]"</span></div><div class="line">Content-<span class="keyword">Type</span>: &lt;MimeType&gt;</div><div class="line">[文件内容]</div><div class="line">--&lt;Boundary&gt;--</div></pre></td></tr></table></figure>
</li>
<li><p><strong>text/plain</strong>：窗体数据以纯文本形式进行编码，其中不含任何控件或格式字符。</p>
</li>
</ul>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-使用CSS控制Android控件的样式--pixate-freestyle-android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/22/使用CSS控制Android控件的样式--pixate-freestyle-android/">使用CSS控制Android控件的样式--pixate-freestyle-android</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###介绍</p>
<p>介绍一个开源项目 <strong>pixate-freestyle-android</strong></p>
<p>项目地址：<a href="https://github.com/Pixate/pixate-freestyle-android" target="_blank" rel="external">https://github.com/Pixate/pixate-freestyle-android</a></p>
<p>让我们使用css的形式来控制Android的控件的样式，支持的控件有</p>
<ol>
<li>View (generic attributes support for all views)</li>
<li>ImageView</li>
<li>TextView</li>
<li>CheckedTextView</li>
<li>Button</li>
<li>CompoundButton  </li>
<li>ImageButton</li>
<li>ToggleButton</li>
<li>RadioButton</li>
<li>CheckBox  </li>
<li>Spinner  </li>
<li>ListView  </li>
<li>GridView  </li>
<li>EditText (support a   non-editing mode)</li>
<li>ActionBar (not in the View’s hierarchy, but almost  completely supported)</li>
</ol>
<p>###使用</p>
<p>1.下载 <a href="http://download.csdn.net/detail/u011282069/8523655" target="_blank" rel="external">JAR</a> 包，导入工程<br>2.创建 <strong>default.css</strong> 在 <strong>assets</strong><br>3.初始化：</p>
<p>Activity中：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">    <span class="comment">// Set the license (get it for free from www.pixate.com).</span></div><div class="line">    <span class="comment">// This should be done at least once in the main activity.</span></div><div class="line">    Pixate.setLicenseKey(<span class="string">"Your License Key"</span>, <span class="string">"Your Email"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Initialize pixate for the Activity</span></div><div class="line">    Pixate.init(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    setContentView(R.layout.main);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Fragment中<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">    <span class="comment">// Initialize pixate for the Fragment</span></div><div class="line">    Pixate.init(getActivity());</div><div class="line"></div><div class="line">    setContentView(R.layout.fragment);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###为控件设置样式</p>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Setting a class for a Button</span></div><div class="line">Pixate.setStyleClass(<span class="keyword">button</span>, <span class="string">"myButton"</span>)<span class="comment">;</span></div><div class="line"></div><div class="line"><span class="comment">// Setting an ID for a Button</span></div><div class="line">Pixate.setStyleId(<span class="keyword">button</span>, <span class="string">"myButtonId"</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:<span class="built_in">id</span>=<span class="string">"@+id/myButtonId"</span></div><div class="line">    <span class="built_in">class</span>=<span class="string">"myButton"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">    android:<span class="built_in">text</span>=<span class="string">"@string/myButtonStr"</span></div><div class="line">    android:textSize=<span class="string">"16sp"</span> /&gt;</div></pre></td></tr></table></figure>
<p><strong>Button</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#button1</span><span class="selector-pseudo">:pressed</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(pressed.svg);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/button.png" alt="这里写图片描述"></p>
<p><strong>CheckBox and RadioButton</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Default state (non-checked) */</span></div><div class="line"><span class="selector-id">#bt</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(unchecked-bg.svg);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Checked state */</span></div><div class="line"><span class="selector-id">#bt</span><span class="selector-pseudo">:checked</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(checked-bg.svg);</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">You</span> <span class="selector-tag">can</span> <span class="selector-tag">also</span> <span class="selector-tag">control</span> <span class="selector-tag">the</span> <span class="selector-tag">check-mark</span> <span class="selector-tag">or</span> <span class="selector-tag">radio</span> <span class="selector-tag">icon</span> <span class="selector-tag">itself</span>. <span class="selector-tag">To</span> <span class="selector-tag">do</span> <span class="selector-tag">so</span>, <span class="selector-tag">we</span> <span class="selector-tag">defined</span> <span class="selector-tag">a</span> <span class="selector-tag">virtual</span> <span class="selector-tag">child</span> <span class="selector-tag">named</span> <span class="selector-tag">icon</span> <span class="selector-tag">for</span> <span class="selector-tag">that</span> <span class="selector-tag">view</span>:</div><div class="line"></div><div class="line"> <span class="comment">/* Default, non-checked, icon */</span></div><div class="line"><span class="selector-id">#bt</span> <span class="selector-tag">icon</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(check-off.svg);</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">60</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Checked state icon */</span></div><div class="line"><span class="selector-id">#bt</span> <span class="selector-tag">icon</span><span class="selector-pseudo">:checked</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(check-on.svg);</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">60</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/checkbox.png" alt="这里写图片描述"></p>
<p><strong>ToggleButton</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">You</span> <span class="selector-tag">can</span> <span class="selector-tag">style</span> <span class="selector-tag">toggle</span> <span class="selector-tag">On</span> <span class="selector-tag">and</span> <span class="selector-tag">Off</span> <span class="selector-tag">states</span> <span class="selector-tag">by</span> <span class="selector-tag">using</span> <span class="selector-tag">the</span> <span class="selector-tag">toggle</span> <span class="selector-tag">virtual-child</span>:</div><div class="line"></div><div class="line"><span class="selector-class">.toggle</span> <span class="selector-tag">toggle</span><span class="selector-pseudo">:off</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(toggle-off.svg);</div><div class="line">    <span class="attribute">background-size</span>:  <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.toggle</span> <span class="selector-tag">toggle</span><span class="selector-pseudo">:on</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(toggle-on.svg);</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/toggle-button.png" alt="这里写图片描述"></p>
<p><strong>ImageView and ImageButton</strong></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The ImageView <span class="keyword">and</span> the ImageButton have <span class="built_in">some</span> <span class="built_in">unique</span> <span class="built_in">properties</span> that can be styled via CSS.</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20150322211131562" alt="这里写图片描述"><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.imageView</span> &#123;</div><div class="line">    <span class="attribute">tint</span>: <span class="number">#450022FF</span>;</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">matrix</span>(0.70710677, -0.70710677, 0.70710677, 0.70710677, 0.0, 200.0);</div><div class="line">    <span class="attribute">scale-type</span>: matrix;</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">450px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">You</span> <span class="selector-tag">can</span> <span class="selector-tag">define</span> <span class="selector-tag">the</span> <span class="selector-tag">image</span> <span class="selector-tag">that</span> <span class="selector-tag">will</span> <span class="selector-tag">be</span> <span class="selector-tag">displayed</span> <span class="selector-tag">in</span> <span class="selector-tag">the</span> <span class="selector-tag">ImageView</span> <span class="selector-tag">by</span> <span class="selector-tag">using</span> <span class="selector-tag">the</span> <span class="selector-tag">image</span> <span class="selector-tag">virtual-child</span>:</div><div class="line"></div><div class="line"><span class="selector-class">.imageView</span> <span class="selector-tag">image</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(default.svg);</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">300px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">And</span> <span class="selector-tag">you</span> <span class="selector-tag">can</span> <span class="selector-tag">easily</span> <span class="selector-tag">define</span> <span class="selector-tag">a</span> <span class="selector-tag">state</span> <span class="selector-tag">for</span> <span class="selector-tag">that</span> <span class="selector-tag">ImageView</span>, <span class="selector-tag">making</span> <span class="selector-tag">it</span> <span class="selector-tag">react</span> <span class="selector-tag">to</span> <span class="selector-tag">clicking</span> <span class="selector-tag">events</span>. <span class="selector-tag">An</span> <span class="selector-tag">ImageButton</span> <span class="selector-tag">already</span> <span class="selector-tag">has</span> <span class="selector-tag">a</span> <span class="selector-tag">pre-defined</span> <span class="selector-tag">state</span> <span class="selector-tag">for</span> <span class="selector-tag">pressed</span>, <span class="selector-tag">so</span> <span class="selector-tag">setting</span> <span class="selector-tag">the</span> <span class="selector-tag">pressed</span> <span class="selector-tag">state</span> <span class="selector-tag">in</span> <span class="selector-tag">the</span> <span class="selector-tag">CSS</span> <span class="selector-tag">will</span> <span class="selector-tag">simply</span> <span class="selector-tag">overwrite</span> <span class="selector-tag">it</span>.</div><div class="line"></div><div class="line"><span class="selector-class">.imageView</span> <span class="selector-tag">image</span><span class="selector-pseudo">:pressed</span> &#123;</div><div class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(pressed.svg);</div><div class="line">    <span class="attribute">background-size</span>: <span class="number">300px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/image-view.png" alt="这里写图片描述"></p>
<p><strong>ListView</strong><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Styling a ListView consists <span class="keyword">of</span> <span class="keyword">of</span> properties <span class="keyword">that</span> will be applied <span class="keyword">to</span> <span class="keyword">the</span> entire <span class="built_in">list</span>, <span class="keyword">and</span> properties <span class="keyword">that</span> will target <span class="keyword">the</span> <span class="built_in">list</span> rows. We'll start <span class="keyword">by</span> showing how <span class="keyword">to</span> control <span class="keyword">the</span> <span class="built_in">list</span> dividers <span class="keyword">and</span> setting an overscroll paint:</div><div class="line"></div><div class="line">/* <span class="keyword">set</span> a <span class="number">5</span> pixel divider <span class="keyword">with</span> a gradient color */</div><div class="line">.myList &#123;</div><div class="line">    divider: linear-gradient(black, orange);</div><div class="line">    divider-height: <span class="number">5</span>px;</div><div class="line">&#125;</div><div class="line">/* <span class="keyword">set</span> <span class="keyword">the</span> overscroll drawables <span class="keyword">for</span> <span class="keyword">the</span> header <span class="keyword">and</span> <span class="keyword">the</span> footer */</div><div class="line">.myList overscroll &#123;</div><div class="line">    distance: <span class="number">200</span>px;</div><div class="line">    footer: linear-gradient(red, white);</div><div class="line">    header: url(top-overscroll.png);</div><div class="line">&#125;</div><div class="line">Note <span class="keyword">that</span> <span class="keyword">the</span> overscroll <span class="keyword">is</span> handled <span class="keyword">by</span> a virtual child named overscroll. It can accept header, footer <span class="keyword">and</span> distance values <span class="keyword">to</span> define <span class="keyword">the</span> overscroll images <span class="keyword">and</span> <span class="keyword">the</span> distance <span class="keyword">that</span> will be allowed <span class="keyword">to</span> show them.</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/list-view.png" alt="这里写图片描述"></p>
<p><strong>Nth-Child</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">We</span> <span class="selector-tag">can</span> <span class="selector-tag">also</span> <span class="selector-tag">access</span> <span class="selector-tag">and</span> <span class="selector-tag">style</span> <span class="selector-tag">the</span> <span class="selector-tag">nth-child</span> <span class="selector-tag">of</span> <span class="selector-tag">the</span> <span class="selector-tag">list</span> <span class="selector-tag">items</span> <span class="selector-tag">to</span> <span class="selector-tag">paint</span> <span class="selector-tag">odd</span> <span class="selector-tag">and</span> <span class="selector-tag">even</span> <span class="selector-tag">rows</span> <span class="selector-tag">differently</span>. <span class="selector-tag">This</span> <span class="selector-tag">is</span> <span class="selector-tag">done</span> <span class="selector-tag">by</span> <span class="selector-tag">using</span> <span class="selector-tag">the</span> <span class="selector-tag">nth-child</span> <span class="selector-tag">pseudo-class</span>.</div><div class="line"></div><div class="line"><span class="comment">/* every odd row */</span></div><div class="line"><span class="selector-class">.myList</span><span class="selector-pseudo">:nth-child(2n+1)</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#006600</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/* every even row */</span></div><div class="line"><span class="selector-class">.myList</span><span class="selector-pseudo">:nth-child(2n)</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#FF0000</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>GridView</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">GridView</span> <span class="selector-tag">styling</span> <span class="selector-tag">includes</span> <span class="selector-tag">properties</span> <span class="selector-tag">that</span> <span class="selector-tag">control</span> <span class="selector-tag">column</span> <span class="selector-tag">count</span>, <span class="selector-tag">width</span> <span class="selector-tag">and</span> <span class="selector-tag">spacing</span>.</div><div class="line"></div><div class="line"><span class="selector-tag">A</span> <span class="selector-tag">typical</span> <span class="selector-tag">usage</span> <span class="selector-tag">would</span> <span class="selector-tag">be</span> <span class="selector-tag">to</span> <span class="selector-tag">simply</span> <span class="selector-tag">set</span> <span class="selector-tag">the</span> <span class="selector-tag">column</span> <span class="selector-tag">count</span> <span class="selector-tag">and</span> <span class="selector-tag">let</span> <span class="selector-tag">Android</span> <span class="selector-tag">take</span> <span class="selector-tag">care</span> <span class="selector-tag">of</span> <span class="selector-tag">evenly</span> <span class="selector-tag">spacing</span> <span class="selector-tag">the</span> <span class="selector-tag">columns</span>.</div><div class="line"></div><div class="line"><span class="selector-class">.myGridView</span> &#123;</div><div class="line">    <span class="attribute">column-count</span>: <span class="number">4</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">For</span> <span class="selector-tag">finer</span> <span class="selector-tag">control</span>, <span class="selector-tag">we</span> <span class="selector-tag">can</span> <span class="selector-tag">set</span> <span class="selector-tag">the</span> <span class="selector-tag">properties</span> <span class="selector-tag">that</span> <span class="selector-tag">affect</span> <span class="selector-tag">width</span> <span class="selector-tag">and</span> <span class="selector-tag">spacing</span>:</div><div class="line"></div><div class="line"><span class="comment">/* 4 cols, each 180 wide with gap of 50 between, and gap of 50 between rows too. */</span></div><div class="line"><span class="selector-class">.myGridView</span> &#123;</div><div class="line">    <span class="attribute">column-count</span>: <span class="number">4</span>;</div><div class="line">    <span class="attribute">column-width</span>: <span class="number">180</span>;</div><div class="line">    <span class="attribute">column-gap</span>: <span class="number">50</span>;</div><div class="line">    <span class="attribute">column-stretch-mode</span>: none; <span class="comment">/* 'none' will leave the width as 180. Can also accept spacing, spacing-uniform or column-width */</span></div><div class="line">    <span class="attribute">row-gap</span>: <span class="number">50</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/Pixate/pixate-freestyle-android/wiki/Articles/2013-12-06-android-views-demo/grid-view.png" alt="这里写图片描述"></p>
<p>更多信息可以去<a href="https://github.com/Pixate/pixate-freestyle-android" target="_blank" rel="external">github</a>上查看</p>
<hr>
<p><a href="http://download.csdn.net/detail/u011282069/8523655" target="_blank" rel="external">JAR包</a><br><a href="http://download.csdn.net/detail/u011282069/8523681" target="_blank" rel="external">Demo下载</a></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Padding与绘制区域--android_clipToPadding和android_clipChildren" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/21/Padding与绘制区域--android_clipToPadding和android_clipChildren/">Padding与绘制区域--android:clipToPadding和android:clipChildren</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>设计一个界面，整个界面包含一个listview，但是listview不是全部充满屏幕,如下:</p>
<p>可能会这样设计布局<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#2262"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/listview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"16dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"16dp"</span></div><div class="line">        <span class="attr">android:paddingTop</span>=<span class="string">"16dp"</span> &gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20150321192538448" alt="这里写图片描述"></p>
<p>但是这里有个问题：<strong>滚动时顶部不能填充</strong></p>
<p>这时候就需要<br><strong><em>android:clipToPadding</em></strong> 和 <strong><em>android:clipChildren</em></strong><br>官方文档：<br><img src="http://img.blog.csdn.net/20150321192847006" alt="这里写图片描述"><br><strong>clipToPadding</strong>:控件的绘制区域是否在padding里面, 值为true时padding那么绘制的区域就不包括padding区域;<br>定义一个孩子是否仅限于画里面的界限。<br><strong>clipChildren</strong>:当ViewGroup的Padding不为0时，定义ViewGroup是否裁剪子孩子的填充。</p>
<p>这两个属性默认是true的，所以在设置了padding情况下，默认滚动是在 padding内部的，要达到上面的效果主要把这两个属性设置了false那么这样子控件就能画到padding的区域了。</p>
<p>修改后的代码<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#2262"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/listview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"16dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"16dp"</span></div><div class="line">        <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">        <span class="attr">android:paddingTop</span>=<span class="string">"16dp"</span> &gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>再看效果<br><img src="http://img.blog.csdn.net/20150321193715691" alt="这里写图片描述"></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-控制View的OnClick_OnTouch来实现LsitView的Item的侧滑出现删除" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/20/控制View的OnClick_OnTouch来实现LsitView的Item的侧滑出现删除/">控制View的OnClick OnTouch来实现LsitView的Item的侧滑出现删除</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>效果：<br><img src="http://img.blog.csdn.net/20150320203755100" alt="这里写图片描述"></p>
<p>触摸：按下，移动，抬起<br>点击：一组触摸事件的组合(按下，松开)<br>长按：一组触摸事件的组合(按下，持续超过500ms（Android中）)</p>
<p>为一个View设置点击事件：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">view.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;    </div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">              Log.i(<span class="string">""</span>, <span class="string">"onClick"</span>);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure></p>
<p>为一个View设置touch事件：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">view.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">	</div><div class="line">		<span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">		</div><div class="line">			<span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">				Log.i(<span class="string">""</span>, <span class="string">"ACTION_DOWN"</span>);</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">				</div><div class="line">			<span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">				Log.i(<span class="string">""</span>, <span class="string">"ACTION_MOVE"</span>);</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">				</div><div class="line">			<span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">			<span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">				Log.i(<span class="string">""</span>, <span class="string">"ACTION_UP"</span>);</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">		&#125;			</div><div class="line">              <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure></p>
<p>当同时为一个View设置点击和touch事件时：</p>
<p>在onTouch返回false时：<br><img src="http://img.blog.csdn.net/20150320202716541" alt="这里写图片描述"><br>当onTouch返回true时：<br><img src="http://img.blog.csdn.net/20150320202702783" alt="这里写图片描述"><br>不在响应点击事件了</p>
<p>我们的需求是，在item关闭时可以响应点击事件（onTouch中返回false），在item打开时不响应点击事件（onTouch中返回true）</p>
<p>下面处理Touch事件：</p>
<blockquote>
<p>ACTION_DOWN： 记录下手指按下的位置<br>ACTION_MOVE： 判断移动的距离（带正负号）移动item<br>ACTION_UP：根据手指抬起位置，将视图移动到合适的位置</p>
</blockquote>
<p>listView 的 item 的布局<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    android:id=<span class="string">"@+id/layout"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"86dp"</span></div><div class="line">    android:layout_below=<span class="string">"@+id/Listview"</span> &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/more"</span></div><div class="line">        android:layout_width=<span class="string">"60dp"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:layout_toLeftOf=<span class="string">"@+id/delete"</span></div><div class="line">        android:<span class="built_in">background</span>=<span class="string">"@android:color/darker_gray"</span></div><div class="line">        android:clickable=<span class="string">"true"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:onClick=<span class="string">"more"</span></div><div class="line">        android:<span class="built_in">text</span>=<span class="string">"更多"</span></div><div class="line">        android:textColor=<span class="string">"@android:color/white"</span></div><div class="line">        android:<span class="built_in">textSize</span>=<span class="string">"16sp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/delete"</span></div><div class="line">        android:layout_width=<span class="string">"60dp"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:layout_alignParentRight=<span class="string">"true"</span></div><div class="line">        android:<span class="built_in">background</span>=<span class="string">"@android:color/holo_red_light"</span></div><div class="line">        android:clickable=<span class="string">"true"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:onClick=<span class="string">"delete"</span></div><div class="line">        android:<span class="built_in">text</span>=<span class="string">"删除"</span></div><div class="line">        android:textColor=<span class="string">"@android:color/white"</span></div><div class="line">        android:<span class="built_in">textSize</span>=<span class="string">"16sp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/tv_top"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:<span class="built_in">background</span>=<span class="string">"@android:color/holo_orange_dark"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:<span class="built_in">text</span>=<span class="string">"item"</span></div><div class="line">        android:<span class="built_in">textSize</span>=<span class="string">"20sp"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<p>自定义的View</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zyh.slideview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.Animator;</div><div class="line"><span class="keyword">import</span> android.animation.Animator.AnimatorListener;</div><div class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</div><div class="line"><span class="keyword">import</span> android.widget.RelativeLayout;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MoveLayout</span> <span class="keyword">extends</span> <span class="title">RelativeLayout</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> downX;</div><div class="line">    <span class="keyword">private</span> TextView tv_top;</div><div class="line">    <span class="keyword">private</span> TextView delete;</div><div class="line">    <span class="keyword">private</span> TextView more;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MoveLayout</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MoveLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MoveLayout</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">        LayoutInflater.from(context).inflate(R.layout.move_layout, <span class="keyword">this</span>, <span class="keyword">true</span>);</div><div class="line">        delete = (TextView) findViewById(R.id.delete);</div><div class="line">        more = (TextView) findViewById(R.id.more);</div><div class="line">        tv_top = (TextView) findViewById(R.id.tv_top);</div><div class="line">        tv_top.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">                <span class="function"><span class="keyword">return</span> <span class="title">handlerTouch</span><span class="params">(v, event)</span></span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        tv_top.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        more.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        delete.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* ---------------------处理 Touch-------------------------- */</span></div><div class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">boolean</span> isOpen = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">boolean</span> <span class="title">handlerTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> bottomWidth = delete.getWidth() + delete.getWidth();</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                // Log.i(<span class="string">""</span>, <span class="string">"ACTION_DOWN"</span>);</div><div class="line">                downX = (<span class="keyword">int</span>) event.getRawX();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                // Log.i(<span class="string">""</span>, <span class="string">"ACTION_MOVE"</span>);</div><div class="line">                <span class="comment">// if (isAniming)</span></div><div class="line">                <span class="comment">// break;</span></div><div class="line">                <span class="keyword">int</span> dx = (<span class="keyword">int</span>) (event.getRawX() - downX);</div><div class="line">                <span class="comment">// Log.i("", "dy___" + dx);</span></div><div class="line">                <span class="keyword">if</span> (isOpen) &#123;</div><div class="line">                    <span class="comment">// 打开状态</span></div><div class="line">                    <span class="comment">// 向右滑动</span></div><div class="line">                    <span class="keyword">if</span> (dx &gt; <span class="number">0</span> &amp;&amp; dx &lt; bottomWidth) &#123;</div><div class="line">                        v.setTranslationX(dx - bottomWidth);</div><div class="line">                        <span class="comment">// 允许移动，阻止点击</span></div><div class="line">                        result = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// 闭合状态</span></div><div class="line">                    <span class="comment">// 向左移动</span></div><div class="line">                    <span class="keyword">if</span> (dx &lt; <span class="number">0</span> &amp;&amp; Math.abs(dx) &lt; bottomWidth) &#123;</div><div class="line">                        v.setTranslationX(dx);</div><div class="line">                        <span class="comment">// 允许移动，阻止点击</span></div><div class="line">                        result = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line"></div><div class="line">                // Log.i(<span class="string">""</span>, <span class="string">"ACTION_UP"</span> + v.getTranslationX());</div><div class="line"></div><div class="line">                <span class="comment">// 获取已经移动的</span></div><div class="line">                <span class="keyword">float</span> ddx = v.getTranslationX();</div><div class="line"></div><div class="line">                <span class="comment">// 判断打开还是关闭</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span> (ddx &lt;= <span class="number">0</span> &amp;&amp; ddx &gt; -(bottomWidth / <span class="number">2</span>)) &#123;</div><div class="line">                    <span class="comment">// 关闭</span></div><div class="line">                    ObjectAnimator oa1 = ObjectAnimator.ofFloat(v, <span class="string">"translationX"</span>, ddx, <span class="number">0</span>).setDuration(<span class="number">100</span>);</div><div class="line">                    oa1.start();</div><div class="line">                    oa1.addListener(<span class="keyword">new</span> AnimatorListener() &#123;</div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                            isOpen = <span class="keyword">false</span>;</div><div class="line">                            result = <span class="keyword">false</span>;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                            isOpen = <span class="keyword">false</span>;</div><div class="line">                            result = <span class="keyword">false</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (ddx &lt;= -(bottomWidth / <span class="number">2</span>) &amp;&amp; ddx &gt; -bottomWidth) &#123;</div><div class="line">                    <span class="comment">// 打开</span></div><div class="line">                    ObjectAnimator oa1 = ObjectAnimator.ofFloat(v, <span class="string">"translationX"</span>, ddx, -bottomWidth)</div><div class="line">                            .setDuration(<span class="number">100</span>);</div><div class="line">                    oa1.start();</div><div class="line">                    result = <span class="keyword">true</span>;</div><div class="line">                    isOpen = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.tv_top:</div><div class="line">                Toast.makeText(context, <span class="string">"item"</span>, 0).show();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.more:</div><div class="line">                Toast.makeText(context, <span class="string">"more"</span>, 0).show();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.delete:</div><div class="line">                Toast.makeText(context, <span class="string">"delete"</span>, 0).show();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>源代码：github](<a href="https://github.com/18236887539/SlideLayout" target="_blank" rel="external">https://github.com/18236887539/SlideLayout</a>)</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-小窝搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/23/小窝搭建/">小窝搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>地址：<a href="http://hanks-zyh.github.io/hankiya/">http://hanks-zyh.github.io/hankiya/</a></p>
<p><img src="http://img.blog.csdn.net/20150223161821494" alt="http://hanks-zyh.github.io/hankiya/"></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Windows_下安装_Jekyll" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/22/Windows_下安装_Jekyll/">Windows 下安装 Jekyll</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###安装Ruby<br> 到官网：<a href="http://rubyinstaller.org/downloads/" target="_blank" rel="external">http://rubyinstaller.org/downloads/</a>  下载Ruby 2.1.5安装<br> <img src="http://img.blog.csdn.net/20150222172631740" alt="这里写图片描述"><br>完成后 输入 ruby -v<br><img src="http://img.blog.csdn.net/20150222172938454" alt="这里写图片描述"></p>
<p>###安装DevKit<br> 下载：<a href="http://rubyinstaller.org/downloads/" target="_blank" rel="external">http://rubyinstaller.org/downloads/</a><br> 解压缩到 C:/DevKit<br>初始化 config.yml </p>
<p>命令行输入：<br><em>cd “C:\DevKit”<br>ruby dk.rb init<br>notepad config.yml</em> </p>
<p>打开的文件末尾添加<br>  <em>- C:\Ruby21-x64</em></p>
<p>命令行：</p>
<p><em>ruby dk.rb review</em><br><em>ruby dk.rb install</em></p>
<p>###安装 Jekyll</p>
<p> 执行  <em>gem install jekyll</em></p>
<blockquote>
<p>c:\Ruby21-x64&gt;gem install jekyll<br>ERROR:  Could not find a valid gem ‘jekyll’ (&gt;= 0), here is why:<br>Unable to download data from <a href="https://rubygems.org/" target="_blank" rel="external">https://rubygems.org/</a> - SSL_connect returned=1 errno=0 state=<br>SSLv3 read server certificate B: certificate verify failed (<a href="https://rubygems.org/latest_specs.4.8.gz" target="_blank" rel="external">https://rubygems.org/latest_specs.4.8.gz</a>)</p>
</blockquote>
<p>需要安装curl<br>下载：<a href="http://curl.haxx.se/download.html" target="_blank" rel="external">http://curl.haxx.se/download.html</a></p>
<p>完成后执行： <em>curl <a href="http://curl.haxx.se/ca/cacert.pem" target="_blank" rel="external">http://curl.haxx.se/ca/cacert.pem</a> -o cacert.pem</em><br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100  223k  100  223k    0     0  82478      0  0:00:02  0:00:02 –:–:– 94724</p>
<p>将 <strong>cacert.pem</strong> 文件移动到Ruby安装目录<br>添加环境变量：<br><img src="http://img.blog.csdn.net/20150222200533619" alt="这里写图片描述"></p>
<p>再次安装 ， 执行  <em>gem install jekyll</em></p>
<blockquote>
<p>C:\Users\Administrator&gt;gem install jekyll<br>Fetching: fast-stemmer-1.0.2.gem (100%)<br>Temporarily enhancing PATH to include DevKit…<br>Building native extensions.  This could take a while…<br>Successfully installed fast-stemmer-1.0.2<br>Fetching: classifier-reborn-2.0.3.gem (100%)<br>Successfully installed classifier-reborn-2.0.3<br>Fetching: ffi-1.9.6-x64-mingw32.gem (100%)<br>Successfully installed ffi-1.9.6-x64-mingw32<br>Fetching: rb-inotify-0.9.5.gem (100%)<br>Successfully installed rb-inotify-0.9.5<br>Fetching: rb-fsevent-0.9.4.gem (100%)<br>Successfully installed rb-fsevent-0.9.4<br>Fetching: hitimes-1.2.2.gem (100%)<br>Building native extensions.  This could take a while…<br>Successfully installed hitimes-1.2.2<br>Fetching: timers-4.0.1.gem (100%)<br>Successfully installed timers-4.0.1<br>Fetching: celluloid-0.16.0.gem (100%)<br>Successfully installed celluloid-0.16.0<br>Fetching: listen-2.8.5.gem (100%)<br>Successfully installed listen-2.8.5<br>Fetching: jekyll-watch-1.2.1.gem (100%)<br>Successfully installed jekyll-watch-1.2.1<br>Fetching: sass-3.4.12.gem (100%)<br>Successfully installed sass-3.4.12<br>Fetching: jekyll-sass-converter-1.3.0.gem (100%)<br>Successfully installed jekyll-sass-converter-1.3.0<br>Fetching: coffee-script-source-1.9.1.gem (100%)<br>Successfully installed coffee-script-source-1.9.1<br>Fetching: execjs-2.3.0.gem (100%)<br>Successfully installed execjs-2.3.0<br>Fetching: coffee-script-2.3.0.gem (100%)<br>Successfully installed coffee-script-2.3.0<br>Fetching: jekyll-coffeescript-1.0.1.gem (100%)<br>Successfully installed jekyll-coffeescript-1.0.1<br>Fetching: jekyll-gist-1.1.0.gem (100%)<br>Successfully installed jekyll-gist-1.1.0<br>Fetching: jekyll-paginate-1.1.0.gem (100%)<br>Successfully installed jekyll-paginate-1.1.0<br>Fetching: blankslate-2.1.2.4.gem (100%)<br>Successfully installed blankslate-2.1.2.4<br>Fetching: parslet-1.5.0.gem (100%)<br>Successfully installed parslet-1.5.0<br>Fetching: toml-0.1.2.gem (100%)<br>Successfully installed toml-0.1.2<br>Fetching: redcarpet-3.2.2.gem (100%)<br>Building native extensions.  This could take a while…<br>Successfully installed redcarpet-3.2.2<br>Fetching: posix-spawn-0.3.10.gem (100%)<br>Building native extensions.  This could take a while…<br>Successfully installed posix-spawn-0.3.10<br>Fetching: yajl-ruby-1.2.1.gem (100%)<br>Building native extensions.  This could take a while…<br>Successfully installed yajl-ruby-1.2.1<br>Fetching: pygments.rb-0.6.2.gem (100%)<br>Successfully installed pygments.rb-0.6.2<br>Fetching: colorator-0.1.gem (100%)<br>Successfully installed colorator-0.1<br>Fetching: safe_yaml-1.0.4.gem (100%)<br>Successfully installed safe_yaml-1.0.4<br>Fetching: mercenary-0.3.5.gem (100%)<br>Successfully installed mercenary-0.3.5<br>Fetching: kramdown-1.5.0.gem (100%)<br>Successfully installed kramdown-1.5.0<br>Fetching: liquid-2.6.2.gem (100%)<br>Successfully installed liquid-2.6.2<br>Fetching: jekyll-2.5.3.gem (100%)<br>Successfully installed jekyll-2.5.3<br>Parsing documentation for blankslate-2.1.2.4<br>Installing ri documentation for blankslate-2.1.2.4<br>Parsing documentation for celluloid-0.16.0<br>Installing ri documentation for celluloid-0.16.0<br>Parsing documentation for classifier-reborn-2.0.3<br>Installing ri documentation for classifier-reborn-2.0.3<br>Parsing documentation for coffee-script-2.3.0<br>Installing ri documentation for coffee-script-2.3.0<br>Parsing documentation for coffee-script-source-1.9.1<br>Installing ri documentation for coffee-script-source-1.9.1<br>Parsing documentation for colorator-0.1<br>Installing ri documentation for colorator-0.1<br>Parsing documentation for execjs-2.3.0<br>Installing ri documentation for execjs-2.3.0<br>Parsing documentation for fast-stemmer-1.0.2<br>Installing ri documentation for fast-stemmer-1.0.2<br>Parsing documentation for ffi-1.9.6-x64-mingw32<br>Installing ri documentation for ffi-1.9.6-x64-mingw32<br>Parsing documentation for hitimes-1.2.2<br>Installing ri documentation for hitimes-1.2.2<br>Parsing documentation for jekyll-2.5.3<br>Installing ri documentation for jekyll-2.5.3<br>Parsing documentation for jekyll-coffeescript-1.0.1<br>Installing ri documentation for jekyll-coffeescript-1.0.1<br>Parsing documentation for jekyll-gist-1.1.0<br>Installing ri documentation for jekyll-gist-1.1.0<br>Parsing documentation for jekyll-paginate-1.1.0<br>Installing ri documentation for jekyll-paginate-1.1.0<br>Parsing documentation for jekyll-sass-converter-1.3.0<br>Installing ri documentation for jekyll-sass-converter-1.3.0<br>Parsing documentation for jekyll-watch-1.2.1<br>Installing ri documentation for jekyll-watch-1.2.1<br>Parsing documentation for kramdown-1.5.0<br>Installing ri documentation for kramdown-1.5.0<br>Parsing documentation for liquid-2.6.2<br>Installing ri documentation for liquid-2.6.2<br>Parsing documentation for listen-2.8.5<br>Installing ri documentation for listen-2.8.5<br>Parsing documentation for mercenary-0.3.5<br>Installing ri documentation for mercenary-0.3.5<br>Parsing documentation for parslet-1.5.0<br>Installing ri documentation for parslet-1.5.0<br>Parsing documentation for posix-spawn-0.3.10<br>Installing ri documentation for posix-spawn-0.3.10<br>Parsing documentation for pygments.rb-0.6.2<br>Installing ri documentation for pygments.rb-0.6.2<br>Parsing documentation for rb-fsevent-0.9.4<br>Installing ri documentation for rb-fsevent-0.9.4<br>Parsing documentation for rb-inotify-0.9.5<br>Installing ri documentation for rb-inotify-0.9.5<br>Parsing documentation for redcarpet-3.2.2<br>Installing ri documentation for redcarpet-3.2.2<br>Parsing documentation for safe_yaml-1.0.4<br>Installing ri documentation for safe_yaml-1.0.4<br>Parsing documentation for sass-3.4.12<br>Installing ri documentation for sass-3.4.12<br>Parsing documentation for timers-4.0.1<br>Installing ri documentation for timers-4.0.1<br>Parsing documentation for toml-0.1.2<br>Installing ri documentation for toml-0.1.2<br>Parsing documentation for yajl-ruby-1.2.1<br>Installing ri documentation for yajl-ruby-1.2.1<br>Done installing documentation for blankslate, celluloid, classifier-reborn, coffee-script, coffee-sc<br>ript-source, colorator, execjs, fast-stemmer, ffi, hitimes, jekyll, jekyll-coffeescript, jekyll-gist<br>, jekyll-paginate, jekyll-sass-converter, jekyll-watch, kramdown, liquid, listen, mercenary, parslet<br>, posix-spawn, pygments.rb, rb-fsevent, rb-inotify, redcarpet, safe_yaml, sass, timers, toml, yajl-r<br>uby after 58 seconds<br>31 gems installed</p>
</blockquote>
<p>安装完成jekyll</p>
<h3 id="构建基于bootstrap模板"><a href="#构建基于bootstrap模板" class="headerlink" title="构建基于bootstrap模板"></a>构建基于bootstrap模板</h3><blockquote>
<p>$ git clone <a href="https://github.com/plusjade/jekyll-bootstrap.git" target="_blank" rel="external">https://github.com/plusjade/jekyll-bootstrap.git</a> jekyll<br>Cloning into ‘jekyll’…<br>remote: Counting objects: 2098, done.<br>remote: Total 2098 (delta 0), reused 0 (delta 0)Receiving objects:  97% (2036/20<br>98), 652.00 KiB | 98.00 KiB/s<br>Receiving objects: 100% (2098/2098), 794.12 KiB | 106.00 KiB/s, done.<br>Resolving deltas: 100% (844/844), done.<br>Checking connectivity… done.</p>
</blockquote>
<p>######进入jekyll 目录, 启动jekyll</p>
<blockquote>
<p>C:\jekyll&gt;jekyll serve<br>Configuration file: C:/jekyll/_config.yml<br>            Source: C:/jekyll<br>       Destination: C:/jekyll/_site<br>      Generating…<br>                    done.<br>  Please add the following to your Gemfile to avoid polling for changes:<br>    gem ‘wdm’, ‘&gt;= 0.1.0’ if Gem.win_platform?<br> Auto-regeneration: enabled for ‘C:/jekyll’<br>Configuration file: C:/jekyll/_config.yml<br>    Server address: <a href="http://127.0.0.1:4000/" target="_blank" rel="external">http://127.0.0.1:4000/</a><br>  Server running… press ctrl-c to stop.</p>
</blockquote>
<p>打开浏览器，<a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a><br><img src="http://img.blog.csdn.net/20150222202352332" alt="这里写图片描述"></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Android仿微信选择照片，拍照" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/17/Android仿微信选择照片，拍照/">Android仿微信选择照片，拍照</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>效果图：</strong><br><img src="http://img.blog.csdn.net/20150217200638079" alt="效果图："></p>
<p>使用的方法简单粗暴，直接利用ContentResolver查询系统媒体数据库，拿到每张图片的实际路径，然后得到他们所在的目录，将其按目录分类（原来测试的是拿到缩略图，但是在模拟器上测试可以，我的手机上一直报找不到缩略图的异常，可能是垃圾手机的原因，不过微信也是没用那缩略图）<br>我把代码都封装到一个Activity中了（SelectPictureActivity.java），下次再使用直接复制就可以用，布局样式需要在layout中修改</p>
<p><strong>使用</strong><br>startActivityForResult(new Intent(this, SelectPictureActivity.class), REQUEST_PICK);</p>
<p>然后选择完成返回选择的图片路径的list<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">      <span class="comment">// super.onActivityResult(requestCode, resultCode, data);</span></div><div class="line">      <span class="keyword">if</span> (resultCode == RESULT_OK) &#123;</div><div class="line">          selectedPicture = (ArrayList&lt;String&gt;) data</div><div class="line">                  .getSerializableExtra(SelectPictureActivity.INTENT_SELECTED_PICTURE);</div><div class="line">          adapter.notifyDataSetChanged();</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>完整的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zyh.selectpicture;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.content.ContentResolver;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.database.Cursor;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.net.Uri;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.os.Environment;</div><div class="line"><span class="keyword">import</span> android.provider.MediaStore;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.view.Window;</div><div class="line"><span class="keyword">import</span> android.view.animation.Animation;</div><div class="line"><span class="keyword">import</span> android.view.animation.Animation.AnimationListener;</div><div class="line"><span class="keyword">import</span> android.view.animation.TranslateAnimation;</div><div class="line"><span class="keyword">import</span> android.widget.AdapterView;</div><div class="line"><span class="keyword">import</span> android.widget.AdapterView.OnItemClickListener;</div><div class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.GridView;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"><span class="keyword">import</span> android.widget.ListView;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.DisplayImageOptions;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.ImageLoader;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.assist.ImageScaleType;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectPictureActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 最多选择图片的个数</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_NUM = <span class="number">6</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TAKE_PICTURE = <span class="number">520</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INTENT_MAX_NUM = <span class="string">"intent_max_num"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INTENT_SELECTED_PICTURE = <span class="string">"intent_selected_picture"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line">    <span class="keyword">private</span> GridView gridview;</div><div class="line">    <span class="keyword">private</span> PictureAdapter adapter;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 临时的辅助类，用于防止同一个文件夹的多次扫描</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> HashMap&lt;String, Integer&gt; tmpDir = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;ImageFloder&gt; mDirPaths = <span class="keyword">new</span> ArrayList&lt;ImageFloder&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ImageLoader loader;</div><div class="line">    <span class="keyword">private</span> DisplayImageOptions options;</div><div class="line">    <span class="keyword">private</span> ContentResolver mContentResolver;</div><div class="line">    <span class="keyword">private</span> Button btn_select, btn_ok;</div><div class="line">    <span class="keyword">private</span> ListView listview;</div><div class="line">    <span class="keyword">private</span> FolderAdapter folderAdapter;</div><div class="line">    <span class="keyword">private</span> ImageFloder imageAll, currentImageFolder;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 已选择的图片</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; selectedPicture = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">    <span class="keyword">private</span> String cameraPath = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class="line">        setContentView(R.layout.activity_select_picture);</div><div class="line">        MAX_NUM = getIntent().getIntExtra(INTENT_MAX_NUM, <span class="number">6</span>);</div><div class="line">        context = <span class="keyword">this</span>;</div><div class="line">        mContentResolver = getContentResolver();</div><div class="line">        loader = ImageLoader.getInstance();</div><div class="line">        options = <span class="keyword">new</span> DisplayImageOptions.Builder().showImageOnLoading(R.drawable.ic_launcher)</div><div class="line">                .showImageForEmptyUri(R.drawable.ic_launcher).showImageOnFail(R.drawable.ic_launcher)</div><div class="line">                .cacheInMemory(<span class="keyword">true</span>).cacheOnDisk(<span class="keyword">true</span>).considerExifParams(<span class="keyword">true</span>)</div><div class="line">                .imageScaleType(ImageScaleType.EXACTLY).bitmapConfig(Bitmap.Config.RGB_565).build();</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (listview.getVisibility() == <span class="number">0</span>) &#123;</div><div class="line">            hideListAnimation();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            listview.setVisibility(<span class="number">0</span>);</div><div class="line">            showListAnimation();</div><div class="line">            folderAdapter.notifyDataSetChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showListAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">        TranslateAnimation ta = <span class="keyword">new</span> TranslateAnimation(<span class="number">1</span>, <span class="number">0f</span>, <span class="number">1</span>, <span class="number">0f</span>, <span class="number">1</span>, <span class="number">1f</span>, <span class="number">1</span>, <span class="number">0f</span>);</div><div class="line">        ta.setDuration(<span class="number">200</span>);</div><div class="line">        listview.startAnimation(ta);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hideListAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">        TranslateAnimation ta = <span class="keyword">new</span> TranslateAnimation(<span class="number">1</span>, <span class="number">0f</span>, <span class="number">1</span>, <span class="number">0f</span>, <span class="number">1</span>, <span class="number">0f</span>, <span class="number">1</span>, <span class="number">1f</span>);</div><div class="line">        ta.setDuration(<span class="number">200</span>);</div><div class="line">        listview.startAnimation(ta);</div><div class="line">        ta.setAnimationListener(<span class="keyword">new</span> AnimationListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">                listview.setVisibility(<span class="number">8</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 点击完成按钮</div><div class="line">     *</div><div class="line">     * <span class="doctag">@version</span> 1.0</div><div class="line">     * <span class="doctag">@author</span> zyh</div><div class="line">     * <span class="doctag">@param</span> v</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ok</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        Intent data = <span class="keyword">new</span> Intent();</div><div class="line">        data.putExtra(INTENT_SELECTED_PICTURE, selectedPicture);</div><div class="line">        setResult(RESULT_OK, data);</div><div class="line">        <span class="keyword">this</span>.finish();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        imageAll = <span class="keyword">new</span> ImageFloder();</div><div class="line">        imageAll.setDir(<span class="string">"/所有图片"</span>);</div><div class="line">        currentImageFolder = imageAll;</div><div class="line">        mDirPaths.add(imageAll);</div><div class="line">        btn_ok = (Button) findViewById(R.id.btn_ok);</div><div class="line">        btn_select = (Button) findViewById(R.id.btn_select);</div><div class="line">        btn_ok.setText(<span class="string">"完成0/"</span> + MAX_NUM);</div><div class="line"></div><div class="line">        gridview = (GridView) findViewById(R.id.gridview);</div><div class="line">        adapter = <span class="keyword">new</span> PictureAdapter();</div><div class="line">        gridview.setAdapter(adapter);</div><div class="line"></div><div class="line">        gridview.setOnItemClickListener(<span class="keyword">new</span> OnItemClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</div><div class="line">                    goCamare();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        listview = (ListView) findViewById(R.id.listview);</div><div class="line">        folderAdapter = <span class="keyword">new</span> FolderAdapter();</div><div class="line">        listview.setAdapter(folderAdapter);</div><div class="line">        listview.setOnItemClickListener(<span class="keyword">new</span> OnItemClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">                currentImageFolder = mDirPaths.get(position);</div><div class="line">                Log.d(<span class="string">"zyh"</span>, position + <span class="string">"-------"</span> + currentImageFolder.getName() + <span class="string">"----"</span></div><div class="line">                        + currentImageFolder.images.size());</div><div class="line">                hideListAnimation();</div><div class="line">                adapter.notifyDataSetChanged();</div><div class="line">                btn_select.setText(currentImageFolder.getName());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        getThumbnail();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 使用相机拍照</div><div class="line">     *</div><div class="line">     * <span class="doctag">@version</span> 1.0</div><div class="line">     * <span class="doctag">@author</span> zyh</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">goCamare</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (selectedPicture.size() + <span class="number">1</span> &gt; MAX_NUM) &#123;</div><div class="line">            Toast.makeText(context, <span class="string">"最多选择"</span> + MAX_NUM + <span class="string">"张"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        Intent openCameraIntent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</div><div class="line">        Uri imageUri = getOutputMediaFileUri();</div><div class="line">        openCameraIntent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri);</div><div class="line">        startActivityForResult(openCameraIntent, TAKE_PICTURE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 用于拍照时获取输出的Uri</div><div class="line">     *</div><div class="line">     * <span class="doctag">@version</span> 1.0</div><div class="line">     * <span class="doctag">@author</span> zyh</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> Uri <span class="title">getOutputMediaFileUri</span><span class="params">()</span> </span>&#123;</div><div class="line">        File mediaStorageDir = <span class="keyword">new</span> File(</div><div class="line">                Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES), <span class="string">"Night"</span>);</div><div class="line">        <span class="keyword">if</span> (!mediaStorageDir.exists()) &#123;</div><div class="line">            <span class="keyword">if</span> (!mediaStorageDir.mkdirs()) &#123;</div><div class="line">                Log.d(<span class="string">"MyCameraApp"</span>, <span class="string">"failed to create directory"</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        String timeStamp = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd_HHmmss"</span>).format(<span class="keyword">new</span> Date());</div><div class="line">        File mediaFile = <span class="keyword">new</span> File(mediaStorageDir.getPath() + File.separator + <span class="string">"IMG_"</span> + timeStamp + <span class="string">".jpg"</span>);</div><div class="line">        cameraPath = mediaFile.getAbsolutePath();</div><div class="line">        <span class="keyword">return</span> Uri.fromFile(mediaFile);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">        <span class="comment">// super.onActivityResult(requestCode, resultCode, data);</span></div><div class="line">        <span class="keyword">if</span> (resultCode == RESULT_OK &amp;&amp; cameraPath != <span class="keyword">null</span>) &#123;</div><div class="line">            selectedPicture.add(cameraPath);</div><div class="line">            Intent data2 = <span class="keyword">new</span> Intent();</div><div class="line">            data2.putExtra(INTENT_SELECTED_PICTURE, selectedPicture);</div><div class="line">            setResult(RESULT_OK, data2);</div><div class="line">            <span class="keyword">this</span>.finish();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">back</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        onBackPressed();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PictureAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> currentImageFolder.images.size() + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</div><div class="line"></div><div class="line">            ViewHolder holder = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</div><div class="line">                convertView = View.inflate(context, R.layout.grid_item_picture, <span class="keyword">null</span>);</div><div class="line">                holder = <span class="keyword">new</span> ViewHolder();</div><div class="line">                holder.iv = (ImageView) convertView.findViewById(R.id.iv);</div><div class="line">                holder.checkBox = (Button) convertView.findViewById(R.id.check);</div><div class="line">                convertView.setTag(holder);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                holder = (ViewHolder) convertView.getTag();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</div><div class="line">                holder.iv.setImageResource(R.drawable.pickphotos_to_camera_normal);</div><div class="line">                holder.checkBox.setVisibility(View.INVISIBLE);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                position = position - <span class="number">1</span>;</div><div class="line">                holder.checkBox.setVisibility(View.VISIBLE);</div><div class="line">                <span class="keyword">final</span> ImageItem item = currentImageFolder.images.get(position);</div><div class="line">                loader.displayImage(<span class="string">"file://"</span> + item.path, holder.iv, options);</div><div class="line">                <span class="keyword">boolean</span> isSelected = selectedPicture.contains(item.path);</div><div class="line">                holder.checkBox.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (!v.isSelected() &amp;&amp; selectedPicture.size() + <span class="number">1</span> &gt; MAX_NUM) &#123;</div><div class="line">                            Toast.makeText(context, <span class="string">"最多选择"</span> + MAX_NUM + <span class="string">"张"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">                            <span class="keyword">return</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span> (selectedPicture.contains(item.path)) &#123;</div><div class="line">                            selectedPicture.remove(item.path);</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            selectedPicture.add(item.path);</div><div class="line">                        &#125;</div><div class="line">                        btn_ok.setText(<span class="string">"完成"</span> + selectedPicture.size() + <span class="string">"/"</span> + MAX_NUM);</div><div class="line">                        v.setSelected(selectedPicture.contains(item.path));</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                holder.checkBox.setSelected(isSelected);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> convertView;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        ImageView iv;</div><div class="line">        Button checkBox;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FolderAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> mDirPaths.size();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</div><div class="line">            FolderViewHolder holder = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</div><div class="line">                convertView = View.inflate(context, R.layout.list_dir_item, <span class="keyword">null</span>);</div><div class="line">                holder = <span class="keyword">new</span> FolderViewHolder();</div><div class="line">                holder.id_dir_item_image = (ImageView) convertView.findViewById(R.id.id_dir_item_image);</div><div class="line">                holder.id_dir_item_name = (TextView) convertView.findViewById(R.id.id_dir_item_name);</div><div class="line">                holder.id_dir_item_count = (TextView) convertView.findViewById(R.id.id_dir_item_count);</div><div class="line">                holder.choose = (ImageView) convertView.findViewById(R.id.choose);</div><div class="line">                convertView.setTag(holder);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                holder = (FolderViewHolder) convertView.getTag();</div><div class="line">            &#125;</div><div class="line">            ImageFloder item = mDirPaths.get(position);</div><div class="line">            loader.displayImage(<span class="string">"file://"</span> + item.getFirstImagePath(), holder.id_dir_item_image, options);</div><div class="line">            holder.id_dir_item_count.setText(item.images.size() + <span class="string">"张"</span>);</div><div class="line">            holder.id_dir_item_name.setText(item.getName());</div><div class="line">            holder.choose.setVisibility(currentImageFolder == item ? <span class="number">0</span> : <span class="number">8</span>);</div><div class="line">            <span class="keyword">return</span> convertView;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FolderViewHolder</span> </span>&#123;</div><div class="line">        ImageView id_dir_item_image;</div><div class="line">        ImageView choose;</div><div class="line">        TextView id_dir_item_name;</div><div class="line">        TextView id_dir_item_count;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 得到缩略图</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getThumbnail</span><span class="params">()</span> </span>&#123;</div><div class="line">        Cursor mCursor = mContentResolver.query(MediaStore.Images.Media.EXTERNAL_CONTENT_URI,</div><div class="line">                <span class="keyword">new</span> String[] &#123; MediaStore.Images.ImageColumns.DATA &#125;, <span class="string">""</span>, <span class="keyword">null</span>,</div><div class="line">                MediaStore.MediaColumns.DATE_ADDED + <span class="string">" DESC"</span>);</div><div class="line">        Log.e(<span class="string">"TAG"</span>, mCursor.getCount() + <span class="string">""</span>);</div><div class="line">        <span class="keyword">if</span> (mCursor.moveToFirst()) &#123;</div><div class="line">            <span class="keyword">int</span> _date = mCursor.getColumnIndex(MediaStore.Images.Media.DATA);</div><div class="line">            <span class="keyword">do</span> &#123;</div><div class="line">                <span class="comment">// 获取图片的路径</span></div><div class="line">                String path = mCursor.getString(_date);</div><div class="line">                Log.e(<span class="string">"TAG"</span>, path);</div><div class="line">                imageAll.images.add(<span class="keyword">new</span> ImageItem(path));</div><div class="line">                <span class="comment">// 获取该图片的父路径名</span></div><div class="line">                File parentFile = <span class="keyword">new</span> File(path).getParentFile();</div><div class="line">                <span class="keyword">if</span> (parentFile == <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">                ImageFloder imageFloder = <span class="keyword">null</span>;</div><div class="line">                String dirPath = parentFile.getAbsolutePath();</div><div class="line">                <span class="keyword">if</span> (!tmpDir.containsKey(dirPath)) &#123;</div><div class="line">                    <span class="comment">// 初始化imageFloder</span></div><div class="line">                    imageFloder = <span class="keyword">new</span> ImageFloder();</div><div class="line">                    imageFloder.setDir(dirPath);</div><div class="line">                    imageFloder.setFirstImagePath(path);</div><div class="line">                    mDirPaths.add(imageFloder);</div><div class="line">                    Log.d(<span class="string">"zyh"</span>, dirPath + <span class="string">","</span> + path);</div><div class="line">                    tmpDir.put(dirPath, mDirPaths.indexOf(imageFloder));</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    imageFloder = mDirPaths.get(tmpDir.get(dirPath));</div><div class="line">                &#125;</div><div class="line">                imageFloder.images.add(<span class="keyword">new</span> ImageItem(path));</div><div class="line">            &#125; <span class="keyword">while</span> (mCursor.moveToNext());</div><div class="line">        &#125;</div><div class="line">        mCursor.close();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mDirPaths.size(); i++) &#123;</div><div class="line">            ImageFloder f = mDirPaths.get(i);</div><div class="line">            Log.d(<span class="string">"zyh"</span>, i + <span class="string">"-----"</span> + f.getName() + <span class="string">"---"</span> + f.images.size());</div><div class="line">        &#125;</div><div class="line">        tmpDir = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ImageFloder</span> </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 图片的文件夹路径</div><div class="line">         */</div><div class="line">        <span class="keyword">private</span> String dir;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 第一张图片的路径</div><div class="line">         */</div><div class="line">        <span class="keyword">private</span> String firstImagePath;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 文件夹的名称</div><div class="line">         */</div><div class="line">        <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> List&lt;ImageItem&gt; images = <span class="keyword">new</span> ArrayList&lt;ImageItem&gt;();</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getDir</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> dir;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDir</span><span class="params">(String dir)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.dir = dir;</div><div class="line">            <span class="keyword">int</span> lastIndexOf = <span class="keyword">this</span>.dir.lastIndexOf(<span class="string">"/"</span>);</div><div class="line">            <span class="keyword">this</span>.name = <span class="keyword">this</span>.dir.substring(lastIndexOf);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getFirstImagePath</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> firstImagePath;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstImagePath</span><span class="params">(String firstImagePath)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.firstImagePath = firstImagePath;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> name;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ImageItem</span> </span>&#123;</div><div class="line">        String path;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ImageItem</span><span class="params">(String p)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.path = p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>源码下载：<a href="https://github.com/18236887539/SelectPicture" target="_blank" rel="external">https://github.com/18236887539/SelectPicture</a></p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-结合Android学设计模式--原型模式(Prototype)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/15/结合Android学设计模式--原型模式(Prototype)/">结合Android学设计模式--原型模式(Prototype)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###一、什么是原型模式<br>  Prototype模式是一种对象创建型模式，它采取复制原型对象的方法来创建对象的实例。使用Prototype模式创建的实例，具有与原型一样的数据。<br>  <img src="http://img.blog.csdn.net/20150215130344255" alt="这里写图片描述"></p>
<p>###二、原型模式的特点</p>
<ol>
<li>由原型对象<strong>自身创建</strong>目标对象。也就是说，对象创建这一动作发自原型对象本身。</li>
<li>目标对象是原型对象的一个克隆。也就是说，通过Prototype模式创建的对象，不仅仅与原型对象具有相同的结构，还与原型对象具有相同的值。</li>
<li>根据对象克隆深度层次的不同，有<strong>浅度克隆</strong>与<strong>深度克隆。</strong><br>###三、原型模式应用场景</li>
</ol>
<ul>
<li><strong><em>类初始化需要消化非常多的资源，这个资源包括数据、硬件资源等，通过原型拷贝避免这些消耗；</em></strong></li>
<li>通过new产生一个对象需要非常繁琐的数据准备或访问权限，则可以使用原型模式</li>
<li>一个对象需要提供给其他对象访问，而且各个调用者可能都需要修改其值时，可以考虑使用原型模式拷贝多个对象供调用者使用，即保护性拷贝。</li>
<li>在创建对象的时候，我们不只是希望被创建的对象继承其基类的基本结构，还希望继承原型对象的数据。</li>
<li>希望对目标对象的修改不影响既有的原型对象（深度克隆的时候可以完全互不影响）。</li>
<li>隐藏克隆操作的细节。很多时候，对对象本身的克隆需要涉及到类本身的数据细节。</li>
</ul>
<hr>
<p>如,有一个Person类</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span> &#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> String gender;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(<span class="params">String name</span>) </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> gender;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span>(<span class="params">String gender</span>) </span>&#123;</div><div class="line">		<span class="keyword">this</span>.gender = gender;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> age;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span>(<span class="params"><span class="keyword">int</span> age</span>) </span>&#123;</div><div class="line">		<span class="keyword">this</span>.age = age;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建一个Person对象</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">      Person person1 = new Person()<span class="comment">;</span></div><div class="line">person1.setName(<span class="string">"Jack"</span>)<span class="comment">;</span></div><div class="line">person1.setGender(<span class="string">"男"</span>)<span class="comment">;</span></div><div class="line">person1.setAge(<span class="number">18</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>当下次想再次创建一个person对象时,</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">      Person person2 = new Person()<span class="comment">;</span></div><div class="line">person2.setName(<span class="string">"John"</span>)<span class="comment">;</span></div><div class="line">person2.setGender(<span class="string">"男"</span>)<span class="comment">;</span></div><div class="line">person2.setAge(<span class="number">18</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>person1与person2对象只有name不同,其他都相同,这个时候我们就可以使用原型模式,一般我们会提供一个clone方法,<strong>克隆不同于引用.</strong><br>我们在Person类中添加clone方法,返回一个克隆的person对象<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Person clone() &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Person person  = (Person)<span class="keyword">super</span>.clone();</div><div class="line">			<span class="keyword">return</span>  person;</div><div class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>注意Person类要实现<strong>Cloneable</strong>接口</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123;</div><div class="line"></div><div class="line">		Person person1 = new Person()<span class="comment">;</span></div><div class="line">		person1.setName(<span class="string">"Jack"</span>)<span class="comment">;</span></div><div class="line">		person1.setGender(<span class="string">"男"</span>)<span class="comment">;</span></div><div class="line">		person1.setAge(<span class="number">18</span>)<span class="comment">;</span></div><div class="line"></div><div class="line">		Person person2 = person1.<span class="keyword">clone();</span></div><div class="line">		System.out.println(<span class="string">"person1---name:"</span>+person1.getName())<span class="comment">;</span></div><div class="line">		person2.setName(<span class="string">"John"</span>)<span class="comment">;</span></div><div class="line">		System.out.println(<span class="string">"person1---name:"</span>+person1.getName())<span class="comment">;</span></div><div class="line">		System.out.println(<span class="string">"person1---name:"</span>+person2.getName())<span class="comment">;</span></div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>输出结果为:<br>person1—name:Jack<br>person1—name:Jack<br>person2—name:John</p>
<p>现在我们给Person添加hobbies字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> List&lt;String&gt; hobbies;</div></pre></td></tr></table></figure>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123;</div><div class="line"></div><div class="line"></div><div class="line">		ArrayList<span class="variable">&lt;String&gt;</span> hobbies = new ArrayList<span class="variable">&lt;&gt;</span>();</div><div class="line">		hobbies.add(<span class="string">"音乐"</span>);</div><div class="line">		hobbies.add(<span class="string">"跑步"</span>);</div><div class="line"></div><div class="line">		Person person1 = new Person();</div><div class="line">		person1.<span class="built_in">set</span>Name(<span class="string">"Jack"</span>);</div><div class="line">		person1.<span class="built_in">set</span>Gender(<span class="string">"男"</span>);</div><div class="line">		person1.<span class="built_in">set</span>Age(<span class="number">18</span>);</div><div class="line">		person1.<span class="built_in">set</span>Hobbies(hobbies);</div><div class="line"></div><div class="line"></div><div class="line">		Person person2 = person1.clone();</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"person2---hobbies:"</span>+person2.getHobbies().<span class="keyword">to</span>String());</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"person1---hobbies:"</span>+person1.getHobbies().<span class="keyword">to</span>String());</div><div class="line"></div><div class="line">		hobbies.add(<span class="string">"打球"</span>);</div><div class="line"></div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"person2---hobbies:"</span>+person2.getHobbies().<span class="keyword">to</span>String());</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"person1---hobbies:"</span>+person1.getHobbies().<span class="keyword">to</span>String());</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>输入结果</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">person2---hobbies:<span class="string">[音乐, 跑步]</span></div><div class="line">person1---hobbies:<span class="string">[音乐, 跑步]</span></div><div class="line">person2---hobbies:<span class="string">[音乐, 跑步, 打球]</span></div><div class="line">person1---hobbies:<span class="string">[音乐, 跑步, 打球]</span></div></pre></td></tr></table></figure>
<p>我们修改了person1的hobbies字段,person2的也跟着该变了,这就是浅度克隆<br><em>什么是深度克隆呢?</em></p>
<p>修改clone方法</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Person clone()&#123;</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">	   Person person  = (Person)<span class="keyword">super</span>.clone();</div><div class="line">	   ArrayList&lt;<span class="keyword">String</span>&gt; <span class="keyword">new</span><span class="type">Hobby</span> = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;<span class="keyword">String</span>&gt;();</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">String</span> hobby : <span class="type">this</span>.getHobbies()) &#123;</div><div class="line">			<span class="keyword">new</span><span class="type">Hobby</span>.add(hobby);</div><div class="line">		&#125;</div><div class="line">		person.setHobbies(<span class="keyword">new</span><span class="type">Hobby</span>);</div><div class="line">		<span class="keyword">return</span> person;</div><div class="line">&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">	e.printStackTrace();</div><div class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>再次运行</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">person2---hobbies:<span class="string">[音乐, 跑步]</span></div><div class="line">person1---hobbies:<span class="string">[音乐, 跑步]</span></div><div class="line">person2---hobbies:<span class="string">[音乐, 跑步]</span></div><div class="line">person1---hobbies:<span class="string">[音乐, 跑步, 打球]</span></div></pre></td></tr></table></figure>
<hr>
<p>Android中的SparseArray类使用了原型模式,SparseArray类用来代替HashMap</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SparseArray</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>clone方法,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   @SuppressWarnings(<span class="string">"unchecked"</span>)</div><div class="line">   <span class="keyword">public</span> SparseArray&lt;E&gt; <span class="keyword">clone</span>() &#123;</div><div class="line">       SparseArray&lt;E&gt; <span class="keyword">clone</span> = <span class="keyword">null</span>;</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           <span class="keyword">clone</span> = (SparseArray&lt;E&gt;) super.<span class="keyword">clone</span>();</div><div class="line">           <span class="keyword">clone</span>.mKeys = mKeys.<span class="keyword">clone</span>(); <span class="comment">//同时需要深度克隆</span></div><div class="line">           <span class="keyword">clone</span>.mValues = mValues.<span class="keyword">clone</span>();<span class="comment">//同时需要深度克隆</span></div><div class="line">       &#125; <span class="keyword">catch</span> (CloneNotSupportedException cnse) &#123;</div><div class="line">           <span class="comment">/* ignore */</span></div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">clone</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>  结合上面的应用场景理解一下SparseArray类为什么使用原型模式</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  
    <article id="post-Android自定义字体类库Calligraphy--快速实现自定义应用字体" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/14/Android自定义字体类库Calligraphy--快速实现自定义应用字体/">Android自定义字体类库Calligraphy--快速实现自定义应用字体</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>现在手机上字体美化软件越来越多,各种怪状各种风格的字体都有,<br><img src="http://img.blog.csdn.net/20150214151225688" alt="这里写图片描述"><br>作为Android开发人员,应用中有时会需要强制使用某种字体(这样做会增大应用的内存消耗,而且字体包越大消耗内存越大),所以我们就需要尽量的减少内存消耗,同时使用我们自定义的字体</p>
<p>####设置自定义字体的方法<br>在xml中,可以看到一个属性</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">android:</span>typeface=<span class="string">"sans"</span></div></pre></td></tr></table></figure>
<p>不过在xml中只能设置为 <strong><em>none,sans,serif,monospace</em></strong> 中的一种<br>在java代码中,可以找到TextView的一个方法<br><img src="http://img.blog.csdn.net/20150214152844920" alt="这里写图片描述"></p>
<p> 我们通过<strong>textview.setTypeface(typeface);</strong>即可实现自定义字体,typeface对象我们可以Typeface类的<strong>createFromAsset</strong>静态方法创建(这里是不是就是前面所学的工厂模式呢),<br> 总之,实现起来跟简单.</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">textview = (TextView) findViewById(R.id.textview)<span class="comment">;</span></div><div class="line">Typeface typeface1 =  Typeface.createFromAsset(getAssets(), <span class="string">"fzltxh_gbk.ttf"</span>)<span class="comment">;</span></div><div class="line">textview.setTypeface(typeface1)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>但是不能每次都这样重新获取TextView再重新设置字体吧,这样太麻烦,而且消耗性能,所以我们就可以自定义TextView,然后重写onDraw</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CoustomFontTextView</span> <span class="keyword">extends</span> <span class="title">TextView</span> </span>&#123;</div><div class="line">    public <span class="type">CoustomFontTextView</span>(<span class="type">Context</span> context) &#123;</div><div class="line">     <span class="keyword">this</span>(context, <span class="literal">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public <span class="type">CoustomFontTextView</span>(<span class="type">Context</span> context, <span class="type">AttributeSet</span> attrs) &#123;</div><div class="line">     <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public <span class="type">CoustomFontTextView</span>(<span class="type">Context</span> context, <span class="type">AttributeSet</span> attrs, int defStyle) &#123;</div><div class="line">     <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line"></div><div class="line">     <span class="keyword">this</span>.setTypeface(<span class="type">Typeface</span>.createFromAsset(getResources().getAssets(), <span class="string">"fzltxh_gbk.ttf"</span>));</div><div class="line">    &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>布局文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:orientation=<span class="string">"vertical"</span></div><div class="line">    android:<span class="attribute">padding</span>=<span class="string">"8dp"</span> &gt;</div><div class="line"></div><div class="line">    &lt;com<span class="selector-class">.zyh</span><span class="selector-class">.testcustomfont</span><span class="selector-class">.CustomFontTextView</span></div><div class="line">        android:id=<span class="string">"@+id/textview1"</span></div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_margin=<span class="string">"4dp"</span></div><div class="line">        android:lineSpacingMultiplier=<span class="string">"1.1"</span></div><div class="line">        android:text=<span class="string">"@string/content"</span></div><div class="line">        android:textColor=<span class="string">"@android:color/black"</span></div><div class="line">        android:textSize=<span class="string">"16sp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;com<span class="selector-class">.zyh</span><span class="selector-class">.testcustomfont</span><span class="selector-class">.CustomFontTextView</span></div><div class="line">        android:id=<span class="string">"@+id/textview2"</span></div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_margin=<span class="string">"4dp"</span></div><div class="line">        android:lineSpacingMultiplier=<span class="string">"1.1"</span></div><div class="line">        android:text=<span class="string">"@string/content"</span></div><div class="line">        android:textColor=<span class="string">"@android:color/black"</span></div><div class="line">        android:textSize=<span class="string">"16sp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;com<span class="selector-class">.zyh</span><span class="selector-class">.testcustomfont</span><span class="selector-class">.CustomFontTextView</span></div><div class="line">        android:id=<span class="string">"@+id/textview3"</span></div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_margin=<span class="string">"4dp"</span></div><div class="line">        android:lineSpacingMultiplier=<span class="string">"1.1"</span></div><div class="line">        android:text=<span class="string">"@string/content"</span></div><div class="line">        android:textColor=<span class="string">"@android:color/black"</span></div><div class="line">        android:textSize=<span class="string">"16sp"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>然后运行起来,一看占内存情况,惊呆了,使用了3个我们自定义的TextView,<br><img src="http://img.blog.csdn.net/20150214155849328" alt="这里写图片描述"></p>
<p>这里主要的原因就是我们每次使用该控件就调用了<strong>Typeface.createFromAsset(getResources().getAssets(), “fzltxh_gbk.ttf”)</strong>,产生typeface对象十分耗内存,这里我们可以把typeface设计成单例模式,</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FontManager</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Typeface typeface = <span class="literal">null</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Typeface <span class="title">getTypeface</span>(<span class="params">Context context</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (typeface == <span class="literal">null</span>) &#123;</div><div class="line">            typeface = Typeface.createFromAsset(context.getAssets(), <span class="string">"fzltxh_gbk.ttf"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> typeface;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样可以减少内存消耗,</p>
<blockquote>
<p>使用字体包较小的字体文件也能大大减少内存消耗</p>
</blockquote>
<hr>
<p>下面介绍一个开源库<strong>Calligraphy</strong>,很方便的进行字体更换,<br>github地址:  <a href="https://github.com/chrisjenx/Calligraphy" target="_blank" rel="external">Calligraphy</a></p>
<p><strong>使用:</strong><br>1.引用库,在assets/fonts/ 下放入需要的字体<br>2.在你的应用的Application类中的onCreate方法中初始化</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        CalligraphyConfig.initDefault(<span class="keyword">new</span> CalligraphyConfig.Builder()</div><div class="line">                        .setDefaultFontPath(<span class="string">"fonts/Roboto-ThinItalic.ttf"</span>)</div><div class="line">                        .setFontAttrId(R.attr.fontPath)</div><div class="line">                        .build()</div><div class="line">        );</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>3.在你的Activity中重写 attachBaseContext方法</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context newBase)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.attachBaseContext(CalligraphyContextWrapper.wrap(newBase));</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>运行起来会看到应用中实现了自定义字体,快试试吧</p>

      
    </div>
</article>
 
 <!-- 上一页 下一页 -->


<!-- 相关文章 -->




  

  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
    </nav>
  


</section>
      </div>
      <footer id="footer">
  <div class="outer footer_center">
    <div id="footer-info" class="inner">
      &copy; 2017 <a href="https://github.com/hanks-zyh"> Hanks</a>
	  </div>
  </div>
 <div id="share">
  <a id="totop" title="" style="display: block;">返回顶部</a>
 </div>
</footer>

    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
