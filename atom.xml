<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hanks&#39; Blog</title>
  <subtitle>coding for fun..</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://hanks.pub/"/>
  <updated>2017-07-10T11:02:58.171Z</updated>
  <id>http://hanks.pub/</id>
  
  <author>
    <name>Hanks</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ¢ç©¶ lua åœ¨ Android ä¸­çš„åº”ç”¨</title>
    <link href="http://hanks.pub/2017/04/28/lua-in-android/"/>
    <id>http://hanks.pub/2017/04/28/lua-in-android/</id>
    <published>2017-04-28T14:04:24.000Z</published>
    <updated>2017-07-10T11:02:58.171Z</updated>
    
    <content type="html"><![CDATA[<p>æ ¹æ®å‰é¢çš„æ–‡ç«  <a href="http://hanks.pub/2017/01/10/android-lua/">Android ä¸ Lua</a> å¯ä»¥å¤§æ¦‚äº†è§£ Lua ã€‚åœ¨ Androidï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰ä¸­ï¼Œå¯ä»¥é€šè¿‡çµæ´»åŠ è½½ Lua è„šæœ¬ï¼Œä½¿åº”ç”¨æ›´åŠ çµæ´»ï¼Œè½»æ¾é¢å¯¹å¤šå˜çš„éœ€æ±‚ã€‚luajava åœ¨ jni å±‚ä¸»è¦å®ç°äº†5ä¸ªæ–¹æ³•ï¼Œå€ŸåŠ©è¿™5ä¸ªæ–¹æ³•luaå‡ ä¹å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„javaç±»äº†ã€‚</p>
<a id="more"></a>
<h2 id="Java-å’Œ-lua-äº¤äº’"><a href="#Java-å’Œ-lua-äº¤äº’" class="headerlink" title="Java å’Œ lua äº¤äº’"></a>Java å’Œ lua äº¤äº’</h2><p>å…³äº java å’Œ lua äº¤äº’çš„å¤§æ¦‚æœ‰ä¸¤ä¸ªé¡¹ç›®ã€‚<br>ä¸€ä¸ªæ˜¯ <a href="https://github.com/jasonsantos/luajava" target="_blank" rel="external">luajava</a>ï¼Œé€šè¿‡ java çš„ jni åŠŸèƒ½ï¼Œjava ä¸ c äº¤äº’ï¼Œç„¶å c è°ƒç”¨ lua ï¼Œå»¶ä¼¸å‡ºæ¥çš„æœ‰ <a href="https://github.com/mkottman/AndroLua" target="_blank" rel="external">AndroLua</a>ã€‚è¿˜æœ‰åœ¨ Android å¹³å°çš„ lua ç¼–è¾‘å™¨ <a href="https://github.com/nirenr/androlua_pro" target="_blank" rel="external">AndroLua+</a>ï¼Œç”¨æ¥å¼€å‘ Androidã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ª <a href="http://www.luaj.org/luaj/3.0/README.html" target="_blank" rel="external">luaj</a>ï¼Œçº¯ java å®ç°çš„ Lua è§£é‡Šå™¨ï¼ŒåŸºäº Lua 5.2.xã€‚å‰é¢ä»‹ç»çš„ LuaSdkView å°±æ˜¯åŸºäº luaj ä¿®æ”¹çš„ã€‚åœ¨ lua è°ƒç”¨ä»»æ„ java ç±»æ–¹é¢ï¼ŒLuaSdkView å®ç°äº†ä¸€äº›é€šç”¨çš„ç±»æ¥åˆ›å»ºjavaå¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ luaj çš„å…·ä½“ä½¿ç”¨ã€‚ </p>
<h3 id="java-è°ƒç”¨-lua"><a href="#java-è°ƒç”¨-lua" class="headerlink" title="java è°ƒç”¨ lua"></a>java è°ƒç”¨ lua</h3><p>hello.lua æ–‡ä»¶</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span> <span class="string">'----hello.lua---'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">( num1, num2 )</span></span></div><div class="line">    <span class="keyword">return</span> num1 + num2</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></div><div class="line">    <span class="keyword">return</span> <span class="string">'hanks'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Test.java æ–‡ä»¶<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// åŠ è½½ lua æ–‡ä»¶</span></div><div class="line">Globals G = JsePlatform.standardGlobals();</div><div class="line">LuaValue scriptValue = G.load(<span class="string">"print 'hello, world'"</span>);</div><div class="line">scriptValue.call();<span class="comment">// æ‰“å°å‡º hello, world</span></div><div class="line"></div><div class="line">G.get(<span class="string">"dofile"</span>).call(LuaValue.valueOf(<span class="string">"hello.lua"</span>)); <span class="comment">// æ‰“å°å‡º ----hello.lua---</span></div><div class="line"></div><div class="line">LuaValue sumFuc = G.get(<span class="string">"sum"</span>);</div><div class="line">LuaValue sum = sumFuc.call(LuaValue.valueOf(<span class="number">5</span>), LuaValue.valueOf(<span class="number">3</span>));</div><div class="line">System.out.println(sum.toint()); <span class="comment">// æ‰“å°å‡º 8</span></div><div class="line"></div><div class="line">LuaValue getNameFun = G.get(<span class="string">"getName"</span>);</div><div class="line">LuaValue name = getNameFun.call();</div><div class="line">System.out.println(name.tojstring());  <span class="comment">// æ‰“å°å‡º hanks</span></div></pre></td></tr></table></figure></p>
<h3 id="lua-è°ƒç”¨-java"><a href="#lua-è°ƒç”¨-java" class="headerlink" title="lua è°ƒç”¨ java"></a>lua è°ƒç”¨ java</h3><p>ç›´æ¥è°ƒç”¨<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">local</span> <span class="keyword">Thread</span> = luajava.bindClass(<span class="string">'java.lang.Thread'</span>)</div><div class="line">print(<span class="keyword">Thread</span>) <span class="comment">// æ‰“å° class java.lang.Thread</span></div></pre></td></tr></table></figure></p>
<p>å®šä¹‰ hyperbolic.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hyperbolic</span> <span class="keyword">extends</span> <span class="title">TwoArgFunction</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">hyperbolic</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> LuaValue <span class="title">call</span><span class="params">(LuaValue modname, LuaValue env)</span> </span>&#123;</div><div class="line">        LuaValue library = tableOf();</div><div class="line">        library.set(<span class="string">"sinh"</span>, <span class="keyword">new</span> sinh());</div><div class="line">        library.set(<span class="string">"cosh"</span>, <span class="keyword">new</span> cosh());</div><div class="line">        env.set(<span class="string">"hyperbolic"</span>, library);</div><div class="line">        <span class="keyword">return</span> library;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">sinh</span> <span class="keyword">extends</span> <span class="title">OneArgFunction</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> LuaValue <span class="title">call</span><span class="params">(LuaValue x)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> LuaValue.valueOf(Math.sinh(x.checkdouble()));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">cosh</span> <span class="keyword">extends</span> <span class="title">OneArgFunction</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> LuaValue <span class="title">call</span><span class="params">(LuaValue x)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> LuaValue.valueOf(Math.cosh(x.checkdouble()));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>testhyperbolic.lua è¿›è¡Œè°ƒç”¨</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span> <span class="string">'hyperbolic'</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">'hyperbolic'</span>, hyperbolic)</div><div class="line"><span class="built_in">print</span>(<span class="string">'hyperbolic.sinh'</span>, hyperbolic.sinh)</div><div class="line"><span class="built_in">print</span>(<span class="string">'hyperbolic.cosh'</span>, hyperbolic.cosh)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">'sinh(0.5)'</span>, hyperbolic.sinh(<span class="number">0.5</span>))</div><div class="line"><span class="built_in">print</span>(<span class="string">'cosh(0.5)'</span>, hyperbolic.cosh(<span class="number">0.5</span>))</div></pre></td></tr></table></figure>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Globals globals = JsePlatform.standardGlobals();</div><div class="line">globals.loadfile(<span class="string">"testhyperbolic.lua"</span>).<span class="built_in">call</span>();</div><div class="line"></div><div class="line">/* æ‰“å°</div><div class="line">hyperbolic  tab<span class="symbol">le:</span> <span class="number">61</span>e717c2</div><div class="line">hyperbolic.sinh functi<span class="symbol">on:</span> <span class="built_in">sinh</span></div><div class="line">hyperbolic.cosh functi<span class="symbol">on:</span> <span class="built_in">cosh</span></div><div class="line"><span class="built_in">sinh</span>(<span class="number">0.5</span>)   <span class="number">0.5210953</span></div><div class="line"><span class="built_in">cosh</span>(<span class="number">0.5</span>)   <span class="number">1.127626</span></div><div class="line">*/</div></pre></td></tr></table></figure>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ ¹æ®å‰é¢çš„æ–‡ç«  &lt;a href=&quot;http://hanks.pub/2017/01/10/android-lua/&quot;&gt;Android ä¸ Lua&lt;/a&gt; å¯ä»¥å¤§æ¦‚äº†è§£ Lua ã€‚åœ¨ Androidï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰ä¸­ï¼Œå¯ä»¥é€šè¿‡çµæ´»åŠ è½½ Lua è„šæœ¬ï¼Œä½¿åº”ç”¨æ›´åŠ çµæ´»ï¼Œè½»æ¾é¢å¯¹å¤šå˜çš„éœ€æ±‚ã€‚luajava åœ¨ jni å±‚ä¸»è¦å®ç°äº†5ä¸ªæ–¹æ³•ï¼Œå€ŸåŠ©è¿™5ä¸ªæ–¹æ³•luaå‡ ä¹å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„javaç±»äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="Lua" scheme="http://hanks.pub/tags/Lua/"/>
    
  </entry>
  
  <entry>
    <title>Node è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—</title>
    <link href="http://hanks.pub/2017/03/26/node-image-recognition/"/>
    <id>http://hanks.pub/2017/03/26/node-image-recognition/</id>
    <published>2017-03-26T08:53:53.000Z</published>
    <updated>2017-03-27T02:05:42.394Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆæ ¹æ®éœ€æ±‚å¤„ç†å›¾ç‰‡å¤§å°æ—‹è½¬è§’åº¦ï¼Œç„¶åè¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚<br><a href="https://github.com/zhangyuanwei/node-images" target="_blank" rel="external">node-images</a>:  Node.js è½»é‡çº§è·¨å¹³å°å›¾åƒç¼–è§£ç åº“<br><a href="https://github.com/naptha/tesseract.js" target="_blank" rel="external">tesseract</a>: çº¯ JS çš„ OCR åº“æ”¯æŒ 62 ç§è¯­è¨€ã€‚<br><a id="more"></a></p>
<p>ä¾‹å­ï¼š</p>
<p>æŸç½‘ç«™çš„éªŒè¯ç <br><img src="http://ww1.sinaimg.cn/large/8c9b876fly1fe0bvsibibj201a00p07l.jpg" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta"></span></div><div class="line">"use strict"</div><div class="line"></div><div class="line"><span class="keyword">var</span> images = <span class="built_in">require</span>(<span class="string">'images'</span>)</div><div class="line"><span class="keyword">var</span> Tesseract = <span class="built_in">require</span>(<span class="string">'tesseract.js'</span>);</div><div class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span>(<span class="params">uri, filename, callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> stream = fs.createWriteStream(filename);</div><div class="line">    request(uri).pipe(stream)</div><div class="line">        .on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            callback();</div><div class="line">        &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¯†åˆ«å›¾ç‰‡</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">recognize</span>(<span class="params">filePath, callback</span>) </span>&#123;</div><div class="line">    <span class="comment">// å›¾ç‰‡æ”¾å¤§</span></div><div class="line">    images(filePath)</div><div class="line">        .size(<span class="number">90</span>)</div><div class="line">        .save(filePath);</div><div class="line">    <span class="comment">// è¯†åˆ«</span></div><div class="line">    Tesseract</div><div class="line">        .recognize(filePath, &#123;</div><div class="line">            <span class="attr">lang</span>: <span class="string">'eng'</span>, <span class="comment">// è¯­è¨€é€‰è‹±æ–‡</span></div><div class="line">            tessedit_char_blacklist: <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></div><div class="line">                <span class="comment">//å› ä¸ºæ˜¯æ•°å­—éªŒè¯ç ï¼Œæ’é™¤å­—æ¯</span></div><div class="line">        &#125;)</div><div class="line">        .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">            callback(result.text);</div><div class="line">        &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVcode</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> url = <span class="string">'http://ww1.sinaimg.cn/large/8c9b876fly1fe0bvsibibj201a00p07l.jpg'</span>;</div><div class="line">    <span class="keyword">var</span> filename = <span class="string">'vcode.png'</span>;</div><div class="line">    <span class="comment">// å…ˆä¸‹è½½ä¸‹æ¥ï¼Œå†è¯†åˆ«</span></div><div class="line">    downloadFile(url, filename, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        recognize(filename, <span class="function"><span class="keyword">function</span> (<span class="params">txt</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'è¯†åˆ«ç»“æœ: '</span> + txt);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">getVcode();</div></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/8c9b876fly1fe0ccaubowj20rk02yaa6.jpg" alt="è¿è¡Œç»“æœ"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¦–å…ˆæ ¹æ®éœ€æ±‚å¤„ç†å›¾ç‰‡å¤§å°æ—‹è½¬è§’åº¦ï¼Œç„¶åè¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚&lt;br&gt;&lt;a href=&quot;https://github.com/zhangyuanwei/node-images&quot;&gt;node-images&lt;/a&gt;:  Node.js è½»é‡çº§è·¨å¹³å°å›¾åƒç¼–è§£ç åº“&lt;br&gt;&lt;a href=&quot;https://github.com/naptha/tesseract.js&quot;&gt;tesseract&lt;/a&gt;: çº¯ JS çš„ OCR åº“æ”¯æŒ 62 ç§è¯­è¨€ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Node.js" scheme="http://hanks.pub/tags/Node-js/"/>
    
  </entry>
  
  <entry>
    <title>è¯·æ±‚ä»£ç†</title>
    <link href="http://hanks.pub/2017/03/22/proxy-test/"/>
    <id>http://hanks.pub/2017/03/22/proxy-test/</id>
    <published>2017-03-22T13:10:52.000Z</published>
    <updated>2017-03-27T02:05:42.428Z</updated>
    
    <content type="html"><![CDATA[<p>çˆ¬è™«è¿‡ç¨‹ä¸­è§£å†³ä¸€äº›ç½‘ç«™é’ˆå¯¹ IP è®¿é—®æ¬¡æ•°é™åˆ¶ã€‚ä¸‹é¢è¿›è¡Œç®€å•æ¨¡æ‹Ÿï¼š</p>
<a id="more"></a>
<p>æœåŠ¡ç«¯ï¼š server.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// è·å–å®¢æˆ·ç«¯ IP</span></div><div class="line">    <span class="keyword">var</span> ip = request.headers[<span class="string">'x-forwarded-for'</span>] ||</div><div class="line">             request.connection.remoteAddress ||</div><div class="line">             request.socket.remoteAddress ||</div><div class="line">             request.connection.socket.remoteAddress;</div><div class="line">    <span class="built_in">console</span>.log(request.headers);</div><div class="line">    <span class="built_in">console</span>.log(request.httpVersion);</div><div class="line">    <span class="built_in">console</span>.log(request.method);</div><div class="line">    <span class="built_in">console</span>.log(request.url);</div><div class="line">    <span class="built_in">console</span>.log(ip);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'-----------'</span>)</div><div class="line">    response.write(<span class="string">"OK"</span>);</div><div class="line">    response.end();</div><div class="line">&#125;).listen(<span class="number">8889</span>);</div></pre></td></tr></table></figure>
<h2 id="æ­£å¸¸è¯·æ±‚"><a href="#æ­£å¸¸è¯·æ±‚" class="headerlink" title="æ­£å¸¸è¯·æ±‚"></a>æ­£å¸¸è¯·æ±‚</h2><p>å®¢æˆ·ç«¯ï¼š index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">"request"</span>)</div><div class="line"><span class="comment">// æœªåŠ ä»£ç†çš„æƒ…å†µ</span></div><div class="line">request(<span class="string">'http://104.194.66.230:8889/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'error:'</span>, error); </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'statusCode:'</span>, response &amp;&amp; response.statusCode); </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'body:'</span>, body);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p> <img src="https://dn-coding-net-production-pp.qbox.me/5f161f05-07d4-4b15-8274-06c8a643ffb6.png" alt="æ­£å¸¸è®¿é—®"> </p>
<h2 id="å®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†"><a href="#å®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†" class="headerlink" title="å®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†"></a>å®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†</h2><p>å®¢æˆ·ç«¯ï¼š index.js</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">"request"</span>)</div><div class="line">request(&#123;</div><div class="line">        'url':'http<span class="symbol">://104</span>.<span class="number">194.66</span>.<span class="number">230</span>:<span class="number">8889</span>/',</div><div class="line">        'proxy':'http<span class="symbol">://111</span>.<span class="number">7.130</span>.<span class="number">36</span>:<span class="number">8080</span>' // proxy</div><div class="line">    &#125;, </div><div class="line">    function (<span class="name">error</span>, response, body) &#123;</div><div class="line">        console.log('error:', error)<span class="comment">;</span></div><div class="line">        console.log('statusCode:', response <span class="symbol">&amp;&amp;</span> response.statusCode)<span class="comment">;</span></div><div class="line">        console.log('body:', body)<span class="comment">;</span></div><div class="line">    &#125;</div><div class="line">)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p> <img src="https://dn-coding-net-production-pp.qbox.me/308e9c14-436c-4180-b0d0-921b73c25a30.png" alt="ä½¿ç”¨ä»£ç†"> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çˆ¬è™«è¿‡ç¨‹ä¸­è§£å†³ä¸€äº›ç½‘ç«™é’ˆå¯¹ IP è®¿é—®æ¬¡æ•°é™åˆ¶ã€‚ä¸‹é¢è¿›è¡Œç®€å•æ¨¡æ‹Ÿï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="http://hanks.pub/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="ä»£ç†" scheme="http://hanks.pub/tags/%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Android è‡ªå®šä¹‰ view è¿æ¥è¾“å…¥æ³•</title>
    <link href="http://hanks.pub/2017/02/16/android-customview-inputmethod/"/>
    <id>http://hanks.pub/2017/02/16/android-customview-inputmethod/</id>
    <published>2017-02-16T14:33:39.000Z</published>
    <updated>2017-03-27T02:05:42.045Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ <code>View</code> çš„æºç é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•åä¸ºï¼š <code>onCreateInputConnection</code> , é€šè¿‡è¯¥æ–¹æ³•å¯ä½¿è‡ªå®šä¹‰ view è¿æ¥ inputMethod, å¯ä»¥æ¥å—è¾“å…¥ä¿¡æ¯ã€‚è¯¥æ–¹æ³•çš„è§£é‡Šå¦‚ä¸‹ï¼š<br><a id="more"></a></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Create a new InputConnection <span class="keyword">for</span> an InputMethod <span class="keyword">to</span> interact</div><div class="line"> * <span class="keyword">with</span> <span class="keyword">the</span> view.  The default implementation returns null, <span class="keyword">since</span> <span class="keyword">it</span> doesn't</div><div class="line"> * support input methods.  You can override this <span class="keyword">to</span> implement such support.</div><div class="line"> * This <span class="keyword">is</span> only needed <span class="keyword">for</span> views <span class="keyword">that</span> take focus <span class="keyword">and</span> <span class="built_in">text</span> input.</div><div class="line"> *</div><div class="line"> * &lt;p&gt;When implementing this, you probably also want <span class="keyword">to</span> implement</div><div class="line"> * &#123;@link <span class="comment">#onCheckIsTextEditor()&#125; to indicate you will return a</span></div><div class="line"> * non-null InputConnection.&lt;/p&gt;</div><div class="line"> *</div><div class="line"> * &lt;p&gt;Also, take good care <span class="keyword">to</span> fill <span class="keyword">in</span> <span class="keyword">the</span> &#123;@link android.view.inputmethod.EditorInfo&#125;</div><div class="line"> * object correctly <span class="keyword">and</span> <span class="keyword">in</span> <span class="keyword">its</span> entirety, so <span class="keyword">that</span> <span class="keyword">the</span> connected IME can rely</div><div class="line"> * <span class="keyword">on</span> <span class="keyword">its</span> values. For example, &#123;@link android.view.inputmethod.EditorInfo<span class="comment">#initialSelStart&#125;</span></div><div class="line"> * <span class="keyword">and</span>  &#123;@link android.view.inputmethod.EditorInfo<span class="comment">#initialSelEnd&#125; members</span></div><div class="line"> * must be filled <span class="keyword">in</span> <span class="keyword">with</span> <span class="keyword">the</span> correct cursor position <span class="keyword">for</span> IMEs <span class="keyword">to</span> work correctly</div><div class="line"> * <span class="keyword">with</span> your <span class="built_in">application</span>.&lt;/p&gt;</div><div class="line"> *</div><div class="line"> * @param outAttrs Fill <span class="keyword">in</span> <span class="keyword">with</span> attribute information <span class="keyword">about</span> <span class="keyword">the</span> connection.</div><div class="line"> */</div><div class="line">public InputConnection onCreateInputConnection(EditorInfo outAttrs) &#123;</div><div class="line"><span class="built_in">    return</span> null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>onCreateInputConnection æ–¹æ³•è¿æ¥äº† view å’Œ inputMethodï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ª InputConnection æ¥æ¥å—è¾“å…¥æ³•çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by hanks on 2017/2/16.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KInputConnection</span> <span class="keyword">extends</span> <span class="title">BaseInputConnection</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KInputConnection</span><span class="params">(View targetView, <span class="keyword">boolean</span> fullEditor)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(targetView, fullEditor);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// è¾“å…¥æ³•çš„æŒ‰é”®ä¿¡æ¯</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">sendKeyEvent</span><span class="params">(KeyEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getKeyCode()) &#123;</div><div class="line">            <span class="keyword">case</span> KeyEvent.KEYCODE_DEL:</div><div class="line">                <span class="keyword">if</span> (event.getAction()== KeyEvent.ACTION_UP</div><div class="line">                        &amp;&amp; onCommitTextListener != <span class="keyword">null</span>) &#123;</div><div class="line">                    onCommitTextListener.onDeleteText();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">sendKeyEvent</span><span class="params">(event)</span></span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// è¾“å…¥æ³•æäº¤äº†ä¸€ä¸ª text</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">commitText</span><span class="params">(CharSequence text, <span class="keyword">int</span> newCursorPosition)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (onCommitTextListener != <span class="keyword">null</span>) &#123;</div><div class="line">            onCommitTextListener.commitText(text, newCursorPosition);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> OnCommitTextListener  onCommitTextListener;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setOnCommitTextListener</span><span class="params">(OnCommitTextListener onCommitTextListener)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.onCommitTextListener = onCommitTextListener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnCommitTextListener</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">commitText</span><span class="params">(CharSequence text, <span class="keyword">int</span> newCursorPosition)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onDeleteText</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * æ”¯æŒè¾“å…¥æ³•çš„ view</div><div class="line"> * Created by hanks on 2017/2/16.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KInputView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> StringBuilder content = <span class="keyword">new</span> StringBuilder();</div><div class="line">    <span class="keyword">private</span> KInputConnection inputConnection;</div><div class="line">    <span class="keyword">private</span> TextPaint paint;</div><div class="line">    <span class="keyword">private</span> InputMethodManager inputMethodManager;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KInputView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KInputView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// è®¾ç½®å¯ä»¥æ¥å—åˆ°ç„¦ç‚¹</span></div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.setFocusableInTouchMode(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// è·å– InputMethodManager</span></div><div class="line">        inputMethodManager = (InputMethodManager) getContext().getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class="line"></div><div class="line">        paint = <span class="keyword">new</span> TextPaint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        paint.setColor(Color.BLUE);</div><div class="line">        <span class="keyword">float</span> textSize = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, <span class="number">14</span>, getResources().getDisplayMetrics());</div><div class="line">        paint.setTextSize(textSize);</div><div class="line">        setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="comment">// å¼¹å‡ºã€å…³é—­è¾“å…¥æ³•</span></div><div class="line">                inputMethodManager.toggleSoftInput(<span class="number">0</span>, InputMethodManager.HIDE_NOT_ALWAYS);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function">InputConnection <span class="title">onCreateInputConnection</span><span class="params">(EditorInfo editorInfo)</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> <span class="title">getInputConnection</span><span class="params">(editorInfo)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="comment">// ä½¿ç”¨ StaticLayout æ¥ draw</span></div><div class="line">        <span class="keyword">new</span> StaticLayout(content, paint, getWidth(), Layout.Alignment.ALIGN_NORMAL, <span class="number">1.5</span>f, <span class="number">0</span>, <span class="keyword">false</span>).draw(canvas);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function">InputConnection <span class="title">getInputConnection</span><span class="params">(EditorInfo editorInfo)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (inputConnection != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> inputConnection;</div><div class="line">        &#125;</div><div class="line">        inputConnection = <span class="keyword">new</span> KInputConnection(<span class="keyword">this</span>, <span class="keyword">false</span>);</div><div class="line">        inputConnection.setOnCommitTextListener(<span class="keyword">new</span> KInputConnection.OnCommitTextListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">commitText</span><span class="params">(CharSequence text, <span class="keyword">int</span> newCursorPosition)</span> </span>&#123;</div><div class="line">                content.append(text);</div><div class="line">                invalidate();</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDeleteText</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (content.length() &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                content.deleteCharAt(content.length() - <span class="number">1</span>);</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> inputConnection;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://dn-coding-net-production-pp.qbox.me/ef22bd81-91e8-4203-b695-2ba86c7b8dc6.gif" alt="è‡ªå®šä¹‰ View"> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ &lt;code&gt;View&lt;/code&gt; çš„æºç é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•åä¸ºï¼š &lt;code&gt;onCreateInputConnection&lt;/code&gt; , é€šè¿‡è¯¥æ–¹æ³•å¯ä½¿è‡ªå®šä¹‰ view è¿æ¥ inputMethod, å¯ä»¥æ¥å—è¾“å…¥ä¿¡æ¯ã€‚è¯¥æ–¹æ³•çš„è§£é‡Šå¦‚ä¸‹ï¼š&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="View" scheme="http://hanks.pub/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸ Lua</title>
    <link href="http://hanks.pub/2017/01/10/android-lua/"/>
    <id>http://hanks.pub/2017/01/10/android-lua/</id>
    <published>2017-01-10T15:18:29.000Z</published>
    <updated>2017-07-10T11:02:57.974Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.lua.org/" target="_blank" rel="external">Lua</a>: ä¸€ç§è½»é‡è¯­è¨€ï¼Œç”±æ ‡å‡†Cç¼–å†™è€Œæˆï¼Œä½“ç§¯å°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ã€‚Lua æœ‰ä¸€ä¸ªåŒæ—¶è¿›è¡Œçš„ JIT é¡¹ç›®ï¼Œæä¾›åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å³æ—¶ç¼–è¯‘åŠŸèƒ½ã€‚<br><a id="more"></a><br><a href="http://www.luaj.org/luaj/3.0/README.html" target="_blank" rel="external">LuaJ</a>ï¼š<br>Luaj æ˜¯ä¸€ä¸ª Java çš„ Lua è§£é‡Šå™¨ï¼ŒåŸºäº Lua 5.2.x ç‰ˆæœ¬ï¼Œç›®çš„æ˜¯ï¼š</p>
<ul>
<li>åŸºäº Java çš„å®ç°ï¼Œå¯ä»¥åœ¨ Java åº”ç”¨ä¸­é›†æˆ Lua è™šæ‹Ÿæœº</li>
<li>è½»é‡çº§ã€é«˜æ€§èƒ½çš„æ‰§è¡Œ Lua</li>
<li>å¤šå¹³å°æ”¯æŒ</li>
<li>å®Œæ•´çš„åº“å’Œå·¥å…·æ”¯æŒ</li>
<li>å¯åœ¨ Java MEã€SE å’Œ EE ç¯å¢ƒä¸­æ‰§è¡Œ</li>
<li>luajava api æ”¯æŒ</li>
<li>æ··åˆè°ƒè¯•</li>
</ul>
<p><a href="https://github.com/mkottman/AndroLua" target="_blank" rel="external">AndroLua</a> :<br><code>Androlua</code> æ˜¯å®‰å“å¹³å°ä¸Šçš„ç”¨ Lua å¼€å‘å®‰å“ç¨‹åºçš„å·¥å…·ï¼Œä¸ä»…æ”¯æŒè°ƒç”¨Java APIï¼Œè€Œä¸”æ”¯æŒç¼–å†™å®‰å“ç•Œé¢ç¨‹åºï¼Œè¿˜å¯ä»¥å°†è‡ªå·±å†™çš„ Lua ç¨‹åºæ‰“åŒ…æˆ apk å®‰è£…æ–‡ä»¶å®‰è£…ã€‚Lua è¯­è¨€çš„ç®€å•ä½¿æ²¡æœ‰ä»»ä½•ç¼–ç¨‹ç»éªŒçš„ç”¨æˆ·ä¹Ÿèƒ½åœ¨çŸ­æ—¶é—´å†…å¼€å‘å‡ºå®‰å“ç¨‹åºã€‚(æ¥è‡ªç™¾åº¦<a href="http://baike.baidu.com/link?url=uKUBS37YCr-ASuAsGJH4RaS2dTbm0AUq_1la8TGBJUHrdjkeFhTwqbxJy4OZkagOI146bPK0csWnijBr-zQ2uLOzN4f_pJGkWOcd5jWf-Hm" target="_blank" rel="external">ç™¾ç§‘</a>)</p>
<p><a href="https://github.com/alibaba/LuaViewSDK" target="_blank" rel="external">LuaViewSDK - Androidç‰ˆ</a><br><code>LuaViewSDK</code> ç”±é˜¿é‡Œèšåˆ’ç®—æ— çº¿å¼€å‘å›¢é˜Ÿå¼€å‘å¹¶ç»´æŠ¤ï¼Œ LuaView æ˜¯ä¸€ç§è¿è¡Œåœ¨ä¸€ä¸ª ViewController/Activity ä¸­ï¼Œå¯ä»¥<strong>çµæ´»åŠ è½½</strong> Lua è„šæœ¬ï¼Œå¹¶èƒ½å¤ŸæŒ‰ç…§ <strong>Native</strong> çš„æ–¹å¼è¿è¡Œçš„ä¸€ç§é¢å‘ä¸šåŠ¡çš„å¼€å‘æŠ€æœ¯æ–¹æ¡ˆã€‚å¯ä»¥å¿«é€Ÿå¼€å‘ç”µå•†åº”ç”¨ä¸­æ—¢è¦æ±‚ä½“éªŒåˆè¦æ±‚çµæ´»æ€§çš„é¡µé¢åŠŸèƒ½ï¼Œä¾‹å¦‚é¦–é¡µï¼Œç±»ç›®é¦–é¡µï¼Œå‚ç›´é¢‘é“ï¼Œå¤§ä¿ƒæ´»åŠ¨ä¼šåœºç­‰ã€‚LuaViewSDK è¿˜æœ‰ iOS ç‰ˆã€‚</p>
<h3 id="LuaViewSDK-ä½“éªŒ"><a href="#LuaViewSDK-ä½“éªŒ" class="headerlink" title="LuaViewSDK ä½“éªŒ"></a>LuaViewSDK ä½“éªŒ</h3><p>å®˜æ–¹æ–‡æ¡£æ”¾äº†ä¸€ä¸ªå¾ˆè¯¦ç»†çš„å…¥é—¨æ–‡æ¡£ ğŸ‘‰<a href="https://github.com/alibaba/LuaViewSDK/blob/master/Android/Documentation/%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8-android/%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8%20-%20android.md" target="_blank" rel="external">æ–°æ‰‹å…¥é—¨ - android</a></p>
<p>ä¸‹é¢çš„æ˜¯æˆ‘è‡ªå·±åˆ›å»ºçš„é¡¹ç›®ï¼ŒåŠ è½½ assets ç›®å½•ä¸‹çš„ <code>haha.lua</code> æ–‡ä»¶<br> <img src="https://dn-coding-net-production-pp.qbox.me/37ef5cb2-98a7-406a-8cfc-ccfa8201bdec.png" alt="å›¾ç‰‡"> </p>
<p> ä¸‹é¢å°è¯•åŠ è½½å¤–éƒ¨çš„è„šæœ¬æ–‡ä»¶ï¼Œ æˆ‘åœ¨ sd å¡ä¸Šæ–°å»ºäº†ä¸€ä¸ª <code>local.lua</code> è„šæœ¬æ–‡ä»¶<br> å†…å®¹å¦‚ä¸‹<br> <figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">w,h = System.screenSize();</div><div class="line">window.frame(<span class="number">0</span>, <span class="number">0</span>, w, h);</div><div class="line">window.backgroundColor(<span class="number">0x220000</span>);</div><div class="line"></div><div class="line">label = Label();</div><div class="line">label.frame(<span class="number">16</span>,<span class="number">16</span>,w, <span class="number">60</span>);</div><div class="line">label.text(<span class="string">"Local Hello World LuaView to Android"</span>);</div></pre></td></tr></table></figure></p>
<p> <img width="360px" src="https://dn-coding-net-production-pp.qbox.me/7e0b62b0-8f3b-40c1-85a7-a097bcebba1b.png" alt=""></p>
<p>æˆ‘ä»¬é¡µå¯åŠ è½½æœåŠ¡å™¨ä¸Šçš„ lua è„šæœ¬ï¼Œæ³¨æ„æ ¡éªŒæœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œé˜²æ­¢ lua è„šæœ¬æ¶æ„æ”»å‡»ã€‚</p>
<h3 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h3><ul>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-LUAScript/" target="_blank" rel="external">Lua åœ¨ç§»åŠ¨å¹³å°ä¸Šçš„åº”ç”¨</a></li>
<li>[]</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.lua.org/&quot;&gt;Lua&lt;/a&gt;: ä¸€ç§è½»é‡è¯­è¨€ï¼Œç”±æ ‡å‡†Cç¼–å†™è€Œæˆï¼Œä½“ç§¯å°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ã€‚Lua æœ‰ä¸€ä¸ªåŒæ—¶è¿›è¡Œçš„ JIT é¡¹ç›®ï¼Œæä¾›åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å³æ—¶ç¼–è¯‘åŠŸèƒ½ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="Lua" scheme="http://hanks.pub/tags/Lua/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸‹ Markdown æ¸²æŸ“</title>
    <link href="http://hanks.pub/2017/01/10/android-markdown-render/"/>
    <id>http://hanks.pub/2017/01/10/android-markdown-render/</id>
    <published>2017-01-10T15:03:07.000Z</published>
    <updated>2017-03-27T02:05:42.063Z</updated>
    
    <content type="html"><![CDATA[<p>Android ä¸‹çš„ <code>webview</code> åŠ è½½æœ¬åœ°å‡†å¤‡å¥½çš„ html å¤–å£³ï¼Œç„¶åé€šè¿‡ä¸ js äº¤äº’å°†å‡†å¤‡æ¸²æŸ“çš„çº¯æ–‡æœ¬ä¼ ç»™è´Ÿè´£ <code>markdown</code> æ¸²æŸ“çš„ js å¤„ç†ï¼ˆæ­¤å¤„ä½¿ç”¨çš„ <code>marked.js</code> ï¼‰ï¼Œå°†æ–‡æœ¬è½¬åŒ–ä¸º html æ ¼å¼å¡«å……åˆ° webview ä¸­ã€‚</p>
<a id="more"></a>
<h3 id="html-å¤–å£³"><a href="#html-å¤–å£³" class="headerlink" title="html å¤–å£³"></a>html å¤–å£³</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">        @<span class="keyword">font-face</span> &#123;</div><div class="line">            <span class="attribute">font-family</span>: <span class="string">'customFont'</span>;</div><div class="line">            <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'file:///sdcard/manaco.ttf'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>);</div><div class="line">            <span class="attribute">font-weight</span>: normal;</div><div class="line">            <span class="attribute">font-style</span>: normal;</div><div class="line">        &#125;</div><div class="line">        *&#123;</div><div class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="selector-tag">body</span>&#123;</div><div class="line">            <span class="attribute">font-family</span>: customFont; <span class="comment">/* è®¾ç½®å­—ä½“ */</span></div><div class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>; <span class="comment">/* body æ§åˆ¶å­—ä½“å¤§å°*/</span></div><div class="line">            <span class="attribute">color</span>: <span class="number">#000</span>; <span class="comment">/* è®¾ç½®é¢œè‰² */</span></div><div class="line">            <span class="attribute">line-height</span>: <span class="number">1.5em</span>; <span class="comment">/* è®¾ç½®è¡Œé«˜*</span></div><div class="line">        &#125;</div><div class="line">     </div><div class="line">        //....å®šä¹‰æ¸²æŸ“çš„css</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- åŠ è½½ marked.js --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"marked.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">class</span>=<span class="string">"markdown-body"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">     <span class="comment">// æ¸²æŸ“æ–‡æœ¬ä¸º html </span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parseMarkdown</span>(<span class="params">content, gfmEnabled</span>) </span>&#123;</div><div class="line">        marked.setOptions(&#123;</div><div class="line">            <span class="attr">renderer</span>: <span class="keyword">new</span> marked.Renderer(),</div><div class="line">            <span class="attr">gfm</span>: gfmEnabled,</div><div class="line">            <span class="attr">tables</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">breaks</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">pedantic</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">sanitize</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">smartLists</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">smartypants</span>: <span class="literal">false</span></div><div class="line">        &#125;);</div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = marked(content);</div><div class="line">        parseDone();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parseDone</span>(<span class="params"></span>) </span>&#123;</div><div class="line">         <span class="comment">//é€šçŸ¥ java å±‚æ¸²æŸ“å®Œæˆ</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeBackgroundColor</span>(<span class="params">color</span>)</span>&#123;</div><div class="line">        <span class="built_in">document</span>.body.style.background = color;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeFontSize</span>(<span class="params">size</span>)</span>&#123;</div><div class="line">        <span class="built_in">document</span>.body.style.fontSize  = size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeFontColor</span>(<span class="params">color</span>)</span>&#123;</div><div class="line">        <span class="built_in">document</span>.body.style.color= color;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeLineHeight</span>(<span class="params">lineHeight</span>)</span>&#123;</div><div class="line">        <span class="built_in">document</span>.body.style.lineHeight= lineHeight;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="æ›´æ”¹-webview-èƒŒæ™¯ä¸ºé€æ˜"><a href="#æ›´æ”¹-webview-èƒŒæ™¯ä¸ºé€æ˜" class="headerlink" title="æ›´æ”¹ webview èƒŒæ™¯ä¸ºé€æ˜"></a>æ›´æ”¹ webview èƒŒæ™¯ä¸ºé€æ˜</h3><p>é€šè¿‡è®¾ç½® webview çš„å±æ€§<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">webView</span><span class="selector-class">.setBackgroundColor</span>(<span class="number">0</span>); <span class="comment">// è®¾ç½®èƒŒæ™¯è‰²é€æ˜</span></div></pre></td></tr></table></figure></p>
<h3 id="æ›´æ”¹ç½‘é¡µå­—ä½“é¢œè‰²"><a href="#æ›´æ”¹ç½‘é¡µå­—ä½“é¢œè‰²" class="headerlink" title="æ›´æ”¹ç½‘é¡µå­—ä½“é¢œè‰²"></a>æ›´æ”¹ç½‘é¡µå­—ä½“é¢œè‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFontColor</span><span class="params">(String color)</span> </span>&#123;</div><div class="line">    mWebView.loadUrl(String.format(<span class="string">"javascript:changeFontColor('%s')"</span>, color));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ›´æ”¹ç½‘é¡µå­—ä½“å¤§å°"><a href="#æ›´æ”¹ç½‘é¡µå­—ä½“å¤§å°" class="headerlink" title="æ›´æ”¹ç½‘é¡µå­—ä½“å¤§å°"></a>æ›´æ”¹ç½‘é¡µå­—ä½“å¤§å°</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> setFontSize(<span class="keyword">float</span> <span class="built_in">size</span>) &#123;</div><div class="line">    mWebView.loadUrl(<span class="keyword">String</span>.format(<span class="string">"javascript:changeFontSize(%s)"</span>, <span class="built_in">size</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ›´æ”¹ç½‘é¡µè¡Œé—´è·"><a href="#æ›´æ”¹ç½‘é¡µè¡Œé—´è·" class="headerlink" title="æ›´æ”¹ç½‘é¡µè¡Œé—´è·"></a>æ›´æ”¹ç½‘é¡µè¡Œé—´è·</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLineHeight</span><span class="params">(<span class="keyword">float</span> lineHeight)</span> </span>&#123;</div><div class="line">   mWebView.loadUrl(String.format(<span class="string">"javascript:changeLineHeight(%s)"</span>, lineHeight));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ›´æ”¹ç½‘é¡µå­—ä½“"><a href="#æ›´æ”¹ç½‘é¡µå­—ä½“" class="headerlink" title="æ›´æ”¹ç½‘é¡µå­—ä½“"></a>æ›´æ”¹ç½‘é¡µå­—ä½“</h3><p>é€šè¿‡ CSS ä¸­çš„ @font-faceï¼Œå…·ä½“çœ‹ä¸Šä¸€ç¯‡å†™çš„ <a href="http://hanks-zyh.github.io/2017/01/09/android-webview-font/" target="_blank" rel="external">Android ä¸­ webview è‡ªå®šä¹‰å­—ä½“</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android ä¸‹çš„ &lt;code&gt;webview&lt;/code&gt; åŠ è½½æœ¬åœ°å‡†å¤‡å¥½çš„ html å¤–å£³ï¼Œç„¶åé€šè¿‡ä¸ js äº¤äº’å°†å‡†å¤‡æ¸²æŸ“çš„çº¯æ–‡æœ¬ä¼ ç»™è´Ÿè´£ &lt;code&gt;markdown&lt;/code&gt; æ¸²æŸ“çš„ js å¤„ç†ï¼ˆæ­¤å¤„ä½¿ç”¨çš„ &lt;code&gt;marked.js&lt;/code&gt; ï¼‰ï¼Œå°†æ–‡æœ¬è½¬åŒ–ä¸º html æ ¼å¼å¡«å……åˆ° webview ä¸­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="WebView" scheme="http://hanks.pub/tags/WebView/"/>
    
      <category term="Markdown" scheme="http://hanks.pub/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸­ webview è‡ªå®šä¹‰å­—ä½“</title>
    <link href="http://hanks.pub/2017/01/09/android-webview-font/"/>
    <id>http://hanks.pub/2017/01/09/android-webview-font/</id>
    <published>2017-01-09T15:45:28.000Z</published>
    <updated>2017-03-27T02:05:42.077Z</updated>
    
    <content type="html"><![CDATA[<p>éœ€æ±‚ï¼š åº”ç”¨ä¸­çš„ webview ç•Œé¢ä¸­å¯ä»¥ä½¿ç”¨ <strong>assets</strong> ç›®å½•ä»¥åŠ <strong>sdcard</strong> çš„å­—ä½“<br>åŸç†ï¼š é€šè¿‡æ›´æ”¹ css ä¸­çš„ <code>font-family</code> å±æ€§æ›´æ”¹å­—ä½“ï¼Œå…³é”®åœ¨äºå¦‚æœåŠ è½½æœ¬åœ°çš„å­—ä½“ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ° css çš„ <code>@font-face</code> å±æ€§<br><a id="more"></a><br>æ•ˆæœå›¾ï¼ˆå³å›¾ä¸ºè‡ªå®šä¹‰å­—ä½“ï¼‰ï¼š</p>
<div style="display: flex; flex-direction: row;"><br>    <img src="http://o6epsoek1.bkt.clouddn.com/2017010914839770115679.jpg?imageView2/0/format/jpg" alt=""><br>    <img src="http://o6epsoek1.bkt.clouddn.com/20170109148397697952698.jpg?imageView2/0/format/jpg" alt=""><br></div>

<p>ä»¥ä¸‹çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">@<span class="keyword">font-face</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>: <span class="string">'customFont'</span>;</div><div class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'file:///mnt/sdcard/manaco.ttf'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>);</div><div class="line">    <span class="attribute">font-weight</span>: normal;</div><div class="line">    <span class="attribute">font-style</span>: normal;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">body</span>&#123;</div><div class="line">  <span class="attribute">font-family</span>: customFont;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å…ˆé€šè¿‡ @font-face åŠ è½½æœ¬åœ°å­—ä½“ï¼Œç„¶åé€šè¿‡ font-family è®¾ç½®å…ƒç´ çš„æ˜¾ç¤ºå­—ä½“ã€‚è®¾ç½® url ä¸ºæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆfile://æœ¬åœ°è·¯å¾„ï¼‰æ¥åŠ è½½ sdcard å­—ä½“ï¼Œå¦‚æœè¦åŠ è½½ assets ç›®å½•çš„å­—ä½“å°† url æ”¹ä¸º <code>file:///android_assets/manaco.ttf</code>ã€‚</p>
<p>æˆªå›¾ç”± <a href="http://coolapk.com/apk/xyz.hanks.note" target="_blank" rel="external"><strong>ä¾¿ç­¾</strong></a> ç”Ÿæˆ</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éœ€æ±‚ï¼š åº”ç”¨ä¸­çš„ webview ç•Œé¢ä¸­å¯ä»¥ä½¿ç”¨ &lt;strong&gt;assets&lt;/strong&gt; ç›®å½•ä»¥åŠ &lt;strong&gt;sdcard&lt;/strong&gt; çš„å­—ä½“&lt;br&gt;åŸç†ï¼š é€šè¿‡æ›´æ”¹ css ä¸­çš„ &lt;code&gt;font-family&lt;/code&gt; å±æ€§æ›´æ”¹å­—ä½“ï¼Œå…³é”®åœ¨äºå¦‚æœåŠ è½½æœ¬åœ°çš„å­—ä½“ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ° css çš„ &lt;code&gt;@font-face&lt;/code&gt; å±æ€§&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="WebView" scheme="http://hanks.pub/tags/WebView/"/>
    
  </entry>
  
  <entry>
    <title>slack bot</title>
    <link href="http://hanks.pub/2016/09/25/slack-bot/"/>
    <id>http://hanks.pub/2016/09/25/slack-bot/</id>
    <published>2016-09-25T13:36:49.000Z</published>
    <updated>2017-07-10T11:02:58.247Z</updated>
    
    <content type="html"><![CDATA[<p>##ã€€å‰µå»ºæ©Ÿå™¨äºº</p>
<p>åˆ©ç”¨æœºå™¨äººå¯ä»¥åšä¸€äº›é‡å¤æ€§çš„å·¥ä½œã€‚<br>åˆ›å»º bot userï¼Œå°±æ˜¯å¯ä»¥è·Ÿå®ƒè¿›è¡Œå®æ—¶èŠå¤©ã€‚<br><a id="more"></a></p>
<p><a href="https://api.slack.com/bot-users" target="_blank" rel="external">https://api.slack.com/bot-users</a><br><a href="https://my.slack.com/services/new/bot" target="_blank" rel="external">https://my.slack.com/services/new/bot</a></p>
<p><img src="https://ws4.sinaimg.cn/large/8c9b876fjw1f864v443vpj20se0ezq4m.jpg" alt="åˆ›å»º"></p>
<p>##ã€€å‰µå»ºåæ‹¿åˆ° token</p>
<p><img src="https://ws3.sinaimg.cn/large/8c9b876fjw1f864vqez0bj20sr0mrdio.jpg" alt="token"></p>
<h2 id="è®“æ©Ÿå™¨äººåœ¨ç¶«"><a href="#è®“æ©Ÿå™¨äººåœ¨ç¶«" class="headerlink" title="è®“æ©Ÿå™¨äººåœ¨ç¶«"></a>è®“æ©Ÿå™¨äººåœ¨ç¶«</h2><p>å®‰è£… <code>botkit</code>ï¼Œ <code>botkit</code> æ˜¯ä¸€ä¸ª node çš„åº“ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> <span class="comment">--save botkit</span></div></pre></td></tr></table></figure>
<p>åˆ›å»º <code>bot.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Botkit = <span class="built_in">require</span>(<span class="string">'botkit'</span>);</div><div class="line"><span class="keyword">var</span> controller = Botkit.slackbot();</div><div class="line"><span class="keyword">var</span> bot = controller.spawn(&#123;</div><div class="line">  <span class="attr">token</span>: your_slack_bot_token <span class="comment">// å¡«å…¥ç”³è«‹çš„ token</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">bot.startRTM(<span class="function"><span class="keyword">function</span>(<span class="params">err,bot,payload</span>) </span>&#123; <span class="comment">//é–‹å•“å¯¦æ™‚èŠå¤©</span></div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Could not connect to Slack'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//è™•ç†ä¾†è‡ªå®¢æˆ¶ç«¯ç™¼ä¾†çš„è«‹æ±‚</span></div><div class="line">controller.hears([<span class="string">"keyword"</span>, <span class="string">"^pattern$"</span>], [<span class="string">"direct_message"</span>, <span class="string">"direct_mention"</span>, <span class="string">"mention"</span>, <span class="string">"ambient"</span>],</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">bot, message</span>) </span>&#123;</div><div class="line">        bot.reply(message, <span class="string">'You used a keyword!'</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span> <span class="title">bot</span>.js</div></pre></td></tr></table></figure>
<p><img src="https://ws4.sinaimg.cn/large/8c9b876fjw1f865asb5w4j20uk0j90ug.jpg" alt="èŠå¤©"></p>
<h2 id="æ©Ÿå™¨äººä¸»å‹•æ¨é€"><a href="#æ©Ÿå™¨äººä¸»å‹•æ¨é€" class="headerlink" title="æ©Ÿå™¨äººä¸»å‹•æ¨é€"></a>æ©Ÿå™¨äººä¸»å‹•æ¨é€</h2><p>èª¿ç”¨ <code>bot.reply(message, &#39;You used a keyword!&#39;);</code></p>
<p>å¦‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">var</span> m = &#123;</div><div class="line">    <span class="class"><span class="keyword">type</span></span>: <span class="symbol">'messag</span>e',</div><div class="line">    channel: <span class="symbol">'D2FFFEXS</span>7',</div><div class="line">    user: <span class="symbol">'U2CE0K88</span>0',</div><div class="line">    text: <span class="symbol">'o</span>p',</div><div class="line">    ts: <span class="symbol">'1474725618</span><span class="number">.000015</span>',</div><div class="line">    team: <span class="symbol">'T2BD7KZH</span>6',</div><div class="line">    event: <span class="symbol">'direct_messag</span>e',</div><div class="line">&#125;</div><div class="line">bot.reply(m, <span class="symbol">'gagagag</span>a'); <span class="comment">//ç™¼é€æ¶ˆæ¯çµ¦ user</span></div></pre></td></tr></table></figure></p>
<h2 id="è‡ªå®šç¾©æ¶ˆæ¯çš„æ¨£å¼"><a href="#è‡ªå®šç¾©æ¶ˆæ¯çš„æ¨£å¼" class="headerlink" title="è‡ªå®šç¾©æ¶ˆæ¯çš„æ¨£å¼"></a>è‡ªå®šç¾©æ¶ˆæ¯çš„æ¨£å¼</h2><p><a href="https://api.slack.com/docs/messages/builder" target="_blank" rel="external">https://api.slack.com/docs/messages/builder</a></p>
<p><img src="https://ws3.sinaimg.cn/large/8c9b876fjw1f865kgcc7dj20tl0o4djn.jpg" alt="è‡ªå®šä¹‰æ¶ˆæ¯"></p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##ã€€å‰µå»ºæ©Ÿå™¨äºº&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨æœºå™¨äººå¯ä»¥åšä¸€äº›é‡å¤æ€§çš„å·¥ä½œã€‚&lt;br&gt;åˆ›å»º bot userï¼Œå°±æ˜¯å¯ä»¥è·Ÿå®ƒè¿›è¡Œå®æ—¶èŠå¤©ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="bot" scheme="http://hanks.pub/tags/bot/"/>
    
      <category term="slack" scheme="http://hanks.pub/tags/slack/"/>
    
  </entry>
  
  <entry>
    <title>è®©ç½‘é¡µæ›´é€‚é…ç§»åŠ¨è®¾å¤‡</title>
    <link href="http://hanks.pub/2016/09/19/webapp/"/>
    <id>http://hanks.pub/2016/09/19/webapp/</id>
    <published>2016-09-19T15:02:44.000Z</published>
    <updated>2017-07-10T11:02:58.294Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥çœ‹ä¸€ä¸‹æ‰‹æœºæ·˜å®çš„æ•ˆæœã€‚æ‰“å¼€ chrome ï¼Œ è¾“å…¥ <a href="http://m.taobao.com" target="_blank" rel="external">http://m.taobao.com</a> ï¼Œç­‰å¾…é¡µé¢åŠ è½½å®Œæ¯•ç‚¹å‡» chrome èœå•ä¸­çš„<strong>æ·»åŠ åˆ°ä¸»å±å¹•</strong>ï¼Œçœ‹åˆ°å¯ä»¥åœ¨æ¡Œé¢ç”Ÿæˆä¸€ä¸ªå¿«æ·å›¾æ ‡ï¼Œç‚¹å‡»å›¾æ ‡è¿›å…¥ï¼Œå¯ä»¥çœ‹åˆ°ç›´æ¥å˜æˆä¸€ä¸ªå…¨å±çš„å•ç‹¬é¡µé¢ï¼Œç»™ç”¨æˆ·ä½“çš„éªŒæ›´å¥½ã€‚æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°éœ€è¦æ·»åŠ ä»¥ä¸‹ä»£ç å»é€‚é…ã€‚<br><a id="more"></a><br><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f7zbeu2phdg20800ehhdx.gif" alt="æ·˜å®"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  .....</div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dnsâ€prefetch"</span> <span class="attr">href</span>=<span class="string">"http://image.uc.cn"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"yes"</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"yes"</span> <span class="attr">name</span>=<span class="string">"apple-touch-fullscreen"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"telephone=no,email=no"</span> <span class="attr">name</span>=<span class="string">"format-detection"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"App-Config"</span> <span class="attr">content</span>=<span class="string">"fullscreen=yes,useHistoryState=yes,transition=yes"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon-precomposed"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://ww1.sinaimg.cn/large/8c9b876fjw1f7zaijlukpj2040040t8m.jpg"</span> <span class="attr">rel</span>=<span class="string">"Shortcut Icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">   .....</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æˆ‘ç»™è‡ªå·±çš„ç½‘é¡µé€‚é…åçš„æ•ˆæœã€‚æ›´å¤šé…ç½®å¯ä»¥è½¬åˆ°<a href="https://developer.chrome.com/multidevice/android/installtohomescreen" target="_blank" rel="external">Install to Homescreen</a></p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f7zbhegntsg20800eh4qs.gif" alt="joke"></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://developer.chrome.com/multidevice/android/installtohomescreen" target="_blank" rel="external">https://developer.chrome.com/multidevice/android/installtohomescreen</a></li>
<li><a href="https://m.taobao.com" target="_blank" rel="external">https://m.taobao.com</a></li>
</ul>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥çœ‹ä¸€ä¸‹æ‰‹æœºæ·˜å®çš„æ•ˆæœã€‚æ‰“å¼€ chrome ï¼Œ è¾“å…¥ &lt;a href=&quot;http://m.taobao.com&quot;&gt;http://m.taobao.com&lt;/a&gt; ï¼Œç­‰å¾…é¡µé¢åŠ è½½å®Œæ¯•ç‚¹å‡» chrome èœå•ä¸­çš„&lt;strong&gt;æ·»åŠ åˆ°ä¸»å±å¹•&lt;/strong&gt;ï¼Œçœ‹åˆ°å¯ä»¥åœ¨æ¡Œé¢ç”Ÿæˆä¸€ä¸ªå¿«æ·å›¾æ ‡ï¼Œç‚¹å‡»å›¾æ ‡è¿›å…¥ï¼Œå¯ä»¥çœ‹åˆ°ç›´æ¥å˜æˆä¸€ä¸ªå…¨å±çš„å•ç‹¬é¡µé¢ï¼Œç»™ç”¨æˆ·ä½“çš„éªŒæ›´å¥½ã€‚æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°éœ€è¦æ·»åŠ ä»¥ä¸‹ä»£ç å»é€‚é…ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://hanks.pub/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ä½“éªŒ weex â€”â€” å†™ä¸€ä¸ªè¡¨æƒ…åŒ…åº”ç”¨</title>
    <link href="http://hanks.pub/2016/09/05/weex-2333/"/>
    <id>http://hanks.pub/2016/09/05/weex-2333/</id>
    <published>2016-09-05T14:45:18.000Z</published>
    <updated>2017-07-10T11:02:58.300Z</updated>
    
    <content type="html"><![CDATA[<p>å‰äº›æ—¶é—´ä½“éªŒ ReactNative çš„æ—¶å€™å†™äº†ä¸€ä¸ª 2333 è¡¨æƒ…åŒ… appï¼Œè¿™æ¬¡ä½¿ç”¨ <code>weex</code> å†™ä¸€ä¸‹ã€‚ weex é€šè¿‡è‡ªå·±çš„ä¸€å¥— sdk å¯ä»¥å°†ä¸€ä¸ª js æ–‡ä»¶æ¸²æŸ“æˆä¸€ä¸ª native ï¼ˆandroid æˆ– iOS ï¼‰çš„ view å¯¹è±¡ã€‚ weex è¯­æ³•å‚ç…§ vue ï¼Œçœ‹è¿‡ä¸€ç‚¹ vue çš„æ–‡æ¡£æ‰€ä»¥å†™èµ·æ¥å¯ä»¥å¾ˆå¿«ä¸Šæ‰‹ã€‚æœ‰ä¸€ç‚¹æ„Ÿå— <code>weex</code> çš„æ–‡æ¡£æ„Ÿè§‰æ²¡æœ‰ RN çš„æ¸…æ™°ï¼Œè¿˜æœ‰å°ºå¯¸å•ä½è¿˜æ²¡ææ¸…æ¥šï¼Œæµè§ˆå™¨é¢„è§ˆçš„å’Œç”Ÿæˆçš„ android ç‰ˆè¿˜æ˜¯æœ‰å·®è·ï¼Œå’Œ iOS ä¹Ÿå°ºå¯¸ä¸å¤ªå¯¹ã€‚<br><a id="more"></a><br><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f7j4ktor7hj20z40hqn2y.jpg" alt="weex"></p>
<p><img src="http://o6epsoek1.bkt.clouddn.com/12.gif" alt="brower"></p>
<p><img src="http://o6epsoek1.bkt.clouddn.com/13.gif" alt="android"></p>
<h2 id="å®‰è£…-weex"><a href="#å®‰è£…-weex" class="headerlink" title="å®‰è£… weex"></a>å®‰è£… weex</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> -g weex-toolkit</div></pre></td></tr></table></figure>
<h2 id="åˆ›å»º-index-we-æ–‡ä»¶"><a href="#åˆ›å»º-index-we-æ–‡ä»¶" class="headerlink" title="åˆ›å»º index.we æ–‡ä»¶"></a>åˆ›å»º index.we æ–‡ä»¶</h2><p>å’Œ vue ç±»ä¼¼ <code>template</code> ä¸­æ”¾å¸ƒå±€ï¼Œ<code>style</code> æ”¾cssï¼Œ<code>script</code> æ“ä½œæ•°æ®ã€‚</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></div><div class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">list</span> <span class="attr">class</span>=<span class="string">"main-list"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">cell</span>  <span class="attr">class</span>=<span class="string">"</span></span><span class="template-variable">&#123;&#123; isSelected ? 'row-select' :'row' &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">repeat</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123;rows&#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">index</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123;$index&#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">onclick</span>=<span class="string">"changeTid"</span> <span class="attr">tid</span>=</span></span><span class="template-variable">&#123;&#123;tid&#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></div><div class="line">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"item-title"</span>&gt;</span><span class="template-variable">&#123;&#123;  title &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></div><div class="line">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">cell</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">list</span> <span class="attr">class</span>=<span class="string">"main-detail"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">cell</span>  <span class="attr">class</span>=<span class="string">"image-row"</span> <span class="attr">repeat</span>=<span class="string">"</span></span><span class="template-variable">&#123;&#123; imageList &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> &gt;</span></span></div><div class="line">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"image-item"</span>&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">div</span> <span class="attr">repeat</span>=<span class="string">"</span></span><span class="template-variable">&#123;&#123;data&#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></div><div class="line">               <span class="tag">&lt;<span class="name">image</span> <span class="attr">style</span>=<span class="string">"width:198;height:198;"</span> <span class="attr">src</span>=<span class="string">"</span></span><span class="template-variable">&#123;&#123; link &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></div><div class="line">             <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">cell</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line"><span class="selector-class">.main</span>&#123;</div><div class="line">  <span class="attribute">flex-direction</span>: row;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#eceff1</span>;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#333333</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.main-list</span>&#123;</div><div class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">  <span class="attribute">align-items</span>: stretch;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.main-detail</span>&#123;</div><div class="line">  <span class="attribute">flex</span>: <span class="number">4</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.row</span> &#123;</div><div class="line">  <span class="attribute">background-color</span>: white;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.row-select</span> &#123;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#e1e1e1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.item</span> &#123;</div><div class="line">  <span class="attribute">justify-content</span>: center;</div><div class="line">  <span class="attribute">border-bottom-width</span>: <span class="number">2</span>;</div><div class="line">  <span class="attribute">border-right-width</span>: <span class="number">2</span>;</div><div class="line">  <span class="attribute">border-bottom-color</span>: <span class="number">#eceff1</span>;</div><div class="line">  <span class="attribute">border-right-color</span>: <span class="number">#eceff1</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">68</span>;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="number">10</span>;</div><div class="line">  <span class="attribute">padding-right</span>: <span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.image-item</span>&#123;</div><div class="line">  <span class="attribute">justify-content</span>: space-between;</div><div class="line">  <span class="attribute">flex-direction</span>: row;</div><div class="line">  <span class="attribute">height</span>: <span class="number">202</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.item-title</span> &#123;</div><div class="line">  <span class="attribute">font-size</span>: <span class="number">24</span>;</div><div class="line">  <span class="attribute">text-overflow</span>: ellipsis;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line"><span class="comment">// ä½¿ç”¨çš„ç»„ä»¶</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'weex-components'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">data</span>: &#123;</div><div class="line">      <span class="attr">rows</span>: [],</div><div class="line">      <span class="attr">imageList</span>: [],</div><div class="line">      <span class="attr">currentTid</span>: <span class="number">128</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">created</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.getCategory()</div><div class="line">        <span class="keyword">this</span>.getImage(<span class="keyword">this</span>.currentTid)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">methods</span>: &#123;</div><div class="line">      <span class="attr">getCategory</span>: <span class="function"><span class="keyword">function</span>(<span class="params">tid</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line">        <span class="keyword">var</span> stream = <span class="built_in">require</span>(<span class="string">'@weex-module/stream'</span>);</div><div class="line">        <span class="comment">// ç›´æ¥ä½¿ç”¨ fetch ä»¥åŠ =&gt; åœ¨é¢„è§ˆä¸­æ²¡é—®é¢˜ï¼Œç”Ÿæˆçš„ js æ–‡ä»¶åœ¨ Android ç‰ˆæœ¬æ¸²æŸ“ä¸å‡ºæ¥ï¼Œå¥½åƒæ˜¯ä¸èƒ½ç›´æ¥æ”¯æŒ ES6 è¯­æ³•</span></div><div class="line">        stream.fetch(&#123;</div><div class="line">          <span class="attr">method</span>: <span class="string">'GET'</span>,</div><div class="line">          <span class="attr">url</span>: <span class="string">'https://api.leancloud.cn/1.1/classes/Category'</span>,</div><div class="line">          <span class="attr">headers</span>: &#123;</div><div class="line">            <span class="string">'X-LC-Id'</span>: <span class="string">'ffTooBOPa3NxxjEo91dVYEel-gzGzoHsz'</span>,</div><div class="line">            <span class="string">'X-LC-Key'</span>: <span class="string">'aysIBDNEvw1n063qpf7Jx9jb'</span>,</div><div class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></div><div class="line">          &#125;,</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">ret</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span>(!ret.ok)&#123;</div><div class="line">            <span class="built_in">console</span>.log( <span class="string">"request failed"</span>)</div><div class="line">          &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">var</span> json = <span class="built_in">JSON</span>.parse(ret.data)</div><div class="line">            <span class="keyword">var</span> list = json.results</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; list.length; i++)&#123;</div><div class="line">                <span class="keyword">var</span> item = list[i]</div><div class="line">                item.isSelected = <span class="literal">false</span></div><div class="line">                that.rows.push(item)</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(response);</div><div class="line">        &#125;);</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      <span class="attr">getImage</span>: <span class="function"><span class="keyword">function</span>(<span class="params">tid</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line">        <span class="keyword">var</span> stream = <span class="built_in">require</span>(<span class="string">'@weex-module/stream'</span>);</div><div class="line">        stream.fetch(&#123;</div><div class="line">          <span class="attr">method</span>: <span class="string">'GET'</span>,</div><div class="line">          <span class="attr">url</span>: <span class="string">'https://api.leancloud.cn/1.1/classes/Image?where=&#123;"tid":'</span>+tid+<span class="string">'&#125;&#125;&amp;order=-update_time'</span>,</div><div class="line">          <span class="attr">headers</span>: &#123;</div><div class="line">            <span class="string">'X-LC-Id'</span>: <span class="string">'ffTooBOPa3NxxjEo91dVYEel-gzGzoHsz'</span>,</div><div class="line">            <span class="string">'X-LC-Key'</span>: <span class="string">'aysIBDNEvw1n063qpf7Jx9jb'</span>,</div><div class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></div><div class="line">          &#125;,</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">ret</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span>(!ret.ok)&#123;</div><div class="line">            <span class="built_in">console</span>.log( <span class="string">"request failed"</span>)</div><div class="line">          &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">var</span> json = <span class="built_in">JSON</span>.parse(ret.data)</div><div class="line">            <span class="keyword">var</span> list = json.results</div><div class="line">            that.imageList.length = <span class="number">0</span></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++)&#123;</div><div class="line">              <span class="keyword">var</span> imageRow;</div><div class="line">              <span class="keyword">if</span> (i % <span class="number">3</span> == <span class="number">0</span>) &#123;</div><div class="line">                  imageRow = [];</div><div class="line">                  that.imageList.push(&#123;<span class="string">'data'</span>:imageRow&#125;);</div><div class="line">              &#125;</div><div class="line">              imageRow[i%<span class="number">3</span>] = list[i];</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">console</span>.log(that.imageList);</div><div class="line">          &#125;</div><div class="line">        &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(response);</div><div class="line">        &#125;);</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      <span class="attr">changeTid</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(e);</div><div class="line">        <span class="keyword">this</span>.currentTid = e.target.attr.tid</div><div class="line">        <span class="keyword">this</span>.getImage(<span class="keyword">this</span>.currentTid)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.rows.length; i++) &#123;</div><div class="line">          <span class="keyword">var</span> row = <span class="keyword">this</span>.rows[i]</div><div class="line">          row.isSelected = row.tid  ==   <span class="keyword">this</span>.currentTid</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="è¿è¡Œèµ·æ¥"><a href="#è¿è¡Œèµ·æ¥" class="headerlink" title="è¿è¡Œèµ·æ¥"></a>è¿è¡Œèµ·æ¥</h2><p>æµè§ˆå™¨ä¸­é¢„è§ˆ</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">weex <span class="keyword">index</span>.we</div></pre></td></tr></table></figure>
<p>ç”Ÿæˆ js æ–‡ä»¶</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">weex <span class="keyword">index</span> -o <span class="keyword">build</span>.js</div></pre></td></tr></table></figure>
<h2 id="è·‘åœ¨-Android-é¡¹ç›®ä¸­"><a href="#è·‘åœ¨-Android-é¡¹ç›®ä¸­" class="headerlink" title="è·‘åœ¨ Android é¡¹ç›®ä¸­"></a>è·‘åœ¨ Android é¡¹ç›®ä¸­</h2><p>æ–°å»º Android é¡¹ç›®ï¼Œ åœ¨é¡¹ç›®ä¸­æ·»åŠ  <code>weex</code> sdk çš„ä¾èµ–åº“ã€‚<br><code>app/build.gradle</code></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:24.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:recyclerview-v7:24.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.alibaba:fastjson:1.1.46.android'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.taobao.android:weex_sdk:0.7.0'</span> <span class="comment">// weex sdk</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.taobao.android:weex_inspector:0.0.2.7'</span> <span class="comment">// weex è°ƒè¯• sdk ï¼Œè¿™ä¸ªå¿…é¡»å¾—åŠ </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ›å»ºè‡ªå·±çš„ Application ç±»ï¼Œç„¶å onCreated ä¸­åˆå§‹åŒ– weex</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by hanks on 16/9/5.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        WXEnvironment.addCustomOptions(<span class="string">"appName"</span>, <span class="string">"TBSample"</span>);</div><div class="line">        InitConfig config = <span class="keyword">new</span> InitConfig.Builder()</div><div class="line">                .setImgAdapter(<span class="keyword">new</span> ImageAdapter())</div><div class="line">                .build();</div><div class="line">        WXSDKEngine.initialize(<span class="keyword">this</span>, config);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–å®Œæˆä¹‹åå°±æ˜¯åŠ è½½ js äº†ï¼Œå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„ js å¤åˆ¶åˆ° assets ç›®å½•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> FrameLayout mContainer;</div><div class="line">    <span class="keyword">private</span> WXSDKInstance mWeexInstance;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        mContainer = (FrameLayout) findViewById(R.id.container);</div><div class="line">        <span class="comment">// sdk å®ä¾‹</span></div><div class="line">        mWeexInstance = <span class="keyword">new</span> WXSDKInstance(<span class="keyword">this</span>);</div><div class="line">        mWeexInstance.registerRenderListener(<span class="keyword">new</span> IWXRenderListener() &#123;</div><div class="line"></div><div class="line">            <span class="comment">// sdk å°† js æ–‡ä»¶æ¸²æŸ“æˆ view å¯¹è±¡å›è°ƒ</span></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewCreated</span><span class="params">(WXSDKInstance wxsdkInstance, View view)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (mContainer != <span class="keyword">null</span>) &#123;</div><div class="line">                    mContainer.addView(view); <span class="comment">// æ·»åŠ åˆ°ç•Œé¢</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRenderSuccess</span><span class="params">(WXSDKInstance wxsdkInstance, <span class="keyword">int</span> i, <span class="keyword">int</span> i1)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefreshSuccess</span><span class="params">(WXSDKInstance wxsdkInstance, <span class="keyword">int</span> i, <span class="keyword">int</span> i1)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(WXSDKInstance wxsdkInstance, String s, String s1)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// åŠ è½½ js æ–‡ä»¶</span></div><div class="line">        mWeexInstance.render(<span class="string">"Weex2333"</span>,</div><div class="line">                WXFileUtils.loadAsset(<span class="string">"build.js"</span>, <span class="keyword">this</span>),</div><div class="line">                <span class="keyword">null</span>, <span class="keyword">null</span>, -<span class="number">1</span>, -<span class="number">1</span>,</div><div class="line">                WXRenderStrategy.APPEND_ASYNC);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åè¿è¡Œ Android é¡¹ç›®ã€‚</p>
<p>iOS å·¥ç¨‹æš‚æ—¶æ²¡æœ‰è·‘èµ·æ¥ &gt;.&lt;</p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰äº›æ—¶é—´ä½“éªŒ ReactNative çš„æ—¶å€™å†™äº†ä¸€ä¸ª 2333 è¡¨æƒ…åŒ… appï¼Œè¿™æ¬¡ä½¿ç”¨ &lt;code&gt;weex&lt;/code&gt; å†™ä¸€ä¸‹ã€‚ weex é€šè¿‡è‡ªå·±çš„ä¸€å¥— sdk å¯ä»¥å°†ä¸€ä¸ª js æ–‡ä»¶æ¸²æŸ“æˆä¸€ä¸ª native ï¼ˆandroid æˆ– iOS ï¼‰çš„ view å¯¹è±¡ã€‚ weex è¯­æ³•å‚ç…§ vue ï¼Œçœ‹è¿‡ä¸€ç‚¹ vue çš„æ–‡æ¡£æ‰€ä»¥å†™èµ·æ¥å¯ä»¥å¾ˆå¿«ä¸Šæ‰‹ã€‚æœ‰ä¸€ç‚¹æ„Ÿå— &lt;code&gt;weex&lt;/code&gt; çš„æ–‡æ¡£æ„Ÿè§‰æ²¡æœ‰ RN çš„æ¸…æ™°ï¼Œè¿˜æœ‰å°ºå¯¸å•ä½è¿˜æ²¡ææ¸…æ¥šï¼Œæµè§ˆå™¨é¢„è§ˆçš„å’Œç”Ÿæˆçš„ android ç‰ˆè¿˜æ˜¯æœ‰å·®è·ï¼Œå’Œ iOS ä¹Ÿå°ºå¯¸ä¸å¤ªå¯¹ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="weex" scheme="http://hanks.pub/tags/weex/"/>
    
  </entry>
  
  <entry>
    <title>WebView å®ç° NestedScrollingChild</title>
    <link href="http://hanks.pub/2016/08/31/nestedscrollchild/"/>
    <id>http://hanks.pub/2016/08/31/nestedscrollchild/</id>
    <published>2016-08-31T14:30:52.000Z</published>
    <updated>2017-07-10T11:02:58.211Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰¿æ¥ä¸Šæ–‡ <a href="http://hanks.xyz/2016/08/29/nestedchildparent/" target="_blank" rel="external">NestedScrollingParent å®ç°å¤æ‚äº¤äº’æ•ˆæœ</a> ï¼Œåœ¨ <code>NestedScroll</code> è¿™ä¸€å¥—æµç¨‹ä¸­ï¼Œ<code>NestedScrollingChild</code> ä¸ç”¨è€ƒè™‘æ€ä¹ˆå»é€šçŸ¥çˆ¶å¸ƒå±€å¦‚ä½•æ»šåŠ¨ï¼Œåªéœ€è¦è´Ÿè´£è‡ªå·±çš„äº‹æƒ…ï¼š<strong>äº§ç”Ÿæ»šåŠ¨</strong>äº‹ä»¶ï¼Œå¹¶<strong>å°†äº‹ä»¶å…±äº«å‡ºå»</strong>ï¼Œ<strong>äº§ç”Ÿ fling</strong> äº‹ä»¶ï¼Œ<strong>å…±äº« fling</strong> ã€‚</p>
<a id="more"></a>
<p>NestedScrollingParent ç®€ç§° <code>NP</code><br>NestedScrollingChild ç®€ç§° <code>NC</code></p>
<ol>
<li><p>NC è°ƒç”¨ <code>startNestedScroll()</code> é€šçŸ¥ NP çš„ <code>onStartNestedScroll</code> ï¼ˆå…·ä½“æ˜¯æ€ä¹ˆé€šçŸ¥åˆ° NP çš„å‚è€ƒ æºç ï¼‰</p>
</li>
<li><p>NC äº§ç”Ÿä¸€ä¸ª Touch äº‹ä»¶ï¼Œå¦‚æ»šåŠ¨ 5 ä¸ªåƒç´ ï¼Œç„¶åè°ƒç”¨ <code>dispatchNestedPreScroll</code> é€šçŸ¥ NP è‡ªå·±è¦æ»šåŠ¨ 5ä¸ªåƒç´ ï¼Œ NP æ”¶åˆ°é€šçŸ¥åæ ¹æ®è‡ªèº«éœ€è¦è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æ¶ˆè´¹äº† 2 ä¸ªåƒç´ ï¼Œç„¶åå°†ç»“æœé€šçŸ¥åˆ° NC </p>
</li>
<li><p>NC å°†å‰©ä¸‹çš„ 3 ä¸ªåƒç´ è¿›è¡Œè‡ªèº«æ¶ˆè´¹ï¼Œå¦‚æ­¤æ—¶æ»šåŠ¨äº† 2 ä¸ªåƒç´ åˆ°è¾¾äº†è¾¹ç•Œï¼Œè¿˜å‰©ä¸‹ 1 ä¸ªåƒç´ æ²¡æœ‰æ¶ˆè´¹æ‰ï¼Œç„¶åå°±è°ƒç”¨ <code>dispatchNestedScroll</code> å°†å‰©ä¸‹çš„æœªæ¶ˆè´¹çš„ 1 ä¸ªåƒç´ å…±äº«å‡ºå»ã€‚</p>
</li>
<li><p>Fling äº‹ä»¶ç±»ä¼¼ Scroll äº‹ä»¶</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by hanks on 16/8/30.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeWebView</span> <span class="keyword">extends</span> <span class="title">WebView</span> <span class="keyword">implements</span> <span class="title">NestedScrollingChild</span>, <span class="title">ScrollListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = CodeWebView.class.getSimpleName();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UP = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DOWN = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] mScrollOffset = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] mScrollConsumed = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mTouchSlop;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mMinimumVelocity;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mMaximumVelocity;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> direction = DOWN; <span class="comment">// TODO è¿˜éœ€è¦åŒæ­¥åˆ°çˆ¶å¸ƒå±€çš„æ–¹å‘</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastMotionY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mNestedYOffset;</div><div class="line">    <span class="keyword">private</span> NestedScrollingChildHelper mChildHelper;</div><div class="line">    <span class="keyword">private</span> VelocityTracker mVelocityTracker;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> allowFly;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> downY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDownY = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CodeWebView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CodeWebView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CodeWebView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        </div><div class="line">        mChildHelper = <span class="keyword">new</span> NestedScrollingChildHelper(<span class="keyword">this</span>); <span class="comment">// è¾…åŠ©ç±»</span></div><div class="line">        setNestedScrollingEnabled(<span class="keyword">true</span>); <span class="comment">// è®¾ç½®æ”¯æŒ NestedScrolling</span></div><div class="line">        </div><div class="line">        <span class="keyword">final</span> ViewConfiguration configuration = ViewConfiguration.get(getContext());</div><div class="line">        mTouchSlop = configuration.getScaledTouchSlop();</div><div class="line">        mMinimumVelocity = configuration.getScaledMinimumFlingVelocity();</div><div class="line">        mMaximumVelocity = configuration.getScaledMaximumFlingVelocity();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">boolean</span> eventAddedToVelocityTracker = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = MotionEventCompat.getActionMasked(event);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = MotionEventCompat.getActionIndex(event);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mVelocityTracker == <span class="keyword">null</span>) &#123;</div><div class="line">            mVelocityTracker = VelocityTracker.obtain();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (action) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                allowFly = <span class="keyword">false</span>;</div><div class="line">                downY = (<span class="keyword">int</span>) event.getRawY();</div><div class="line">                <span class="comment">// å¼€å§‹ NestedScroll</span></div><div class="line">                startNestedScroll(ViewCompat.SCROLL_AXIS_VERTICAL);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> moveY = (<span class="keyword">int</span>) event.getRawY();</div><div class="line">                <span class="keyword">int</span> dy = -(moveY - downY); <span class="comment">//æ»šåŠ¨æ–¹æ³•çš„æ–¹å‘è·Ÿåæ ‡æ˜¯ç›¸åçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦åŠ ä¸€ä¸ªè´Ÿå·</span></div><div class="line">                downY = moveY;</div><div class="line">                <span class="comment">//åœ¨consumed ä¸­å°±æ˜¯çˆ¶ç±»æ»‘åŠ¨çš„è·ç¦»ï¼Œ</span></div><div class="line">                <span class="keyword">if</span> (dispatchNestedPreScroll(<span class="number">0</span>, dy, mScrollConsumed, mScrollOffset)) &#123;</div><div class="line">                    dy -= mScrollConsumed[<span class="number">1</span>]; <span class="comment">// å‡å»çˆ¶ç±»æ¶ˆè´¹çš„è·ç¦»</span></div><div class="line">                    scrollBy(<span class="number">0</span>, dy); <span class="comment">// å‰©ä¸‹çš„è‡ªå·±æ¶ˆè´¹</span></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">            </div><div class="line">                mVelocityTracker.addMovement(event);</div><div class="line">                eventAddedToVelocityTracker = <span class="keyword">true</span>;</div><div class="line">                mVelocityTracker.computeCurrentVelocity(<span class="number">1000</span>, mMaximumVelocity);</div><div class="line">                <span class="keyword">int</span> mScrollPointerId = MotionEventCompat.getPointerId(event, actionIndex);</div><div class="line">                <span class="keyword">float</span> vY = -VelocityTrackerCompat.getYVelocity(mVelocityTracker, mScrollPointerId); </div><div class="line">                <span class="comment">// äº§ç”Ÿ fling äº‹ä»¶</span></div><div class="line">                <span class="keyword">if</span> (Math.abs(vY) &gt; mMinimumVelocity &amp;&amp; !dispatchNestedPreFling(<span class="number">0</span>, vY)) &#123;</div><div class="line">                    dispatchNestedFling(<span class="number">0</span>, vY, <span class="keyword">true</span>);</div><div class="line">                    logi(<span class="string">"dispatchNestedFling"</span>);</div><div class="line">                &#125;</div><div class="line">                resetTouch();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!eventAddedToVelocityTracker) &#123;</div><div class="line">            mVelocityTracker.addMovement(event);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetTouch</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mVelocityTracker != <span class="keyword">null</span>) &#123;</div><div class="line">            mVelocityTracker.clear();</div><div class="line">        &#125;</div><div class="line">        stopNestedScroll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNestedScrollingEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mChildHelper.setNestedScrollingEnabled(enabled);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startNestedScroll</span><span class="params">(<span class="keyword">int</span> axes)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.startNestedScroll(axes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopNestedScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        mChildHelper.stopNestedScroll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNestedScrollingParent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.hasNestedScrollingParent();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchNestedScroll</span><span class="params">(<span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed, <span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed, <span class="keyword">int</span>[] offsetInWindow)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.dispatchNestedScroll(dxConsumed, dyConsumed, dxUnconsumed, dyUnconsumed, offsetInWindow);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchNestedPreScroll</span><span class="params">(<span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed, <span class="keyword">int</span>[] offsetInWindow)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.dispatchNestedPreScroll(dx, dy, consumed, offsetInWindow);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchNestedFling</span><span class="params">(<span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY, <span class="keyword">boolean</span> consumed)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.dispatchNestedFling(velocityX, velocityY, consumed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchNestedPreFling</span><span class="params">(<span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mChildHelper.dispatchNestedPreFling(velocityX, velocityY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.e(TAG, s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logi</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.i(TAG, s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logw</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.w(TAG, s);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‰¿æ¥ä¸Šæ–‡ &lt;a href=&quot;http://hanks.xyz/2016/08/29/nestedchildparent/&quot;&gt;NestedScrollingParent å®ç°å¤æ‚äº¤äº’æ•ˆæœ&lt;/a&gt; ï¼Œåœ¨ &lt;code&gt;NestedScroll&lt;/code&gt; è¿™ä¸€å¥—æµç¨‹ä¸­ï¼Œ&lt;code&gt;NestedScrollingChild&lt;/code&gt; ä¸ç”¨è€ƒè™‘æ€ä¹ˆå»é€šçŸ¥çˆ¶å¸ƒå±€å¦‚ä½•æ»šåŠ¨ï¼Œåªéœ€è¦è´Ÿè´£è‡ªå·±çš„äº‹æƒ…ï¼š&lt;strong&gt;äº§ç”Ÿæ»šåŠ¨&lt;/strong&gt;äº‹ä»¶ï¼Œå¹¶&lt;strong&gt;å°†äº‹ä»¶å…±äº«å‡ºå»&lt;/strong&gt;ï¼Œ&lt;strong&gt;äº§ç”Ÿ fling&lt;/strong&gt; äº‹ä»¶ï¼Œ&lt;strong&gt;å…±äº« fling&lt;/strong&gt; ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="NestedScrolling" scheme="http://hanks.pub/tags/NestedScrolling/"/>
    
  </entry>
  
  <entry>
    <title>NestedScrollingParent å®ç°å¤æ‚äº¤äº’æ•ˆæœ</title>
    <link href="http://hanks.pub/2016/08/29/nestedchildparent/"/>
    <id>http://hanks.pub/2016/08/29/nestedchildparent/</id>
    <published>2016-08-29T13:49:44.000Z</published>
    <updated>2017-07-10T11:02:58.206Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€ç»ˆæ•ˆæœï¼š<br>ä¸Šä¸‹æ’åˆ— 3 ä¸ª viewï¼Œ ä¾æ¬¡ä¸º RecyclerView ï¼ŒNestedScrollViewï¼ŒRecyclerViewï¼Œè§„åˆ™ï¼šå­ View å¯ä»¥æ»šåŠ¨æ—¶ Touch äº‹ä»¶ç»™å­ view æ¶ˆè´¹ï¼Œå¦åˆ™ç»™çˆ¶å¸ƒå±€ã€‚</p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f7asx0kp5rg20b40jlx6s.gif" alt="img" width="240" height="427"></p>
<a id="more"></a>
<h2 id="1-æ¥å£"><a href="#1-æ¥å£" class="headerlink" title="1. æ¥å£"></a>1. æ¥å£</h2><p><code>NestedScrollingParent</code> ç”¨æ¥é…ç½®å­è§†å›¾ï¼ˆ <code>NestedScrollingChild</code> ï¼‰åµŒå¥—æ»šåŠ¨ã€‚</p>
<p><code>NestedScrollingParent</code> ç®€ç§° <code>NP</code><br><code>NestedScrollingChild</code> ç®€ç§° <code>NC</code></p>
<ol>
<li>NC äº§ç”Ÿä¸€ä¸ª touch äº‹ä»¶ï¼Œè°ƒç”¨ <code>startNestedScroll</code>ï¼Œè¡¨ç¤ºå¼€å§‹åˆ†äº«å‡ºå» touch äº‹ä»¶ï¼Œ NP çš„ <code>onStartNestedScroll</code> åˆ¤æ–­æ˜¯å¦éœ€è¦è·Ÿ NC é…åˆï¼Œè¿”å› true è¡¨ç¤ºæ¥å—</li>
<li>NC è°ƒç”¨ <code>dispatchNestedPreScroll</code> ï¼Œé€šçŸ¥ NP å°†è¦è¿›è¡Œä¸€ä¸ª Touch äº‹ä»¶ï¼Œå¦‚ç§»åŠ¨ 5ä¸ªåƒç´ ï¼ŒNP çš„ <code>onNestedPreScroll</code> ä¸­æ”¶åˆ°é€šçŸ¥ï¼ŒçŸ¥é“ NC è¦å‡†å¤‡ç§»åŠ¨5ä¸ªåƒç´ ï¼Œè¿™æ—¶å€™ NP æ­£å¥½ä¹Ÿéœ€è¦æ»‘åŠ¨ 2 ä¸ªåƒç´ ï¼Œç„¶ååœ¨ <code>onNestedPreScroll</code> çš„å‚æ•° <code>consumed[]</code> æ•°ç»„å¯¹åº”çš„æ–¹å‘ï¼ˆä¸‹æ ‡ä¸º0çš„xè½´ï¼Œä¸‹æ ‡ä¸º1çš„yè½´ï¼‰èµ‹å€¼ 2ï¼Œè¡¨ç¤ºæ¶ˆè´¹ 2 ä¸ªåƒç´ </li>
<li><p>NC æ‹¿åˆ° <code>consumed[]</code> æ•°ç»„ï¼ŒçŸ¥é“ NP æ¶ˆè´¹äº† 2 ä¸ªåƒç´ ï¼Œå‰©ä¸‹äº† 3 ä¸ªåƒç´ ï¼Œç„¶åè‡ªå·±æ ¹æ®éœ€è¦å†ç§»åŠ¨ 3 ä¸ªåƒç´ çš„è·ç¦»ï¼Œå¦‚æœè¿™æ—¶å€™ NC ç”±äºæŸä¸ªåŸå› åªç§»åŠ¨äº† 2 ä¸ªåƒç´ ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 1 ä¸ªåƒç´ è·ç¦»ä¼šè°ƒç”¨ <code>dispatchNestedScroll</code> ç»™ NPï¼ŒNP åœ¨ <code>onNestedScroll</code> å¤„ç†å‰©ä¸‹çš„æœªæ¶ˆè´¹çš„ 1 åƒç´ ã€‚æœ€åï¼ŒNC è°ƒç”¨ <code>stopNestedScroll</code> ï¼Œæœ€å NP è°ƒç”¨ <code>onStopNestedScroll</code>ç»“æŸã€‚</p>
</li>
<li><p>åŒ NestedScroll ç±»ä¼¼çš„è¿˜æœ‰ä¸€å¥— NestedFling æ“ä½œï¼Œæ•´ä½“æµç¨‹ç±»ä¼¼ï¼ŒNC å¿«é€Ÿæ»‘åŠ¨äº§ç”Ÿä¸€ä¸ª fling äº‹ä»¶ï¼Œå¤„ç†æµç¨‹ NC.<code>dispatchNestedPreFling</code> -&gt; NP.<code>onNestedPreFling</code> -&gt; NC.<code>dispatchNestedFling</code> -&gt; NP.<code>onNestedFling</code></p>
</li>
</ol>
<p>ä¸ºä»€ä¹ˆ NC å’Œ NP èƒ½ç›¸äº’é…åˆæ»šåŠ¨ï¼Ÿ ä¸»è¦çš„æºç åœ¨ <a href="http://androidxref.com/7.0.0_r1/xref/frameworks/support/v4/java/android/support/v4/view/NestedScrollingChildHelper.java" target="_blank" rel="external">NestedScrollingChildHelper</a> å’Œ  <a href="http://androidxref.com/7.0.0_r1/xref/frameworks/support/v4/java/android/support/v4/view/NestedScrollingParentHelper.java" target="_blank" rel="external">NestedScrollingParentHelper</a></p>
<h2 id="æ•ˆæœå®ç°"><a href="#æ•ˆæœå®ç°" class="headerlink" title="æ•ˆæœå®ç°"></a>æ•ˆæœå®ç°</h2><p>è‡ªå®š ViewGroup ï¼Œå®ç° <code>NestedScrollingParent</code> æ¥å£ï¼Œä¸€ä¸ª <code>NestedScrollingParentHelper</code> æˆå‘˜å˜é‡ä½œä¸ºè¾…åŠ©</p>
<p>å¸ƒå±€<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">xyz.hanks.nestedwebview.nestedscroll.NScrollView</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recyclerView0"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#20f0"</span></div><div class="line">        <span class="attr">android:scrollbarSize</span>=<span class="string">"3dp"</span></div><div class="line">        <span class="attr">android:scrollbars</span>=<span class="string">"vertical"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:background</span>=<span class="string">"#e1e1e1"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"cdsadadlick"</span>/&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"asddasda"</span>/&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"asdadarewe"</span>/&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recyclerView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#2f00"</span></div><div class="line">        <span class="attr">android:scrollbarStyle</span>=<span class="string">"insideInset"</span></div><div class="line">        <span class="attr">android:scrollbars</span>=<span class="string">"vertical"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">xyz.hanks.nestedwebview.nestedscroll.NScrollView</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>åŸºç¡€çš„ onMeasure ï¼ŒonLayout</p>
<p><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f7ay490vzjj20ga0xgwf5.jpg" alt="onLayout"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * NestedScrollView</div><div class="line"> * Created by hanks on 16/8/22.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NScrollView</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> <span class="keyword">implements</span> <span class="title">NestedScrollingParent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"NScrollView"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxDistance = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalHeight = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> NestedScrollingParentHelper mParentHelper;</div><div class="line">    <span class="keyword">private</span> List&lt;View&gt; nestedScrollingChildList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> ScrollerCompat scroller;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NScrollView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NScrollView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        setOverScrollMode(View.OVER_SCROLL_NEVER);</div><div class="line">        mParentHelper = <span class="keyword">new</span> NestedScrollingParentHelper(<span class="keyword">this</span>);</div><div class="line">        scroller = ScrollerCompat.create(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">            View child = getChildAt(i);</div><div class="line">            measureChild(child, widthMeasureSpec, heightMeasureSpec);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> parentHeight = getMeasuredHeight();</div><div class="line">        <span class="keyword">int</span> top = t;</div><div class="line">        <span class="keyword">int</span> lastChildHeight = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">            View child =  getChildAt(i);</div><div class="line">            LayoutParams layoutParams = child.getLayoutParams();</div><div class="line">            <span class="keyword">if</span> (layoutParams.height == LayoutParams.MATCH_PARENT) &#123;</div><div class="line">                layoutParams.height = parentHeight;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">int</span> childMeasuredHeight = child.getMeasuredHeight();</div><div class="line">                layoutParams.height = childMeasuredHeight;</div><div class="line">            &#125;</div><div class="line">            log(child + <span class="string">","</span> + layoutParams.height);</div><div class="line">            child.setLayoutParams(layoutParams);</div><div class="line">            child.layout(l, top, r, top + layoutParams.height);</div><div class="line">            top += layoutParams.height;</div><div class="line">            lastChildHeight = layoutParams.height;</div><div class="line">        &#125;</div><div class="line">        maxDistance = top - lastChildHeight;</div><div class="line">        totalHeight = top;</div><div class="line">        <span class="comment">//viewGroup.layout(l, t, r, top);</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onFinishInflate();</div><div class="line"></div><div class="line">        nestedScrollingChildList.clear();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">            View child =  getChildAt(i);</div><div class="line">            nestedScrollingChildList.add(child);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">consumeEvent</span><span class="params">(<span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed)</span> </span>&#123;</div><div class="line">        scrollBy(dx, dy);</div><div class="line">        consumed[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        consumed[<span class="number">1</span>] = dy;</div><div class="line">        log(<span class="string">"parent consumed pre : "</span> + consumed[<span class="number">1</span>]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentWrapline</span><span class="params">(View target)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> line = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (View view : nestedScrollingChildList) &#123;</div><div class="line">            <span class="keyword">if</span> (view == target) &#123;</div><div class="line">                <span class="keyword">return</span> line;</div><div class="line">            &#125;</div><div class="line">            line += view.getHeight();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> line;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(View child, View target, <span class="keyword">int</span> nestedScrollAxes)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (nestedScrollAxes &amp; SCROLL_AXIS_VERTICAL) != <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScrollAccepted</span><span class="params">(View child, View target, <span class="keyword">int</span> axes)</span> </span>&#123;</div><div class="line">        mParentHelper.onNestedScrollAccepted(child, target, axes);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedPreScroll</span><span class="params">(View target, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed)</span> </span>&#123;</div><div class="line">        logi(<span class="string">"======== onStartNestedScroll ======="</span>);</div><div class="line">        <span class="keyword">int</span> scrollY = getScrollY();</div><div class="line">        <span class="keyword">int</span> line = getCurrentWrapline(target);</div><div class="line">        <span class="keyword">boolean</span> targetScrollDown = ScrollUtils.canChildScrollDown(target);</div><div class="line">        <span class="keyword">boolean</span> targetScrollUp = ScrollUtils.canChildScrollUp(target);</div><div class="line">        log(<span class="string">"onNestedPreScroll: target = ["</span> + target.getClass().getName() + <span class="string">"], dx = ["</span> + dx + <span class="string">"], dy = ["</span> + dy + <span class="string">"], consumed = ["</span> + consumed + <span class="string">"]"</span>);</div><div class="line">        log(<span class="string">"scrollY:"</span> + scrollY + <span class="string">",lien:"</span> + line + <span class="string">",scrollDown:"</span> + targetScrollDown + <span class="string">"scrollUp:"</span> + targetScrollUp + <span class="string">",maxDistance"</span> + maxDistance);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (scrollY == line</div><div class="line">                &amp;&amp; ((dy &gt; <span class="number">0</span> &amp;&amp; targetScrollDown) || (dy &lt; <span class="number">0</span> &amp;&amp; targetScrollUp))) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (scrollY + dy &lt; <span class="number">0</span> || scrollY + dy &gt; maxDistance) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        consumeEvent(<span class="number">0</span>, dy, consumed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(View target, <span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed, <span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> scrollY = getScrollY();</div><div class="line">        <span class="keyword">if</span> (scrollY + dyUnconsumed &lt; <span class="number">0</span> || scrollY + dyUnconsumed &gt; maxDistance) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        scrollBy(dxUnconsumed, dyUnconsumed);</div><div class="line">        log(<span class="string">"onNestedScroll: target = ["</span> + target.getClass().getName() + <span class="string">"], dxConsumed = ["</span> + dxConsumed + <span class="string">"], dyConsumed = ["</span> + dyConsumed + <span class="string">"], dxUnconsumed = ["</span> + dxUnconsumed + <span class="string">"], dyUnconsumed = ["</span> + dyUnconsumed + <span class="string">"]"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedPreFling</span><span class="params">(View target, <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> scrollY = getScrollY();</div><div class="line">        log(<span class="string">"onNestedPreFling: target = ["</span> + target.getClass().getName() + <span class="string">"], velocityX = ["</span> + velocityX + <span class="string">"], velocityY = ["</span> + velocityY + <span class="string">"]"</span> + <span class="string">",scrollY:"</span> + scrollY);</div><div class="line">        <span class="keyword">int</span> line = getCurrentWrapline(target);</div><div class="line">        <span class="keyword">if</span> (scrollY != line) &#123;</div><div class="line">            fling((<span class="keyword">int</span>) velocityY, scrollY);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fling</span><span class="params">(<span class="keyword">int</span> velocityY, <span class="keyword">int</span> scrollY)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (getChildCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">int</span> height = getHeight() - getPaddingTop() - getPaddingBottom();</div><div class="line">            <span class="keyword">int</span> bottom = totalHeight;</div><div class="line">            scroller.fling(<span class="number">0</span>, scrollY, <span class="number">0</span>, velocityY, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">                    Math.max(<span class="number">0</span>, bottom - height));</div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (scroller.computeScrollOffset()) &#123;</div><div class="line">            <span class="keyword">int</span> y = scroller.getCurrY();</div><div class="line">            scrollTo(<span class="number">0</span>, y);</div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedFling</span><span class="params">(View target, <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY, <span class="keyword">boolean</span> consumed)</span> </span>&#123;</div><div class="line">        log(<span class="string">"onNestedFling: target = ["</span> + target.getClass().getName() + <span class="string">"], velocityX = ["</span> + velocityX + <span class="string">"], velocityY = ["</span> + velocityY + <span class="string">"], consumed = ["</span> + consumed + <span class="string">"]"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopNestedScroll</span><span class="params">(View target)</span> </span>&#123;</div><div class="line">        logi(<span class="string">"======== onStopNestedScroll ======="</span>);</div><div class="line">        mParentHelper.onStopNestedScroll(target);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.e(TAG, s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logi</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.i(TAG, s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logw</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.w(TAG, s);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€ç»ˆæ•ˆæœï¼š&lt;br&gt;ä¸Šä¸‹æ’åˆ— 3 ä¸ª viewï¼Œ ä¾æ¬¡ä¸º RecyclerView ï¼ŒNestedScrollViewï¼ŒRecyclerViewï¼Œè§„åˆ™ï¼šå­ View å¯ä»¥æ»šåŠ¨æ—¶ Touch äº‹ä»¶ç»™å­ view æ¶ˆè´¹ï¼Œå¦åˆ™ç»™çˆ¶å¸ƒå±€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww3.sinaimg.cn/large/8c9b876fjw1f7asx0kp5rg20b40jlx6s.gif&quot; alt=&quot;img&quot; width=&quot;240&quot; height=&quot;427&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="NestedScrolling" scheme="http://hanks.pub/tags/NestedScrolling/"/>
    
  </entry>
  
  <entry>
    <title>å†™ä¸€ä¸ªç¦åˆ© Telegram æœºå™¨äºº</title>
    <link href="http://hanks.pub/2016/08/04/telegram-bot/"/>
    <id>http://hanks.pub/2016/08/04/telegram-bot/</id>
    <published>2016-08-04T01:58:03.000Z</published>
    <updated>2017-07-10T11:02:58.265Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ©ç”¨ Telegram æä¾›çš„ API å†™ä¸€æœºå™¨äººï¼Œé€šè¿‡å‘é€æŒ‡ä»¤æ¥æ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚<br><a id="more"></a></p>
<p><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f6gyh0y6l8j20k00zktb8.jpg" alt="img" width="240" height="427"></p>
<p><a href="https://core.telegram.org/bots/api" target="_blank" rel="external">å®˜ç½‘</a></p>
<h2 id="åˆ›å»º-bot"><a href="#åˆ›å»º-bot" class="headerlink" title="åˆ›å»º bot"></a>åˆ›å»º bot</h2><p>æ ¹æ®æ–‡æ¡£ï¼Œåœ¨ telegram é‡Œé¢æ·»åŠ  <a href="https://telegram.me/botfather" target="_blank" rel="external">@BotFather</a>, ç„¶åè·Ÿä»–èŠå¤©æ¥åˆ›å»ºæœºå™¨äºº</p>
<p><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f6gyodg5q4j20k00zk782.jpg" alt=""></p>
<p>æ‹¿åˆ° <code>token</code></p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>åœ¨æµè§ˆå™¨ä¸­ï¼ˆç¿»å¢™ï¼‰è¾“å…¥ <code>https://api.telegram.org/botYOU_TOKEN/getMe</code> æµ‹è¯•ï¼š<br>è¿”å›å¦‚ä¸‹æ ¼å¼ï¼Œè¯´æ˜æˆåŠŸã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"ok"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">"result"</span>: &#123;</div><div class="line">        <span class="attr">"id"</span>: <span class="number">249208551</span>,</div><div class="line">        <span class="attr">"first_name"</span>: <span class="string">"LinuxC"</span>,</div><div class="line">        <span class="attr">"username"</span>: <span class="string">"LinuxC_bot"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ç¼–å†™-api"><a href="#ç¼–å†™-api" class="headerlink" title="ç¼–å†™ api"></a>ç¼–å†™ api</h2><p>æˆ‘ä½¿ç”¨çš„ node å†™çš„ï¼Œ å‚è€ƒ <a href="https://github.com/Naltox/telegram-node-bot" target="_blank" rel="external">telegram-node-bot</a></p>
<p>é¦–å…ˆå®‰è£… <code>telegram-node-bot</code></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save telegram-<span class="keyword">node</span><span class="title">-bot</span></div></pre></td></tr></table></figure>
<p>ç„¶ååˆ›å»º app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> api = <span class="built_in">require</span>(<span class="string">'./api'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Telegram = <span class="built_in">require</span>(<span class="string">'telegram-node-bot'</span>)</div><div class="line"><span class="keyword">const</span> TelegramBaseController = Telegram.TelegramBaseController</div><div class="line"><span class="keyword">const</span> tg = <span class="keyword">new</span> Telegram.Telegram(<span class="string">'YOU_TOKEN'</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PingController</span> <span class="keyword">extends</span> <span class="title">TelegramBaseController</span></span>&#123;</div><div class="line">    pingHandler($)&#123;</div><div class="line">        api.getMZ(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">            $.sendMessage(data)</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">    get routes()&#123;</div><div class="line">        <span class="keyword">return</span> &#123; <span class="string">'ping'</span>:<span class="string">'pingHandler'</span>&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">tg.router</div><div class="line">  .when([<span class="string">'ping'</span>],<span class="keyword">new</span> PingController())</div></pre></td></tr></table></figure>
<p>æŠ“å–å›¾ç‰‡çš„ <code>api.js</code>, æŠ“å–å›¾ç‰‡å¯ä»¥å‚è€ƒå‰é¢çš„æ–‡ç«  <a href="http://hanks.xyz/2016/05/26/node-spider/" target="_blank" rel="external">Node.js çˆ¬å¾®ä¿¡æ–‡ç« </a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta"></span></div><div class="line">'use strict'</div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> url = <span class="string">'http://www.kmeitu.com/'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPicture</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> array = []</div><div class="line">    <span class="keyword">var</span> $ = cheerio.load(html)</div><div class="line">    <span class="keyword">var</span> items = $(<span class="string">'.lz-img'</span>)</div><div class="line">    items.each(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">'data-src'</span>).replace(<span class="regexp">/\s+/g</span>, <span class="string">''</span>)</div><div class="line">        array.push(url)</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">return</span> array[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*array.length)]</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.getMZ = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</div><div class="line">    http.get(url, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> html = <span class="string">''</span></div><div class="line">        res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            html += data</div><div class="line">        &#125;)</div><div class="line">        res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">//console.log(html)</span></div><div class="line">            <span class="keyword">var</span> array = getPicture(html)</div><div class="line">            callback(array)</div><div class="line">        &#125;)</div><div class="line">    &#125;).on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'get html error'</span>)</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åè¿è¡Œ <code>node app.js</code> å³å¯<br>æ³¨æ„ç‚¹ï¼š å…¨ç¨‹éœ€è¦ FQï¼ˆè·Ÿ telegram è¿æ¥ç”¨ï¼‰ï¼Œ <code>app.js</code> æ–¹æ³•æœåŠ¡å™¨è¿è¡Œï¼ˆæˆ‘ä½¿ç”¨çš„ <code>pm2</code> ï¼‰ã€‚</p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ©ç”¨ Telegram æä¾›çš„ API å†™ä¸€æœºå™¨äººï¼Œé€šè¿‡å‘é€æŒ‡ä»¤æ¥æ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Telegram" scheme="http://hanks.pub/tags/Telegram/"/>
    
  </entry>
  
  <entry>
    <title>å†™ä¸€ä¸ª ButterKnife</title>
    <link href="http://hanks.pub/2016/07/31/write-butterkinfe/"/>
    <id>http://hanks.pub/2016/07/31/write-butterkinfe/</id>
    <published>2016-07-30T19:07:03.000Z</published>
    <updated>2017-07-10T11:02:58.306Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://jakewharton.github.io/butterknife/" target="_blank" rel="external">ButterKnife</a> å¾ˆå¤šäººéƒ½ç”¨è¿‡ï¼Œèƒ½èŠ‚çœå¾ˆå¤šä»£ç ï¼Œæœ€å¤šçš„å°±æ˜¯çœå»äº†å¾ˆå¤š <code>findViewById</code> è¯­å¥ã€‚æ¥ä¸‹æ¥è‡ªå·±å†™ä¸€ä¸ªï¼Œå°±å« <code>BBKnife</code> å§ã€‚</p>
<a id="more"></a>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åœ¨ä½¿ç”¨ ButterKnife æ—¶ï¼Œéœ€è¦ä¹¦å†™ä¸‹é¢çš„ç±»ä¼¼ä»£ç ï¼Œä»¥ä¸€ä¸ª Activity ä¸ºä¾‹</p>
<p><code>ExampleActivity.java</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">  <span class="meta">@BindView</span>(R.id.title) TextView title;</div><div class="line">  <span class="meta">@BindView</span>(R.id.subtitle) TextView subtitle;</div><div class="line">  <span class="meta">@BindView</span>(R.id.footer) TextView footer;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.simple_activity);</div><div class="line">    ButterKnife.bind(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// TODO Use fields...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ç¼–è¯‘åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå’Œ Activity åŒåçš„ <code>ExampleActivity$ViewBinder</code> çš„è¾…åŠ©ç±»æ–‡ä»¶ï¼Œå¹¶ä¸”ç”Ÿæˆ findViewById ç›¸å…³çš„ä»£ç </p>
<p><code>ExampleActivity$ViewBinder.java</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(ExampleActivity activity)</span> </span>&#123;</div><div class="line">  activity.subtitle = (android.widget.TextView) activity.findViewById(<span class="number">2130968578</span>);</div><div class="line">  activity.footer = (android.widget.TextView) activity.findViewById(<span class="number">2130968579</span>);</div><div class="line">  activity.title = (android.widget.TextView) activity.findViewById(<span class="number">2130968577</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆ <code>BBKnife</code> åº“è¦åšçš„äº‹æƒ…å°±å¾ˆæ¸…æ¥šäº†ï¼Œç”Ÿæˆè¾…åŠ©ç±»ã€‚</p>
<h2 id="åŠ¨æ‰‹å¼€å†™"><a href="#åŠ¨æ‰‹å¼€å†™" class="headerlink" title="åŠ¨æ‰‹å¼€å†™"></a>åŠ¨æ‰‹å¼€å†™</h2><p>æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºæ³¨è§£</li>
<li>ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£</li>
<li>ç”Ÿæˆè¾…åŠ©ç±»</li>
<li>è°ƒç”¨è¾…åŠ©ç±»</li>
</ol>
<h3 id="0x00-åˆ›å»ºå·¥ç¨‹"><a href="#0x00-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="0x00 åˆ›å»ºå·¥ç¨‹"></a>0x00 åˆ›å»ºå·¥ç¨‹</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹</p>
<p><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f6ch0o8ai8j20fq09g74z.jpg" alt=""></p>
<p>ç„¶ååˆ›å»ºä¸€ä¸ª module ï¼Œ é€‰æ‹© java Libraryã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f6ch5zk9suj20g20ixt9p.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f6ch7emf5sj20700gnaba.jpg" alt=""></p>
<h3 id="0x01-åˆ›å»ºæ³¨è§£"><a href="#0x01-åˆ›å»ºæ³¨è§£" class="headerlink" title="0x01 åˆ›å»ºæ³¨è§£"></a>0x01 åˆ›å»ºæ³¨è§£</h3><p>è¿™ä¸ªæ³¨è§£ä½œç”¨äºç±»çš„å±æ€§ä¸Šé¢ï¼ŒåŒ…å«ä¸€ä¸ªæ•´å‹çš„å‚æ•°ï¼Œç±»ä¼¼äº <code>@BindView(R.id.title)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by hanks on 2016/7/31.</div><div class="line"> */</div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.CLASS)</div><div class="line"><span class="meta">@Target</span>(ElementType.FIELD)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView &#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="0x02-ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£-amp-amp-ç”Ÿæˆè¾…åŠ©ç±»"><a href="#0x02-ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£-amp-amp-ç”Ÿæˆè¾…åŠ©ç±»" class="headerlink" title="0x02 ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£ &amp;&amp; ç”Ÿæˆè¾…åŠ©ç±»"></a>0x02 ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£ &amp;&amp; ç”Ÿæˆè¾…åŠ©ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * ç¼–è¯‘æœŸé—´å¤„ç†æ³¨è§£</div><div class="line"> * Created by hanks on 2016/7/31.</div><div class="line"> */</div><div class="line"><span class="meta">@SupportedAnnotationTypes</span>(<span class="string">"xyz.hanks.BindView"</span>)</div><div class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_7)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BindViewProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Messager messager;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX = <span class="string">"$ViewBinder"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment processingEnv)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.init(processingEnv);</div><div class="line">        messager = processingEnv.getMessager();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</div><div class="line">        Map&lt;String, List&lt;VariableElement&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// key æ˜¯ç±»åï¼Œvalue æ˜¯è¯¥ç±»çš„æ³¨è§£å…ƒç´ </span></div><div class="line">        <span class="comment">// éå† BindView æ³¨è§£çš„æ‰€æœ‰å…ƒç´ </span></div><div class="line">        <span class="keyword">for</span> (Element element : roundEnv.getElementsAnnotatedWith(BindView.class)) &#123;</div><div class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span> || !(element <span class="keyword">instanceof</span> VariableElement)) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// ç»™å±æ€§æ·»åŠ çš„æ³¨è§£</span></div><div class="line">            VariableElement variableElement = (VariableElement) element;</div><div class="line">            <span class="comment">// è·å–å±æ€§æ‰€åœ¨çš„ç±»å</span></div><div class="line">            String className = element.getEnclosingElement().getSimpleName().toString();</div><div class="line">            List&lt;VariableElement&gt; variableElementList = map.get(className);</div><div class="line">            <span class="keyword">if</span> (variableElementList == <span class="keyword">null</span>) &#123;</div><div class="line">                variableElementList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                map.put(className, variableElementList);</div><div class="line">            &#125;</div><div class="line">            variableElementList.add(variableElement);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// ç”Ÿæˆè¾…åŠ©ç±»</span></div><div class="line">        generate(map);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generate</span><span class="params">(Map&lt;String, List&lt;VariableElement&gt;&gt; map)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == map || map.size() == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (String className : map.keySet()) &#123;</div><div class="line">            List&lt;VariableElement&gt; variableElementList = map.get(className);</div><div class="line">            <span class="keyword">if</span> (variableElementList == <span class="keyword">null</span> || variableElementList.size() &lt;= <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// è·å–åŒ…å</span></div><div class="line">            String packageName = variableElementList.get(<span class="number">0</span>).getEnclosingElement().getEnclosingElement().toString();</div><div class="line">            StringBuilder builder = <span class="keyword">new</span> StringBuilder()</div><div class="line">                    .append(<span class="string">"package "</span>).append(packageName).append(<span class="string">";\n\n"</span>)</div><div class="line">                    .append(<span class="string">"public class "</span>).append(className).append(SUFFIX).append(<span class="string">"&#123;\n"</span>) <span class="comment">// open class</span></div><div class="line">                    .append(<span class="string">"    public void bind(Object target) &#123;\n"</span>)</div><div class="line">                    .append(<span class="string">"        "</span>).append(className).append(<span class="string">" activity = ("</span>).append(className).append(<span class="string">")target;\n"</span>);</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (VariableElement variableElement : variableElementList) &#123;</div><div class="line">                BindView bindView = variableElement.getAnnotation(BindView.class);</div><div class="line">                log(bindView.toString());</div><div class="line">                builder.append(<span class="string">"        activity."</span>).append(variableElement.getSimpleName().toString()).append(<span class="string">"=("</span>).append(variableElement.asType()).append(<span class="string">")activity.findViewById("</span>).append(bindView.value()).append(<span class="string">");\n"</span>);</div><div class="line">            &#125;</div><div class="line">            builder.append(<span class="string">"    &#125;\n&#125;\n"</span>);</div><div class="line">            <span class="comment">// write the file</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                String bindViewClassName = packageName + <span class="string">"."</span> + className + SUFFIX;</div><div class="line">                JavaFileObject source = processingEnv.getFiler().createSourceFile(bindViewClassName);</div><div class="line">                Writer writer = source.openWriter();</div><div class="line">                writer.write(builder.toString());</div><div class="line">                writer.flush();</div><div class="line">                writer.close();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                log(e.getMessage());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">        messager.printMessage(Diagnostic.Kind.WARNING, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>æ·»åŠ  <code>@SupportedAnnotationTypes</code>  <code>@SupportedSourceVersion</code> æ³¨è§£ï¼Œ åŸå› : AbstractProcessor ä¸­åšäº†ç›¸å…³æ ¡éªŒï¼ˆçœ‹ AbstractProcessor æºç ï¼‰ã€‚</li>
<li>æ‰“å°æ¶ˆæ¯æ˜¯ç”± <code>processingEnv.getMessager().printMessage</code> æˆ–è€…è¾“å‡ºæ—¥å¿—æ–‡ä»¶ï¼ŒåŸå› ï¼šç¼–è¯‘æœŸé—´åšçš„å¤„ç†ï¼Œä¸èƒ½ä½¿ç”¨ System.out æˆ–è€… Log.i</li>
<li>å¤„ç†æ³¨è§£çš„æ—¶å€™éœ€è¦è·å–ç±»åæˆ–è€…åŒ…åï¼Œéœ€è¦æ³¨æ„è·å–çš„æ˜¯å…¨è·¯å¾„è¿˜æ˜¯ç®€å•åç§°ã€‚</li>
<li>ä¾ç…§éœ€è¦ç”Ÿæˆè¾…åŠ©ç±»æ–‡ä»¶ã€‚</li>
</ul>
<p>åœ¨ main ä¸‹æ–°å»º resources &gt; META_INF &gt; services ç›®å½•ï¼Œåˆ›å»º javax.annotation.processing.Processor æ–‡ä»¶ï¼Œjavac ä¼šè‡ªåŠ¨æ£€æŸ¥å’Œè¯»å– <code>javax.annotation.processing.Processor</code> ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”æ³¨å†Œ <code>BindViewProcessor</code> ä½œä¸ºæ³¨è§£å¤„ç†å™¨ã€‚<br><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f6ciagzi37j20c6074jrv.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f6cib9hm97j20by025t8t.jpg" alt=""></p>
<h3 id="0x03-è°ƒç”¨è¾…åŠ©ç±»"><a href="#0x03-è°ƒç”¨è¾…åŠ©ç±»" class="headerlink" title="0x03 è°ƒç”¨è¾…åŠ©ç±»"></a>0x03 è°ƒç”¨è¾…åŠ©ç±»</h3><p>å½“æ‰§è¡Œ <code>BBKnife.bind(activity)</code> çš„æ—¶å€™è°ƒç”¨æˆ‘ä»¬ç”Ÿæˆçš„è¾…åŠ©ç±»ï¼Œè¾…åŠ©ç±»å†…éƒ¨è¿›è¡Œ <code>findViewById</code> ä»è€Œè¿›è¡Œæ³¨å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BBKnife</span> </span>&#123;</div><div class="line">    <span class="comment">// è°ƒç”¨æˆ‘ä»¬ç”Ÿæˆçš„è¾…åŠ©ç±»</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(Object view)</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            String cla = view.getClass().getName()+BindViewProcessor.SUFFIX;</div><div class="line">            Class clazz = Class.forName(cla);</div><div class="line">            Object instance = clazz.newInstance();</div><div class="line">            Method bind = clazz.getMethod(<span class="string">"bind"</span>,Object.class);</div><div class="line">            bind.invoke(instance,view);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å¯¼å‡º-bbknife-jar"><a href="#å¯¼å‡º-bbknife-jar" class="headerlink" title="å¯¼å‡º bbknife.jar"></a>å¯¼å‡º bbknife.jar</h3><p>åœ¨ build/libs ç›®å½•ä¸‹æœ‰è‡ªåŠ¨å¯¼å‡ºçš„ jar æ–‡ä»¶ï¼Œ </p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f6cihkdt83j20ch0b8js9.jpg" alt=""></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¤åˆ¶åˆ° app  ä¸‹çš„ libs è¿›è¡Œå¼•ç”¨ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f6ciom1hxfj20bi09zt9e.jpg" alt=""></p>
<p>app ä¸‹çš„ build.gradle<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line">apply plugin: <span class="string">'com.neenbedankt.android-apt'</span> <span class="comment">// ä½¿ç”¨ apt</span></div><div class="line"></div><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.8'</span> <span class="comment">// æ·»åŠ å¼•ç”¨</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">24</span></div><div class="line">    buildToolsVersion <span class="string">"24.0.1"</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="string">"xyz.hanks.bbknifeproject"</span></div><div class="line">        minSdkVersion <span class="number">15</span></div><div class="line">        targetSdkVersion <span class="number">24</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è®¾ç½®java ç‰ˆæœ¬</span></div><div class="line">    compileOptions&#123;</div><div class="line">        <span class="keyword">sourceCompatibility</span> JavaVersion.VERSION_1_7</div><div class="line">        <span class="keyword">targetCompatibility</span> JavaVersion.VERSION_1_7</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:24.1.1'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ MainActivity ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindView</span>(R.id.bb_button) Button mButton;</div><div class="line">    <span class="meta">@BindView</span>(R.id.bb_image)  ImageView mImage;</div><div class="line">    <span class="meta">@BindView</span>(R.id.bb_text)   TextView mText;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        BBKnife.bind(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        mButton.setText(<span class="string">"hanks.xyz"</span>);</div><div class="line">        mText.setText(<span class="string">"hanks.xyz"</span>);</div><div class="line">        mImage.setImageResource(R.mipmap.ic_launcher);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹æœ€åç”Ÿæˆçš„è¾…åŠ©ç±» <code>MainActivity$ViewBinder.java</code><br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span>$<span class="title">ViewBinder</span></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(Object <span class="keyword">target</span>)</span> </span>&#123;</div><div class="line">        MainActivity activity = (MainActivity)<span class="keyword">target</span>;</div><div class="line">        activity.mButton=(android.widget.Button)activity.findViewById(<span class="number">2131427412</span>);</div><div class="line">        activity.mImage=(android.widget.ImageView)activity.findViewById(<span class="number">2131427414</span>);</div><div class="line">        activity.mText=(android.widget.TextView)activity.findViewById(<span class="number">2131427413</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f6citq0ptdj20bu0l2dg4.jpg" alt=""></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="http://blog.stablekernel.com/the-10-step-guide-to-annotation-processing-in-android-studio" target="_blank" rel="external">http://blog.stablekernel.com/the-10-step-guide-to-annotation-processing-in-android-studio
</a></p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://jakewharton.github.io/butterknife/&quot;&gt;ButterKnife&lt;/a&gt; å¾ˆå¤šäººéƒ½ç”¨è¿‡ï¼Œèƒ½èŠ‚çœå¾ˆå¤šä»£ç ï¼Œæœ€å¤šçš„å°±æ˜¯çœå»äº†å¾ˆå¤š &lt;code&gt;findViewById&lt;/code&gt; è¯­å¥ã€‚æ¥ä¸‹æ¥è‡ªå·±å†™ä¸€ä¸ªï¼Œå°±å« &lt;code&gt;BBKnife&lt;/code&gt; å§ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="ä¾èµ–æ³¨å…¥" scheme="http://hanks.pub/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>å¤šè¡Œ EditText çš„å…‰æ ‡é«˜åº¦é—®é¢˜</title>
    <link href="http://hanks.pub/2016/07/24/edittext-cursor/"/>
    <id>http://hanks.pub/2016/07/24/edittext-cursor/</id>
    <published>2016-07-24T15:23:12.000Z</published>
    <updated>2017-07-10T11:02:58.015Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æ”¹å˜æ–‡æœ¬çš„è¡Œé—´è·éœ€è¦ç»™ <code>EditText</code> è®¾ç½® <code>lineSpacingExtra</code> å’Œ <code>lineSpacingMultiplier</code> è¿™ä¸ªæ—¶å€™çš„ <code>EditText</code>çš„å…‰æ ‡é«˜åº¦å°±ä¼šå˜å¾—å¾ˆéš¾çœ‹.<br><a id="more"></a><br><img src="http://ww3.sinaimg.cn/large/8c9b876fjw1f65febqq97j20bm082dge.jpg" alt="é»˜è®¤æ•ˆæœ"></p>
<h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>è‡ªå®šä¹‰ <code>cursorDrawable</code> ç„¶åè®¾ç½® <code>padding</code> å€¼</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><code>EditText</code> åœ¨æ›´æ–°å…‰æ ‡çš„è§†å›¾çš„æ—¶å€™æ£€æŸ¥äº†å…‰æ ‡ drawable çš„ padding. è®¡ç®—å…‰æ ‡é«˜åº¦ä¼šç®—ä¸Šç›¸åº”çš„å€¼.</p>
<p>ç›¸å…³æºç :</p>
<p><code>Editor.java</code></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">updateCursorPosition</span><span class="params">(<span class="keyword">int</span> cursorIndex, <span class="keyword">int</span> top, <span class="keyword">int</span> bottom, <span class="keyword">float</span> horizontal)</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mTempRect == <span class="keyword">null</span>) mTempRect = <span class="keyword">new</span> Rect();</div><div class="line">    mCursorDrawable[cursorIndex].getPadding(mTempRect); <span class="comment">//å…‰æ ‡çš„ padding</span></div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="comment">// ä¸Šä¸‹è¾¹è·çš„æœ€ç»ˆå€¼ä¸º top - mTempRect.top å’Œ bottom + mTempRect.bottom</span></div><div class="line">    mCursorDrawable[cursorIndex].setBounds(left, top - mTempRect.top, left + width,</div><div class="line">            bottom + mTempRect.bottom);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ top å’Œ bottom çš„å€¼æ˜¯å¤šå°‘ ?</p>
<p><code>Editor.java</code><br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="type">void</span> updateCursorsPositions() &#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    Layout <span class="keyword">layout</span> = mTextView.getLayout();</div><div class="line">    Layout hintLayout = mTextView.getHintLayout();</div><div class="line">    final <span class="type">int</span> <span class="keyword">offset</span> = mTextView.getSelectionStart();</div><div class="line">    final <span class="type">int</span> line = <span class="keyword">layout</span>.getLineForOffset(<span class="keyword">offset</span>); <span class="comment">// ç®—å‡ºå½“å‰æ˜¯ç¬¬å‡ è¡Œ</span></div><div class="line">    final <span class="type">int</span> top = <span class="keyword">layout</span>.getLineTop(line); <span class="comment">// ç®—å‡ºç¬¬ line è¡Œçš„é¡¶éƒ¨åæ ‡</span></div><div class="line">    final <span class="type">int</span> bottom = <span class="keyword">layout</span>.getLineTop(line + <span class="number">1</span>); <span class="comment">// ç®—å‡ºç¬¬ line+1 è¡Œçš„é¡¶éƒ¨åæ ‡</span></div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    boolean clamped = <span class="keyword">layout</span>.shouldClampCursor(line);</div><div class="line">    updateCursorPosition(<span class="number">0</span>, top, middle,</div><div class="line">            getPrimaryHorizontal(<span class="keyword">layout</span>, hintLayout, <span class="keyword">offset</span>, clamped));</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä»æºç çœ‹å‡º bottom åˆ° top çš„è·ç¦»ä¸ºç¬¬ line è¡Œçš„é¡¶éƒ¨åˆ°ç¬¬ line+1 è¡Œçš„é¡¶éƒ¨. ä¹Ÿå°±æ˜¯ä¸Šé¢å›¾ä¸­çš„æ•ˆæœ.</p>
<p>è§£å†³æ–¹æ³•:<br>è‡ªå®šä¹‰ä¸€ä¸ª <code>cursor.xml</code>, ç„¶åè®¾ç½® <code>android:textCursorDrawable=&quot;@drawable/cursor&quot;</code></p>
<p><code>cursor.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:shape</span>=<span class="string">"rectangle"</span> &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">size</span></span></div><div class="line">        <span class="attr">android:width</span>=<span class="string">"2dip"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">solid</span></span></div><div class="line">        <span class="attr">android:color</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">padding</span></span></div><div class="line">        <span class="attr">android:top</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:bottom</span>=<span class="string">"-22dp"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ä¸Šé¢è®¾ç½®äº† shape çš„ <code>padding</code> è®¡ç®—å‡ºæ¥ <code>bottom = è¡Œé«˜ - æ–‡å­—é«˜åº¦ = 42 - 20 = 22</code>.å½“ç„¶è¿™å€¼æ˜¯å¯ä»¥è‡ªå·±è°ƒæ•´çš„.</p>
<p><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f65fgftcsij20bi06u74r.jpg" alt="è®¾ç½®åæ•ˆæœ"></p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h2&gt;&lt;p&gt;æ”¹å˜æ–‡æœ¬çš„è¡Œé—´è·éœ€è¦ç»™ &lt;code&gt;EditText&lt;/code&gt; è®¾ç½® &lt;code&gt;lineSpacingExtra&lt;/code&gt; å’Œ &lt;code&gt;lineSpacingMultiplier&lt;/code&gt; è¿™ä¸ªæ—¶å€™çš„ &lt;code&gt;EditText&lt;/code&gt;çš„å…‰æ ‡é«˜åº¦å°±ä¼šå˜å¾—å¾ˆéš¾çœ‹.&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="EditText" scheme="http://hanks.pub/tags/EditText/"/>
    
  </entry>
  
  <entry>
    <title>TextView è®¾ç½®è¡Œé«˜å¹¶å‚ç›´å±…ä¸­</title>
    <link href="http://hanks.pub/2016/07/22/textview-lineheight/"/>
    <id>http://hanks.pub/2016/07/22/textview-lineheight/</id>
    <published>2016-07-22T13:49:04.000Z</published>
    <updated>2017-07-10T11:02:58.271Z</updated>
    
    <content type="html"><![CDATA[<p><strong>éœ€æ±‚</strong>ï¼š TextView å¤šè¡Œæ–‡æœ¬å¯ä»¥è®¾ç½®è¡Œé«˜ï¼ˆå¦‚20dpï¼‰ï¼Œæ¯è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="http://ww4.sinaimg.cn/large/8c9b876fjw1f61ytzwj8ej20bt09sjs2.jpg" alt="å¤šè¡Œæ–‡æœ¬,è®¾ç½®è¡Œé«˜,å‚ç›´å±…ä¸­"><br><a id="more"></a></p>
<p><strong>å®ç°æ€è·¯</strong>ï¼šé€šè¿‡è®¾ç½® TextView çš„ <code>lineSpacingExtra</code> å’Œ <code>lineSpacingMultiplier</code> æ¥å®ç°ã€‚</p>
<ul>
<li><code>lineSpacingMultiplier</code> çš„å€¼ä¸ºè¡Œé—´è·çš„å€æ•°ï¼Œé»˜è®¤å€¼ä¸º 1.0fã€‚</li>
<li><code>lineSpacingExtra</code> å€¼ä¸ºå…·ä½“çš„è¡Œé—´è·å€¼ï¼Œå¦‚20dpã€‚</li>
<li>å‚ç›´å±…ä¸­é è®¾ç½® paddingTop å’Œ paddingBottom</li>
</ul>
<h3 id="TextView-ç›¸å…³"><a href="#TextView-ç›¸å…³" class="headerlink" title="TextView ç›¸å…³"></a>TextView ç›¸å…³</h3><p>TextView å†…éƒ¨é™¤äº†ç»§æ‰¿è‡ª View çš„ç›¸å…³å±æ€§å’Œ <code>measureã€layoutã€draw</code>æ­¥éª¤ï¼Œè¿˜åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Layout</strong>: TextView çš„æ–‡å­—æ’ç‰ˆã€æŠ˜è¡Œç­–ç•¥ä»¥åŠæ–‡æœ¬ç»˜åˆ¶éƒ½æ˜¯åœ¨ Layout é‡Œé¢å®Œæˆçš„ï¼ŒTextView çš„è‡ªèº«æµ‹é‡ä¹Ÿå— Layout çš„å½±å“ã€‚Layout æ˜¯ TextView æ‰§è¡ŒsetTextæ–¹æ³•åï¼Œç”± TextView å†…éƒ¨åˆ›å»ºçš„å®ä¾‹ï¼Œå¹¶ä¸èƒ½ç”±å¤–éƒ¨æä¾›ã€‚Layoutæœ‰ä¸‰ä¸ªå­ç±»ï¼ŒBoringLayoutã€DynamicLayoutã€StaticLayoutã€‚</li>
<li><strong>TransformationMethod</strong>: ç”¨æ¥å¤„ç†æœ€ç»ˆçš„æ˜¾ç¤ºç»“æœçš„ç±»ï¼Œä¾‹å¦‚æ˜¾ç¤ºå¯†ç çš„æ—¶å€™æŠŠå¯†ç è½¬æ¢æˆåœ†ç‚¹ã€‚è¿™ä¸ªç±»å¹¶ä¸ç›´æ¥å½±å“ TextView å†…éƒ¨å‚¨å­˜çš„ Text ï¼Œåªå½±å“æ˜¾ç¤ºçš„ç»“æœã€‚</li>
<li><strong>MovementMethod</strong>: ç”¨æ¥å¤„ç† TextView å†…éƒ¨äº‹ä»¶å“åº”çš„ç±»ï¼Œå¯ä»¥é’ˆ å¯¹TextView å†…æ–‡æœ¬çš„æŸä¸€ä¸ªåŒºåŸŸåšè½¯é”®ç›˜è¾“å…¥æˆ–è€…è§¦æ‘¸äº‹ä»¶çš„å“åº”ã€‚</li>
<li><strong>Drawables</strong>: TextView çš„é™æ€å†…éƒ¨ç±»ï¼Œç”¨æ¥å¤„ç†å’Œå‚¨å­˜ TextView çš„ CompoundDrawables ï¼ŒåŒ…æ‹¬ TextView çš„ä¸Šä¸‹å·¦å³çš„ Drawable ä»¥åŠé”™è¯¯æç¤ºçš„ Drawableã€‚</li>
<li><strong>Spans</strong>: Spans å¹¶ä¸æ˜¯ç‰¹å®šçš„æŸä¸€ä¸ªç±»æˆ–è€…å®ç°äº†æŸä¸€ä¸ªæ¥å£çš„ç±»ã€‚å®ƒå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒSpanså®é™…ä¸Šåšçš„äº‹æƒ…æ˜¯åœ¨ TextView çš„å†…éƒ¨çš„ text çš„æŸä¸€ä¸ªåŒºåŸŸåšæ ‡è®°ã€‚å…¶ä¸­æœ‰éƒ¨ åˆ†Spans å¯ä»¥å½±å“TextViewçš„ç»˜åˆ¶å’Œæµ‹é‡ï¼Œå¦‚ ImageSpanã€BackgroundColorSpanã€AbsoluteSizeSpanã€‚è¿˜æœ‰å¯ä»¥å“åº”ç‚¹å‡»äº‹ä»¶çš„ClickableSpanã€‚</li>
<li><strong>Editor</strong>: TextViewä½œä¸ºå¯ç¼–è¾‘æ–‡æœ¬æ§ä»¶çš„æ—¶å€™(EditText)ï¼Œä½¿ç”¨Editoræ¥å¤„ç†æ–‡æœ¬çš„åŒºåŸŸé€‰æ‹©å¤„ç†å’Œåˆ¤æ–­ã€æ‹¼å†™æ£€æŸ¥ã€å¼¹å‡ºæ–‡æœ¬èœå•ç­‰ã€‚</li>
<li><strong>InputConnection</strong>: EditText çš„æ–‡æœ¬è¾“å…¥éƒ¨åˆ†æ˜¯åœ¨ TextView ä¸­å®Œæˆçš„ã€‚è€Œ InputConnection æ˜¯è½¯é”®ç›˜å’ŒTextViewä¹‹é—´çš„æ¡¥æ¢ï¼Œæ‰€æœ‰çš„è½¯é”®ç›˜çš„è¾“å…¥æ–‡å­—ã€ä¿®æ”¹æ–‡å­—å’Œåˆ é™¤æ–‡å­—éƒ½æ˜¯é€šè¿‡ InputConnection ä¼ é€’ç»™ TextView çš„ã€‚</li>
</ul>
<h3 id="TextView-é»˜è®¤æ–‡å­—çš„ä¸Šä¸‹è¾¹è·"><a href="#TextView-é»˜è®¤æ–‡å­—çš„ä¸Šä¸‹è¾¹è·" class="headerlink" title="TextView é»˜è®¤æ–‡å­—çš„ä¸Šä¸‹è¾¹è·"></a>TextView é»˜è®¤æ–‡å­—çš„ä¸Šä¸‹è¾¹è·</h3><p>TextView çš„ <code>textSize</code> å±æ€§ä»£è¡¨çš„æ„ä¹‰æ˜¯å­—ä½“çš„å¤§å°ï¼Œä½“ç°ä¸ºå­—ä½“é«˜åº¦,ä¸€èˆ¬å•ä½æ˜¯ spï¼Œ sp ä»£è¡¨çš„å­—ä½“å¤§å°æ ¹æ®æ‰‹æœºè®¾ç½®çš„æ–‡å­—å¤§å°æœ‰å…³ï¼Œé»˜è®¤çš„ <code>1sp = 1dp</code>ã€‚ä½†æ˜¯Android ç³»ç»Ÿä¼šé»˜è®¤çš„ç»™æ–‡å­—å¢åŠ ä¸€ç‚¹è¾¹æ¡†ã€‚<br><img src="http://ww4.sinaimg.cn/large/8c9b876fjw1f62r61rhp5j20m706k75j.jpg" alt="é»˜è®¤æ•ˆæœ"></p>
<p><img src="http://ww4.sinaimg.cn/large/8c9b876fjw1f62rzmn4gvj20al04jmxe.jpg" alt="æ¸²æŸ“å›¾"></p>
<p>Android æä¾›äº†ä¸€ä¸ª setIncludeFontPadding æ–¹æ³•.ç”¨æ¥è®¾ç½® TextView æ˜¯å¦åœ¨é¡¶éƒ¨å’Œåº•éƒ¨ä¿ç•™ä¸€äº›ç©ºéš™,é»˜è®¤ä¸º ture ã€‚å¦‚æœæˆ‘ä»¬è®¾ç½®ä¸º false çš„è¯å¯èƒ½ä¼šå¯¼è‡´æŸäº›è¯­è¨€æ˜¾ç¤ºçš„ä¸å®Œæ•´, å¦‚ Arabic Kannada ã€‚åœ¨ <code>StaticLayout</code> çš„ <code>setIncludePad</code> æ–¹æ³•æåˆ°ã€‚</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Set whether <span class="keyword">to</span> include extra <span class="literal">space</span> beyond font ascent <span class="keyword">and</span> descent (which <span class="keyword">is</span></div><div class="line"> * needed <span class="keyword">to</span> avoid clipping <span class="keyword">in</span> <span class="keyword">some</span> languages, such <span class="keyword">as</span> Arabic <span class="keyword">and</span> Kannada). The</div><div class="line"> * default <span class="keyword">is</span> &#123;@code <span class="literal">true</span>&#125;.</div><div class="line"> *</div><div class="line"> * @param includePad whether <span class="keyword">to</span> include padding</div><div class="line"> * @<span class="literal">return</span> this builder, useful <span class="keyword">for</span> chaining</div><div class="line"> * @see android.widget.TextView<span class="comment">#setIncludeFontPadding</span></div><div class="line"> */</div><div class="line">public Builder setIncludePad(<span class="built_in">boolean</span> includePad) &#123;</div><div class="line">    mIncludePad = includePad;</div><div class="line"><span class="built_in">    return</span> this;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>android:includeFontPadding=&quot;false&quot;</code> å¯ä»¥å»æ‰ä¸€å®šçš„è¾¹è·å€¼ä½†æ˜¯ä¸èƒ½å®Œå…¨å»æ‰ã€‚è¿˜å°‘è¾¾ä¸åˆ°<br>æ–‡å­—é«˜åº¦ç²¾ç¡®ï¼Œæ‰€ä»¥ä¸é€šè¿‡è¿‡è®¾ç½® lineSpacingMultiplier æ¥æ”¹å˜, lineSpacingMultiplier ä¸º 0 , é‚£ä¹ˆå¤šè¡Œæ–‡æœ¬å°±éƒ½å˜æˆä¸€è¡Œäº†ã€‚<br><img src="http://ww1.sinaimg.cn/large/8c9b876fjw1f62nk9xof1j20v009q416.jpg" alt="å³è¾¹çš„ç»¿è‰²èƒŒæ™¯çš„æ•ˆæœ"></p>
<p>æœ€ç»ˆç»“æœæ˜¯ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">lineSpacingMultiplier</span> = <span class="number">0</span></div><div class="line"><span class="attr">lineSpacingExtra</span> = è¡Œé«˜</div><div class="line"><span class="attr">paddingTop</span> = paddingBottom = ï¼ˆè¡Œé«˜-å­—ä½“å¤§å°ï¼‰* <span class="number">0.5</span></div></pre></td></tr></table></figure>
<p><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f62nc6ai84j20bt09s0tl.jpg" alt="è®¡ç®—paddingTop"></p>
<p><img src="http://ww4.sinaimg.cn/large/8c9b876fjw1f61yuqmw9aj214l0lsqbe.jpg" alt="è®¾ç½®é«˜åº¦"></p>
<p>å°è£…æˆæ§ä»¶ã€‚è¿™é‡Œç»§æ‰¿äº†EditText, é»˜è®¤çš„ç¼–è¾‘æ–‡æœ¬æ—¶çš„è¡Œé«˜ä¼šæ”¹å˜,æ‰€ä»¥åœ¨æ–‡æœ¬å˜åŒ–æ—¶éœ€è¦é‡æ–°è®¾ç½®.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> xyz.hanks.note.ui.widget;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.text.Editable;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.Gravity;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"></div><div class="line"><span class="keyword">import</span> xyz.hanks.note.R;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ¯ä¸€è¡Œçš„æ–‡å­—å‚ç›´å±…ä¸­</div><div class="line"> * Created by hanks on 16/7/2.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineTextView</span> <span class="keyword">extends</span> <span class="title">EditText</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ITEM_HEIGHT = <span class="number">125</span>;</div><div class="line">    <span class="keyword">boolean</span> reLayout = <span class="keyword">false</span>;</div><div class="line">    TextWatcher textWatcher;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineTextView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context,<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineTextView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs,<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineTextView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        addTextChangedListener(<span class="keyword">new</span> android.text.TextWatcher() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence charSequence, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (textWatcher != <span class="keyword">null</span>) &#123;</div><div class="line">                    textWatcher.beforeTextChanged(charSequence, i, i1, i2);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence charSequence, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line">                <span class="keyword">float</span> add = ITEM_HEIGHT;</div><div class="line">                setLineSpacing(<span class="number">0f</span>, <span class="number">1f</span>);</div><div class="line">                setLineSpacing(add, <span class="number">0</span>);</div><div class="line">                setIncludeFontPadding(<span class="keyword">false</span>);</div><div class="line">                setGravity(Gravity.CENTER_VERTICAL);</div><div class="line">                <span class="keyword">int</span> top = (<span class="keyword">int</span>) ((add - getTextSize()) * <span class="number">0.5f</span>);</div><div class="line">                setPadding(getPaddingLeft(), top, getPaddingRight(), -top);</div><div class="line">                <span class="keyword">if</span> (textWatcher != <span class="keyword">null</span>) &#123;</div><div class="line">                    textWatcher.onTextChanged(charSequence, i, i1, i2);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable editable)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (textWatcher != <span class="keyword">null</span>) &#123;</div><div class="line">                    textWatcher.afterTextChanged(editable);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        <span class="keyword">if</span> (!reLayout) &#123;</div><div class="line">            reLayout = <span class="keyword">true</span>;</div><div class="line">            setIncludeFontPadding(<span class="keyword">false</span>);</div><div class="line">            setGravity(Gravity.CENTER_VERTICAL);</div><div class="line">            setLineSpacing(ITEM_HEIGHT, <span class="number">0</span>);</div><div class="line">            <span class="keyword">int</span> top = (<span class="keyword">int</span>) ((ITEM_HEIGHT - getTextSize()) * <span class="number">0.5f</span>);</div><div class="line">            setPadding(getPaddingLeft(), top, getPaddingRight(), -top);</div><div class="line">            requestLayout();</div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTextWatcher</span><span class="params">(TextWatcher textWatcher)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.textWatcher = textWatcher;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TextWatcher</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence var1, <span class="keyword">int</span> var2, <span class="keyword">int</span> var3, <span class="keyword">int</span> var4)</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence var1, <span class="keyword">int</span> var2, <span class="keyword">int</span> var3, <span class="keyword">int</span> var4)</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable var1)</span></span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> å‚è€ƒé“¾æ¥:</p>
<p> <a href="https://github.com/7heaven/AndroidSdkSourceAnalysis/blob/master/article/textview%E6%BA%90%E7%A2%BC%E8%A7%A3%E6%9E%90.md" target="_blank" rel="external">TextViewæºç è§£æ</a></p>
<p> <a href="http://www.cnblogs.com/tianzhijiexian/p/4297664.html" target="_blank" rel="external">ç”¨TextPaintæ¥ç»˜åˆ¶æ–‡å­—</a></p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;éœ€æ±‚&lt;/strong&gt;ï¼š TextView å¤šè¡Œæ–‡æœ¬å¯ä»¥è®¾ç½®è¡Œé«˜ï¼ˆå¦‚20dpï¼‰ï¼Œæ¯è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww4.sinaimg.cn/large/8c9b876fjw1f61ytzwj8ej20bt09sjs2.jpg&quot; alt=&quot;å¤šè¡Œæ–‡æœ¬,è®¾ç½®è¡Œé«˜,å‚ç›´å±…ä¸­&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="TextView" scheme="http://hanks.pub/tags/TextView/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåŠ¨åŒ–æµ‹è¯•è¿˜å¯ä»¥ç”¨æ¥å¹²å•¥</title>
    <link href="http://hanks.pub/2016/07/07/auto-test/"/>
    <id>http://hanks.pub/2016/07/07/auto-test/</id>
    <published>2016-07-06T16:01:00.000Z</published>
    <updated>2017-07-10T11:02:57.993Z</updated>
    
    <content type="html"><![CDATA[<p>è‡ªåŠ¨åŒ–æµ‹è¯•å°±æ˜¯æŠŠä¸€äº›é‡å¤çš„æµ‹è¯•å·¥ä½œåˆ©ç”¨ç›¸å…³å·¥å…·è‡ªåŠ¨åŒ–ï¼Œå‡å°‘é‡å¤çš„åŠ³åŠ¨ã€‚æˆ‘ä»¬ä¸ä»…å¯ä»¥åˆ©ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·åšæµ‹è¯•ï¼Œè¿˜å¯ä»¥åˆ©ç”¨è¿™äº›å·¥ä½œåšä¸€äº›å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚çˆ¬æ•°æ®ï¼Œæ›¾ç»æŠ“å–è¿‡å­¦æ ¡çš„æ•´ä¸ªå­¦æœŸçš„è¯¾è¡¨ï¼Œç©ºé—²æ•™å®¤ï¼Œå¸®è€çˆ¸æŠ“å–ä»–çš„å®¢æˆ·è”ç³»ä¿¡æ¯åˆ° excel è¡¨ã€‚è¿™ç§å·¥å…·ä¸åŒäºä¸€èˆ¬çš„è„šæœ¬çˆ¬è™«ï¼Œè¿™ç›¸å½“äºæ­£å¸¸çš„ç”¨æˆ·è¡Œä¸ºï¼Œæ¯”å¦‚ç‚¹å‡»è¾“å…¥æ¡†ï¼Œè¾“å…¥æ–‡æœ¬ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œè€Œä¸”ä¸ç”¨æ‹…å¿ƒåŠ¨æ€ js ç­‰é—®é¢˜ã€‚</p>
<a id="more"></a>
<p>å¤§æ¦‚æœç´¢äº†å‡ ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•çš„å·¥å…·ï¼š<br><a href="http://www.seleniumhq.org/projects/webdriver/" target="_blank" rel="external">selenium</a><br><a href="http://casperjs.org/" target="_blank" rel="external">capserjs</a><br><a href="http://phantomjs.org/best-practices.html" target="_blank" rel="external">phantomjs</a><br><a href="https://launchpad.net/sikuli" target="_blank" rel="external">Sikuli</a><br><a href="http://zombie.js.org/" target="_blank" rel="external">Zombie </a><br><a href="http://watij.com/webspec-api/" target="_blank" rel="external">WebSpec</a></p>
<p>ä»¥å‰ä½¿ç”¨çš„ <code>WebSpec</code> ï¼Œæ”¯æŒå¤šç§æµè§ˆå™¨å†…æ ¸ï¼Œå¯å¼€å…³ GUIã€‚</p>
<p>ä¸‹é¢äº†è§£äº†ä¸€ä¸‹ <a href="https://www.npmjs.com/package/selenium-webdriver" target="_blank" rel="external">selenium-webdrive</a>,æ”¯æŒè¯­è¨€æœ‰ <code>java</code> <code>c#</code> <code>python</code> <code>ruby</code><br><code>php</code> <code>perl</code> <code>javascript</code>ã€‚</p>
<p>javascript ç‰ˆå®‰è£…å¾ˆç®€å•<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> selenium-webdriver</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯è‡ªå¸¦çš„ firefox ç‰ˆæœ¬çš„ï¼Œå…¶ä»–æµè§ˆå™¨çš„å¯ä»¥å¦è¡Œä¸‹è½½ã€‚</p>
<p>çœ‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webdriver = <span class="keyword">require</span>(<span class="string">'selenium-webdriver'</span>), <span class="comment">// å¼•ç”¨æ¨¡å—</span></div><div class="line">    <span class="keyword">By</span> = webdriver.By,</div><div class="line">    <span class="keyword">until</span> = webdriver.until;</div><div class="line"></div><div class="line"><span class="keyword">var</span> driver = <span class="keyword">new</span> webdriver.Builder()</div><div class="line">    .forBrowser(<span class="string">'firefox'</span>) <span class="comment">// æ‰“å¼€ firfox </span></div><div class="line">    .build();</div><div class="line"></div><div class="line">driver.get(<span class="string">'http://www.google.com/ncr'</span>); <span class="comment">// æ‰“å¼€ç½‘é¡µ</span></div><div class="line">driver.findElement(<span class="keyword">By</span>.name(<span class="string">'q'</span>)).sendKeys(<span class="string">'webdriver'</span>); <span class="comment">// è·å–è¾“å…¥æ¡†ï¼Œå¹¶è¾“å…¥å…ƒç´ </span></div><div class="line">driver.findElement(<span class="keyword">By</span>.name(<span class="string">'btnG'</span>)).click(); <span class="comment">// è·å–æœç´¢æŒ‰é’®ï¼Œå¹¶ç‚¹å‡»</span></div><div class="line">driver.wait(<span class="keyword">until</span>.titleIs(<span class="string">'webdriver - Google Search'</span>),  <span class="number">1000</span>); <span class="comment">// ç­‰å¾…ç½‘ç»œå“åº”ç›´åˆ°ç½‘é¡µæ ‡é¢˜å˜ä¸ºwebdriver - Google Search</span></div><div class="line">driver.quit();</div></pre></td></tr></table></figure></p>
<p>api éƒ½ç®€å•æ˜“æ‡‚ï¼Œå¾ˆå¿«å°±èƒ½å…¥æ‰‹ä½¿ç”¨ã€‚ä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æ˜¯ <code>driver.findElement</code> æœ‰æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼ŒåŸå› æ˜¯æœ‰çš„ç½‘é¡µæ˜¯åç«¯åŠ¨æ€æ¸²æŸ“çš„ï¼Œæ— æ³•ä¸€ä¸‹å­è·å–åˆ°å¯¹åº”çš„å…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> button = driver.wait(<span class="keyword">until</span>.elementLocated(By.<span class="keyword">name</span>(<span class="string">'login'</span>)), <span class="number">5</span> * <span class="number">1000</span>)</div></pre></td></tr></table></figure>
<hr>
<p>è®¡åˆ’ç”¨è‡ªåŠ¨æµ‹è¯•æ¥è‡ªåŠ¨è¿è¥å¾®ä¿¡å…¬ä¼—å·ã€‚å¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼ˆåŸºæœ¬å°±æ˜¯æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼‰ï¼š</p>
<p>ç°åœ¨éœ€è¦æ‰«æäºŒç»´ç ï¼Œé‚£ä¹ˆå°±å°†äºŒç»´ç å‘é€åˆ°æ‰‹æœºç„¶åå¾®ä¿¡è¯†åˆ«ç™»å½•ã€‚</p>
<ol>
<li>ç™»å½•</li>
<li>è·å–äºŒç»´ç </li>
<li>ç‚¹å‡»ç¾¤å‘æ¶ˆæ¯</li>
<li>ç‚¹å‡»æ¶ˆæ¯</li>
<li>ç¼–è¾‘æ–‡ç« </li>
<li>å‘é€</li>
<li>è·å–äºŒç»´ç </li>
<li>æ–‡ç« å‘å¸ƒæˆåŠŸ</li>
</ol>
<p>å¯ä»¥åˆ©ç”¨ slack æˆ–è€… telegram æœºå™¨äººçš„ api æ¥é€šçŸ¥è‡ªå·±ï¼ˆæ¯”å¦‚å°†éªŒè¯ç å›¾ç‰‡å‘é€åˆ°æ‰‹æœºï¼‰ã€‚</p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‡ªåŠ¨åŒ–æµ‹è¯•å°±æ˜¯æŠŠä¸€äº›é‡å¤çš„æµ‹è¯•å·¥ä½œåˆ©ç”¨ç›¸å…³å·¥å…·è‡ªåŠ¨åŒ–ï¼Œå‡å°‘é‡å¤çš„åŠ³åŠ¨ã€‚æˆ‘ä»¬ä¸ä»…å¯ä»¥åˆ©ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·åšæµ‹è¯•ï¼Œè¿˜å¯ä»¥åˆ©ç”¨è¿™äº›å·¥ä½œåšä¸€äº›å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚çˆ¬æ•°æ®ï¼Œæ›¾ç»æŠ“å–è¿‡å­¦æ ¡çš„æ•´ä¸ªå­¦æœŸçš„è¯¾è¡¨ï¼Œç©ºé—²æ•™å®¤ï¼Œå¸®è€çˆ¸æŠ“å–ä»–çš„å®¢æˆ·è”ç³»ä¿¡æ¯åˆ° excel è¡¨ã€‚è¿™ç§å·¥å…·ä¸åŒäºä¸€èˆ¬çš„è„šæœ¬çˆ¬è™«ï¼Œè¿™ç›¸å½“äºæ­£å¸¸çš„ç”¨æˆ·è¡Œä¸ºï¼Œæ¯”å¦‚ç‚¹å‡»è¾“å…¥æ¡†ï¼Œè¾“å…¥æ–‡æœ¬ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œè€Œä¸”ä¸ç”¨æ‹…å¿ƒåŠ¨æ€ js ç­‰é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="è‡ªåŠ¨åŒ–" scheme="http://hanks.pub/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹  Promise ï¼ˆç»“åˆ RxJavaï¼‰</title>
    <link href="http://hanks.pub/2016/06/26/promise-by-rx/"/>
    <id>http://hanks.pub/2016/06/26/promise-by-rx/</id>
    <published>2016-06-26T08:24:37.000Z</published>
    <updated>2017-03-27T02:05:42.423Z</updated>
    
    <content type="html"><![CDATA[<p>Promisse è§£å†³å›è°ƒåµŒå¥—é—®é¢˜ã€‚<br><a id="more"></a></p>
<h2 id="å½“å‰çš„é—®é¢˜"><a href="#å½“å‰çš„é—®é¢˜" class="headerlink" title="å½“å‰çš„é—®é¢˜"></a>å½“å‰çš„é—®é¢˜</h2><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸åŒçš„è¯­è¨€éƒ½æœ‰é‡åˆ° callback hellï¼ˆå›è°ƒåœ°ç‹±ï¼‰ï¼Œ å›è°ƒä¸€èˆ¬å‡ºç°åœ¨å¼‚æ­¥æ“ä½œä¸­ã€‚<br>ç®€å•çš„ä¾‹å­:<br>â‘  ä»ç½‘ç»œè·å–å›¾ç‰‡<br>â‘¡ å°†å›¾ç‰‡è¿›è¡Œå‹ç¼©<br>â‘¢ å‹ç¼©åçš„æ•°æ®ä¿å­˜åˆ°æœ¬åœ°<br>ä»¥ä¸Šå‡ ä¸ªæ“ä½œéƒ½å±äºå¼‚æ­¥æ“ä½œï¼Œ</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">op1(<span class="name">callback</span>()&#123;</div><div class="line">    success()&#123;</div><div class="line">        op2(<span class="name">callback</span>()&#123;</div><div class="line">            success()&#123;</div><div class="line">                op3(<span class="name">callback</span>()&#123;</div><div class="line">                    success()&#123;</div><div class="line">                     // done</div><div class="line">                    &#125;</div><div class="line">                    error(<span class="name">e</span>)&#123;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">            error(<span class="name">e</span>)&#123;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">    error(<span class="name">e</span>)&#123;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¸åŒè¯­è¨€è®¾è®¡é’ˆå¯¹æ­¤éƒ½æœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°†å›è°ƒå†™æˆæµæ°´çº¿ï¼Œå°†å¤æ‚çš„æ“ä½œå˜æˆä¸€æ¡çº¿ã€‚</p>
<p><code>Rxjava</code>ï¼šjava ä¸­å¤„ç†å¼‚æ­¥</p>
<p><code>Promise</code>ï¼š JavaScript ä¸­å¤„ç†å¼‚æ­¥</p>
<p>å†™èµ·æ¥ç±»ä¼¼äºä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">op1</span>()</div><div class="line">  <span class="selector-class">.then</span>(op2)</div><div class="line">  <span class="selector-class">.then</span>(op3)</div><div class="line">  <span class="selector-class">.catch</span>(e)</div><div class="line">  <span class="selector-class">.done</span>();</div></pre></td></tr></table></figure>
<p><code>Promise</code> å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>Pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>Resolved</code>ï¼ˆå·²å®Œæˆï¼Œåˆç§°Fulfilledï¼‰å’Œ <code>Rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚</p>
<h3 id="åˆ›å»º-promise"><a href="#åˆ›å»º-promise" class="headerlink" title="åˆ›å»º promise"></a>åˆ›å»º promise</h3><p><code>rxjava</code></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Observable</span> observable = Observable.create(new Observable.OnSubscribe&lt;<span class="keyword">String&gt;() </span>&#123;</div><div class="line">    <span class="comment">@Override</span></div><div class="line">    public void call(<span class="keyword">Subscriber&lt;? </span>super <span class="keyword">String&gt; </span><span class="keyword">subscriber) </span>&#123;</div><div class="line">      // ... some <span class="meta">code</span></div><div class="line">      <span class="meta">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</div><div class="line">        <span class="keyword">subscriber.onNext(value);</span></div><div class="line">        <span class="keyword">subscriber.onCompleted();</span></div><div class="line">      &#125; <span class="meta">else</span> &#123;</div><div class="line">        <span class="keyword">subscriber.onError(error);</span></div><div class="line">      &#125;</div><div class="line">&#125;)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p><code>Promise</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">  <span class="comment">// ... some code</span></div><div class="line">  <span class="keyword">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</div><div class="line">    resolve(value);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    reject(error);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="æµæ°´çº¿"><a href="#æµæ°´çº¿" class="headerlink" title="æµæ°´çº¿"></a>æµæ°´çº¿</h2><p><code>rxjava</code><br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">observable.doOnNext()</div><div class="line">    .map</div><div class="line">    .filter</div><div class="line">    .doOnNext()</div><div class="line">    .subscribe(</div><div class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="comment">// ....</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onNext</span><span class="params">(AppInfo appInfo)</span> </span>&#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line">    );</div></pre></td></tr></table></figure></p>
<p><code>promise</code></p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">promise.<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;</span></div><div class="line"></div><div class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;</span></div><div class="line"></div><div class="line">&#125;).<span class="keyword">catch</span>(<span class="function"><span class="keyword">function</span><span class="params">(error)</span>&#123;</span></div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="all"><a href="#all" class="headerlink" title="all"></a>all</h3><p>ç±»ä¼¼äº <code>Observable ob  = Observable.merge(ob1,ob2,ob3)</code></p>
<p>Promise.allæ–¹æ³•ç”¨äºå°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> p = Promise.all([<span class="built_in">p1</span>, <span class="built_in">p2</span>, <span class="built_in">p3</span>])<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.all</code> æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<code>p1ã€p2ã€p3</code> éƒ½æ˜¯Promiseå¯¹è±¡çš„å®ä¾‹ã€‚ï¼ˆPromise.allæ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰Iteratoræ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯Promiseå®ä¾‹ã€‚ï¼‰</p>
<p>pçš„çŠ¶æ€ç”±p1ã€p2ã€p3å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p>
<p>ï¼ˆ1ï¼‰åªæœ‰<code>p1ã€p2ã€p3</code>çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œpçš„çŠ¶æ€æ‰ä¼šå˜æˆfulfilledï¼Œæ­¤æ—¶p1ã€p2ã€p3çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p>
<p>ï¼ˆ2ï¼‰åªè¦<code>p1ã€p2ã€p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼Œ<code>pçš„çŠ¶æ€å°±å˜æˆrejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="race"><a href="#race" class="headerlink" title="race"></a>race</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> p = Promise.race([<span class="built_in">p1</span>,<span class="built_in">p2</span>,<span class="built_in">p3</span>])<span class="comment">;</span></div></pre></td></tr></table></figure>
<p><code>Promise.race</code> æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚</p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦<code>p1ã€p2ã€p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>pçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜</code>ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„Promiseå®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h3><p>ä¸ç®¡ <code>Promise</code> å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="http://es6.ruanyifeng.com/?search=fetch&amp;x=0&amp;y=0#docs/promise" target="_blank" rel="external">http://es6.ruanyifeng.com/?search=fetch&amp;x=0&amp;y=0#docs/promise</a></p>
<p><a href="https://mcxiaoke.gitbooks.io/rxdocs/content/operators/Merge.html" target="_blank" rel="external">https://mcxiaoke.gitbooks.io/rxdocs/content/operators/Merge.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Promisse è§£å†³å›è°ƒåµŒå¥—é—®é¢˜ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Promise" scheme="http://hanks.pub/tags/Promise/"/>
    
      <category term="JavaScript" scheme="http://hanks.pub/tags/JavaScript/"/>
    
      <category term="å‰ç«¯" scheme="http://hanks.pub/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ Android æ‰‹æœºæ‰“é€ æ¥ç”µé€šçŸ¥è®¡åˆ’</title>
    <link href="http://hanks.pub/2016/06/21/motifyme/"/>
    <id>http://hanks.pub/2016/06/21/motifyme/</id>
    <published>2016-06-21T15:38:27.000Z</published>
    <updated>2017-07-10T11:02:58.200Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä½çš„åœ°æ–¹æ€»åœ¨æ™šä¸Šåœç”µï¼Œè¿˜è®©ä¸è®©äººæ´»äº†ï¼Œå¤§çƒ­å¤©çš„ï¼Œäºæ˜¯å°±æ™šä¸Šåœ¨å¤–é¢å…ˆæ‰¾ä¸ªå‡‰å¿«çš„åœ°æ–¹å‘†ç€ï¼Œä½†æ˜¯æ¥ç”µçš„æ—¶é—´ä¸ç¡®å®šï¼Œæœ‰æ—¶å€™æ„Ÿè§‰åº”è¯¥æ¥ç”µäº†ï¼Œå›å»äº†è¿˜æ˜¯æ²¡ç”µï¼Œé‚£ä¸ªçƒ­å•Šã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¦æ˜¯å±‹é‡Œæ¥ç”µäº†æœ‰äººå‘Šè¯‰æˆ‘å°±å¥½äº†ï¼äºæ˜¯è®¡åˆ’å†™ä¸€ä¸ªå°ç¨‹åºè®©å®ƒåœ¨å±‹é‡Œæ¥ç”µåé€šçŸ¥ã€‚<br><a id="more"></a><br>åˆ©ç”¨ç°ç”¨èµ„æºï¼šä¸€å°<strong>é€€ä¼‘çš„æ‰‹æœº</strong><br>å¤§æ¦‚æ€è·¯æ˜¯è¿™æ ·çš„ï¼šå®¶é‡Œçš„è·¯ç”±å™¨æ˜¯ä¸€ç›´è¿ç€ç”µæºçš„ï¼Œè€æ‰‹æœºæ˜¯ä¸€ç›´å¼€ç€ wifi çš„ï¼Œæ¥ç”µåè·¯ç”±å™¨é€šç”µï¼Œè‡ªåŠ¨è¿æ¥ä¸Šç½‘ç»œï¼Œè¿™ä¸ªæ—¶å€™æ‰‹æœºä¹Ÿæ£€æµ‹åˆ°ç½‘ç»œï¼Œè¿æ¥ä¸Šäº† wifiï¼Œç„¶ååå°ç¨‹åºé€šè¿‡æ­¤åˆ¤æ–­æ¥ç”µäº†ï¼Œå†è®©è€æ‰‹æœºç»™æˆ‘å‘çŸ­ä¿¡é€šçŸ¥ï¼Œæ”¶åˆ°æ¥ç”µé€šçŸ¥åæˆ‘å°±å¯ä»¥å›å»äº†å¹ç”µæ‰‡äº†ï¼</p>
<p>æ¥æ¥æ¥ï¼Œå¼€å§‹å†™ç¨‹åº</p>
<ol>
<li>é¦–å…ˆå¼€å¯ä¸€ä¸ªåå°æœåŠ¡ <code>NetCheckService</code>ï¼Œ1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚è®°å¾— AndroidMenifest.xml æ³¨å†Œã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by hanks on 16/6/21.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCheckService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LAST_STATUS = <span class="string">"lastStatus"</span>; </div><div class="line">    <span class="meta">@Nullable</span> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æœåŠ¡å¼€å¯</span></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        handleIntent();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleIntent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> Thread()&#123;</div><div class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>)&#123; </div><div class="line">                    System.out.println(<span class="string">"onStart"</span>);</div><div class="line">                    </div><div class="line">                    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ¥ç”µäº†</span></div><div class="line">                    handleStatus();</div><div class="line"></div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        Thread.sleep(<span class="number">60</span>*<span class="number">1000</span>);</div><div class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                    System.out.println(<span class="string">"----è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæˆ---"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;.start();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ol>
<li>æ£€æµ‹ç½‘ç»œ</li>
</ol>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/**</span></div><div class="line"> * æ£€æµ‹å½“çš„ç½‘ç»œçŠ¶æ€</div><div class="line"> * <span class="doctag">@return</span> true è¡¨ç¤ºç½‘ç»œå¯ç”¨</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isNetworkAvailable</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    ConnectivityManager connectivity = (ConnectivityManager) context</div><div class="line">            .getSystemService(Context.CONNECTIVITY_SERVICE);</div><div class="line">    <span class="keyword">if</span> (connectivity != <span class="keyword">null</span>) &#123;</div><div class="line">        NetworkInfo info = connectivity.getActiveNetworkInfo();</div><div class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span> &amp;&amp; info.isConnected()) &#123;</div><div class="line">            <span class="comment">// å½“å‰ç½‘ç»œæ˜¯è¿æ¥çš„</span></div><div class="line">            <span class="keyword">if</span> (info.getState() == NetworkInfo.State.CONNECTED) &#123;</div><div class="line">                <span class="comment">// å½“å‰æ‰€è¿æ¥çš„ç½‘ç»œå¯ç”¨</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>åˆ¤æ–­æ˜¯å¦æ¥ç”µäº†, <strong>è®°å¾—æ³¨å†Œç›¸åº”çš„æƒé™</strong>ã€‚</li>
</ol>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">boolean</span> <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</div><div class="line">    SharedPreferences sp = PreferenceManager.getDefaultSharedPreferences(getApplicationContext());</div><div class="line">    <span class="function"><span class="keyword">return</span> sp.<span class="title">getBoolean</span><span class="params">(LAST_STATUS, <span class="keyword">false</span>)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">updateStatus</span><span class="params">(<span class="keyword">boolean</span> isAvailable)</span> </span>&#123;</div><div class="line">    SharedPreferences sp = PreferenceManager.getDefaultSharedPreferences(getApplicationContext());</div><div class="line">    SharedPreferences.Editor editor = sp.edit();</div><div class="line">    editor.putBoolean(LAST_STATUS, isAvailable);</div><div class="line">    editor.apply();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">hanldeStatus</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span> lastStatus = getStatus();</div><div class="line">    <span class="comment">// æ£€æµ‹ç½‘ç»œçŠ¶å†µ</span></div><div class="line">    <span class="keyword">boolean</span> isNetworkAvailable = isNetworkAvailable(getApplicationContext());</div><div class="line">    <span class="comment">// å¦‚æœåŸæ¥ç½‘ç»œä¸å¯ç”¨ &amp;&amp; ç°åœ¨å¯ç”¨äº†</span></div><div class="line">    <span class="keyword">if</span> (!lastStatus &amp;&amp; isNetworkAvailable) &#123;</div><div class="line">        <span class="comment">// å‘é€çŸ­ä¿¡</span></div><div class="line">        sendSMS();</div><div class="line">    &#125;</div><div class="line">    System.out.println(<span class="string">"isNetworkAvailable = "</span> + isNetworkAvailable);</div><div class="line">    <span class="comment">// æ›´æ–°ç½‘ç»œçŠ¶æ€</span></div><div class="line">    updateStatus(isNetworkAvailable);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>å®šæœŸæ£€æµ‹æ‰‹æœºè¿æ¥ç½‘ç»œçš„çŠ¶æ€ï¼Œå¦‚æœå½“å‰ç½‘ç»œæ˜¯å¯ç”¨çŠ¶æ€å¹¶ä¸”ä¸Šæ¬¡æ˜¯ä¸å¯ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ¥ç”µäº†ï¼Œç„¶åå°±å‘é€çŸ­ä¿¡é€šçŸ¥æˆ‘<br>å‘é€çŸ­ä¿¡å°±ä½¿ç”¨çš„ ShareSDK çš„ã€‚è‡ªå®šä¹‰çŸ­ä¿¡æ¨¡æ¿è¿˜è¦å®¡æ ¸ï¼Œæ‰€ä»¥æš‚æ—¶ç”¨ç³»ç»Ÿé»˜è®¤çš„ã€‚</li>
</ol>
<p><img src="http://ww2.sinaimg.cn/large/8c9b876fjw1f53acno7raj20k00zkjss.jpg" alt="æ”¶åˆ°çŸ­ä¿¡" style="width: 400px;"></p>
<p>è¿˜ä¸å®Œå–„çš„åœ°æ–¹ï¼š</p>
<ul>
<li>æ‰‹æœºæœåŠ¡å¾ˆæœ‰å¯èƒ½è¢«æ€æ­»ã€‚</li>
<li>çŸ­ä¿¡æ¨¡æ¿ã€‚</li>
</ul>
<blockquote>
<p>è¿˜æœ‰ä¸€ç§æ€è·¯å°±æ˜¯æ‰‹æœºä¸€ç›´å……ç€ç”µï¼Œæ£€æµ‹æ‰‹æœºç”µæ± çŠ¶æ€æ˜¯å¦ä¸ºå……ç”µã€‚</p>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ä½çš„åœ°æ–¹æ€»åœ¨æ™šä¸Šåœç”µï¼Œè¿˜è®©ä¸è®©äººæ´»äº†ï¼Œå¤§çƒ­å¤©çš„ï¼Œäºæ˜¯å°±æ™šä¸Šåœ¨å¤–é¢å…ˆæ‰¾ä¸ªå‡‰å¿«çš„åœ°æ–¹å‘†ç€ï¼Œä½†æ˜¯æ¥ç”µçš„æ—¶é—´ä¸ç¡®å®šï¼Œæœ‰æ—¶å€™æ„Ÿè§‰åº”è¯¥æ¥ç”µäº†ï¼Œå›å»äº†è¿˜æ˜¯æ²¡ç”µï¼Œé‚£ä¸ªçƒ­å•Šã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¦æ˜¯å±‹é‡Œæ¥ç”µäº†æœ‰äººå‘Šè¯‰æˆ‘å°±å¥½äº†ï¼äºæ˜¯è®¡åˆ’å†™ä¸€ä¸ªå°ç¨‹åºè®©å®ƒåœ¨å±‹é‡Œæ¥ç”µåé€šçŸ¥ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>SwipeRefreshLayout æºç </title>
    <link href="http://hanks.pub/2016/06/18/swiperefreshlayout/"/>
    <id>http://hanks.pub/2016/06/18/swiperefreshlayout/</id>
    <published>2016-06-18T11:37:51.000Z</published>
    <updated>2017-07-10T11:02:58.260Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/widget/SwipeRefreshLayout.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<p><code>SwipeRefreshLayout</code> æ˜¯ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œå‡ ä¹å¯ä»¥åŒ…è£¹ä¸€ä¸ªä»»ä½•å¯ä»¥æ»šåŠ¨çš„å†…å®¹ï¼ˆListView GridView ScrollView RecyclerViewï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«å‚ç›´æ»šåŠ¨æ‰‹åŠ¿ã€‚ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p>
<a id="more"></a>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="http://img.blog.csdn.net/20150127120706062" alt=""></td>
<td style="text-align:center"><img src="http://img.blog.csdn.net/20150127121649015" alt=""></td>
</tr>
</tbody>
</table>
<p> 1.å°†éœ€è¦ä¸‹æ‹‰åˆ·æ–°çš„ç©ºé—´åŒ…è£¹èµ·æ¥</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.SwipeRefreshLayout</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recyclerView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.SwipeRefreshLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 2.è®¾ç½®åˆ·æ–°åŠ¨ç”»çš„è§¦å‘å›è°ƒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è®¾ç½®ä¸‹æ‹‰å‡ºç°å°åœ†åœˆæ˜¯å¦æ˜¯ç¼©æ”¾å‡ºç°ï¼Œå‡ºç°çš„ä½ç½®ï¼Œæœ€å¤§çš„ä¸‹æ‹‰ä½ç½®</span></div><div class="line">mySwipeRefreshLayout.setProgressViewOffset(<span class="keyword">true</span>, <span class="number">50</span>, <span class="number">200</span>);</div><div class="line"></div><div class="line"><span class="comment">//è®¾ç½®ä¸‹æ‹‰åœ†åœˆçš„å¤§å°ï¼Œä¸¤ä¸ªå€¼ LARGEï¼Œ DEFAULT</span></div><div class="line">mySwipeRefreshLayout.setSize(SwipeRefreshLayout.LARGE);</div><div class="line"></div><div class="line"><span class="comment">// è®¾ç½®ä¸‹æ‹‰åœ†åœˆä¸Šçš„é¢œè‰²ï¼Œè“è‰²ã€ç»¿è‰²ã€æ©™è‰²ã€çº¢è‰²</span></div><div class="line">mySwipeRefreshLayout.setColorSchemeResources(</div><div class="line">    android.R.color.holo_blue_bright,</div><div class="line">    android.R.color.holo_green_light,</div><div class="line">    android.R.color.holo_orange_light,</div><div class="line">    android.R.color.holo_red_light);</div><div class="line"></div><div class="line"><span class="comment">// é€šè¿‡ setEnabled(false) ç¦ç”¨ä¸‹æ‹‰åˆ·æ–°</span></div><div class="line">mySwipeRefreshLayout.setEnabled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">// è®¾å®šä¸‹æ‹‰åœ†åœˆçš„èƒŒæ™¯</span></div><div class="line">mSwipeLayout.setProgressBackgroundColor(R.color.red);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * è®¾ç½®æ‰‹åŠ¿ä¸‹æ‹‰åˆ·æ–°çš„ç›‘å¬</div><div class="line"> */</div><div class="line">mySwipeRefreshLayout.setOnRefreshListener(</div><div class="line">    <span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="comment">// åˆ·æ–°åŠ¨ç”»å¼€å§‹åå›è°ƒåˆ°æ­¤æ–¹æ³•</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>setRefreshing(false)</code> å’Œ <code>setRefreshing(true)</code> æ¥æ‰‹åŠ¨è°ƒç”¨åˆ·æ–°çš„åŠ¨ç”»ã€‚</p>
<blockquote>
<p><code>onRefresh</code> çš„å›è°ƒåªæœ‰åœ¨æ‰‹åŠ¿ä¸‹æ‹‰çš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ï¼Œé€šè¿‡ <code>setRefreshing</code> åªèƒ½è°ƒç”¨åˆ·æ–°çš„åŠ¨ç”»æ˜¯å¦æ˜¾ç¤ºã€‚<br>SwipeRefreshLayout ä¹Ÿå¯æ”¾åœ¨ CoordinatorLayout å†…å…±åŒå¤„ç†æ»‘åŠ¨å†²çªï¼Œæœ‰å…´è¶£å¯ä»¥å°è¯•ã€‚</p>
</blockquote>
<h2 id="SwipeRefreshLayout-æºç åˆ†æ"><a href="#SwipeRefreshLayout-æºç åˆ†æ" class="headerlink" title="SwipeRefreshLayout æºç åˆ†æ"></a>SwipeRefreshLayout æºç åˆ†æ</h2><blockquote>
<p>æœ¬æ–‡åŸºäº v4 ç‰ˆæœ¬ <code>23.2.0</code></p>
</blockquote>
<p>extends <code>ViewGroup</code> implements <code>NestedScrollingParent</code> <code>NestedScrollingChild</code><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">java<span class="selector-class">.lang</span><span class="selector-class">.Object</span></div><div class="line">   â†³    android<span class="selector-class">.view</span><span class="selector-class">.View</span></div><div class="line">       â†³    android<span class="selector-class">.view</span><span class="selector-class">.ViewGroup</span></div><div class="line">           â†³    android<span class="selector-class">.support</span><span class="selector-class">.v4</span><span class="selector-class">.widget</span><span class="selector-class">.SwipeRefreshLayout</span></div></pre></td></tr></table></figure></p>
<p>SwipeRefreshLayout çš„åˆ†æåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>è‡ªå®šä¹‰ ViewGroup çš„éƒ¨åˆ†</strong>ï¼Œ<strong>å¤„ç†å’Œå­è§†å›¾çš„åµŒå¥—æ»šåŠ¨éƒ¨åˆ†</strong>ã€‚</p>
<h3 id="SwipeRefreshLayout-extends-ViewGroup"><a href="#SwipeRefreshLayout-extends-ViewGroup" class="headerlink" title="SwipeRefreshLayout extends ViewGroup"></a>SwipeRefreshLayout extends ViewGroup</h3><p>å…¶å®å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ ViewGroup ï¼Œç»“åˆæˆ‘ä»¬è‡ªå·±å¹³æ—¶è‡ªå®šä¹‰ ViewGroup çš„æ­¥éª¤ï¼š</p>
<ol>
<li>åˆå§‹åŒ–å˜é‡</li>
<li>onMeasure</li>
<li>onLayout</li>
<li>å¤„ç†äº¤äº’ ï¼ˆ<code>dispatchTouchEvent</code> <code>onInterceptTouchEvent</code> <code>onTouchEvent</code>ï¼‰</li>
</ol>
<p>æ¥ä¸‹æ¥å°±æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œåˆ†æã€‚</p>
<h4 id="1-åˆå§‹åŒ–å˜é‡"><a href="#1-åˆå§‹åŒ–å˜é‡" class="headerlink" title="1.åˆå§‹åŒ–å˜é‡"></a>1.åˆå§‹åŒ–å˜é‡</h4><p><code>SwipeRefreshLayout</code> å†…éƒ¨æœ‰ 2 ä¸ª Viewï¼Œä¸€ä¸ª<code>åœ†åœˆï¼ˆmCircleViewï¼‰</code>ï¼Œä¸€ä¸ªå†…éƒ¨å¯æ»šåŠ¨çš„<code>Viewï¼ˆmTargetï¼‰</code>ã€‚é™¤äº† Viewï¼Œè¿˜åŒ…å«ä¸€ä¸ª <code>OnRefreshListener</code> æ¥å£ï¼Œå½“åˆ·æ–°åŠ¨ç”»è¢«è§¦å‘æ—¶å›è°ƒã€‚</p>
<p> <img src="https://dn-coding-net-production-pp.qbox.me/8e02212d-b364-4df8-bfaa-47f3084f89e7.png" alt="å›¾ç‰‡"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Constructor that is called when inflating SwipeRefreshLayout from XML.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> context</div><div class="line"> * <span class="doctag">@param</span> attrs</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SwipeRefreshLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs);</div><div class="line"></div><div class="line">    <span class="comment">// ç³»ç»Ÿé»˜è®¤çš„æœ€å°æ»šåŠ¨è·ç¦»</span></div><div class="line">    mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop();</div><div class="line"></div><div class="line">    <span class="comment">// ç³»ç»Ÿé»˜è®¤çš„åŠ¨ç”»æ—¶é•¿</span></div><div class="line">    mMediumAnimationDuration = getResources().getInteger(</div><div class="line">            android.R.integer.config_mediumAnimTime);</div><div class="line"></div><div class="line">    setWillNotDraw(<span class="keyword">false</span>);</div><div class="line">    mDecelerateInterpolator = <span class="keyword">new</span> DecelerateInterpolator(DECELERATE_INTERPOLATION_FACTOR);</div><div class="line"></div><div class="line">    <span class="comment">// è·å– xml ä¸­å®šä¹‰çš„å±æ€§</span></div><div class="line">    <span class="keyword">final</span> TypedArray a = context.obtainStyledAttributes(attrs, LAYOUT_ATTRS);</div><div class="line">    setEnabled(a.getBoolean(<span class="number">0</span>, <span class="keyword">true</span>));</div><div class="line">    a.recycle();</div><div class="line"></div><div class="line">    <span class="comment">// åˆ·æ–°çš„åœ†åœˆçš„å¤§å°ï¼Œå•ä½è½¬æ¢æˆ sp</span></div><div class="line">    <span class="keyword">final</span> DisplayMetrics metrics = getResources().getDisplayMetrics();</div><div class="line">    mCircleWidth = (<span class="keyword">int</span>) (CIRCLE_DIAMETER * metrics.density);</div><div class="line">    mCircleHeight = (<span class="keyword">int</span>) (CIRCLE_DIAMETER * metrics.density);</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºåˆ·æ–°åŠ¨ç”»çš„åœ†åœˆ</span></div><div class="line">    createProgressView();</div><div class="line"></div><div class="line">    ViewCompat.setChildrenDrawingOrderEnabled(<span class="keyword">this</span>, <span class="keyword">true</span>);</div><div class="line">    <span class="comment">// the absolute offset has to take into account that the circle starts at an offset</span></div><div class="line">    mSpinnerFinalOffset = DEFAULT_CIRCLE_TARGET * metrics.density;</div><div class="line">    <span class="comment">// åˆ·æ–°åŠ¨ç”»çš„ä¸´ç•Œè·ç¦»å€¼</span></div><div class="line">    mTotalDragDistance = mSpinnerFinalOffset;</div><div class="line"></div><div class="line">    <span class="comment">// é€šè¿‡ NestedScrolling æœºåˆ¶æ¥å¤„ç†åµŒå¥—æ»šåŠ¨</span></div><div class="line">    mNestedScrollingParentHelper = <span class="keyword">new</span> NestedScrollingParentHelper(<span class="keyword">this</span>);</div><div class="line">    mNestedScrollingChildHelper = <span class="keyword">new</span> NestedScrollingChildHelper(<span class="keyword">this</span>);</div><div class="line">    setNestedScrollingEnabled(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>// åˆ›å»ºåˆ·æ–°åŠ¨ç”»çš„åœ†åœˆ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createProgressView</span><span class="params">()</span> </span>&#123;</div><div class="line">    mCircleView = <span class="keyword">new</span> CircleImageView(getContext(), CIRCLE_BG_LIGHT, CIRCLE_DIAMETER/<span class="number">2</span>);</div><div class="line">    mProgress = <span class="keyword">new</span> MaterialProgressDrawable(getContext(), <span class="keyword">this</span>);</div><div class="line">    mProgress.setBackgroundColor(CIRCLE_BG_LIGHT);</div><div class="line">    mCircleView.setImageDrawable(mProgress);</div><div class="line">    mCircleView.setVisibility(View.GONE);</div><div class="line">    addView(mCircleView);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå‡ºæ¥ä¸€ä¸ª View ï¼ˆä¸‹æ‹‰åˆ·æ–°çš„åœ†åœˆï¼‰ã€‚å¯ä»¥çœ‹å‡ºä½¿ç”¨èƒŒæ™¯åœ†åœˆæ˜¯ v4 åŒ…é‡Œæä¾›çš„ <code>CircleImageView</code> æ§ä»¶ï¼Œä¸­é—´çš„æ˜¯ <code>MaterialProgressDrawable</code> è¿›åº¦æ¡ã€‚<br>å¦ä¸€ä¸ª View æ˜¯åœ¨ xml ä¸­åŒ…å«çš„å¯æ»šåŠ¨è§†å›¾ã€‚</p>
<h4 id="2-onMeasure"><a href="#2-onMeasure" class="headerlink" title="2.onMeasure"></a>2.onMeasure</h4><p>onMeasure ç¡®å®šå­è§†å›¾çš„å¤§å°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">    <span class="keyword">if</span> (mTarget == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// ç¡®å®šå†…éƒ¨è¦æ»šåŠ¨çš„Viewï¼Œå¦‚ RecycleView</span></div><div class="line">        ensureTarget();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mTarget == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// æµ‹é‡å­ View ï¼ˆmTargetï¼‰</span></div><div class="line">    mTarget.measure(MeasureSpec.makeMeasureSpec(</div><div class="line">            getMeasuredWidth() - getPaddingLeft() - getPaddingRight(),</div><div class="line">            MeasureSpec.EXACTLY), MeasureSpec.makeMeasureSpec(</div><div class="line">            getMeasuredHeight() - getPaddingTop() - getPaddingBottom(), MeasureSpec.EXACTLY));</div><div class="line"></div><div class="line">    <span class="comment">// æµ‹é‡åˆ·æ–°çš„åœ†åœˆ mCircleView</span></div><div class="line">    mCircleView.measure(MeasureSpec.makeMeasureSpec(mCircleWidth, MeasureSpec.EXACTLY),</div><div class="line">            MeasureSpec.makeMeasureSpec(mCircleHeight, MeasureSpec.EXACTLY));</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!mUsingCustomStart &amp;&amp; !mOriginalOffsetCalculated) &#123;</div><div class="line">        mOriginalOffsetCalculated = <span class="keyword">true</span>;</div><div class="line">        mCurrentTargetOffsetTop = mOriginalOffsetTop = -mCircleView.getMeasuredHeight();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// è®¡ç®— mCircleView åœ¨ ViewGroup ä¸­çš„ç´¢å¼•</span></div><div class="line">    mCircleViewIndex = -<span class="number">1</span>;</div><div class="line">    <span class="comment">// Get the index of the circleview.</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getChildCount(); index++) &#123;</div><div class="line">        <span class="keyword">if</span> (getChildAt(index) == mCircleView) &#123;</div><div class="line">            mCircleViewIndex = index;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ­¥éª¤ç¡®å®šäº† mCircleView å’Œ SwipeRefreshLayout çš„å­è§†å›¾çš„å¤§å°ã€‚</p>
<h4 id="3-onLayout"><a href="#3-onLayout" class="headerlink" title="3.onLayout"></a>3.onLayout</h4><p>onLayout ä¸»è¦è´Ÿè´£ç¡®å®šå„ä¸ªå­è§†å›¾çš„ä½ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</div><div class="line">   <span class="comment">// è·å– SwipeRefreshLayout çš„å®½é«˜</span></div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> width = getMeasuredWidth();</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> height = getMeasuredHeight();</div><div class="line">   <span class="keyword">if</span> (getChildCount() == <span class="number">0</span>) &#123;</div><div class="line">       <span class="keyword">return</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">if</span> (mTarget == <span class="keyword">null</span>) &#123;</div><div class="line">       ensureTarget();</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">if</span> (mTarget == <span class="keyword">null</span>) &#123;</div><div class="line">       <span class="keyword">return</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">// è€ƒè™‘åˆ°ç»™æ§ä»¶è®¾ç½® paddingï¼Œå»é™¤ padding çš„è·ç¦»</span></div><div class="line">   <span class="keyword">final</span> View child = mTarget;</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> childLeft = getPaddingLeft();</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> childTop = getPaddingTop();</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> childWidth = width - getPaddingLeft() - getPaddingRight();</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> childHeight = height - getPaddingTop() - getPaddingBottom();</div><div class="line">   <span class="comment">// è®¾ç½® mTarget çš„ä½ç½®</span></div><div class="line">   child.layout(childLeft, childTop, childLeft + childWidth, childTop + childHeight);</div><div class="line">   <span class="keyword">int</span> circleWidth = mCircleView.getMeasuredWidth();</div><div class="line">   <span class="keyword">int</span> circleHeight = mCircleView.getMeasuredHeight();</div><div class="line">   <span class="comment">// æ ¹æ® mCurrentTargetOffsetTop å˜é‡çš„å€¼æ¥è®¾ç½® mCircleView çš„ä½ç½®</span></div><div class="line">   mCircleView.layout((width / <span class="number">2</span> - circleWidth / <span class="number">2</span>), mCurrentTargetOffsetTop,</div><div class="line">           (width / <span class="number">2</span> + circleWidth / <span class="number">2</span>), mCurrentTargetOffsetTop + circleHeight);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="https://dn-coding-net-production-pp.qbox.me/8df6d458-700b-4ec5-b731-c6b8c34cdddc.png" alt="å›¾ç‰‡"></p>
<p>åœ¨ onLayout ä¸­æ”¾ç½®äº† mCircleView çš„ä½ç½®ï¼Œæ³¨æ„ é¡¶éƒ¨ä½ç½®æ˜¯ mCurrentTargetOffsetTop ï¼ŒmCurrentTargetOffsetTop åˆå§‹è·ç¦»æ˜¯<code>-mCircleView.getMeasuredHeight()</code>ï¼Œæ‰€ä»¥æ˜¯åœ¨ SwipeRefreshLayout å¤–ã€‚</p>
<blockquote>
<p>ç»è¿‡ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ï¼ŒSwipeRefreshLayout åˆ›å»ºäº†å­è§†å›¾ï¼Œç¡®å®šä»–ä»¬çš„å¤§å°ã€ä½ç½®ï¼Œç°åœ¨æ‰€æœ‰è§†å›¾å¯ä»¥æ˜¾ç¤ºåœ¨ç•Œé¢äº†ã€‚</p>
</blockquote>
<h3 id="å¤„ç†ä¸å­è§†å›¾çš„æ»šåŠ¨äº¤äº’"><a href="#å¤„ç†ä¸å­è§†å›¾çš„æ»šåŠ¨äº¤äº’" class="headerlink" title="å¤„ç†ä¸å­è§†å›¾çš„æ»šåŠ¨äº¤äº’"></a>å¤„ç†ä¸å­è§†å›¾çš„æ»šåŠ¨äº¤äº’</h3><p>ä¸‹æ‹‰åˆ·æ–°æ§ä»¶çš„ä¸»è¦åŠŸèƒ½æ˜¯å½“å­è§†å›¾ä¸‹æ‹‰åˆ°æœ€é¡¶éƒ¨æ—¶ï¼Œç»§ç»­ä¸‹æ‹‰å¯ä»¥å‡ºç°åˆ·æ–°åŠ¨ç”»ã€‚è€Œå­è§†å›¾å¯ä»¥æ»šåŠ¨æ—¶éœ€è¦å°†æ‰€æœ‰æ»šåŠ¨äº‹ä»¶éƒ½äº¤ç»™å­è§†å›¾ã€‚å€ŸåŠ© Android æä¾›çš„ NestedScrolling æœºåˆ¶ï¼Œä½¿å¾— SwipeRefreshLayout å¾ˆè½»æ¾çš„è§£å†³äº†ä¸å­è§†å›¾çš„æ»šåŠ¨å†²çªé—®é¢˜ã€‚<br>SwipeRefreshLayout é€šè¿‡å®ç° <code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code> æ¥å£æ¥å¤„ç†æ»šåŠ¨å†²çªã€‚SwipeRefreshLayout ä½œä¸º Parent åµŒå¥—ä¸€ä¸ªå¯ä»¥æ»šåŠ¨çš„å­è§†å›¾ï¼Œé‚£ä¹ˆå°±éœ€è¦äº†è§£ä¸€ä¸‹ NestedScrollingParent æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> å½“ä½ å¸Œæœ›è‡ªå·±çš„è‡ªå®šä¹‰å¸ƒå±€æ”¯æŒåµŒå¥—å­è§†å›¾å¹¶ä¸”å¤„ç†æ»šåŠ¨æ“ä½œï¼Œå°±å¯ä»¥å®ç°è¯¥æ¥å£ã€‚</div><div class="line"> å®ç°è¿™ä¸ªæ¥å£åå¯ä»¥åˆ›å»ºä¸€ä¸ª NestedScrollingParentHelper å­—æ®µï¼Œä½¿ç”¨å®ƒæ¥å¸®åŠ©ä½ å¤„ç†å¤§éƒ¨åˆ†çš„æ–¹æ³•ã€‚</div><div class="line"> å¤„ç†åµŒå¥—çš„æ»šåŠ¨æ—¶åº”è¯¥ä½¿ç”¨  `ViewCompat`ï¼Œ`ViewGroupCompat`æˆ–`ViewParentCompat` ä¸­çš„æ–¹æ³•æ¥å¤„ç†ï¼Œè¿™æ˜¯ä¸€äº›å…¼å®¹åº“ï¼Œ</div><div class="line"> ä»–ä»¬ä¿è¯ Android 5.0ä¹‹å‰çš„å…¼å®¹æ€§å«ç‰‡çš„é™æ€æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å…¼å®¹ Android 5.0 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NestedScrollingParent</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å½“å­è§†å›¾è°ƒç”¨ startNestedScroll(View, int) åè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¿”å› true è¡¨ç¤ºå“åº”å­è§†å›¾çš„æ»šåŠ¨ã€‚</div><div class="line">     * å®ç°è¿™ä¸ªæ–¹æ³•æ¥å£°æ˜æ”¯æŒåµŒå¥—æ»šåŠ¨ï¼Œå¦‚æœè¿”å› trueï¼Œé‚£ä¹ˆè¿™ä¸ªè§†å›¾å°†è¦é…åˆå­è§†å›¾åµŒå¥—æ»šåŠ¨ã€‚å½“åµŒå¥—æ»šåŠ¨ç»“æŸæ—¶ä¼šè°ƒç”¨åˆ° onStopNestedScroll(View)ã€‚</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> child å¯æ»šåŠ¨çš„å­è§†å›¾</div><div class="line">     * <span class="doctag">@param</span> target NestedScrollingParent çš„ç›´æ¥å¯æ»šåŠ¨çš„è§†å›¾ï¼Œä¸€èˆ¬æƒ…å†µå°±æ˜¯ child</div><div class="line">     * <span class="doctag">@param</span> nestedScrollAxes åŒ…å« ViewCompat#SCROLL_AXIS_HORIZONTAL, ViewCompat#SCROLL_AXIS_VERTICAL æˆ–è€…ä¸¤ä¸ªå€¼éƒ½æœ‰ã€‚</div><div class="line">     * <span class="doctag">@return</span> è¿”å› true è¡¨ç¤ºå“åº”å­è§†å›¾çš„æ»šåŠ¨ã€‚</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(View child, View target, <span class="keyword">int</span> nestedScrollAxes)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å¦‚æœ onStartNestedScroll è¿”å› true ï¼Œç„¶åèµ°è¯¥æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œå¯ä»¥åšä¸€äº›åˆå§‹åŒ–ã€‚</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScrollAccepted</span><span class="params">(View child, View target, <span class="keyword">int</span> nestedScrollAxes)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å­è§†å›¾å¼€å§‹æ»šåŠ¨å‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ—¶å€™çˆ¶å¸ƒå±€ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çš„ NestedScrollingParent çš„å®ç°ç±»ï¼‰å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥é…åˆå­è§†å›¾åŒæ—¶å¤„ç†æ»šåŠ¨äº‹ä»¶ã€‚</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> target æ»šåŠ¨çš„å­è§†å›¾</div><div class="line">     * <span class="doctag">@param</span> dx ç»å¯¹å€¼ä¸ºæ‰‹æŒ‡åœ¨xæ–¹å‘æ»šåŠ¨çš„è·ç¦»ï¼Œdx&lt;0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘å³æ»šåŠ¨</div><div class="line">     * <span class="doctag">@param</span> dy ç»å¯¹å€¼ä¸ºæ‰‹æŒ‡åœ¨yæ–¹å‘æ»šåŠ¨çš„è·ç¦»ï¼Œdy&lt;0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘ä¸‹æ»šåŠ¨</div><div class="line">     * <span class="doctag">@param</span> consumed ä¸€ä¸ªæ•°ç»„ï¼Œå€¼ç”¨æ¥è¡¨ç¤ºçˆ¶å¸ƒå±€æ¶ˆè€—äº†å¤šå°‘è·ç¦»ï¼Œæœªæ¶ˆè€—å‰ä¸º[0,0], å¦‚æœçˆ¶å¸ƒå±€æƒ³å¤„ç†æ»šåŠ¨äº‹ä»¶ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­ä¸ºconsumed[0]ï¼Œconsumed[1]èµ‹å€¼ã€‚</div><div class="line">     *                 åˆ†åˆ«è¡¨ç¤ºxå’Œyæ–¹å‘æ¶ˆè€—çš„è·ç¦»ã€‚å¦‚çˆ¶å¸ƒå±€æƒ³åœ¨ç«–ç›´æ–¹å‘ï¼ˆyï¼‰å®Œå…¨æ‹¦æˆªå­è§†å›¾ï¼Œé‚£ä¹ˆè®© consumed[1] = dyï¼Œå°±æŠŠæ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸äº‹ä»¶ç»™æ‹¦æˆªäº†ï¼Œå­è§†å›¾ä¾¿å“åº”ä¸åˆ°è§¦æ‘¸äº‹ä»¶äº† ã€‚</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedPreScroll</span><span class="params">(View target, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">     * è¿™ä¸ªæ–¹æ³•è¡¨ç¤ºå­è§†å›¾æ­£åœ¨æ»šåŠ¨ï¼Œå¹¶ä¸”æŠŠæ»šåŠ¨è·ç¦»å›è°ƒç”¨åˆ°è¯¥æ–¹æ³•ï¼Œå‰ææ˜¯ onStartNestedScroll è¿”å›äº† trueã€‚</div><div class="line">     * &lt;p&gt;Both the consumed and unconsumed portions of the scroll distance are reported to the</div><div class="line">     * ViewParent. An implementation may choose to use the consumed portion to match or chase scroll</div><div class="line">     * position of multiple child elements, for example. The unconsumed portion may be used to</div><div class="line">     * allow continuous dragging of multiple scrolling or draggable elements, such as scrolling</div><div class="line">     * a list within a vertical drawer where the drawer begins dragging once the edge of inner</div><div class="line">     * scrolling content is reached.&lt;/p&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> target æ»šåŠ¨çš„å­è§†å›¾</div><div class="line">     * <span class="doctag">@param</span> dxConsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œå­è§†å›¾æ¶ˆè€—çš„xæ–¹å‘çš„è·ç¦»</div><div class="line">     * <span class="doctag">@param</span> dyConsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œå­è§†å›¾æ¶ˆè€—çš„yæ–¹å‘çš„è·ç¦» ï¼Œå¦‚æœ onNestedPreScroll ä¸­ dy = 20ï¼Œ consumed[0] = 8ï¼Œé‚£ä¹ˆ dy = 12</div><div class="line">      * <span class="doctag">@param</span> dxUnconsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œæœªè¢«å­è§†å›¾æ¶ˆè€—çš„xæ–¹å‘çš„è·ç¦»</div><div class="line">     * <span class="doctag">@param</span> dyUnconsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œæœªè¢«å­è§†å›¾æ¶ˆè€—çš„yæ–¹å‘çš„è·ç¦»</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(View target, <span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed,<span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å“åº”åµŒå¥—æ»šåŠ¨ç»“æŸ</div><div class="line">     *</div><div class="line">     * å½“ä¸€ä¸ªåµŒå¥—æ»šåŠ¨ç»“æŸåï¼ˆå¦‚MotionEvent#ACTION_UPï¼Œ MotionEvent#ACTION_CANCELï¼‰ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¯æœ‰åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚å˜é‡é‡ç½®</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopNestedScroll</span><span class="params">(View target)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ‰‹æŒ‡åœ¨å±å¹•å¿«é€Ÿæ»‘è§¦å‘Flingå‰å›è°ƒï¼Œå¦‚æœå‰é¢ onNestedPreScroll ä¸­çˆ¶å¸ƒå±€æ¶ˆè€—äº†äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªä¹Ÿä¼šè¢«è§¦å‘</div><div class="line">     * è¿”å›trueè¡¨ç¤ºçˆ¶å¸ƒå±€å®Œå…¨å¤„ç† fling äº‹ä»¶</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> target æ»šåŠ¨çš„å­è§†å›¾</div><div class="line">     * <span class="doctag">@param</span> velocityX xæ–¹å‘çš„é€Ÿåº¦ï¼ˆpx/sï¼‰</div><div class="line">     * <span class="doctag">@param</span> velocityY yæ–¹å‘çš„é€Ÿåº¦</div><div class="line">     * <span class="doctag">@return</span> true if this parent consumed the fling ahead of the target view</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedPreFling</span><span class="params">(View target, <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å­è§†å›¾fling æ—¶å›è°ƒï¼Œçˆ¶å¸ƒå±€å¯ä»¥é€‰æ‹©ç›‘å¬å­è§†å›¾çš„ flingã€‚</div><div class="line">     * true è¡¨ç¤ºçˆ¶å¸ƒå±€å¤„ç† flingï¼Œfalseè¡¨ç¤ºçˆ¶å¸ƒå±€ç›‘å¬å­è§†å›¾çš„fling</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> target View that initiated the nested scroll</div><div class="line">     * <span class="doctag">@param</span> velocityX Horizontal velocity in pixels per second</div><div class="line">     * <span class="doctag">@param</span> velocityY Vertical velocity in pixels per second</div><div class="line">     * <span class="doctag">@param</span> consumed true è¡¨ç¤ºå­è§†å›¾å¤„ç†äº†fling</div><div class="line"></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedFling</span><span class="params">(View target, <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY, <span class="keyword">boolean</span> consumed)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¿”å›å½“å‰ NestedScrollingParent çš„æ»šåŠ¨æ–¹å‘ï¼Œ</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     * <span class="doctag">@see</span> ViewCompat#SCROLL_AXIS_HORIZONTAL</div><div class="line">     * <span class="doctag">@see</span> ViewCompat#SCROLL_AXIS_VERTICAL</div><div class="line">     * <span class="doctag">@see</span> ViewCompat#SCROLL_AXIS_NONE</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNestedScrollAxes</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹ SwipeRefreshLayout å®ç° NestedScrollingParent çš„ç›¸å…³æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NestedScrollingParent</span></div><div class="line"></div><div class="line"><span class="comment">// å­ View ï¼ˆNestedScrollingChildï¼‰å¼€å§‹æ»šåŠ¨å‰å›è°ƒæ­¤æ–¹æ³•,è¿”å› true è¡¨ç¤ºæ¥ Parent æ”¶åµŒå¥—æ»šåŠ¨ï¼Œç„¶åè°ƒç”¨ onNestedScrollAccepted</span></div><div class="line"><span class="comment">// å…·ä½“å¯ä»¥çœ‹ NestedScrollingChildHelper çš„æºç </span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(View child, View target, <span class="keyword">int</span> nestedScrollAxes)</span> </span>&#123;</div><div class="line">    <span class="comment">// å­ View å›è°ƒï¼Œåˆ¤æ–­æ˜¯å¦å¼€å§‹åµŒå¥—æ»šåŠ¨ ï¼Œ</span></div><div class="line">    <span class="keyword">return</span> isEnabled() &amp;&amp; !mReturningToStart &amp;&amp; !mRefreshing</div><div class="line">            &amp;&amp; (nestedScrollAxes &amp; ViewCompat.SCROLL_AXIS_VERTICAL) != <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScrollAccepted</span><span class="params">(View child, View target, <span class="keyword">int</span> axes)</span> </span>&#123;</div><div class="line">     <span class="comment">// Reset the counter of how much leftover scroll needs to be consumed.</span></div><div class="line">     mNestedScrollingParentHelper.onNestedScrollAccepted(child, target, axes);</div><div class="line"></div><div class="line">     <span class="comment">// ...çœç•¥ä»£ç </span></div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>SwipeRefreshLayout åªæ¥å—ç«–ç›´æ–¹å‘ï¼ˆYè½´ï¼‰çš„æ»šåŠ¨ï¼Œå¹¶ä¸”åœ¨åˆ·æ–°åŠ¨ç”»è¿›è¡Œä¸­ä¸æ¥å—æ»šåŠ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NestedScrollingChild åœ¨æ»šåŠ¨çš„æ—¶å€™ä¼šè§¦å‘ï¼Œ çœ‹çˆ¶ç±»æ¶ˆè€—äº†å¤šå°‘è·ç¦»</span></div><div class="line"><span class="comment">//   * @param dx x è½´æ»šåŠ¨çš„è·ç¦»</span></div><div class="line"><span class="comment">//   * @param dy y è½´æ»šåŠ¨çš„è·ç¦»</span></div><div class="line"><span class="comment">//   * @param consumed ä»£è¡¨ çˆ¶ View æ¶ˆè´¹çš„æ»šåŠ¨è·ç¦»</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedPreScroll</span><span class="params">(View target, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// dy &gt; 0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘ä¸Šç§»åŠ¨</span></div><div class="line">    <span class="comment">//  mTotalUnconsumed è¡¨ç¤ºå­è§†å›¾Yè½´æœªæ¶ˆè´¹çš„è·ç¦»</span></div><div class="line">    <span class="comment">// ç°åœ¨è¡¨ç¤º</span></div><div class="line">    <span class="keyword">if</span> (dy &gt; <span class="number">0</span> &amp;&amp; mTotalUnconsumed &gt; <span class="number">0</span>) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (dy &gt; mTotalUnconsumed) &#123;</div><div class="line">            consumed[<span class="number">1</span>] = dy - (<span class="keyword">int</span>) mTotalUnconsumed; <span class="comment">// SwipeRefreshLayout å°±å§å­è§†å›¾ä½æ¶ˆè´¹çš„è·ç¦»å…¨éƒ¨æ¶ˆè´¹äº†ã€‚</span></div><div class="line">            mTotalUnconsumed = <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mTotalUnconsumed -= dy; <span class="comment">// æ¶ˆè´¹çš„ y è½´çš„è·ç¦»</span></div><div class="line">            consumed[<span class="number">1</span>] = dy;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// å‡ºç°åŠ¨ç”»åœ†åœˆï¼Œå¹¶å‘ä¸Šç§»åŠ¨</span></div><div class="line">        moveSpinner(mTotalUnconsumed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// onStartNestedScroll è¿”å› true æ‰ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¡¨ç¤ºå­Viewå°†æ»šåŠ¨äº‹ä»¶åˆ†å‘åˆ°çˆ¶ Viewï¼ˆSwipeRefreshLayoutï¼‰</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(<span class="keyword">final</span> View target, <span class="keyword">final</span> <span class="keyword">int</span> dxConsumed, <span class="keyword">final</span> <span class="keyword">int</span> dyConsumed,</span></span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> dxUnconsumed, <span class="keyword">final</span> <span class="keyword">int</span> dyUnconsumed) &#123;</div><div class="line">    <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line"></div><div class="line">    <span class="comment">// This is a bit of a hack. Nested scrolling works from the bottom up, and as we are</span></div><div class="line">    <span class="comment">// sometimes between two nested scrolling views, we need a way to be able to know when any</span></div><div class="line">    <span class="comment">// nested scrolling parent has stopped handling events. We do that by using the</span></div><div class="line">    <span class="comment">// 'offset in window 'functionality to see if we have been moved from the event.</span></div><div class="line">    <span class="comment">// This is a decent indication of whether we should take over the event stream or not.</span></div><div class="line">    <span class="comment">// æ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘ä¸‹æ»šåŠ¨ï¼Œå¹¶ä¸”å­è§†å›¾ä¸å¯ä»¥æ»šåŠ¨</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> dy = dyUnconsumed + mParentOffsetInWindow[<span class="number">1</span>];</div><div class="line">    <span class="keyword">if</span> (dy &lt; <span class="number">0</span> &amp;&amp; !canChildScrollUp()) &#123;</div><div class="line">        mTotalUnconsumed += Math.abs(dy);</div><div class="line">        moveSpinner(mTotalUnconsumed);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SwipeRefreshLayout é€šè¿‡ NestedScrollingParent æ¥å£å®Œæˆäº†å¤„ç†å­è§†å›¾çš„æ»šåŠ¨çš„å†²çªï¼Œä¸­é—´çœç•¥äº†ä¸€äº› SwipeRefreshLayoutä½œä¸º child çš„ç›¸å…³ä»£ç ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ºäº†å…¼å®¹å°† SwipeRefreshLayout ä½œä¸ºå­è§†å›¾æ”¾åœ¨çŸ¥è¯†åµŒå¥—æ»šåŠ¨çš„çˆ¶å¸ƒå±€çš„æƒ…å†µï¼Œè¿™é‡Œä¸åšæ·±å…¥è®¨è®ºã€‚ä½†æ˜¯ä¸‹æ‹‰åˆ·æ–°éœ€è¦åˆ¤æ–­æ‰‹æŒ‡åœ¨å±å¹•çš„çŠ¶æ€æ¥è¿›è¡Œä¸€ä¸ªåˆ·æ–°çš„åŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ¤æ–­æ‰‹æŒ‡åœ¨å±å¹•ä¸­çš„çŠ¶æ€ã€‚</p>
<p>é¦–å…ˆæ˜¯ onInterceptTouchEventï¼Œè¿”å› true è¡¨ç¤ºæ‹¦æˆªè§¦æ‘¸äº‹ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">    ensureTarget();</div><div class="line"></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> action = MotionEventCompat.getActionMasked(ev);</div><div class="line"></div><div class="line">    <span class="comment">// æ‰‹æŒ‡æŒ‰ä¸‹æ—¶æ¢å¤çŠ¶æ€</span></div><div class="line">    <span class="keyword">if</span> (mReturningToStart &amp;&amp; action == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">        mReturningToStart = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// æ§ä»¶å¯ç”¨ || åˆ·æ–°äº‹ä»¶åˆšç»“æŸæ­£åœ¨æ¢å¤åˆå§‹çŠ¶æ€æ—¶ || å­ View å¯æ»šåŠ¨ || æ­£åœ¨åˆ·æ–° || çˆ¶ View æ­£åœ¨æ»šåŠ¨</span></div><div class="line">    <span class="keyword">if</span> (!isEnabled() || mReturningToStart || canChildScrollUp()</div><div class="line">            || mRefreshing || mNestedScrollInProgress) &#123;</div><div class="line">        <span class="comment">// Fail fast if we're not in a state where a swipe is possible</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">switch</span> (action) &#123;</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">            setTargetOffsetTopAndBottom(mOriginalOffsetTop - mCircleView.getTop(), <span class="keyword">true</span>);</div><div class="line">            mActivePointerId = MotionEventCompat.getPointerId(ev, <span class="number">0</span>);</div><div class="line">            mIsBeingDragged = <span class="keyword">false</span>;</div><div class="line">            <span class="comment">// è®°å½•æ‰‹æŒ‡æŒ‰ä¸‹çš„ä½ç½®ï¼Œä¸ºäº†åˆ¤æ–­æ˜¯å¦å¼€å§‹æ»šåŠ¨</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> initialDownY = getMotionEventY(ev, mActivePointerId);</div><div class="line">            <span class="keyword">if</span> (initialDownY == -<span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">            mInitialDownY = initialDownY;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">            <span class="keyword">if</span> (mActivePointerId == INVALID_POINTER) &#123;</div><div class="line">                Log.e(LOG_TAG, <span class="string">"Got ACTION_MOVE event but don't have an active pointer id."</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> y = getMotionEventY(ev, mActivePointerId);</div><div class="line">            <span class="keyword">if</span> (y == -<span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// åˆ¤æ–­å½“æ‹–åŠ¨è·ç¦»å¤§äºæœ€å°è·ç¦»æ—¶è®¾ç½® mIsBeingDragged = true;</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> yDiff = y - mInitialDownY;</div><div class="line">            <span class="keyword">if</span> (yDiff &gt; mTouchSlop &amp;&amp; !mIsBeingDragged) &#123;</div><div class="line">                mInitialMotionY = mInitialDownY + mTouchSlop;</div><div class="line">                mIsBeingDragged = <span class="keyword">true</span>;</div><div class="line">                <span class="comment">// æ­£åœ¨æ‹–åŠ¨çŠ¶æ€ï¼Œæ›´æ–°åœ†åœˆçš„ progressbar çš„ alpha å€¼</span></div><div class="line">                mProgress.setAlpha(STARTING_PROGRESS_ALPHA);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_UP:</div><div class="line">            onSecondaryPointerUp(ev);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">            mIsBeingDragged = <span class="keyword">false</span>;</div><div class="line">            mActivePointerId = INVALID_POINTER;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> mIsBeingDragged;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æºç ä¹Ÿå°±æ˜¯è¿›è¡Œç®€å•å¤„ç†ï¼ŒDOWN çš„æ—¶å€™è®°å½•ä¸€ä¸‹ä½ç½®ï¼ŒMOVE æ—¶åˆ¤æ–­ç§»åŠ¨çš„è·ç¦»ï¼Œè¿”å›å€¼ mIsBeingDragged ä¸º true æ—¶ï¼Œ å³ onInterceptTouchEvent è¿”å›trueï¼ŒSwipeRefreshLayout æ‹¦æˆªè§¦æ‘¸äº‹ä»¶ï¼Œä¸åˆ†å‘ç»™ mTargetï¼Œç„¶åæŠŠ MotionEvent ä¼ ç»™ onTouchEvent æ–¹æ³•ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªåˆ¤æ–­å­Viewçš„æ˜¯å¦è¿˜å¯ä»¥æ»šåŠ¨çš„æ–¹æ³• <code>canChildScrollUp</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@return</span> Whether it is possible for the child view of this layout to</div><div class="line"> *         scroll up. Override this if the child view is a custom view.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canChildScrollUp</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &lt; <span class="number">14</span>) &#123;</div><div class="line">        <span class="comment">// åˆ¤æ–­ AbsListView çš„å­ç±» ListView æˆ–è€… GridView ç­‰</span></div><div class="line">        <span class="keyword">if</span> (mTarget <span class="keyword">instanceof</span> AbsListView) &#123;</div><div class="line">            <span class="keyword">final</span> AbsListView absListView = (AbsListView) mTarget;</div><div class="line">            <span class="keyword">return</span> absListView.getChildCount() &gt; <span class="number">0</span></div><div class="line">                    &amp;&amp; (absListView.getFirstVisiblePosition() &gt; <span class="number">0</span> || absListView.getChildAt(<span class="number">0</span>)</div><div class="line">                            .getTop() &lt; absListView.getPaddingTop());</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> ViewCompat.canScrollVertically(mTarget, -<span class="number">1</span>) || mTarget.getScrollY() &gt; <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> ViewCompat.canScrollVertically(mTarget, -<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“SwipeRefreshLayout æ‹¦æˆªäº†è§¦æ‘¸äº‹ä»¶ä¹‹åï¼ˆ mIsBeingDragged ä¸º true ï¼‰ï¼Œå°† MotionEvent äº¤ç»™ onTouchEvent å¤„ç†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line">    <span class="keyword">switch</span> (action) &#123;</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">            <span class="comment">// è·å–ç¬¬ä¸€ä¸ªæŒ‰ä¸‹çš„æ‰‹æŒ‡</span></div><div class="line">            mActivePointerId = MotionEventCompat.getPointerId(ev, <span class="number">0</span>);</div><div class="line">            mIsBeingDragged = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE: &#123;</div><div class="line">            <span class="comment">// å¤„ç†å¤šæŒ‡è§¦æ§</span></div><div class="line">            pointerIndex = MotionEventCompat.findPointerIndex(ev, mActivePointerId);</div><div class="line"></div><div class="line">            <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line"></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> y = MotionEventCompat.getY(ev, pointerIndex);</div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> overscrollTop = (y - mInitialMotionY) * DRAG_RATE;</div><div class="line">            <span class="keyword">if</span> (mIsBeingDragged) &#123;</div><div class="line">                <span class="keyword">if</span> (overscrollTop &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="comment">// æ­£åœ¨æ‹–åŠ¨çŠ¶æ€ï¼Œæ›´æ–°åœ†åœˆçš„ä½ç½®</span></div><div class="line">                    moveSpinner(overscrollTop);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP: &#123;</div><div class="line">            pointerIndex = MotionEventCompat.findPointerIndex(ev, mActivePointerId);</div><div class="line">            <span class="keyword">if</span> (pointerIndex &lt; <span class="number">0</span>) &#123;</div><div class="line">                Log.e(LOG_TAG, <span class="string">"Got ACTION_UP event but don't have an active pointer id."</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> y = MotionEventCompat.getY(ev, pointerIndex);</div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span> overscrollTop = (y - mInitialMotionY) * DRAG_RATE;</div><div class="line">            mIsBeingDragged = <span class="keyword">false</span>;</div><div class="line">            <span class="comment">// æ‰‹æŒ‡æ¾å¼€ï¼Œå°†åœ†åœˆç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®</span></div><div class="line">            finishSpinner(overscrollTop);</div><div class="line">            mActivePointerId = INVALID_POINTER;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// ... çœç•¥ä»£ç </span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨æ‰‹æŒ‡æ»šåŠ¨è¿‡ç¨‹ä¸­é€šè¿‡åˆ¤æ–­ mIsBeingDragged æ¥ç§»åŠ¨åˆ·æ–°çš„åœ†åœˆï¼ˆå¯¹åº”çš„æ˜¯ moveSpinner ï¼‰ï¼Œæ‰‹æŒ‡æ¾å¼€å°†åœ†åœˆç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®ï¼ˆåˆå§‹ä½ç½®æˆ–è€…åˆ·æ–°åŠ¨ç”»çš„ä½ç½®ï¼Œå¯¹åº”çš„æ˜¯ finishSpinner æ–¹æ³•ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ‰‹æŒ‡ä¸‹æ‹‰è¿‡ç¨‹ä¸­è§¦å‘çš„åœ†åœˆçš„å˜åŒ–è¿‡ç¨‹ï¼Œé€æ˜åº¦å˜åŒ–ï¼Œæ¸æ¸å‡ºç°ç®­å¤´ï¼Œå¤§å°çš„å˜åŒ–</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moveSpinner</span><span class="params">(<span class="keyword">float</span> overscrollTop)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// è®¾ç½®ä¸ºæœ‰ç®­å¤´çš„ progress</span></div><div class="line">    mProgress.showArrow(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// è¿›åº¦è½¬åŒ–æˆç™¾åˆ†æ¯”</span></div><div class="line">    <span class="keyword">float</span> originalDragPercent = overscrollTop / mTotalDragDistance;</div><div class="line"></div><div class="line">    <span class="comment">// é¿å…ç™¾åˆ†æ¯”è¶…è¿‡ 100%</span></div><div class="line">    <span class="keyword">float</span> dragPercent = Math.min(<span class="number">1f</span>, Math.abs(originalDragPercent));</div><div class="line">    <span class="comment">// è°ƒæ•´æ‹–åŠ¨ç™¾åˆ†æ¯”ï¼Œé€ æˆè§†å·®æ•ˆæœ</span></div><div class="line">    <span class="keyword">float</span> adjustedPercent = (<span class="keyword">float</span>) Math.max(dragPercent - .<span class="number">4</span>, <span class="number">0</span>) * <span class="number">5</span> / <span class="number">3</span>;</div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keyword">float</span> extraOS = Math.abs(overscrollTop) - mTotalDragDistance;</div><div class="line"></div><div class="line">    <span class="comment">// è¿™é‡ŒmUsingCustomStart ä¸º true ä»£è¡¨ç”¨æˆ·è‡ªå®šä¹‰äº†èµ·å§‹å‡ºç°çš„åæ ‡</span></div><div class="line">    <span class="keyword">float</span> slingshotDist = mUsingCustomStart ? mSpinnerFinalOffset - mOriginalOffsetTop</div><div class="line">            : mSpinnerFinalOffset;</div><div class="line"></div><div class="line">    <span class="comment">// å¼¹æ€§ç³»æ•°</span></div><div class="line">    <span class="keyword">float</span> tensionSlingshotPercent = Math.max(<span class="number">0</span>, Math.min(extraOS, slingshotDist * <span class="number">2</span>)</div><div class="line">            / slingshotDist);</div><div class="line">    <span class="keyword">float</span> tensionPercent = (<span class="keyword">float</span>) ((tensionSlingshotPercent / <span class="number">4</span>) - Math.pow(</div><div class="line">            (tensionSlingshotPercent / <span class="number">4</span>), <span class="number">2</span>)) * <span class="number">2f</span>;</div><div class="line">    <span class="keyword">float</span> extraMove = (slingshotDist) * tensionPercent * <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="comment">// å› ä¸ºæœ‰å¼¹æ€§ç³»æ•°ï¼Œä¸åŒçš„æ‰‹æŒ‡æ»šåŠ¨è·ç¦»ä¸åŒäºviewçš„ç§»åŠ¨è·ç¦»</span></div><div class="line">    <span class="keyword">int</span> targetY = mOriginalOffsetTop + (<span class="keyword">int</span>) ((slingshotDist * dragPercent) + extraMove);</div><div class="line"></div><div class="line">    <span class="comment">// where 1.0f is a full circle</span></div><div class="line">    <span class="keyword">if</span> (mCircleView.getVisibility() != View.VISIBLE) &#123;</div><div class="line">        mCircleView.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è®¾ç½®çš„æ˜¯å¦æœ‰ç¼©æ”¾</span></div><div class="line">    <span class="keyword">if</span> (!mScale) &#123;</div><div class="line">        ViewCompat.setScaleX(mCircleView, <span class="number">1f</span>);</div><div class="line">        ViewCompat.setScaleY(mCircleView, <span class="number">1f</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è®¾ç½®ç¼©æ”¾è¿›åº¦</span></div><div class="line">    <span class="keyword">if</span> (mScale) &#123;</div><div class="line">        setAnimationProgress(Math.min(<span class="number">1f</span>, overscrollTop / mTotalDragDistance));</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ç§»åŠ¨è·ç¦»æœªè¾¾åˆ°æœ€å¤§è·ç¦»</span></div><div class="line">    <span class="keyword">if</span> (overscrollTop &lt; mTotalDragDistance) &#123;</div><div class="line">        <span class="keyword">if</span> (mProgress.getAlpha() &gt; STARTING_PROGRESS_ALPHA</div><div class="line">                &amp;&amp; !isAnimationRunning(mAlphaStartAnimation)) &#123;</div><div class="line">            <span class="comment">// Animate the alpha</span></div><div class="line">            startProgressAlphaStartAnimation();</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (mProgress.getAlpha() &lt; MAX_ALPHA &amp;&amp; !isAnimationRunning(mAlphaMaxAnimation)) &#123;</div><div class="line">            <span class="comment">// Animate the alpha</span></div><div class="line">            startProgressAlphaMaxAnimation();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å‡ºç°çš„è¿›åº¦ï¼Œè£å‰ª mProgress</span></div><div class="line">    <span class="keyword">float</span> strokeStart = adjustedPercent * .<span class="number">8f</span>;</div><div class="line">    mProgress.setStartEndTrim(<span class="number">0f</span>, Math.min(MAX_PROGRESS_ANGLE, strokeStart));</div><div class="line">    mProgress.setArrowScale(Math.min(<span class="number">1f</span>, adjustedPercent));</div><div class="line"></div><div class="line">    <span class="comment">// æ—‹è½¬</span></div><div class="line">    <span class="keyword">float</span> rotation = (-<span class="number">0.25f</span> + .<span class="number">4f</span> * adjustedPercent + tensionPercent * <span class="number">2</span>) * .<span class="number">5f</span>;</div><div class="line">    mProgress.setProgressRotation(rotation);</div><div class="line">    setTargetOffsetTopAndBottom(targetY - mCurrentTargetOffsetTop, <span class="keyword">true</span> <span class="comment">/* requires update */</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ·æ–°åœ†åœˆçš„ç§»åŠ¨è¿‡ç¨‹ä¹Ÿæ˜¯æœ‰å¥½å‡ ç§çŠ¶æ€ï¼Œçœ‹ä¸Šé¢çš„æ³¨é‡ŠåŸºæœ¬ä¸Šå°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishSpinner</span><span class="params">(<span class="keyword">float</span> overscrollTop)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (overscrollTop &gt; mTotalDragDistance) &#123;</div><div class="line">        <span class="comment">//ç§»åŠ¨è·ç¦»è¶…è¿‡äº†åˆ·æ–°çš„ä¸´ç•Œå€¼ï¼Œè§¦å‘åˆ·æ–°åŠ¨ç”»</span></div><div class="line">        setRefreshing(<span class="keyword">true</span>, <span class="keyword">true</span> <span class="comment">/* notify */</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// å–æ¶ˆåˆ·æ–°çš„åœ†åœˆï¼Œå°†åœ†åœˆç§»åŠ¨åˆ°åˆå§‹ä½ç½®</span></div><div class="line">        mRefreshing = <span class="keyword">false</span>;</div><div class="line">        mProgress.setStartEndTrim(<span class="number">0f</span>, <span class="number">0f</span>);</div><div class="line">        <span class="comment">// ...çœç•¥ä»£ç </span></div><div class="line"></div><div class="line">        <span class="comment">// ç§»åŠ¨åˆ°åˆå§‹ä½ç½®</span></div><div class="line">        animateOffsetToStartPosition(mCurrentTargetOffsetTop, listener);</div><div class="line">        <span class="comment">// è®¾ç½®æ²¡æœ‰ç®­å¤´</span></div><div class="line">        mProgress.showArrow(<span class="keyword">false</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è°ƒç”¨ setRefresh(true,true) æ–¹æ³•è§¦å‘åˆ·æ–°åŠ¨ç”»å¹¶è¿›è¡Œå›è°ƒï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯ private çš„ã€‚å‰é¢æåˆ°æˆ‘ä»¬è‡ªå·±è°ƒç”¨ setRefresh(true) åªèƒ½äº§ç”ŸåŠ¨ç”»ï¼Œè€Œä¸èƒ½å›è°ƒåˆ·æ–°å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„è°ƒç”¨ 2 ä¸ªå‚æ•°çš„ setRefresh å‡½æ•°ã€‚ æˆ–è€…æ‰‹åŠ¨è°ƒ setRefreshing(true)+ OnRefreshListener.onRefresh æ–¹æ³•ã€‚</p>
<h3 id="setRefresh"><a href="#setRefresh" class="headerlink" title="setRefresh"></a>setRefresh</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * æ”¹å˜åˆ·æ–°åŠ¨ç”»çš„çš„åœ†åœˆåˆ·æ–°çŠ¶æ€ã€‚Notify the widget that refresh state has changed. Do not call this when</div><div class="line">  * refresh is triggered by a swipe gesture.</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> refreshing æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°çš„åœ†åœˆ</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRefreshing</span><span class="params">(<span class="keyword">boolean</span> refreshing)</span> </span>&#123;</div><div class="line">     <span class="keyword">if</span> (refreshing &amp;&amp; mRefreshing != refreshing) &#123;</div><div class="line">         <span class="comment">// scale and show</span></div><div class="line">         mRefreshing = refreshing;</div><div class="line">         <span class="keyword">int</span> endTarget = <span class="number">0</span>;</div><div class="line">         <span class="keyword">if</span> (!mUsingCustomStart) &#123;</div><div class="line">             endTarget = (<span class="keyword">int</span>) (mSpinnerFinalOffset + mOriginalOffsetTop);</div><div class="line">         &#125; <span class="keyword">else</span> &#123;</div><div class="line">             endTarget = (<span class="keyword">int</span>) mSpinnerFinalOffset;</div><div class="line">         &#125;</div><div class="line">         setTargetOffsetTopAndBottom(endTarget - mCurrentTargetOffsetTop,</div><div class="line">                 <span class="keyword">true</span> <span class="comment">/* requires update */</span>);</div><div class="line">         mNotify = <span class="keyword">false</span>;</div><div class="line">         startScaleUpAnimation(mRefreshListener);</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         setRefreshing(refreshing, <span class="keyword">false</span> <span class="comment">/* notify */</span>);</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>startScaleUpAnimation å¼€å¯ä¸€ä¸ªåŠ¨ç”»ï¼Œç„¶ååœ¨åŠ¨ç”»ç»“æŸåå›è°ƒ onRefresh æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Animation.AnimationListener mRefreshListener = <span class="keyword">new</span> Animation.AnimationListener() &#123;</div><div class="line">   <span class="comment">// .. çœç•¥ä»£ç </span></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mRefreshing) &#123;</div><div class="line">           mProgress.setAlpha(MAX_ALPHA); <span class="comment">//ç¡®ä¿åˆ·æ–°åœ†åœˆä¸­é—´çš„è¿›åº¦æ¡æ˜¯å®Œå…¨ä¸é€æ˜äº†</span></div><div class="line">           mProgress.start();</div><div class="line">           <span class="keyword">if</span> (mNotify) &#123; <span class="comment">// å½“ mNotify ä¸º true æ—¶æ‰ä¼šå›è°ƒ onRefresh</span></div><div class="line">               <span class="keyword">if</span> (mListener != <span class="keyword">null</span>) &#123;</div><div class="line">                   <span class="comment">// å›è°ƒ listener çš„ onRefresh æ–¹æ³•</span></div><div class="line">                   mListener.onRefresh();</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           mCurrentTargetOffsetTop = mCircleView.getTop();</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           reset();</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ†æ SwipeRefreshLayout çš„æµç¨‹å°±æ˜¯æŒ‰ç…§å¹³æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ <code>ViewGroup</code> çš„æµç¨‹ï¼Œä½†æ˜¯å…¶ä¸­ä¹Ÿæœ‰å¥½å¤šéœ€è¦æˆ‘ä»¬å€Ÿé‰´çš„åœ°æ–¹ï¼Œå¦‚ä½•ä½¿ç”¨ NestedScrollingç›¸å…³æœºåˆ¶ ï¼Œå¤šç‚¹è§¦æ§çš„å¤„ç†ï¼ŒonMeasure ä¸­å‡å»äº† paddingï¼Œå¦‚ä½•åˆ¤æ–­å­ View æ˜¯å¦å¯æ»šåŠ¨ï¼Œå¦‚ä½•ç¡®å®š ViewGroup ä¸­æŸä¸€ä¸ª View çš„ç´¢å¼•ç­‰ã€‚<br>æ­¤å¤–ï¼Œä¸€ä¸ªå¥½çš„ä¸‹æ‹‰åˆ·æ–°æ¡†æ¶ä¸ä»…ä»…è¦å…¼å®¹å„ç§æ»šåŠ¨çš„å­æ§ä»¶ï¼Œè¿˜è¦è€ƒè™‘è‡ªå·±è¦å…¼å®¹ NestedScrollingChild çš„æƒ…å†µï¼Œæ¯”å¦‚æ”¾åˆ° CooCoordinatorLayout çš„æƒ…å†µï¼Œç›®å‰å¤§å¤šæ•°å¼€æºçš„ä¸‹æ‹‰åˆ·æ–°å¥½åƒéƒ½æ²¡æœ‰è¾¾åˆ°è¿™ä¸ªè¦æ±‚ï¼Œä¸€èˆ¬éƒ½æ˜¯åªè€ƒè™‘äº†å†…éƒ¨åµŒå¥—æ»šåŠ¨å­è§†å›¾çš„æƒ…å†µï¼Œæ²¡æœ‰è€ƒè™‘è‡ªå·±ä½œä¸ºæ»šåŠ¨å­è§†å›¾çš„æƒ…å†µã€‚</p>
<blockquote>
<p>æ–‡ç« æ¥è‡ªï¼š <a href="http://hanks.pub">http://hanks.pub</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://developer.android.com/intl/zh-cn/reference/android/support/v4/widget/SwipeRefreshLayout.html&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SwipeRefreshLayout&lt;/code&gt; æ˜¯ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œå‡ ä¹å¯ä»¥åŒ…è£¹ä¸€ä¸ªä»»ä½•å¯ä»¥æ»šåŠ¨çš„å†…å®¹ï¼ˆListView GridView ScrollView RecyclerViewï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«å‚ç›´æ»šåŠ¨æ‰‹åŠ¿ã€‚ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://hanks.pub/tags/Android/"/>
    
      <category term="SwipeRefreshLayout" scheme="http://hanks.pub/tags/SwipeRefreshLayout/"/>
    
  </entry>
  
</feed>
